<!doctype html><html lang="en">
 <head>
  <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
  <meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport">
  <title>Open Screen Protocol</title>
  <meta content="w3c/ED" name="w3c-status">
  <link href="https://www.w3.org/StyleSheets/TR/2021/W3C-ED" rel="stylesheet">
  <meta content="Bikeshed version 4afc1fdf9, updated Tue May 28 15:43:17 2024 -0700" name="generator">
  <link href="https://w3c.github.io/openscreenprotocol/" rel="canonical">
  <meta content="4a988e39d8445284d867d21cf6d06a479627ec4b" name="revision">
  <meta content="dark light" name="color-scheme">
  <link href="https://www.w3.org/StyleSheets/TR/2021/dark.css" media="(prefers-color-scheme: dark)" rel="stylesheet" type="text/css">
<style>
.highlight .hll { background-color: #ffffcc }
.highlight .c { color: #999988; font-style: italic } /* Comment */
.highlight .err { color: #a61717; background-color: #e3d2d2 } /* Error */
.highlight .k { color: #000000; font-weight: bold } /* Keyword */
.highlight .o { color: #000000; font-weight: bold } /* Operator */
.highlight .cm { color: #999988; font-style: italic } /* Comment.Multiline */
.highlight .cp { color: #999999; font-weight: bold; font-style: italic } /* Comment.Preproc */
.highlight .c1 { color: #999988; font-style: italic } /* Comment.Single */
.highlight .cs { color: #999999; font-weight: bold; font-style: italic } /* Comment.Special */
.highlight .gd { color: #000000; background-color: #ffdddd } /* Generic.Deleted */
.highlight .ge { color: #000000; font-style: italic } /* Generic.Emph */
.highlight .gr { color: #aa0000 } /* Generic.Error */
.highlight .gh { color: #999999 } /* Generic.Heading */
.highlight .gi { color: #000000; background-color: #ddffdd } /* Generic.Inserted */
.highlight .go { color: #888888 } /* Generic.Output */
.highlight .gp { color: #555555 } /* Generic.Prompt */
.highlight .gs { font-weight: bold } /* Generic.Strong */
.highlight .gu { color: #aaaaaa } /* Generic.Subheading */
.highlight .gt { color: #aa0000 } /* Generic.Traceback */
.highlight .kc { color: #000000; font-weight: bold } /* Keyword.Constant */
.highlight .kd { color: #000000; font-weight: bold } /* Keyword.Declaration */
.highlight .kn { color: #000000; font-weight: bold } /* Keyword.Namespace */
.highlight .kp { color: #000000; font-weight: bold } /* Keyword.Pseudo */
.highlight .kr { color: #000000; font-weight: bold } /* Keyword.Reserved */
.highlight .kt { color: #445588; font-weight: bold } /* Keyword.Type */
.highlight .m { color: #009999 } /* Literal.Number */
.highlight .s { color: #d01040 } /* Literal.String */
.highlight .na { color: #008080 } /* Name.Attribute */
.highlight .nb { color: #0086B3 } /* Name.Builtin */
.highlight .nc { color: #445588; font-weight: bold } /* Name.Class */
.highlight .no { color: #008080 } /* Name.Constant */
.highlight .nd { color: #3c5d5d; font-weight: bold } /* Name.Decorator */
.highlight .ni { color: #800080 } /* Name.Entity */
.highlight .ne { color: #990000; font-weight: bold } /* Name.Exception */
.highlight .nf { color: #990000; font-weight: bold } /* Name.Function */
.highlight .nl { color: #990000; font-weight: bold } /* Name.Label */
.highlight .nn { color: #555555 } /* Name.Namespace */
.highlight .nt { color: #000080 } /* Name.Tag */
.highlight .nv { color: #008080 } /* Name.Variable */
.highlight .ow { color: #000000; font-weight: bold } /* Operator.Word */
.highlight .w { color: #bbbbbb } /* Text.Whitespace */
.highlight .mf { color: #009999 } /* Literal.Number.Float */
.highlight .mh { color: #009999 } /* Literal.Number.Hex */
.highlight .mi { color: #009999 } /* Literal.Number.Integer */
.highlight .mo { color: #009999 } /* Literal.Number.Oct */
.highlight .sb { color: #d01040 } /* Literal.String.Backtick */
.highlight .sc { color: #d01040 } /* Literal.String.Char */
.highlight .sd { color: #d01040 } /* Literal.String.Doc */
.highlight .s2 { color: #d01040 } /* Literal.String.Double */
.highlight .se { color: #d01040 } /* Literal.String.Escape */
.highlight .sh { color: #d01040 } /* Literal.String.Heredoc */
.highlight .si { color: #d01040 } /* Literal.String.Interpol */
.highlight .sx { color: #d01040 } /* Literal.String.Other */
.highlight .sr { color: #009926 } /* Literal.String.Regex */
.highlight .s1 { color: #d01040 } /* Literal.String.Single */
.highlight .ss { color: #990073 } /* Literal.String.Symbol */
.highlight .bp { color: #999999 } /* Name.Builtin.Pseudo */
.highlight .vc { color: #008080 } /* Name.Variable.Class */
.highlight .vg { color: #008080 } /* Name.Variable.Global */
.highlight .vi { color: #008080 } /* Name.Variable.Instance */
.highlight .il { color: #009999 } /* Literal.Number.Integer.Long */
</style>
<style>/* Boilerplate: style-autolinks */
.css.css, .property.property, .descriptor.descriptor {
    color: var(--a-normal-text);
    font-size: inherit;
    font-family: inherit;
}
.css::before, .property::before, .descriptor::before {
    content: "‘";
}
.css::after, .property::after, .descriptor::after {
    content: "’";
}
.property, .descriptor {
    /* Don't wrap property and descriptor names */
    white-space: nowrap;
}
.type { /* CSS value <type> */
    font-style: italic;
}
pre .property::before, pre .property::after {
    content: "";
}
[data-link-type="property"]::before,
[data-link-type="propdesc"]::before,
[data-link-type="descriptor"]::before,
[data-link-type="value"]::before,
[data-link-type="function"]::before,
[data-link-type="at-rule"]::before,
[data-link-type="selector"]::before,
[data-link-type="maybe"]::before {
    content: "‘";
}
[data-link-type="property"]::after,
[data-link-type="propdesc"]::after,
[data-link-type="descriptor"]::after,
[data-link-type="value"]::after,
[data-link-type="function"]::after,
[data-link-type="at-rule"]::after,
[data-link-type="selector"]::after,
[data-link-type="maybe"]::after {
    content: "’";
}

[data-link-type].production::before,
[data-link-type].production::after,
.prod [data-link-type]::before,
.prod [data-link-type]::after {
    content: "";
}

[data-link-type=element],
[data-link-type=element-attr] {
    font-family: Menlo, Consolas, "DejaVu Sans Mono", monospace;
    font-size: .9em;
}
[data-link-type=element]::before { content: "<" }
[data-link-type=element]::after  { content: ">" }

[data-link-type=biblio] {
    white-space: pre;
}

@media (prefers-color-scheme: dark) {
    :root {
        --selflink-text: black;
        --selflink-bg: silver;
        --selflink-hover-text: white;
    }
}
</style>
<style>/* Boilerplate: style-colors */
/* Any --*-text not paired with a --*-bg is assumed to have a transparent bg */
:root {
    color-scheme: light dark;

    --text: black;
    --bg: white;

    --unofficial-watermark: url(https://www.w3.org/StyleSheets/TR/2016/logos/UD-watermark);

    --logo-bg: #1a5e9a;
    --logo-active-bg: #c00;
    --logo-text: white;

    --tocnav-normal-text: #707070;
    --tocnav-normal-bg: var(--bg);
    --tocnav-hover-text: var(--tocnav-normal-text);
    --tocnav-hover-bg: #f8f8f8;
    --tocnav-active-text: #c00;
    --tocnav-active-bg: var(--tocnav-normal-bg);

    --tocsidebar-text: var(--text);
    --tocsidebar-bg: #f7f8f9;
    --tocsidebar-shadow: rgba(0,0,0,.1);
    --tocsidebar-heading-text: hsla(203,20%,40%,.7);

    --toclink-text: var(--text);
    --toclink-underline: #3980b5;
    --toclink-visited-text: var(--toclink-text);
    --toclink-visited-underline: #054572;

    --heading-text: #005a9c;

    --hr-text: var(--text);

    --algo-border: #def;

    --del-text: red;
    --del-bg: transparent;
    --ins-text: #080;
    --ins-bg: transparent;

    --a-normal-text: #034575;
    --a-normal-underline: #bbb;
    --a-visited-text: var(--a-normal-text);
    --a-visited-underline: #707070;
    --a-hover-bg: rgba(75%, 75%, 75%, .25);
    --a-active-text: #c00;
    --a-active-underline: #c00;

    --blockquote-border: silver;
    --blockquote-bg: transparent;
    --blockquote-text: currentcolor;

    --issue-border: #e05252;
    --issue-bg: #fbe9e9;
    --issue-text: var(--text);
    --issueheading-text: #831616;

    --example-border: #e0cb52;
    --example-bg: #fcfaee;
    --example-text: var(--text);
    --exampleheading-text: #574b0f;

    --note-border: #52e052;
    --note-bg: #e9fbe9;
    --note-text: var(--text);
    --noteheading-text: hsl(120, 70%, 30%);
    --notesummary-underline: silver;

    --assertion-border: #aaa;
    --assertion-bg: #eee;
    --assertion-text: black;

    --advisement-border: orange;
    --advisement-bg: #fec;
    --advisement-text: var(--text);
    --advisementheading-text: #b35f00;

    --warning-border: red;
    --warning-bg: hsla(40,100%,50%,0.95);
    --warning-text: var(--text);

    --amendment-border: #330099;
    --amendment-bg: #F5F0FF;
    --amendment-text: var(--text);
    --amendmentheading-text: #220066;

    --def-border: #8ccbf2;
    --def-bg: #def;
    --def-text: var(--text);
    --defrow-border: #bbd7e9;

    --datacell-border: silver;

    --indexinfo-text: #707070;

    --indextable-hover-text: black;
    --indextable-hover-bg: #f7f8f9;

    --outdatedspec-bg: rgba(0, 0, 0, .5);
    --outdatedspec-text: black;
    --outdated-bg: maroon;
    --outdated-text: white;
    --outdated-shadow: red;

    --editedrec-bg: darkorange;
}

@media (prefers-color-scheme: dark) {
    :root {
        --text: #ddd;
        --bg: black;

        --unofficial-watermark: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='400'%3E%3Cg fill='%23100808' transform='translate(200 200) rotate(-45) translate(-200 -200)' stroke='%23100808' stroke-width='3'%3E%3Ctext x='50%25' y='220' style='font: bold 70px sans-serif; text-anchor: middle; letter-spacing: 6px;'%3EUNOFFICIAL%3C/text%3E%3Ctext x='50%25' y='305' style='font: bold 70px sans-serif; text-anchor: middle; letter-spacing: 6px;'%3EDRAFT%3C/text%3E%3C/g%3E%3C/svg%3E");

        --logo-bg: #1a5e9a;
        --logo-active-bg: #c00;
        --logo-text: white;

        --tocnav-normal-text: #999;
        --tocnav-normal-bg: var(--bg);
        --tocnav-hover-text: var(--tocnav-normal-text);
        --tocnav-hover-bg: #080808;
        --tocnav-active-text: #f44;
        --tocnav-active-bg: var(--tocnav-normal-bg);

        --tocsidebar-text: var(--text);
        --tocsidebar-bg: #080808;
        --tocsidebar-shadow: rgba(255,255,255,.1);
        --tocsidebar-heading-text: hsla(203,20%,40%,.7);

        --toclink-text: var(--text);
        --toclink-underline: #6af;
        --toclink-visited-text: var(--toclink-text);
        --toclink-visited-underline: #054572;

        --heading-text: #8af;

        --hr-text: var(--text);

        --algo-border: #456;

        --del-text: #f44;
        --del-bg: transparent;
        --ins-text: #4a4;
        --ins-bg: transparent;

        --a-normal-text: #6af;
        --a-normal-underline: #555;
        --a-visited-text: var(--a-normal-text);
        --a-visited-underline: var(--a-normal-underline);
        --a-hover-bg: rgba(25%, 25%, 25%, .2);
        --a-active-text: #f44;
        --a-active-underline: var(--a-active-text);

        --borderedblock-bg: rgba(255, 255, 255, .05);

        --blockquote-border: silver;
        --blockquote-bg: var(--borderedblock-bg);
        --blockquote-text: currentcolor;

        --issue-border: #e05252;
        --issue-bg: var(--borderedblock-bg);
        --issue-text: var(--text);
        --issueheading-text: hsl(0deg, 70%, 70%);

        --example-border: hsl(50deg, 90%, 60%);
        --example-bg: var(--borderedblock-bg);
        --example-text: var(--text);
        --exampleheading-text: hsl(50deg, 70%, 70%);

        --note-border: hsl(120deg, 100%, 35%);
        --note-bg: var(--borderedblock-bg);
        --note-text: var(--text);
        --noteheading-text: hsl(120, 70%, 70%);
        --notesummary-underline: silver;

        --assertion-border: #444;
        --assertion-bg: var(--borderedblock-bg);
        --assertion-text: var(--text);

        --advisement-border: orange;
        --advisement-bg: #222218;
        --advisement-text: var(--text);
        --advisementheading-text: #f84;

        --warning-border: red;
        --warning-bg: hsla(40,100%,20%,0.95);
        --warning-text: var(--text);

        --amendment-border: #330099;
        --amendment-bg: #080010;
        --amendment-text: var(--text);
        --amendmentheading-text: #cc00ff;

        --def-border: #8ccbf2;
        --def-bg: #080818;
        --def-text: var(--text);
        --defrow-border: #136;

        --datacell-border: silver;

        --indexinfo-text: #aaa;

        --indextable-hover-text: var(--text);
        --indextable-hover-bg: #181818;

        --outdatedspec-bg: rgba(255, 255, 255, .5);
        --outdatedspec-text: black;
        --outdated-bg: maroon;
        --outdated-text: white;
        --outdated-shadow: red;

        --editedrec-bg: darkorange;
    }
    /* In case a transparent-bg image doesn't expect to be on a dark bg,
       which is quite common in practice... */
    img { background: white; }
}
</style>
<style>/* Boilerplate: style-counters */
body {
    counter-reset: example figure issue;
}
.issue {
    counter-increment: issue;
}
.issue:not(.no-marker)::before {
    content: "Issue " counter(issue);
}

.example {
    counter-increment: example;
}
.example:not(.no-marker)::before {
    content: "Example " counter(example);
}
.invalid.example:not(.no-marker)::before,
.illegal.example:not(.no-marker)::before {
    content: "Invalid Example" counter(example);
}

figcaption {
    counter-increment: figure;
}
figcaption:not(.no-marker)::before {
    content: "Figure " counter(figure) " ";
}
</style>
<style>/* Boilerplate: style-dfn-panel */
:root {
    --dfnpanel-bg: #ddd;
    --dfnpanel-text: var(--text);
    --dfnpanel-target-bg: #ffc;
    --dfnpanel-target-outline: orange;
}
@media (prefers-color-scheme: dark) {
    :root {
        --dfnpanel-bg: #222;
        --dfnpanel-text: var(--text);
        --dfnpanel-target-bg: #333;
        --dfnpanel-target-outline: silver;
    }
}
.dfn-panel {
    position: absolute;
    z-index: 35;
    width: 20em;
    width: 300px;
    height: auto;
    max-height: 500px;
    overflow: auto;
    padding: 0.5em 0.75em;
    font: small Helvetica Neue, sans-serif, Droid Sans Fallback;
    background: var(--dfnpanel-bg);
    color: var(--dfnpanel-text);
    border: outset 0.2em;
    white-space: normal; /* in case it's moved into a pre */
}
.dfn-panel:not(.on) { display: none; }
.dfn-panel * { margin: 0; padding: 0; text-indent: 0; }
.dfn-panel > b { display: block; }
.dfn-panel a { color: var(--dfnpanel-text); }
.dfn-panel a:not(:hover) { text-decoration: none !important; border-bottom: none !important; }
.dfn-panel a:focus {
    outline: 5px auto Highlight;
    outline: 5px auto -webkit-focus-ring-color;
}
.dfn-panel > b + b { margin-top: 0.25em; }
.dfn-panel ul { padding: 0 0 0 1em; list-style: none; }
.dfn-panel li a {
    max-width: calc(300px - 1.5em - 1em);
    overflow: hidden;
    text-overflow: ellipsis;
}

.dfn-panel.activated {
    display: inline-block;
    position: fixed;
    left: 8px;
    bottom: 2em;
    margin: 0 auto;
    max-width: calc(100vw - 1.5em - .4em - .5em);
    max-height: 30vh;
    transition: left 1s ease-out, bottom 1s ease-out;
}

.dfn-panel .link-item:hover {
    text-decoration: underline;
}
.dfn-panel .link-item .copy-icon {
    opacity: 0;
}
.dfn-panel .link-item:hover .copy-icon,
.dfn-panel .link-item .copy-icon:focus {
    opacity: 1;
}

.dfn-panel .copy-icon {
    display: inline-block;
    margin-right: 0.5em;
    width: 0.85em;
    height: 1em;
    border-radius: 3px;
    background-color: #ccc;
    cursor: pointer;
}

.dfn-panel .copy-icon .icon {
    width: 100%;
    height: 100%;
    background-color: #fff;
    display: flex;
    justify-content: center;
    align-items: center;
    position: relative;
}

.dfn-panel .copy-icon .icon::before {
    content: "";
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    border: 1px solid black;
    background-color: #ccc;
    opacity: 0.25;
    transform: translate(3px, -3px);
}

.dfn-panel .copy-icon:active .icon::before {
    opacity: 1;
}

.dfn-paneled[role="button"] { cursor: help; }

.highlighted {
    animation: target-fade 3s;
}

@keyframes target-fade {
    from {
        background-color: var(--dfnpanel-target-bg);
        outline: 5px solid var(--dfnpanel-target-outline);
    }
    to {
        color: var(--a-normal-text);
        background-color: transparent;
        outline: transparent;
    }
}
</style>
<style>/* Boilerplate: style-issues */
a[href].issue-return {
    float: right;
    float: inline-end;
    color: var(--issueheading-text);
    font-weight: bold;
    text-decoration: none;
}
</style>
<style>/* Boilerplate: style-md-lists */
/* This is a weird hack for me not yet following the commonmark spec
   regarding paragraph and lists. */
[data-md] > :first-child {
    margin-top: 0;
}
[data-md] > :last-child {
    margin-bottom: 0;
}
</style>
<style>/* Boilerplate: style-ref-hints */
:root {
    --ref-hint-bg: #ddd;
    --ref-hint-text: var(--text);
}
@media (prefers-color-scheme: dark) {
    :root {
        --ref-hint-bg: #222;
        --ref-hint-text: var(--text);
    }
}

.ref-hint {
    display: inline-block;
    position: absolute;
    z-index: 35;
    width: 20em;
    width: 300px;
    height: auto;
    max-height: 500px;
    overflow: auto;
    padding: 0.5em 0.5em;
    font: small Helvetica Neue, sans-serif, Droid Sans Fallback;
    background: var(--ref-hint-bg);
    color: var(--ref-hint-text);
    border: outset 0.2em;
    white-space: normal; /* in case it's moved into a pre */
}

.ref-hint * { margin: 0; padding: 0; text-indent: 0; }

.ref-hint ul { padding: 0 0 0 1em; list-style: none; }
</style>
<style>/* Boilerplate: style-selflinks */
:root {
    --selflink-text: white;
    --selflink-bg: gray;
    --selflink-hover-text: black;
}
.heading, .issue, .note, .example, li, dt {
    position: relative;
}
a.self-link {
    position: absolute;
    top: 0;
    left: calc(-1 * (3.5rem - 26px));
    width: calc(3.5rem - 26px);
    height: 2em;
    text-align: center;
    border: none;
    transition: opacity .2s;
    opacity: .5;
}
a.self-link:hover {
    opacity: 1;
}
.heading > a.self-link {
    font-size: 83%;
}
.example > a.self-link,
.note > a.self-link,
.issue > a.self-link {
    /* These blocks are overflow:auto, so positioning outside
       doesn't work. */
    left: auto;
    right: 0;
}
li > a.self-link {
    left: calc(-1 * (3.5rem - 26px) - 2em);
}
dfn > a.self-link {
    top: auto;
    left: auto;
    opacity: 0;
    width: 1.5em;
    height: 1.5em;
    background: var(--selflink-bg);
    color: var(--selflink-text);
    font-style: normal;
    transition: opacity .2s, background-color .2s, color .2s;
}
dfn:hover > a.self-link {
    opacity: 1;
}
dfn > a.self-link:hover {
    color: var(--selflink-hover-text);
}

a.self-link::before            { content: "¶"; }
.heading > a.self-link::before { content: "§"; }
dfn > a.self-link::before      { content: "#"; }
</style>
 <body class="h-entry">
  <div class="head">
   <p data-fill-with="logo"><a class="logo" href="https://www.w3.org/"> <img alt="W3C" height="48" src="https://www.w3.org/StyleSheets/TR/2021/logos/W3C" width="72"> </a> </p>
   <h1 class="p-name no-ref" id="title">Open Screen Protocol</h1>
   <p id="w3c-state"><a href="https://www.w3.org/standards/types#ED">Editor’s Draft</a>, <time class="dt-updated" datetime="2024-05-31">31 May 2024</time></p>
   <details open>
    <summary>More details about this document</summary>
    <div data-fill-with="spec-metadata">
     <dl>
      <dt>This version:
      <dd><a class="u-url" href="https://w3c.github.io/openscreenprotocol/">https://w3c.github.io/openscreenprotocol/</a>
      <dt>Latest published version:
      <dd><a href="https://www.w3.org/TR/openscreenprotocol/">https://www.w3.org/TR/openscreenprotocol/</a>
      <dt>Feedback:
      <dd><a href="https://github.com/w3c/openscreenprotocol/issues/">GitHub</a>
      <dd><a href="#issues-index">Inline In Spec</a>
      <dt class="editor">Editor:
      <dd class="editor p-author h-card vcard" data-editor-id="68454"><a class="p-name fn u-url url" href="https://github.com/mfoltzgoogle">Mark Foltz</a> (<span class="p-org org">Google</span>)
     </dl>
    </div>
   </details>
   <div data-fill-with="warning"></div>
   <p class="copyright" data-fill-with="copyright"><a href="https://www.w3.org/policies/#copyright">Copyright</a> © 2024 <a href="https://www.w3.org/">World Wide Web Consortium</a>. <abbr title="World Wide Web Consortium">W3C</abbr><sup>®</sup> <a href="https://www.w3.org/policies/#Legal_Disclaimer">liability</a>, <a href="https://www.w3.org/policies/#W3C_Trademarks">trademark</a> and <a href="https://www.w3.org/copyright/software-license/" rel="license" title="W3C Software and Document License">permissive document license</a> rules apply. </p>
   <hr title="Separator for header">
  </div>
  <div class="p-summary" data-fill-with="abstract">
   <h2 class="no-num no-toc no-ref heading settled" id="abstract"><span class="content">Abstract</span></h2>
   <p>The Open Screen Protocol is a suite of network protocols that allow
user agents to implement the <a data-link-type="biblio" href="#biblio-presentation-api" title="Presentation API">Presentation API</a> and
the <a data-link-type="biblio" href="#biblio-remote-playback" title="Remote Playback API">Remote Playback API</a> in an interoperable
fashion.</p>
  </div>
  <h2 class="no-num no-toc no-ref heading settled" id="sotd"><span class="content">Status of this document</span></h2>
  <div data-fill-with="status">
   <p> <em>This section describes the status of this document at the time of its publication. A list of current <abbr title="World Wide Web Consortium">W3C</abbr> publications and the latest revision of this technical report can be found in the <a href="https://www.w3.org/TR/"><abbr title="World Wide Web Consortium">W3C</abbr> technical reports index</a> at https://www.w3.org/TR/.</em> </p>
   <p> This document was published by the <a href="https://www.w3.org/groups/wg/secondscreen">Second Screen Working Group</a> as an Editor’s Draft. This document is intended to become a W3C Recommendation. </p>
   <p> Feedback and comments on this specification are welcome. Please use <a href="https://github.com/w3c/openscreenprotocol/issues">Github issues</a>. </p>
   <p> Publication as an Editor’s Draft does not imply endorsement by <abbr title="World Wide Web Consortium">W3C</abbr> and its Members. This is a draft document and may be updated, replaced or obsoleted by other documents at any time. It is inappropriate to cite this document as other than work in progress. </p>
   <p> This document was produced by a group operating under the <a class="css" data-link-type="property" href="https://www.w3.org/Consortium/Patent-Policy-20200915/" id="sotd_patent">W3C Patent Policy</a>. <abbr title="World Wide Web Consortium">W3C</abbr> maintains a <a href="https://www.w3.org/2004/01/pp-impl/74168/status" rel="disclosure">public list of any patent disclosures</a> made in connection with the deliverables of the group; that page also includes instructions for disclosing a patent. An individual who has actual knowledge of a patent which the individual believes contains <a href="https://www.w3.org/Consortium/Patent-Policy-20200915/#def-essential">Essential
    Claim(s)</a> must disclose the information in accordance with <a href="https://www.w3.org/Consortium/Patent-Policy-20200915/#sec-Disclosure">section 6 of the <abbr title="World Wide Web Consortium">W3C</abbr> Patent Policy</a>. </p>
   <p> This document is governed by the <a href="https://www.w3.org/2023/Process-20231103/" id="w3c_process_revision">03 November 2023 W3C Process Document</a>. </p>
   <p></p>
  </div>
  <div data-fill-with="at-risk"></div>
  <nav data-fill-with="table-of-contents" id="toc">
   <h2 class="no-num no-toc no-ref" id="contents">Table of Contents</h2>
   <ol class="toc" role="directory">
    <li>
     <a href="#introduction"><span class="secno">1</span> <span class="content">Introduction</span></a>
     <ol class="toc">
      <li><a href="#terminology"><span class="secno">1.1</span> <span class="content">Terminology</span></a>
     </ol>
    <li>
     <a href="#requirements"><span class="secno">2</span> <span class="content">Requirements</span></a>
     <ol class="toc">
      <li><a href="#requirements-general"><span class="secno">2.1</span> <span class="content">General Requirements</span></a>
      <li><a href="#requirements-presentation-api"><span class="secno">2.2</span> <span class="content">Presentation API Requirements</span></a>
      <li><a href="#requirements-remote-playback"><span class="secno">2.3</span> <span class="content">Remote Playback API Requirements</span></a>
      <li><a href="#requirements-non-functional"><span class="secno">2.4</span> <span class="content">Non-Functional Requirements</span></a>
     </ol>
    <li>
     <a href="#discovery"><span class="secno">3</span> <span class="content">Discovery with mDNS</span></a>
     <ol class="toc">
      <li><a href="#computing-agent-fingerprint"><span class="secno">3.1</span> <span class="content">Computing the Agent Fingerprint</span></a>
     </ol>
    <li>
     <a href="#transport"><span class="secno">4</span> <span class="content">Transport and metadata discovery with QUIC</span></a>
     <ol class="toc">
      <li><a href="#tls-13"><span class="secno">4.1</span> <span class="content">TLS 1.3</span></a>
      <li><a href="#certificates"><span class="secno">4.2</span> <span class="content">Agent Certificates</span></a>
      <li><a href="#metadata"><span class="secno">4.3</span> <span class="content">Metadata Discovery</span></a>
     </ol>
    <li>
     <a href="#messages"><span class="secno">5</span> <span class="content">Messages delivery using CBOR and QUIC streams</span></a>
     <ol class="toc">
      <li><a href="#message-compatibility"><span class="secno">5.1</span> <span class="content">Type Key Backwards Compatibility</span></a>
     </ol>
    <li>
     <a href="#authentication"><span class="secno">6</span> <span class="content">Authentication</span></a>
     <ol class="toc">
      <li><a href="#authentication-with-spake2"><span class="secno">6.1</span> <span class="content">Authentication with SPAKE2</span></a>
     </ol>
    <li>
     <a href="#presentation-protocol"><span class="secno">7</span> <span class="content">Presentation Protocol</span></a>
     <ol class="toc">
      <li><a href="#presentation-api"><span class="secno">7.1</span> <span class="content">Presentation API</span></a>
     </ol>
    <li><a href="#time-representation"><span class="secno">8</span> <span class="content">Representation Of Time</span></a>
    <li>
     <a href="#remote-playback-protocol"><span class="secno">9</span> <span class="content">Remote Playback Protocol</span></a>
     <ol class="toc">
      <li><a href="#remote-playback-state-and-controls"><span class="secno">9.1</span> <span class="content">Remote Playback State and Controls</span></a>
      <li><a href="#remote-playback-api"><span class="secno">9.2</span> <span class="content">Remote Playback API</span></a>
     </ol>
    <li>
     <a href="#streaming-protocol"><span class="secno">10</span> <span class="content">Streaming Protocol</span></a>
     <ol class="toc">
      <li><a href="#streaming-protocol-capabilities"><span class="secno">10.1</span> <span class="content">Streaming Protocol Capabilities</span></a>
      <li><a href="#streaming-sessions"><span class="secno">10.2</span> <span class="content">Sessions</span></a>
      <li><a href="#streaming-audio"><span class="secno">10.3</span> <span class="content">Audio</span></a>
      <li><a href="#streaming-video"><span class="secno">10.4</span> <span class="content">Video</span></a>
      <li><a href="#streaming-data"><span class="secno">10.5</span> <span class="content">Data</span></a>
      <li><a href="#streaming-feedback"><span class="secno">10.6</span> <span class="content">Feedback</span></a>
      <li><a href="#streaming-stats"><span class="secno">10.7</span> <span class="content">Stats</span></a>
     </ol>
    <li><a href="#requests-responses-watches"><span class="secno">11</span> <span class="content">Requests, Responses, and Watches</span></a>
    <li>
     <a href="#protocol-extensions"><span class="secno">12</span> <span class="content">Protocol Extensions</span></a>
     <ol class="toc">
      <li><a href="#protocol-extension-fields"><span class="secno">12.1</span> <span class="content">Protocol Extension Fields</span></a>
     </ol>
    <li>
     <a href="#security-privacy"><span class="secno">13</span> <span class="content">Security and Privacy</span></a>
     <ol class="toc">
      <li>
       <a href="#threat-models"><span class="secno">13.1</span> <span class="content">Threat Models</span></a>
       <ol class="toc">
        <li><a href="#passive-network-attackers"><span class="secno">13.1.1</span> <span class="content">Passive Network Attackers</span></a>
        <li><a href="#active-network-attackers"><span class="secno">13.1.2</span> <span class="content">Active Network Attackers</span></a>
        <li><a href="#denial-of-service"><span class="secno">13.1.3</span> <span class="content">Denial of Service</span></a>
        <li><a href="#same-origin-policy-violations"><span class="secno">13.1.4</span> <span class="content">Same-Origin Policy Violations</span></a>
       </ol>
      <li>
       <a href="#security-privacy-questions"><span class="secno">13.2</span> <span class="content">Open Screen Protocol Security and Privacy Considerations</span></a>
       <ol class="toc">
        <li><a href="#personally-identifiable-information"><span class="secno">13.2.1</span> <span class="content">Personally Identifiable Information &amp; High-Value Data</span></a>
        <li><a href="#cross-origin-state"><span class="secno">13.2.2</span> <span class="content">Cross Origin State Considerations</span></a>
        <li><a href="#origin-access-devices"><span class="secno">13.2.3</span> <span class="content">Origin Access to Other Devices</span></a>
        <li><a href="#private-browsing-mode"><span class="secno">13.2.4</span> <span class="content">Private Browsing Mode</span></a>
        <li><a href="#persistent-state"><span class="secno">13.2.5</span> <span class="content">Persistent State</span></a>
        <li><a href="#other-considerations"><span class="secno">13.2.6</span> <span class="content">Other Considerations</span></a>
       </ol>
      <li><a href="#presentation-api-considerations"><span class="secno">13.3</span> <span class="content">Presentation API Considerations</span></a>
      <li><a href="#remote-playback-considerations"><span class="secno">13.4</span> <span class="content">Remote Playback API Considerations</span></a>
      <li>
       <a href="#security-mitigations"><span class="secno">13.5</span> <span class="content">Mitigation Strategies</span></a>
       <ol class="toc">
        <li><a href="#local-passive-mitigations"><span class="secno">13.5.1</span> <span class="content">Local passive network attackers</span></a>
        <li><a href="#local-active-mitigations"><span class="secno">13.5.2</span> <span class="content">Local active network attackers</span></a>
        <li><a href="#remote-active-mitigations"><span class="secno">13.5.3</span> <span class="content">Remote active network attackers</span></a>
        <li><a href="#denial-of-service-mitigations"><span class="secno">13.5.4</span> <span class="content">Denial of service</span></a>
        <li><a href="#malicious-input-mitigations"><span class="secno">13.5.5</span> <span class="content">Malicious input</span></a>
       </ol>
      <li>
       <a href="#security-ui"><span class="secno">13.6</span> <span class="content">User Interface Considerations</span></a>
       <ol class="toc">
        <li><a href="#instance-names"><span class="secno">13.6.1</span> <span class="content">Instance and Display Names</span></a>
       </ol>
     </ol>
    <li><a href="#appendix-a"><span class="secno"></span> <span class="content">Appendix A: Messages</span></a>
    <li><a href="#appendix-b"><span class="secno"></span> <span class="content">Appendix B: Message Type Key Ranges</span></a>
    <li>
     <a href="#appendix-c"><span class="secno"></span> <span class="content">Appendix C: PSK Encoding Schemes</span></a>
     <ol class="toc">
      <li><a href="#appendix-c-base-10"><span class="secno"></span> <span class="content">Base-10 Numeric</span></a>
      <li><a href="#appendix-c-qr-code"><span class="secno"></span> <span class="content">QR Code</span></a>
     </ol>
    <li><a href="#appendix-d"><span class="secno"></span> <span class="content">Appendix D: Entire Flow Chart</span></a>
    <li><a href="#appendix-e"><span class="secno"></span> <span class="content">Appendix E: Media Time Conversions</span></a>
    <li>
     <a href="#w3c-conformance"><span class="secno"></span> <span class="content">Conformance</span></a>
     <ol class="toc">
      <li><a href="#w3c-conventions"><span class="secno"></span> <span class="content">Document conventions</span></a>
      <li><a href="#w3c-conformant-algorithms"><span class="secno"></span> <span class="content">Conformant Algorithms</span></a>
     </ol>
    <li>
     <a href="#index"><span class="secno"></span> <span class="content">Index</span></a>
     <ol class="toc">
      <li><a href="#index-defined-here"><span class="secno"></span> <span class="content">Terms defined by this specification</span></a>
      <li><a href="#index-defined-elsewhere"><span class="secno"></span> <span class="content">Terms defined by reference</span></a>
     </ol>
    <li>
     <a href="#references"><span class="secno"></span> <span class="content">References</span></a>
     <ol class="toc">
      <li><a href="#normative"><span class="secno"></span> <span class="content">Normative References</span></a>
      <li><a href="#informative"><span class="secno"></span> <span class="content">Informative References</span></a>
     </ol>
    <li><a href="#issues-index"><span class="secno"></span> <span class="content">Issues Index</span></a>
   </ol>
  </nav>
  <main>
   <h2 class="heading settled" data-level="1" id="introduction"><span class="secno">1. </span><span class="content">Introduction</span><a class="self-link" href="#introduction"></a></h2>
   <p>The Open Screen Protocol connects browsers to devices capable of rendering Web
content for a shared audience.  Typically, these are devices like
Internet-connected TVs, HDMI dongles, and smart speakers.</p>
   <p>This spec defines a suite of network protocols that enable two user agents to
implement the <a data-link-type="biblio" href="#biblio-presentation-api" title="Presentation API">Presentation API</a> and <a data-link-type="biblio" href="#biblio-remote-playback" title="Remote Playback API">Remote Playback API</a> in an interoperable fashion.  This means
that a Web developer can expect these APIs to work as intended when connecting
two devices from independent implementations of the Open Screen Protocol.</p>
   <p>The Open Screen Protocol is a specific implementation of these two APIs, meaning
that it does not handle all possible ways that browsers and presentation
displays could support these APIs.  The Open Screen Protocol specifically
supports browsers and displays that are connected via the same local area
network.  It allows a browser to present a URL, initiate remote playback of an
HTML <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/media.html#media-element" id="ref-for-media-element">media element</a>, and stream media data to another
device.</p>
   <p>The Open Screen Protocol is intended to be extensible, so that additional
capabilities can be added over time.  This may include additions to existing Web
APIs or new Web APIs.</p>
   <p>The accompanying <a href="https://w3c.github.io/openscreenprotocol/explainer.html">explainer</a> provides
more background on the protocol.</p>
   <h3 class="heading settled" data-level="1.1" id="terminology"><span class="secno">1.1. </span><span class="content">Terminology</span><a class="self-link" href="#terminology"></a></h3>
   <p>An <dfn class="dfn-paneled" data-dfn-type="dfn" data-lt="open screen protocol agent|osp agent" data-noexport id="open-screen-protocol-agent">Open Screen Protocol
agent</dfn> (or OSP agent) is any implementation of this protocol (browser,
display, speaker, or other software).</p>
   <p>Some OSP agents support the <a data-link-type="biblio" href="#biblio-presentation-api" title="Presentation API">Presentation API</a>.  The
API allows a <a data-link-type="dfn" href="https://www.w3.org/TR/presentation-api/#dfn-controlling-user-agent" id="ref-for-dfn-controlling-user-agent">controlling user agent</a> to initiate presentation of Web content
on another device.  We call this agent a <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="controller">controller</dfn> for short.  A <a data-link-type="dfn" href="https://www.w3.org/TR/presentation-api/#dfn-receiving-user-agent" id="ref-for-dfn-receiving-user-agent">receiving user agent</a> is responsible for rendering the Web content, which we
will call a <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="receiver">receiver</dfn> for short.  The the Web content itself is called
a <a data-link-type="dfn" href="https://www.w3.org/TR/presentation-api/#dfn-receiving-browsing-context" id="ref-for-dfn-receiving-browsing-context">presentation</a>.</p>
   <p>Some OSP agents also support the <a data-link-type="biblio" href="#biblio-remote-playback" title="Remote Playback API">Remote Playback API</a>.  That
API allows an agent to render a <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/media.html#media-element" id="ref-for-media-element①">media element</a> on a <a data-link-type="dfn" href="https://w3c.github.io/remote-playback/#dfn-remote-playback-devices" id="ref-for-dfn-remote-playback-devices">remote playback device</a>.  In this document, we refer to it as a <a data-link-type="dfn" href="#receiver" id="ref-for-receiver">receiver</a> because it is shorter and keeps terminology consistent between presentations and
remote playbacks. Similarly, we use the term <a data-link-type="dfn" href="#controller" id="ref-for-controller">controller</a> to refer to the
agent that starts, terminates, and controls the remote playback.</p>
   <p>For media streaming, we refer to an OSP agent that sends a media stream
as a <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="media-sender">media sender</dfn> and an agent that receives a media stream as a <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="media-receiver">media receiver</dfn>.  Note that an agent can be both a media sender and a
media receiver.</p>
   <p>For additional terms and idioms specific to the <a data-link-type="biblio" href="#biblio-presentation-api" title="Presentation API">Presentation API</a> or <a data-link-type="biblio" href="#biblio-remote-playback" title="Remote Playback API">Remote Playback API</a>,
please consult the respective specifications.</p>
   <h2 class="heading settled" data-level="2" id="requirements"><span class="secno">2. </span><span class="content">Requirements</span><a class="self-link" href="#requirements"></a></h2>
   <h3 class="heading settled" data-level="2.1" id="requirements-general"><span class="secno">2.1. </span><span class="content">General Requirements</span><a class="self-link" href="#requirements-general"></a></h3>
   <ol>
    <li data-md>
     <p>An <a data-link-type="dfn" href="#open-screen-protocol-agent" id="ref-for-open-screen-protocol-agent">Open Screen Protocol agent</a> must be able to discover the presence of
another OSP agent connected to the same IPv4 or IPv6 subnet and reachable by
IP multicast.</p>
    <li data-md>
     <p>An OSP agent must be able to obtain the IPv4 or IPv6 address of
the agent, a display name for the agent, and an IP port number for
establishing a network transport to the agent.</p>
   </ol>
   <h3 class="heading settled" data-level="2.2" id="requirements-presentation-api"><span class="secno">2.2. </span><span class="content">Presentation API Requirements</span><a class="self-link" href="#requirements-presentation-api"></a></h3>
   <ol>
    <li data-md>
     <p>A <a data-link-type="dfn" href="#controller" id="ref-for-controller①">controller</a> must be able to determine if a <a data-link-type="dfn" href="#receiver" id="ref-for-receiver①">receiver</a> is reasonably
capable of rendering a specific <a data-link-type="dfn" href="https://www.w3.org/TR/presentation-api/#dfn-presentation-request-url" id="ref-for-dfn-presentation-request-url">presentation request URL</a>.</p>
    <li data-md>
     <p>A controller must be able to start a new <a data-link-type="dfn" href="https://www.w3.org/TR/presentation-api/#dfn-receiving-browsing-context" id="ref-for-dfn-receiving-browsing-context①">presentation</a> on a
receiver given a <a data-link-type="dfn" href="https://www.w3.org/TR/presentation-api/#dfn-presentation-request-url" id="ref-for-dfn-presentation-request-url①">presentation request URL</a> and <a data-link-type="dfn" href="https://www.w3.org/TR/presentation-api/#dfn-presentation-identifier" id="ref-for-dfn-presentation-identifier">presentation
identifier</a>.</p>
    <li data-md>
     <p>A controller must be able to create a new <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/presentation-api/#dom-presentationconnection" id="ref-for-dom-presentationconnection">PresentationConnection</a></code> to an
existing presentation on the receiver, given its <a data-link-type="dfn" href="https://www.w3.org/TR/presentation-api/#dfn-presentation-request-url" id="ref-for-dfn-presentation-request-url②">presentation request
URL</a> and <a data-link-type="dfn" href="https://www.w3.org/TR/presentation-api/#dfn-presentation-identifier" id="ref-for-dfn-presentation-identifier①">presentation identifier</a>.</p>
    <li data-md>
     <p>It must be possible to close a <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/presentation-api/#dom-presentationconnection" id="ref-for-dom-presentationconnection①">PresentationConnection</a></code> between a
controller and a presentation, and signal both parties with the reason why
the connection was closed.</p>
    <li data-md>
     <p>Multiple controllers must be able to connect to a single presentation
simultaneously.</p>
    <li data-md>
     <p>Messages sent by the controller must be delivered to the presentation (or
vice versa) in a reliable and in-order fashion.</p>
    <li data-md>
     <p>If a message cannot be delivered, then the controller must be
able to signal the receiver (or vice versa) that the connection should be
closed with reason <code>error</code>.</p>
    <li data-md>
     <p>The controller and presentation must be able to send and receive <code>DOMString</code> messages (represented as <code>string</code> type in ECMAScript).</p>
    <li data-md>
     <p>The controller and presentation must be able to send and receive binary
messages (represented as <code>Blob</code> objects in HTML5, or <code>ArrayBuffer</code> or <code>ArrayBufferView</code> types in ECMAScript).</p>
    <li data-md>
     <p>The controller must be able to signal to the receiver to
terminate a presentation, given its <a data-link-type="dfn" href="https://www.w3.org/TR/presentation-api/#dfn-presentation-request-url" id="ref-for-dfn-presentation-request-url③">presentation request URL</a> and <a data-link-type="dfn" href="https://www.w3.org/TR/presentation-api/#dfn-presentation-identifier" id="ref-for-dfn-presentation-identifier②">presentation identifier</a>.</p>
    <li data-md>
     <p>The receiver must be able to signal all connected controllers
when a presentation is terminated.</p>
   </ol>
   <h3 class="heading settled" data-level="2.3" id="requirements-remote-playback"><span class="secno">2.3. </span><span class="content">Remote Playback API Requirements</span><a class="self-link" href="#requirements-remote-playback"></a></h3>
   <ol>
    <li data-md>
     <p>A <a data-link-type="dfn" href="#controller" id="ref-for-controller②">controller</a> must be able to find out whether there is at least one
compatible <a data-link-type="dfn" href="#receiver" id="ref-for-receiver②">receiver</a> for a given <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/media.html#htmlmediaelement" id="ref-for-htmlmediaelement">HTMLMediaElement</a></code>, both
instantaneously and continuously.</p>
    <li data-md>
     <p>A controller must be able to to <a data-link-type="dfn" href="https://w3c.github.io/remote-playback/#dfn-initiate-remote-playback" id="ref-for-dfn-initiate-remote-playback">initiate remote playback</a> of
an <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/media.html#htmlmediaelement" id="ref-for-htmlmediaelement①">HTMLMediaElement</a></code> to a compatible receiver.</p>
    <li data-md>
     <p>The controller must be able send media sources as URLs and text
tracks from an <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/media.html#htmlmediaelement" id="ref-for-htmlmediaelement②">HTMLMediaElement</a></code> to a compatible receiver.</p>
    <li data-md>
     <p>The controller must be able send media data from an <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/media.html#htmlmediaelement" id="ref-for-htmlmediaelement③">HTMLMediaElement</a></code> to
a compatible receiver.</p>
    <li data-md>
     <p>During remote playback, the controller and the remote playback
device must be able to synchronize the <a data-link-type="dfn" href="https://w3c.github.io/remote-playback/#dfn-media-element-state" id="ref-for-dfn-media-element-state">media element state</a> of the <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/media.html#htmlmediaelement" id="ref-for-htmlmediaelement④">HTMLMediaElement</a></code>.</p>
    <li data-md>
     <p>During remote playback, either the controller or the receiver must be able
to disconnect from the other party.</p>
    <li data-md>
     <p>The controller should be able to pass locale and text direction information
to the receiver to assist in rendering text during remote playback.</p>
   </ol>
   <h3 class="heading settled" data-level="2.4" id="requirements-non-functional"><span class="secno">2.4. </span><span class="content">Non-Functional Requirements</span><a class="self-link" href="#requirements-non-functional"></a></h3>
   <ol>
    <li data-md>
     <p>It should be possible to implement an OSP agent using modest
hardware requirements, similar to what is found in a low end smartphone,
smart TV or streaming device. See the <a href="https://w3c.github.io/openscreenprotocol/device_specs.html">Device
Specifications</a> document for agent hardware specifications.</p>
    <li data-md>
     <p>The discovery and connection protocols should minimize power consumption,
especially on a <a data-link-type="dfn" href="#listening-agent" id="ref-for-listening-agent">listening agent</a> which is likely to be battery
powered.</p>
    <li data-md>
     <p>The protocol should minimize the amount of information provided to a passive
network observer about the identity of the user or activities on the agent, including
presentations, remote playbacks, or the content of media streams.</p>
    <li data-md>
     <p>The protocol should prevent active network attackers from impersonating a
display and observing or altering data intended for the controller or
receiver.</p>
    <li data-md>
     <p>A listening agent should be able to discover quickly when an <a data-link-type="dfn" href="#advertising-agent" id="ref-for-advertising-agent">advertising
agent</a> becomes available or unavailable (i.e., when it connects or
disconnects from the network).</p>
    <li data-md>
     <p>Agents should present sensible information to the user when a protocol
operation fails.  For example, if a controller is unable to start a
presentation, it should be possible to report in the controller interface if
it was a network error, authentication error, or the presentation content
failed to load.</p>
    <li data-md>
     <p>Agents should be able to remember that a user authenticated another agent.
This means it is not required for the user to intervene and re-authenticate
each time an agent wants to connect to an agent that the user has already
authenticated.</p>
    <li data-md>
     <p>Message latency between agents should be minimized to permit interactive
use.  For example, it should be comfortable to type in a form in one agent
and have the text appear in the presentation in real time.  Real-time
latency for gaming or mouse use is ideal, but not a requirement.</p>
    <li data-md>
     <p>The controller initiating a presentation or remote playback should
communicate its preferred locale to the receiver, so it can render the
content in that locale.</p>
    <li data-md>
     <p>It should be possible to extend the control protocol (above the discovery and
transport levels) with optional features not defined explicitly by the
specification, to facilitate experimentation and enhancement of the base
APIs.</p>
   </ol>
   <h2 class="heading settled" data-level="3" id="discovery"><span class="secno">3. </span><span class="content">Discovery with mDNS</span><a class="self-link" href="#discovery"></a></h2>
   <p><a data-link-type="dfn" href="#open-screen-protocol-agent" id="ref-for-open-screen-protocol-agent①">Open Screen Protocol agents</a> discover one another by advertising and
listening for information identifying themselves along with an IP service
endpoint.  Agent advertisement and discovery through <a data-link-type="biblio" href="#biblio-rfc6763" title="DNS-Based Service Discovery">DNS-SD</a> and <a data-link-type="biblio" href="#biblio-rfc6762" title="Multicast DNS">mDNS</a> is defined by this specification and is mandatory to implement
by all agents. However, agents are free to implement additional discovery
mechanisms, such as querying for the same DNS-SD records via unicast DNS.</p>
   <p>OSP agents must use the DNS-SD <a data-link-type="dfn" href="https://tools.ietf.org/html/rfc6763#section-7" id="ref-for-section-7">Service Name</a> <code>_openscreen._udp</code>.</p>
   <p>An <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="advertising-agent">advertising agent</dfn> is one that responds to mDNS queries
for <code>_openscreen._udp.local</code>.  Such an agent should have a <dfn class="dfn-paneled" data-dfn-type="dfn" data-lt="display name" data-noexport id="display-name">display
name</dfn> (a non-empty string) that is a human readable description of the
presentation display, e.g. "Living Room TV."</p>
   <p>A <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="listening-agent">listening agent</dfn> is one that sends mDNS queries for <code>_openscreen._udp.local</code>.  Listening agents may have a display name.</p>
   <p>Advertising agents must use a DNS-SD <a data-link-type="dfn" href="https://tools.ietf.org/html/rfc6763#section-4.1.1" id="ref-for-section-4.1.1">Instance Name</a> that is a prefix of the
agent’s display name.  If the Instance Name is not the complete display name, it
must be terminated by a null (<code>\000</code>) character, so that a listening agent knows
it has been truncated.</p>
   <p>Advertising agents must follow the mDNS <a data-link-type="dfn" href="https://tools.ietf.org/html/rfc6762#section-9" id="ref-for-section-9">conflict resolution</a> procedure, to
prevent multiple advertising agents from using the same DNS-SD Instance Name.</p>
   <p>Agents should be careful when displaying Instance Names to users; see <a href="#instance-names">§ 13.6.1 Instance and Display Names</a> for guidelines on Instance Name display.</p>
   <p>Advertising agents must include DNS TXT records with the following
keys and values:</p>
   <dl>
    <dt data-md>fp
    <dd data-md>
     <p>The <a data-link-type="dfn" href="#agent-fingerprint" id="ref-for-agent-fingerprint">agent fingerprint</a> of the advertising agent. The steps to compute
the agent fingerprint are defined below.</p>
    <dt data-md>mv
    <dd data-md>
     <p>An unsigned integer value that indicates that metadata has changed.   The
advertising agent must update it to a greater value.  This signals to the
listening agent that it should connect to the advertising agent to discover
updated metadata.  The value should be encoded as a <a data-link-type="dfn" href="https://datatracker.ietf.org/doc/html/rfc9000#name-variable-length-integer-enc" id="ref-for-name-variable-length-integer-enc">variable-length integer</a>.</p>
    <dt data-md>at
    <dd data-md>
     <p>An alphanumeric, unguessable token consisting of characters from the set <code>[A-Za-z0-9+/]</code>.</p>
   </dl>
   <p class="note" role="note"><span class="marker">Note:</span> <code>at</code> prevents off-LAN parties from attempting authentication; see <a href="#remote-active-mitigations">§ 13.5.3 Remote active network attackers</a>. <code>at</code> should have at least 32 bits of true
entropy to make brute force attacks impractical.</p>
   <p class="note" role="note"><span class="marker">NOTE:</span> If an OSP agent suspends its network connectivity (e.g. for power saving
reasons) it should attempt to retain cached and valid mDNS records so that
discovery state is preserved when the network connection is resumed.</p>
   <p>Future extensions to this QUIC-based protocol can use the same metadata
discovery process to indicate support for those extensions, through a
capabilities mechanism to be determined. If a future version of the Open Screen
Protocol uses mDNS but breaks compatibility with the metadata discovery process,
it should change the DNS-SD service name to a new value, indicating a new
mechanism for metadata discovery.</p>
   <h3 class="heading settled" data-level="3.1" id="computing-agent-fingerprint"><span class="secno">3.1. </span><span class="content">Computing the Agent Fingerprint</span><a class="self-link" href="#computing-agent-fingerprint"></a></h3>
   <p>The <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="agent-fingerprint">agent fingerprint</dfn> of an agent is computed by following these
steps:</p>
   <ol>
    <li data-md>
     <p>Compute the <a href="https://www.rfc-editor.org/rfc/rfc7469#section-2.4">SKPI Fingerprint</a> of the <a data-link-type="dfn" href="#agent-certificate" id="ref-for-agent-certificate">agent certificate</a> according to <a data-link-type="biblio" href="#biblio-rfc7469" title="Public Key Pinning Extension for HTTP">[RFC7469]</a> using <a data-link-type="biblio" href="#biblio-rfc6234" title="US Secure Hash Algorithms (SHA and SHA-based HMAC and HKDF)">SHA-256</a> as the hash algorithm.</p>
    <li data-md>
     <p>base64 encode the result of Step 1 according to <a data-link-type="biblio" href="#biblio-rfc4648" title="The Base16, Base32, and Base64 Data Encodings">[RFC4648]</a>.</p>
   </ol>
   <p class="note" role="note"><span class="marker">Note:</span> The resulting string will be 44 bytes in length.</p>
   <h2 class="heading settled" data-level="4" id="transport"><span class="secno">4. </span><span class="content">Transport and metadata discovery with QUIC</span><a class="self-link" href="#transport"></a></h2>
   <p>If a <a data-link-type="dfn" href="#listening-agent" id="ref-for-listening-agent①">listening agent</a> wants to connect to or learn further metadata about an <a data-link-type="dfn" href="#advertising-agent" id="ref-for-advertising-agent①">advertising agent</a>, it initiates a <a data-link-type="biblio" href="#biblio-rfc9000" title="QUIC: A UDP-Based Multiplexed and Secure Transport">QUIC</a> connection to the IP and port
from its SRV record.  Prior to authentication, a message may be exchanged (such
as further metadata), but such info should be treated as unverified (such as
indicating to a user that a display name of an unauthenticated agent is
unverified).</p>
   <p>The connection IDs used both by agents should be zero length.  If zero length
connection IDs are chosen, agents are restricted from changing IP or port
without establishing a new QUIC connection.  In such cases, agents must
establish a new QUIC connection in order to change IP or port.</p>
   <h3 class="heading settled" data-level="4.1" id="tls-13"><span class="secno">4.1. </span><span class="content">TLS 1.3</span><a class="self-link" href="#tls-13"></a></h3>
   <p>When an <a data-link-type="dfn" href="#open-screen-protocol-agent" id="ref-for-open-screen-protocol-agent②">OSP Agent</a> makes a QUIC connection to another agent, it must use <a data-link-type="biblio" href="#biblio-rfc8446" title="The Transport Layer Security (TLS) Protocol Version 1.3">TLS 1.3</a> to secure the connection.  TLS 1.3 should be used with the
following application-specific parameters to indicate that the connection will
be used to communicate with a specific OSP Agent using OSP.  An OSP Agent may
refuse incoming connections that lack these parameters.</p>
   <ul>
    <li data-md>
     <p>The <a data-link-type="biblio" href="#biblio-rfc7301" title="Transport Layer Security (TLS) Application-Layer Protocol Negotiation Extension">ALPN</a> used must be "osp".</p>
    <li data-md>
     <p>The <a data-link-type="biblio" href="#biblio-rfc6066" title="Transport Layer Security (TLS) Extensions: Extension Definitions">server_name extension</a> must be set to the following <code>host_name</code>: <code>&lt;fp>._openscreen._udp</code>.</p>
     <ul>
      <li data-md>
       <p><code>&lt;fp></code> must be substituted with the <a data-link-type="dfn" href="#agent-fingerprint" id="ref-for-agent-fingerprint①">agent fingerprint</a> as used in mDNS TXT.</p>
     </ul>
   </ul>
   <p>An OSP Agent must not send TLS early data.</p>
   <p class="issue" id="issue-808efb48"><a class="self-link" href="#issue-808efb48"></a> Register ALPN with IANA. <a href="https://github.com/w3c/openscreenprotocol/issues/228">[Issue #228]</a></p>
   <h3 class="heading settled" data-level="4.2" id="certificates"><span class="secno">4.2. </span><span class="content">Agent Certificates</span><a class="self-link" href="#certificates"></a></h3>
   <p>Each OSP Agent must generate an <a data-link-type="biblio" href="#biblio-rfc5280" title="Internet X.509 Public Key Infrastructure Certificate and Certificate Revocation List (CRL) Profile">X.509 v3</a> <dfn class="dfn-paneled" data-dfn-type="dfn" data-lt="agent certificate" data-noexport id="agent-certificate">agent
certificate</dfn> containing a public key to be used with the TLS 1.3
certificate exchange.  Both <a data-link-type="dfn" href="#advertising-agent" id="ref-for-advertising-agent②">advertising agents</a> and <a data-link-type="dfn" href="#listening-agent" id="ref-for-listening-agent②">listening agents</a> must
use the <a data-link-type="dfn" href="#agent-certificate" id="ref-for-agent-certificate①">agent certificate</a> in TLS 1.3 <code>Certificate</code> messages when making a
QUIC connection.</p>
   <p>The <a data-link-type="dfn" href="#agent-certificate" id="ref-for-agent-certificate②">agent certificate</a> must have the following characteristics:</p>
   <ul>
    <li data-md>
     <p>256-bit ECDSA public key.</p>
    <li data-md>
     <p>Self-signed.</p>
    <li data-md>
     <p>Support the <code>ecdsa_secp256r1_sha256</code> <a data-link-type="dfn" href="https://datatracker.ietf.org/doc/html/rfc8446#section-4.2.3" id="ref-for-section-4.2.3">signature scheme</a> as defined in TLS 1.3.</p>
     <ul>
      <li data-md>
       <p>The <code>AlgorithmIdentifier</code> values are as defined in <a data-link-type="biblio" href="#biblio-rfc5480" title="Elliptic Curve Cryptography Subject Public Key Information">[RFC5480]</a> (for public
keys) and <a data-link-type="biblio" href="#biblio-rfc5758" title="Internet X.509 Public Key Infrastructure: Additional Algorithms and Identifiers for DSA and ECDSA">[RFC5758]</a> (for signature schemes).</p>
      <li data-md>
       <p><a data-link-type="biblio" href="#biblio-x690" title="Recommendation X.690 — Information Technology — ASN.1 Encoding Rules — Specification of Basic Encoding Rules (BER), Canonical Encoding Rules (CER), and Distinguished Encoding Rules (DER)">[X690]</a> specifies the Distinguished Encoding Rules (DER) representation
used to encode the identifiers.</p>
     </ul>
    <li data-md>
     <p>Valid for signing.</p>
   </ul>
   <p>Let the <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="certificate-serial-number">certificate serial number</dfn> be the result of the following steps:</p>
   <ol>
    <li>
     If the agent has never generated an agent certificate: 
     <ol>
      <li>Let the <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="certificate-serial-number-base">certificate serial number base</dfn> be a 32-bit
        pseudorandom integer value. 
      <li>Let the <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="certificate-serial-number-counter">certificate serial number counter</dfn> be a 32-bit
        unsigned integer, initially set to 0.
     </ol>
    <li>
     Generate a 64-bit value as follows: 
     <ol>
      <li>Increment the <a data-link-type="dfn" href="#certificate-serial-number-counter" id="ref-for-certificate-serial-number-counter">certificate serial number counter</a> by one.
      <li>Assign the upper 32 bits to the <a data-link-type="dfn" href="#certificate-serial-number-base" id="ref-for-certificate-serial-number-base">certificate serial number base</a>.
      <li>Assign the lower 32 bits to the <a data-link-type="dfn" href="#certificate-serial-number-counter" id="ref-for-certificate-serial-number-counter①">certificate serial number counter</a>. 
     </ol>
   </ol>
   <p>The following X.509 v3 fields are to be set as follows:</p>
   <div class="assertion">
    <table>
     <thead>
      <tr>
       <th>Field
       <th>Value
     <tbody>
      <tr>
       <td>Version Number
       <td>3
      <tr>
       <td>Serial Number
       <td>The <a data-link-type="dfn" href="#certificate-serial-number" id="ref-for-certificate-serial-number">certificate serial number</a>.
      <tr>
       <td>Public Key <code>AlgorithmIdentifier</code>
       <td>
        <ul>
         <li>ECC OID: <code>1.2.840.10045.2.1</code>
         <li>ECDSA 256 OID: <code>1.2.840.10045.3.1.7</code>
         <li>DER representation: <code>301306072a8648ce3d020106082a8648ce3d030107</code>
        </ul>
      <tr>
       <td>Signature <code>AlgorithmIdentifier</code>
       <td>
        <ul>
         <li>OID: <code>1.2.840.10045.4.3.2</code>
         <li>DER representation: <code>300a06082a8648ce3d040302</code>
        </ul>
      <tr>
       <td>Issuer Name
       <td>CN = The <code>model-name</code> from the <code>agent-info</code> message.<br> O = See note.<br> L = See note.<br> ST = See note.<br> C = See note.<br> 
      <tr>
       <td>Subject Name
       <td>CN = <code>&lt;fp></code>._openscreen._udp<br> O = See note.<br> 
      <tr>
       <td>Subject Public Key Algorithm
       <td>Elliptic Curve Public Key
      <tr>
       <td>Certificate Key usage
       <td><a data-link-type="dfn" href="https://tools.ietf.org/html/rfc5280#section-4.2.1.3" id="ref-for-section-4.2.1.3">digitalSignature</a>
    </table>
   </div>
   <p>Mandatory fields not mentioned above should be set according to <a data-link-type="biblio" href="#biblio-rfc5280" title="Internet X.509 Public Key Infrastructure Certificate and Certificate Revocation List (CRL) Profile">[RFC5280]</a>.</p>
   <p>The value <code>&lt;sn></code> above should be substituted with the <a data-link-type="dfn" href="#certificate-serial-number" id="ref-for-certificate-serial-number①">certificate serial
number</a>.</p>
   <p class="note" role="note"><span class="marker">Note:</span> The OSP agent may use the implementer or device model name as the value
for the <code>O</code> key for user interface and debugging purposes. It may use the agent
implementer’s or device manufacturer’s location as the value for the location
keys (<code>L</code>, <code>ST</code>, and <code>C</code>) for user interface and debugging purposes.</p>
   <p>If an OSP agent sees an <a data-link-type="dfn" href="#agent-certificate" id="ref-for-agent-certificate③">agent certificate</a> it has not yet verified through <a href="#authentication">§ 6 Authentication</a>, it must treat that agent as unverified and initiate
authentication with that agent before allowing additional messages to be
exchanged with that agent (apart from the messages described in <a href="#metadata">§ 4.3 Metadata Discovery</a>).</p>
   <p>If an OSP agent sees a valid <a data-link-type="dfn" href="#agent-certificate" id="ref-for-agent-certificate④">agent certificate</a> it has verified through
authentication, it is not required to initiate authentication with that agent
before sending further messages.</p>
   <h3 class="heading settled" data-level="4.3" id="metadata"><span class="secno">4.3. </span><span class="content">Metadata Discovery</span><a class="self-link" href="#metadata"></a></h3>
   <p>To learn further metadata, an agent may send an <a data-link-type="dfn" href="#agent-info-request" id="ref-for-agent-info-request">agent-info-request</a> message
and receive back an <a data-link-type="dfn" href="#agent-info-response" id="ref-for-agent-info-response">agent-info-response</a> message.  Any agent may send this
request at any time to learn about the state and capabilities of another device,
which are described by the <a data-link-type="dfn" href="#agent-info" id="ref-for-agent-info">agent-info</a> message in the <a data-link-type="dfn" href="#agent-info-response" id="ref-for-agent-info-response①">agent-info-response</a>.</p>
   <p>If an agent changes any information in its <a data-link-type="dfn" href="#agent-info" id="ref-for-agent-info①">agent-info</a> message, it should
send an <a data-link-type="dfn" href="#agent-info-event" id="ref-for-agent-info-event">agent-info-event</a> message to all other connected agents with the new <a data-link-type="dfn" href="#agent-info" id="ref-for-agent-info②">agent-info</a> (without waiting for an <a data-link-type="dfn" href="#agent-info-request" id="ref-for-agent-info-request①">agent-info-request</a>).</p>
   <p>The <a data-link-type="dfn" href="#agent-info" id="ref-for-agent-info③">agent-info</a> message contains the following fields:</p>
   <dl>
    <dt data-md>display-name (required)
    <dd data-md>
     <p>The display name of the agent, intended to be displayed to a user by the
 requester. The requester should indicate through the UI if the responder
 is not authenticated or if the display name changes.</p>
    <dt data-md>model-name (optional)
    <dd data-md>
     <p>If the agent is a hardware device, the model name of
the device.  This is used mainly for debugging purposes, but may be
displayed to the user of the requesting agent.</p>
    <dt data-md>capabilities (required)
    <dd data-md>
     <p>The control protocols, roles, and media types the agent supports.
Presence indicates a capability and absence indicates lack of a
capability.  Capabilities should should affect how an agent is
presented to a user, such as drawing a different icon depending on
the whether it receives audio, video or both.</p>
    <dt data-md>state-token (required)
    <dd data-md>
     <p>A random alphanumeric value consisting of 8 characters in the range
[0-9A-Za-z].  This value is set before the agent makes its first connection
and must be set to a new value when the agent is reset or otherwise lost all
of its state related to this protocol.</p>
    <dt data-md>locales (required)
    <dd data-md>
     <p>The agent’s preferred locales for display of localized content, in the order
of user preference.  Each entry is an RFC5646 <a data-link-type="dfn" href="https://tools.ietf.org/html/rfc5646#section-2" id="ref-for-section-2">language tag</a>.</p>
   </dl>
   <p>The various capabilities have the following meanings:</p>
   <dl>
    <dt data-md>receive-audio
    <dd data-md>
     <p>The agent can render audio via the other protocols it supports.  Those other
protocols may report more specific capabilities, such as support for
certain audio codecs in the streaming protocol.</p>
    <dt data-md>receive-video
    <dd data-md>
     <p>The agent can receive video via the other protocols it supports.  Those other
protocols may report more specific capabilities, such as support for
certain video codecs in the streaming protocol.</p>
    <dt data-md>receive-presentation
    <dd data-md>
     <p>The agent can receive presentations using the presentation protocol.</p>
    <dt data-md>control-presentation
    <dd data-md>
     <p>The agent can control presentations using the presentation protocol.</p>
    <dt data-md>receive-remote-playback
    <dd data-md>
     <p>The agent can receive remote playback using the remote playback
protocol.</p>
    <dt data-md>control-remote-playback
    <dd data-md>
     <p>The agent can control remote playback using the remote playback
protocol.</p>
    <dt data-md>receive-streaming
    <dd data-md>
     <p>The agent can receiving streaming using the streaming protocol.</p>
    <dt data-md>send-streaming
    <dd data-md>
     <p>The agent can send streaming using the streaming protocol.</p>
   </dl>
   <p class="note" role="note"><span class="marker">NOTE:</span> See the <a href="https://github.com/w3c/openscreenprotocol/blob/main/capabilities.md">Capabilities Registry</a> for a list of all known capabilities (both defined by this specification, and
through <a href="#protocol-extensions">§ 12 Protocol Extensions</a>).</p>
   <p>If a listening agent wishes to receive messages from an advertising agent or an
advertising agent wishes to send messages to a listening agent, it may wish to
keep the QUIC connection alive.  Once neither side needs to keep the connection
alive for the purposes of sending or receiving messages, the connection should
be closed with an error code of 5139.  In order to keep a QUIC connection alive, an
agent may send an <a data-link-type="dfn" href="#agent-status-request" id="ref-for-agent-status-request">agent-status-request</a> message, and any agent that receives an <a data-link-type="dfn" href="#agent-status-request" id="ref-for-agent-status-request①">agent-status-request</a> message should send an <a data-link-type="dfn" href="#agent-status-response" id="ref-for-agent-status-response">agent-status-response</a> message. Such
messages should be sent more frequently than the QUIC idle_timeout transport
parameter (see <a data-link-type="dfn" href="https://datatracker.ietf.org/doc/html/rfc9000#name-transport-parameter-encodin" id="ref-for-name-transport-parameter-encodin">Transport Parameter Encoding</a> in <a data-link-type="biblio" href="#biblio-rfc9000" title="QUIC: A UDP-Based Multiplexed and Secure Transport">QUIC</a>) and QUIC PING
frames should not be used.  An idle_timeout transport parameter of 25 seconds is
recommended.  The agent should behave as though a timer less than the
idle_timeout were reset every time a message is sent on a QUIC stream.  If the
timer expires, a <a data-link-type="dfn" href="#agent-status-request" id="ref-for-agent-status-request②">agent-status-request</a> message should be sent.</p>
   <p>If a listening agent wishes to send messages to an advertising agent, the
listening agent can connect to the advertising agent "on demand"; it does not
need to keep the connection alive.</p>
   <p>If an OSP agent suspends its network connectivity (e.g. for power saving
reasons), it should attempt to resume QUIC connections to the OSP agents to
which it was previously connected once network connectivity is restored.  Once
reconnected, it should send <code>agent-status-request</code> messages to those agents.</p>
   <p>The <a data-link-type="dfn" href="#agent-info" id="ref-for-agent-info④">agent-info</a> and <a data-link-type="dfn" href="#agent-status-response" id="ref-for-agent-status-response①">agent-status-response</a> messages may be extended to
include additional information not defined in this spec, as described in <a href="#protocol-extension-fields">§ 12.1 Protocol Extension Fields</a>.</p>
   <h2 class="heading settled" data-level="5" id="messages"><span class="secno">5. </span><span class="content">Messages delivery using CBOR and QUIC streams</span><a class="self-link" href="#messages"></a></h2>
   <p>Messages are serialized using <a data-link-type="biblio" href="#biblio-rfc8949" title="Concise Binary Object Representation (CBOR)">CBOR</a>.  To send a group of messages in
order, that group of messages must be sent in one QUIC stream.  Independent
groups of messages (with no ordering dependency across groups) should be sent in
different QUIC streams.  In order to put multiple CBOR-serialized messages into
the the same QUIC stream, the following is used.</p>
   <p>For each message, the <a data-link-type="dfn" href="#open-screen-protocol-agent" id="ref-for-open-screen-protocol-agent③">OSP agent</a> must write to the QUIC stream the following:</p>
   <ol>
    <li data-md>
     <p>A type key representing the type of the message, encoded as a <a data-link-type="dfn" href="https://datatracker.ietf.org/doc/html/rfc9000#name-variable-length-integer-enc" id="ref-for-name-variable-length-integer-enc①">variable-length
integer</a> (see <a href="#appendix-a">Appendix A: Messages</a> for type keys)</p>
    <li data-md>
     <p>The message encoded as CBOR.</p>
   </ol>
   <p>If an agent receives a message for which it does not recognize a type key, it
must close the QUIC connection with an application error code of 404 and should
include the unknown type key in the reason phrase of the <a data-link-type="dfn" href="https://datatracker.ietf.org/doc/html/rfc9000#name-connection_close-frames" id="ref-for-name-connection_close-frames">CONNECTION_CLOSE
frame</a>.</p>
   <p>Variable-length integers are encoded in the <a data-link-type="dfn" href="https://datatracker.ietf.org/doc/html/rfc9000#name-variable-length-integer-enc" id="ref-for-name-variable-length-integer-enc②">Variable-Length Integer Encoding</a> used by <a data-link-type="biblio" href="#biblio-rfc9000" title="QUIC: A UDP-Based Multiplexed and Secure Transport">QUIC</a>.</p>
   <p>Many messages are requests and responses, so a common format is defined for
those.  A request and a response includes a request ID which is an unsigned
integer chosen by the requester.  Responses must include the request ID of the
request they are associated with.</p>
   <h3 class="heading settled" data-level="5.1" id="message-compatibility"><span class="secno">5.1. </span><span class="content">Type Key Backwards Compatibility</span><a class="self-link" href="#message-compatibility"></a></h3>
   <p>As messages are modified or extended over time, certain rules must be followed
to maintain backwards compatibiilty with agents that understand older versions
of messages.</p>
   <ol>
    <li data-md>
     <p>If a required field is added to or removed from a message (either to/from the
message directly or indirectly through the field of a field), a new type key
must be assigned to the message.  Is is effectively a new message and must not
be sent unless the receiving agent is known to understand the new type key.</p>
    <li data-md>
     <p>If an optional field is added to a message (either to the message directly
or indirectly through the field of a field), the type key may remain unchanged
if the behavior of older receiving agents that do not understand the added field
is compatible with newer sending agents that include the field.
Otherwise, a new type key must be assigned.</p>
    <li data-md>
     <p>If an optional field is removed from a message (either from the message
directly or indirectly through the field of a field), the type key may remain
unchanged if the behavior of newer receiving agents that do not understand the
removed field is compatible with older sending agents that include the field.
Otherwise, a new type key must be assigned.</p>
    <li data-md>
     <p>Required fields may not be added or removed from array-based messages, such
as audio-frame.</p>
   </ol>
   <h2 class="heading settled" data-level="6" id="authentication"><span class="secno">6. </span><span class="content">Authentication</span><a class="self-link" href="#authentication"></a></h2>
   <p>Each supported authentication method is implemeted via authentication messages
specific to that method.  The authentication method is explicitly specified by
the message itself.  The authentication status message is common for all authentication
methods.  Any new authentication method added must define new authentication messages.</p>
   <p><a data-link-type="dfn" href="#open-screen-protocol-agent" id="ref-for-open-screen-protocol-agent④">Open Screen Protocol agents</a> must implement <a href="#authentication-with-spake2">§ 6.1 Authentication with SPAKE2</a> with pre-shared keys.</p>
   <p>Prior to authentication, agents exchange <a data-link-type="dfn" href="#auth-capabilities" id="ref-for-auth-capabilities">auth-capabilities</a> messages specifying
pre-shared key (PSK) ease of input for the user and supported PSK input methods.
The agent with the lowest PSK ease of input presents a PSK to the user when the agent
either sends or receives an authentication request.  In case both agents have the same
PSK ease of input value, the server presents the PSK to the user.  The same pre-shared key
is used by both agents.  The agent presenting the PSK to the user is the PSK presenter,
the agent requiring the user to input the PSK is the PSK consumer.</p>
   <p>PSK ease of input is an integer in the range from 0 to 100 inclusive, where 0 means
it is not possible for the user to input PSK on this device and 100 means
that it’s easy for the user to input PSK on the device.  Supported PSK input methods
are numeric and scanning a QR-code.  Devices with non-zero PSK ease of input must
support the numeric PSK input method.</p>
   <p>Any authentication method may require an <a data-link-type="dfn" href="#auth-initiation-token" id="ref-for-auth-initiation-token">auth-initiation-token</a> before
showing a PSK to the user or requesting PSK input from the user.  For an <a data-link-type="dfn" href="#advertising-agent" id="ref-for-advertising-agent③">advertising agent</a>, the <code>at</code> field in its mDNS TXT record must be used as the <code>auth-initation-token</code> in the the first authentication message sent to or from
that agent.  Agents should discard any authentication message whose <code>auth-initation-token</code> is set and does not match the <code>at</code> provided by the
advertising agent.</p>
   <p>In the <code>psk-min-bits-of-entropy</code> field of the <a data-link-type="dfn" href="#auth-capabilities" id="ref-for-auth-capabilities①">auth-capabilities</a> messsage,
agents may specify the minimum bits of entropy it requires for a PSK, in the
range of 20 to 60 bits inclusive, with a default of 20.  The PSK presenter must
generate a PSK that has at least as many bits of entropy as it receives in this
field, and at least as many bits of entropy as it sends in this field.</p>
   <p>If an agent chooses to show a user a PSK in more than one way (such as both a
QR-code and a numeric PSK), they should be for the same PSK.  If they were
different, the PSK presenter would not know which one the user chose to use, and
that may lead to authentication failures.</p>
   <p><a href="#appendix-c">Appendix C: PSK Encoding Schemes</a> describes two encoding schemes for PSKs that agents may
support to produce either a string or a <a data-link-type="dfn" href="https://www.iso.org/standard/62021.html#" id="ref-for-something">QR code</a> for display to the user.</p>
   <h3 class="heading settled" data-level="6.1" id="authentication-with-spake2"><span class="secno">6.1. </span><span class="content">Authentication with SPAKE2</span><a class="self-link" href="#authentication-with-spake2"></a></h3>
   <p class="issue" id="issue-dc398825"><a class="self-link" href="#issue-dc398825"></a> [Meta] Track CFRG PAKE competition outcome <a href="https://github.com/w3c/openscreenprotocol/issues/242">[Issue #242]</a></p>
   <p>For all messages and objects defined in this section, see <a href="#appendix-a">Appendix A: Messages</a> for
the full CDDL definitions.</p>
   <p>The default authentication method is <a href="https://tools.ietf.org/html/draft-irtf-cfrg-spake2-26">SPAKE2</a> with
the following cipher suite:</p>
   <ol>
    <li data-md>
     <p>Elliptic curve is <a href="https://tools.ietf.org/html/rfc7748#page-4">edwards25519</a>.</p>
    <li data-md>
     <p>Hash function is <a href="https://tools.ietf.org/html/rfc6234">SHA-256</a>.</p>
    <li data-md>
     <p>Key derivation function is <a href="https://tools.ietf.org/html/rfc5869">HKDF</a>.</p>
    <li data-md>
     <p>Message authentication code is <a href="https://tools.ietf.org/html/rfc2104">HMAC</a>.</p>
    <li data-md>
     <p>Password hash function is <a href="https://tools.ietf.org/html/rfc6234">SHA-512</a>.</p>
   </ol>
   <p>Open Screen Protocol does not use a memory-hard hash function to hash PSKs with
SPAKE2 and uses SHA-512 instead, as the PSK is one-time use and is not stored in
any form.</p>
   <p>SPAKE2 provides explicit mutual authentication.</p>
   <p>This authentication method assumes the agents share a low-entropy secret,
such as a number or a short password that could be entered by a user on a
phone, a keyboard or a TV remote control.</p>
   <p>SPAKE2 is not symmetric and has two roles, Alice (A) and Bob (B).</p>
   <p>The messages used in this authentication method are: <a data-link-type="dfn" href="#auth-spake2-handshake" id="ref-for-auth-spake2-handshake">auth-spake2-handshake</a>, <a data-link-type="dfn" href="#auth-spake2-confirmation" id="ref-for-auth-spake2-confirmation">auth-spake2-confirmation</a> and <a data-link-type="dfn" href="#auth-status" id="ref-for-auth-status">auth-status</a>.  [SPAKE2] describes in detail
how <a data-link-type="dfn" href="#auth-spake2-handshake" id="ref-for-auth-spake2-handshake①">auth-spake2-handshake</a> and <a data-link-type="dfn" href="#auth-spake2-confirmation" id="ref-for-auth-spake2-confirmation①">auth-spake2-confirmation</a> are computed.</p>
   <p>The values <code>A</code> and <code>B</code> used in SPAKE2 are the <a data-link-type="dfn" href="#agent-fingerprint" id="ref-for-agent-fingerprint②">agent fingerprints</a> of the
client and server, respectively. <code>pw</code> is the PSK presented to the user.</p>
   <p>The PSK presenter or the PSK consumer may initiate authentication (assuming the
role of Alice in SPAKE2).</p>
   <p>If the PSK presenter wants to initiate authentication, it starts the
authentication process by presenting the PSK to the user and sending a <a data-link-type="dfn" href="#auth-spake2-handshake" id="ref-for-auth-spake2-handshake②">auth-spake2-handshake</a> message.  The <code>public-value</code> field of the <a data-link-type="dfn" href="#auth-spake2-handshake" id="ref-for-auth-spake2-handshake③">auth-spake2-handshake</a> message must be set to the value of <code>pA</code> from SPAKE2
and the <code>psk-status</code> field must be set to <code>psk-shown</code>.</p>
   <p>When the PSK consumer receives the <a data-link-type="dfn" href="#auth-spake2-handshake" id="ref-for-auth-spake2-handshake④">auth-spake2-handshake</a> message, the PSK
consumer prompts the user for the PSK input if it has not done so yet.  Once it
receives the PSK, it sends an <a data-link-type="dfn" href="#auth-spake2-handshake" id="ref-for-auth-spake2-handshake⑤">auth-spake2-handshake</a> message with the <code>public-value</code> field set to the value of <code>pB</code> from SPAKE2 and the <code>psk-status</code> field set to <code>psk-input</code>.</p>
   <p>If the PSK consumer wants to initiate authentication, the PSK consumer sends a <a data-link-type="dfn" href="#auth-spake2-handshake" id="ref-for-auth-spake2-handshake⑥">auth-spake2-handshake</a> message to the PSK presenter with the <code>psk-status</code> field set to <code>psk-needs-presentation</code> and the <code>public-value</code> field set to <code>pA</code>. The PSK presenter, on receiving this message, creates a PSK and presents
it to the the user.  Once that is done, it sends an <a data-link-type="dfn" href="#auth-spake2-handshake" id="ref-for-auth-spake2-handshake⑦">auth-spake2-handshake</a> message to the PSK consumer with <code>psk-status</code> set to <code>psk-input</code> and the <code>public-value</code> field set to <code>pB</code>.</p>
   <p>Once an agent knows both <code>pA</code> and <code>pB</code> from <a data-link-type="dfn" href="#auth-spake2-handshake" id="ref-for-auth-spake2-handshake⑧">auth-spake2-handshake</a> messages,
it computes and sends a <a data-link-type="dfn" href="#auth-spake2-confirmation" id="ref-for-auth-spake2-confirmation②">auth-spake2-confirmation</a> with the <code>confirmation-value</code> field set to <code>cA</code> (for Alice) or <code>cB</code> (for Bob) to the
other agent.</p>
   <p>Once an agent receives an <a data-link-type="dfn" href="#auth-spake2-confirmation" id="ref-for-auth-spake2-confirmation③">auth-spake2-confirmation</a> message, it validates
that message using the procedure in [SPAKE2] and then replies with an <a data-link-type="dfn" href="#auth-status" id="ref-for-auth-status①">auth-status</a> authenticated message to the other agent.  Any value of <code>result</code> other than <code>authenticated</code> means that authentication failed, and the agent must
immediately disconnect.</p>
   <p class="note" role="note"><span class="marker">NOTE:</span> The <a data-link-type="dfn" href="#auth-status" id="ref-for-auth-status②">auth-status</a> message is merely informative as each agent
independently computes the outcome of SPAKE2 through key confirmation
verification.</p>
   <p><a href="#appendix-d">Appendix D: Entire Flow Chart</a> shows the entire process when agents have not
authenticated each other, including discovery, QUIC connection establishment,
metadata exchange and authentication. When agents have completed authentication,
the authentication phase can be omitted.</p>
   <h2 class="heading settled" data-level="7" id="presentation-protocol"><span class="secno">7. </span><span class="content">Presentation Protocol</span><a class="self-link" href="#presentation-protocol"></a></h2>
   <p>This section defines the use of the Open Screen Protocol for starting,
terminating, and controlling presentations as defined by <a data-link-type="biblio" href="#biblio-presentation-api" title="Presentation API">Presentation API</a>. <a href="#presentation-api">§ 7.1 Presentation API</a> defines how APIs in <a data-link-type="biblio" href="#biblio-presentation-api" title="Presentation API">Presentation API</a> map to the
protocol messages defined in this section.</p>
   <p>To learn which receivers are <a data-link-type="dfn" href="https://www.w3.org/TR/presentation-api/#dfn-available-presentation-display" id="ref-for-dfn-available-presentation-display">available presentation displays</a> for a
particular <a data-link-type="dfn" href="https://www.w3.org/TR/presentation-api/#dfn-presentation-request-url" id="ref-for-dfn-presentation-request-url④">presentation request URL</a> or set of URLs, the controller may send
a <a data-link-type="dfn" href="#presentation-url-availability-request" id="ref-for-presentation-url-availability-request">presentation-url-availability-request</a> message with the following values:</p>
   <dl>
    <dt data-md>urls
    <dd data-md>
     <p>A list of presentation URLs.  Must not be empty.</p>
    <dt data-md>watch-duration
    <dd data-md>
     <p>The period of time that the controller is interested in receiving updates
about their URLs, should the availability change.</p>
    <dt data-md>watch-id
    <dd data-md>
     <p>An identifier the receiver must use when sending updates about URL
availability so that the controller knows which URLs the receiver is referring
to.</p>
   </dl>
   <p>In response, the receiver should send one <a data-link-type="dfn" href="#presentation-url-availability-response" id="ref-for-presentation-url-availability-response">presentation-url-availability-response</a> message with the following values:</p>
   <dl>
    <dt data-md>url-availabilities
    <dd data-md>
     <p>A list of URL availability states.  Each state must correspond to the matching URL
from the request by list index.</p>
   </dl>
   <p>While the watch is valid (the watch-duration has not expired), the receivers
should send <a data-link-type="dfn" href="#presentation-url-availability-event" id="ref-for-presentation-url-availability-event">presentation-url-availability-event</a> messages when URL
availabilities change.  Such events contain the following values:</p>
   <dl>
    <dt data-md>watch-id
    <dd data-md>
     <p>The watch-id given in the <a data-link-type="dfn" href="#presentation-url-availability-response" id="ref-for-presentation-url-availability-response①">presentation-url-availability-response</a>,
used to refer to the presentation URLs whose availability has changed.</p>
    <dt data-md>url-availabilities
    <dd data-md>
     <p>A list of URL availability states.  Each state must correspond to the URLs from the
request referred to by the watch-id.</p>
   </dl>
   <p>Note that these messages are not broadcasted to all controllers. They are sent
individually to controllers that have requested availability for the URLs that
have changed in availability state within the watch duration of the original
availability request.</p>
   <p>To save power, the controller may disconnect the QUIC connection and
later reconnect to send availability requests and receive availability
responses and updates.  The QUIC connection ID may or may not be the same
when reconnecting.</p>
   <p>To start a presentation, the controller may send a <a data-link-type="dfn" href="#presentation-start-request" id="ref-for-presentation-start-request">presentation-start-request</a> message to the receiver with the following
values:</p>
   <dl>
    <dt data-md>presentation-id
    <dd data-md>
     <p>The <a data-link-type="dfn" href="https://www.w3.org/TR/presentation-api/#dfn-presentation-identifier" id="ref-for-dfn-presentation-identifier③">presentation identifier</a></p>
    <dt data-md>url
    <dd data-md>
     <p>The selected presentation URL</p>
    <dt data-md>headers
    <dd data-md>
     <p>headers that the receiver should use to fetch the presentation URL.  For example, <a href="https://w3c.github.io/presentation-api/#creating-a-receiving-browsing-context">section 6.6.1</a> of
the Presentation API says that the HTTP <code>Accept-Language</code> header should be
provided.</p>
   </dl>
   <p>The <a data-link-type="dfn" href="https://www.w3.org/TR/presentation-api/#dfn-presentation-identifier" id="ref-for-dfn-presentation-identifier④">presentation identifier</a> must follow the restrictions defined by <a href="https://w3c.github.io/presentation-api/#common-idioms">section 6.1</a> of the Presentation API, in that
it must consist of at least 16 ASCII characters.</p>
   <p>When the receiver receives the <a data-link-type="dfn" href="#presentation-start-request" id="ref-for-presentation-start-request①">presentation-start-request</a>, it should send back a <a data-link-type="dfn" href="#presentation-start-response" id="ref-for-presentation-start-response">presentation-start-response</a> message after either the presentation URL has been
fetched and loaded, or the receiver has failed to do so. If it has failed, it
must respond with the appropriate result (such as invalid-url or timeout).  If
it has succeeded, it must reply with a success result.</p>
   <p>Additionally, the response must include the following:</p>
   <dl>
    <dt data-md>connection-id
    <dd data-md>
     <p>An ID that both agents can use to send connection messages
to each other.  It is chosen by the receiver for ease of implementation: if
the message receiver chooses the connection-id, it may keep the ID unique
across connections, thus making message demuxing/routing easier.</p>
   </dl>
   <p>The response should include the following:</p>
   <dl>
    <dt data-md>http-response-code
    <dd data-md>
     <p>The numeric HTTP response code that was returned from fetching the
presentation URL (after redirects).</p>
   </dl>
   <p>To send a presentation message, the controller or receiver may send a <a data-link-type="dfn" href="#presentation-connection-message" id="ref-for-presentation-connection-message">presentation-connection-message</a> with the following values:</p>
   <dl>
    <dt data-md>connection-id
    <dd data-md>
     <p>The ID from the <a data-link-type="dfn" href="#presentation-start-response" id="ref-for-presentation-start-response①">presentation-start-response</a> or <a data-link-type="dfn" href="#presentation-connection-open-response" id="ref-for-presentation-connection-open-response">presentation-connection-open-response</a> messages.</p>
    <dt data-md>message
    <dd data-md>
     <p>The presentation message data.</p>
   </dl>
   <p class="note" role="note"><span class="marker">NOTE:</span> An OSP agent should minimize buffering and processing of messages sent or
received via the QUIC connection beyond what is strictly necessary (i.e., CBOR
serialization).  Message payloads should be treated as real-time data, as they
may be used to synchronize playback of media streams between agents or other low
latency use cases.  The synchronization thresholds recommended in <a data-link-type="biblio" href="#biblio-itu-r-bt1359-1" title="ITU-R BT.1359-1, Relative Timing of Sound and Vision for Broadcasting">[ITU-R-BT.1359-1]</a> imply that the total agent-to-agent processing latency
(including serialization, buffering, QUIC processing, and network latency) must
be no greater than 45 ms to permit effective lip sync during media playback.</p>
   <p>To terminate a presentation, the controller may send a <a data-link-type="dfn" href="#presentation-termination-request" id="ref-for-presentation-termination-request">presentation-termination-request</a> message with the following values:</p>
   <dl>
    <dt data-md>presentation-id
    <dd data-md>
     <p>The ID of the presentation to terminate.</p>
    <dt data-md>reason
    <dd data-md>
     <p>Set to <code>application-request</code> if the application requested termination,
or <code>user-request</code> if the user requested termination. (These are the only
valid values for <code>reason</code> in a <a data-link-type="dfn" href="#presentation-termination-request" id="ref-for-presentation-termination-request①">presentation-termination-request</a>.)</p>
   </dl>
   <p>When a <a data-link-type="dfn" href="#receiver" id="ref-for-receiver③">receiver</a> receives a <a data-link-type="dfn" href="#presentation-termination-request" id="ref-for-presentation-termination-request②">presentation-termination-request</a>, it should
send back a <a data-link-type="dfn" href="#presentation-termination-response" id="ref-for-presentation-termination-response">presentation-termination-response</a> message to the requesting
controller.</p>
   <p>It should also notify other controllers about the termination by sending
a <a data-link-type="dfn" href="#presentation-termination-event" id="ref-for-presentation-termination-event">presentation-termination-event</a> message.  And it can send the same message if
it terminates a presentation without a request from a controller to do so. This
message contains the following values:</p>
   <dl>
    <dt data-md>presentation-id
    <dd data-md>
     <p>The ID of the presentation that was terminated.</p>
    <dt data-md>source
    <dd data-md>
     <p>Set to <code>controller</code> when the termination was in response to a <a data-link-type="dfn" href="#presentation-termination-request" id="ref-for-presentation-termination-request③">presentation-termination-request</a>, or <code>receiver</code> otherwise.</p>
    <dt data-md>reason
    <dd data-md>
     <p>The detailed reason why the presentation was terminated.</p>
   </dl>
   <p>To accept incoming connection requests from controller, a receiver must receive
and process the <a data-link-type="dfn" href="#presentation-connection-open-request" id="ref-for-presentation-connection-open-request">presentation-connection-open-request</a> message which contains the
following values:</p>
   <dl>
    <dt data-md>presentation-id
    <dd data-md>
     <p>The ID of the presentation to connect to.</p>
    <dt data-md>url
    <dd data-md>
     <p>The URL of the presentation to connect to.</p>
   </dl>
   <p>The receiver should, upon receipt of a <a data-link-type="dfn" href="#presentation-connection-open-request" id="ref-for-presentation-connection-open-request①">presentation-connection-open-request</a> message, send back a <a data-link-type="dfn" href="#presentation-connection-open-response" id="ref-for-presentation-connection-open-response①">presentation-connection-open-response</a> message which contains the
following values:</p>
   <dl>
    <dt data-md>result
    <dd data-md>
     <p>a code indicating success or failure, and the reason for the failure</p>
    <dt data-md>connection-id
    <dd data-md>
     <p>An ID that both agents can use to send connection messages
to each other.  It is chosen by the receiver for ease of implementation (if
the message receiver chooses the connection-id, it may keep the ID unique
across connections, thus making message demuxing/routing easier).</p>
    <dt data-md>connection-count
    <dd data-md>
     <p>The new number of open connections to the presentation that received
the incoming connection request.</p>
   </dl>
   <p>If the <a data-link-type="dfn" href="#presentation-connection-open-response" id="ref-for-presentation-connection-open-response②">presentation-connection-open-response</a> message indicates success, the
receiver should also send a <a data-link-type="dfn" href="#presentation-change-event" id="ref-for-presentation-change-event">presentation-change-event</a> to all other endpoints
that have an active presentation connection to that presentation with the
values:</p>
   <dl>
    <dt data-md>presentation-id
    <dd data-md>
     <p>The ID of the presentation that just received a new presentation connection.</p>
    <dt data-md>connection-count
    <dd data-md>
     <p>The new total number of open connections to that presentation.</p>
   </dl>
   <p>A controller may close a connection without terminating the presentation by
sending a <a data-link-type="dfn" href="#presentation-connection-close-event" id="ref-for-presentation-connection-close-event">presentation-connection-close-event</a> message to the receiver with the
following values:</p>
   <dl>
    <dt data-md>connection-id
    <dd data-md>
     <p>The ID of the connection that was closed.</p>
    <dt data-md>reason
    <dd data-md>
     <p>Set to <code>close-method-called</code> or <code>connection-object-discarded</code>.</p>
   </dl>
   <p>The receiver may also close a connection without terminating a presentation.  If
it does so, it should send a <a data-link-type="dfn" href="#presentation-connection-close-event" id="ref-for-presentation-connection-close-event①">presentation-connection-close-event</a> message to the
controller with the following values:</p>
   <dl>
    <dt data-md>connection-id
    <dd data-md>
     <p>The ID of the connection that was closed.</p>
    <dt data-md>reason
    <dd data-md>
     <p>Set to <code>close-method-called</code> or <code>connection-object-discarded</code>.</p>
    <dt data-md>connection-count
    <dd data-md>
     <p>The number of open presentation connections that remain.</p>
   </dl>
   <p>If a receiver closes a presentation connection (for any reason), it should send
a <a data-link-type="dfn" href="#presentation-change-event" id="ref-for-presentation-change-event①">presentation-change-event</a> to all other controllers with an open connection
to that presentation with the values:</p>
   <dl>
    <dt data-md>presentation-id
    <dd data-md>
     <p>The ID of the presentation that just closed a connection.</p>
    <dt data-md>connection-count
    <dd data-md>
     <p>The number of open presentation connections that remain.</p>
   </dl>
   <p class="note" role="note"><span class="marker">Note:</span> When an agent closes a presentation connection, it is always successful,
so request and response messages are not needed.  A request to terminate a
presentation may succeed or fail, so a response message is required.</p>
   <h3 class="heading settled" data-level="7.1" id="presentation-api"><span class="secno">7.1. </span><span class="content">Presentation API</span><a class="self-link" href="#presentation-api"></a></h3>
   <p>An <a data-link-type="dfn" href="#open-screen-protocol-agent" id="ref-for-open-screen-protocol-agent⑤">Open Screen Protocol agent</a> that is a <a data-link-type="dfn" href="https://www.w3.org/TR/presentation-api/#dfn-controlling-user-agent" id="ref-for-dfn-controlling-user-agent①">controlling user agent</a> for the <a data-link-type="biblio" href="#biblio-presentation-api" title="Presentation API">Presentation API</a> must support the <code>control-presentation</code> capability.
An <a data-link-type="dfn" href="#open-screen-protocol-agent" id="ref-for-open-screen-protocol-agent⑥">OSP agent</a> that is a <a data-link-type="dfn" href="https://www.w3.org/TR/presentation-api/#dfn-receiving-user-agent" id="ref-for-dfn-receiving-user-agent①">receiving user agent</a> for the <a data-link-type="biblio" href="#biblio-presentation-api" title="Presentation API">Presentation API</a> must support the <code>receive-presentation</code> capability.
The same OSP agent may be a <a data-link-type="dfn" href="https://www.w3.org/TR/presentation-api/#dfn-controlling-user-agent" id="ref-for-dfn-controlling-user-agent②">controlling user agent</a> and a <a data-link-type="dfn" href="https://www.w3.org/TR/presentation-api/#dfn-receiving-user-agent" id="ref-for-dfn-receiving-user-agent②">receiving user agent</a>.</p>
   <p class="note" role="note"><span class="marker">Note:</span> These roles are independent of which agent was the <a data-link-type="dfn" href="#advertising-agent" id="ref-for-advertising-agent④">advertising agent</a> or the <a data-link-type="dfn" href="#listening-agent" id="ref-for-listening-agent③">listening agent</a> during discovery and connection establishment.</p>
   <p>This is how the <a data-link-type="biblio" href="#biblio-presentation-api" title="Presentation API">Presentation API</a> uses the <a href="#presentation-protocol">§ 7 Presentation Protocol</a>:</p>
   <p>When <a href="https://w3c.github.io/presentation-api/#the-list-of-available-presentation-displays">section
6.4.2</a> says "This list of presentation displays ... is populated based on an
implementation specific discovery mechanism", the <a data-link-type="dfn" href="#controller" id="ref-for-controller③">controller</a> may
use the mDNS, QUIC, <a data-link-type="dfn" href="#agent-info-request" id="ref-for-agent-info-request②">agent-info-request</a>, and <a data-link-type="dfn" href="#presentation-url-availability-request" id="ref-for-presentation-url-availability-request①">presentation-url-availability-request</a> messages defined previously in this spec
to discover receivers.</p>
   <p>When <a href="https://w3c.github.io/presentation-api/#the-list-of-available-presentation-displays">section
6.4.2</a> says "To further save power, ... implementation specific discovery of
presentation displays can be resumed or suspended.", the agent may use the
power saving mechanism defined in the previous section.</p>
   <p>When <a href="https://w3c.github.io/presentation-api/#starting-a-presentation-connection">section 6.3.4</a> says
"Using an implementation specific mechanism, tell U to create a receiving
browsing context with D, presentationUrl, and I as parameters.", U (the
controller) may send a <a data-link-type="dfn" href="#presentation-start-request" id="ref-for-presentation-start-request②">presentation-start-request</a> message to D
(the receiver), with I for the <a data-link-type="dfn" href="https://www.w3.org/TR/presentation-api/#dfn-presentation-identifier" id="ref-for-dfn-presentation-identifier⑤">presentation identifier</a> and presentationUrl
for the selected presentation URL.</p>
   <p>When <a href="https://w3c.github.io/presentation-api/#reconnecting-to-a-presentation">section 6.3.5</a> says to
"establish a presentation connection with newConnection," let U be the
presentationURL of <code>newConnection</code> and I the presentation identifier of <code>newConnection.</code> The agent should send a <a data-link-type="dfn" href="#presentation-connection-open-request" id="ref-for-presentation-connection-open-request②">presentation-connection-open-request</a> message with U for the <code>url</code> and I for
the <code>presentation-id</code>.</p>
   <p>When <a href="https://w3c.github.io/presentation-api/#sending-a-message-through-presentationconnection">section
6.5.2</a> says "Using an implementation specific mechanism, transmit the contents
of messageOrData as the presentation message data and messageType as the
presentation message type to the destination browsing context", the
controller may send a <a data-link-type="dfn" href="#presentation-connection-message" id="ref-for-presentation-connection-message①">presentation-connection-message</a> with
messageOrData for the presentation message data.  Note that the messageType is
embedded in the encoded CBOR type and does not need an additional value in the
message.</p>
   <p>When <a href="https://w3c.github.io/presentation-api/#closing-a-presentationconnection">section 6.5.5</a> says
"Start to signal to the destination browsing context the intention to close the
corresponding PresentationConnection", the agent may send a <a data-link-type="dfn" href="#presentation-connection-close-event" id="ref-for-presentation-connection-close-event②">presentation-connection-close-event</a> message to the other agent with the
destination browsing context and a <a data-link-type="dfn" href="#presentation-change-event" id="ref-for-presentation-change-event②">presentation-change-event</a> when required.</p>
   <p>When <a href="https://w3c.github.io/presentation-api/#terminating-a-presentation-in-a-controlling-browsing-context">section
6.5.6</a> says "Send a termination request for the presentation to its receiving
user agent using an implementation specific mechanism", the controller may send
a <a data-link-type="dfn" href="#presentation-termination-request" id="ref-for-presentation-termination-request④">presentation-termination-request</a> message to the receiver with a <code>reason</code> of <code>application-request</code>.</p>
   <p>When <a href="https://w3c.github.io/presentation-api/#monitoring-incoming-presentation-connections">section
6.7.1</a> says "it MUST listen to and accept incoming connection requests from a
controlling browsing context using an implementation specific
mechanism", the receiver must receive and process the <a data-link-type="dfn" href="#presentation-connection-open-request" id="ref-for-presentation-connection-open-request③">presentation-connection-open-request</a>.</p>
   <p>When <a href="https://w3c.github.io/presentation-api/#monitoring-incoming-presentation-connections">section
6.7.1</a> says "Establish the connection between the controlling and receiving
browsing contexts using an implementation specific mechanism.", the receiver
must send a <a data-link-type="dfn" href="#presentation-connection-open-response" id="ref-for-presentation-connection-open-response③">presentation-connection-open-response</a> message and <a data-link-type="dfn" href="#presentation-change-event" id="ref-for-presentation-change-event③">presentation-change-event</a> messages when required.</p>
   <h2 class="heading settled" data-level="8" id="time-representation"><span class="secno">8. </span><span class="content">Representation Of Time</span><a class="self-link" href="#time-representation"></a></h2>
   <p>The <a href="#remote-playback-protocol">§ 9 Remote Playback Protocol</a> and the <a href="#streaming-protocol">§ 10 Streaming Protocol</a> represent
points of time and durations in terms of a <a data-link-type="dfn" href="#time-scale" id="ref-for-time-scale">time scale</a>.  A <dfn class="dfn-paneled" data-dfn-type="dfn" data-lt="time scale" data-noexport id="time-scale">time
scale</dfn> is a common denominator for time values that allows values to be
expressed as rational numbers without loss of precision.  The <a data-link-type="dfn" href="#time-scale" id="ref-for-time-scale①">time scale</a> is
represented in hertz, such as 90000 for 90000 Hz, a common time scale for
video.</p>
   <h2 class="heading settled" data-level="9" id="remote-playback-protocol"><span class="secno">9. </span><span class="content">Remote Playback Protocol</span><a class="self-link" href="#remote-playback-protocol"></a></h2>
   <p>This section defines the use of the Open Screen Protocol for starting, terminating,
and controlling remote playback of media as defined by the <a data-link-type="biblio" href="#biblio-remote-playback" title="Remote Playback API">Remote Playback API</a>. <a href="#remote-playback-api">§ 9.2 Remote Playback API</a> defines how
APIs in <a data-link-type="biblio" href="#biblio-remote-playback" title="Remote Playback API">Remote Playback API</a> map to the protocol messages
defined in this section.</p>
   <p>For all messages defined in this section, see <a href="#appendix-a">Appendix A: Messages</a> for the full CDDL
definitions.</p>
   <p>To learn which receivers are <a data-link-type="dfn" href="https://w3c.github.io/remote-playback/#dfn-compatible-remote-playback-device" id="ref-for-dfn-compatible-remote-playback-device">compatible remote playback devices</a> for a
particular URL or set of URLs, the controller may send a <a data-link-type="dfn" href="#remote-playback-availability-request" id="ref-for-remote-playback-availability-request">remote-playback-availability-request</a> message with the following values:</p>
   <dl>
    <dt data-md>sources
    <dd data-md>
     <p>A list of <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/media.html#media-resource" id="ref-for-media-resource">media resources</a>, the same as specified in the <a data-link-type="dfn" href="#remote-playback-start-request" id="ref-for-remote-playback-start-request">remote-playback-start-request</a> message.  Must not be empty.</p>
    <dt data-md>headers
    <dd data-md>
     <p>headers that the receiver should use to fetch the
urls.  For example, <a href="https://w3c.github.io/remote-playback/#establishing-a-connection-with-a-remote-playback-device">section 6.2.4 of
the Remote Playback API</a> says that the Accept-Language header should be
provided.</p>
    <dt data-md>watch-duration
    <dd data-md>
     <p>The period of time that the controller is interested in receiving updates
about their URLs, should the availability change.</p>
    <dt data-md>watch-id
    <dd data-md>
     <p>An identifier the receiver must use when sending updates about URL
availability so that the controller knows which URLs the receiver is referring
to.</p>
   </dl>
   <p>In response, the receiver should send a <a data-link-type="dfn" href="#remote-playback-availability-response" id="ref-for-remote-playback-availability-response">remote-playback-availability-response</a> message with the following values:</p>
   <dl>
    <dt data-md>url-availabilities
    <dd data-md>
     <p>A list of URL availability states.  Each state must correspond to the matching URL
from the request by list index.</p>
   </dl>
   <p>The receivers should later (up to the current time plus request
watch-duration) send <a data-link-type="dfn" href="#remote-playback-availability-event" id="ref-for-remote-playback-availability-event">remote-playback-availability-event</a> messages if
URL availabilities change.  Such events contain the following values:</p>
   <dl>
    <dt data-md>watch-id
    <dd data-md>
     <p>The watch-id given in the <a data-link-type="dfn" href="#remote-playback-availability-response" id="ref-for-remote-playback-availability-response①">remote-playback-availability-response</a> used to refer to the remote playback URLs whose availability has changed.</p>
    <dt data-md>url-availabilities
    <dd data-md>
     <p>A list of URL availability states.  Each state must correspond to the URLs from the
request referred to by the watch-id.</p>
   </dl>
   <p>Note that these messages are not broadcasted to all controllers. They are sent
individually to controllers that have requested availability for the URLs that
have changed in availability state within the watch duration of the original
availability request.</p>
   <p>To save power, the controller may disconnect the QUIC connection and
later reconnect to send availability requests and receive availability
responses and updates. The QUIC connection ID may or may not be the same
when reconnecting.</p>
   <p>To start remote playback, the controller may send a <a data-link-type="dfn" href="#remote-playback-start-request" id="ref-for-remote-playback-start-request①">remote-playback-start-request</a> message to the receiver with the following
values:</p>
   <dl>
    <dt data-md>remote-playback-id
    <dd data-md>
     <p>An identifier for this remote playback.  It should be universally unique
among all remote playbacks.</p>
   </dl>
   <p class="note" role="note"><span class="marker">Note:</span> A version 4 (pseudorandom) <a data-link-type="dfn" href="https://tools.ietf.org/html/rfc4122#section-4.4" id="ref-for-section-4.4">UUID</a> is recommended as it meets the
requirements for a remote-playback-id.</p>
   <dl>
    <dt data-md>sources (optional)
    <dd data-md>
     <p>The <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/media.html#media-resource" id="ref-for-media-resource①">media resources</a> that the controller has selected for playback
on the receiver.  Each source must include a <code><a data-link-type="element-sub" href="https://html.spec.whatwg.org/multipage/embedded-content.html#attr-source-src" id="ref-for-attr-source-src">source URL</a></code> and should include an <code><a data-link-type="element-sub" href="https://html.spec.whatwg.org/multipage/embedded-content.html#attr-source-type" id="ref-for-attr-source-type">extended MIME type</a></code> when available
for the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/media.html#media-resource" id="ref-for-media-resource②">media resource</a>.  If <code>sources</code> is missing or empty, the <code>remoting</code> field must be populated, as the controller will use a
streaming session to send encoded media.</p>
    <dt data-md>text-track-urls
    <dd data-md>
     <p>URLs of text tracks associated with the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/media.html#media-resource" id="ref-for-media-resource③">media resources</a>.</p>
    <dt data-md>controls
    <dd data-md>
     <p>Initial controls for modifying the initial state of the remote playback, as
defined in <a href="#remote-playback-state-and-controls">§ 9.1 Remote Playback State and Controls</a>.  The controller may send
controls that are optional for the receiver to support before it knows the
receiver supports them.  If the receiver does not support them, it will
ignore them and the controller will learn that it does not support them from
the <a data-link-type="dfn" href="#remote-playback-start-response" id="ref-for-remote-playback-start-response">remote-playback-start-response</a> message.</p>
    <dt data-md>remoting (optional)
    <dd data-md>
     <p>Parameters for starting a streaming session associated with this
remote playback.  If not included, no streaming session is started.
Required when <code>sources</code> is missing or empty.</p>
   </dl>
   <p>When the receiver receives a <a data-link-type="dfn" href="#remote-playback-start-request" id="ref-for-remote-playback-start-request②">remote-playback-start-request</a> message, it should
send back a <a data-link-type="dfn" href="#remote-playback-start-response" id="ref-for-remote-playback-start-response①">remote-playback-start-response</a> message.  It should do so quickly,
usually before the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/media.html#media-resource" id="ref-for-media-resource④">media resource</a> has been loaded and instead give updates
of the progress of  loading with <a data-link-type="dfn" href="#remote-playback-state-event" id="ref-for-remote-playback-state-event">remote-playback-state-event</a> messages, unless
the receiver decides to not attempt to load the resource at all.  If it chooses
not to, it must respond with the appropriate failure result (such as timeout or
invalid-url).  Additionally, the response must include the following:</p>
   <dl>
    <dt data-md>state
    <dd data-md>
     <p>The initial state of the remote playback, as defined in <a href="#remote-playback-state-and-controls">§ 9.1 Remote Playback State and Controls</a>.</p>
    <dt data-md>remoting (optional)
    <dd data-md>
     <p>A response to the started streaming session associated with this remote playback.
If not included, no streaming session is started.</p>
   </dl>
   <p>If a streaming session is started, streaming messages such a <a data-link-type="dfn" href="#streaming-session-modify-request" id="ref-for-streaming-session-modify-request">streaming-session-modify-request</a> and <a data-link-type="dfn" href="#video-frame" id="ref-for-video-frame">video-frame</a> can be used for the
streaming session as if the streaming session had been started with <a data-link-type="dfn" href="#streaming-session-start-request" id="ref-for-streaming-session-start-request">streaming-session-start-request</a> and <a data-link-type="dfn" href="#streaming-session-start-response" id="ref-for-streaming-session-start-response">streaming-session-start-response</a>. The streaming session may be terminated
before the remote playback is terminated, but if the remote playback is
terminated first, the streaming session associated with it is automatically
terminated.</p>
   <p class="issue" id="issue-9717419d"><a class="self-link" href="#issue-9717419d"></a> Add a back pressure signal for media remoting <a href="https://github.com/w3c/openscreenprotocol/issues/241">[Issue #241]</a></p>
   <p>If the controller wishes to modify the state of the remote playback (for
example, to pause, resume, skip, etc), it may send a <a data-link-type="dfn" href="#remote-playback-modify-request" id="ref-for-remote-playback-modify-request">remote-playback-modify-request</a> message with the following values:</p>
   <dl>
    <dt data-md>remote-playback-id
    <dd data-md>
     <p>The ID of the remote playback to be modified.</p>
    <dt data-md>controls
    <dd data-md>
     <p>Updated controls as defined in <a href="#remote-playback-state-and-controls">§ 9.1 Remote Playback State and Controls</a>.</p>
   </dl>
   <p>When a receiver receives a <a data-link-type="dfn" href="#remote-playback-modify-request" id="ref-for-remote-playback-modify-request①">remote-playback-modify-request</a> it should send a <a data-link-type="dfn" href="#remote-playback-modify-response" id="ref-for-remote-playback-modify-response">remote-playback-modify-response</a> message in reply with the following values:</p>
   <dl>
    <dt data-md>state
    <dd data-md>
     <p>The updated state of the remote playback as defined in <a href="#remote-playback-state-and-controls">§ 9.1 Remote Playback State and Controls</a>.</p>
   </dl>
   <p>When the state of remote playback changes without request for modification from
the controller (such as when the skips or pauses due to user user interaction on
the receiver), the receiver may send a <a data-link-type="dfn" href="#remote-playback-state-event" id="ref-for-remote-playback-state-event①">remote-playback-state-event</a> to the
controller.</p>
   <p>The receiver should send a <a data-link-type="dfn" href="#remote-playback-state-event" id="ref-for-remote-playback-state-event②">remote-playback-state-event</a> message whenever:</p>
   <p>Any of the following methods are called:</p>
   <ul>
    <li data-md>
     <p><code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/media.html#dom-media-fastseek" id="ref-for-dom-media-fastseek">HTMLMediaElement.fastSeek()</a></code></p>
    <li data-md>
     <p><code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/media.html#dom-media-pause" id="ref-for-dom-media-pause">HTMLMediaElement.pause()</a></code></p>
    <li data-md>
     <p><code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/media.html#dom-media-play" id="ref-for-dom-media-play">HTMLMediaElement.play()</a></code></p>
   </ul>
   <p>Any of the following attributes observably change since the last sent <a data-link-type="dfn" href="#remote-playback-state-event" id="ref-for-remote-playback-state-event③">remote-playback-state-event</a> message:</p>
   <ul>
    <li data-md>
     <p><code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/media.html#dom-media-currentsrc" id="ref-for-dom-media-currentsrc">HTMLMediaElement.currentSrc</a></code></p>
    <li data-md>
     <p><code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/media.html#dom-media-networkstate" id="ref-for-dom-media-networkstate">HTMLMediaElement.networkState</a></code></p>
    <li data-md>
     <p><code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/media.html#dom-media-readystate" id="ref-for-dom-media-readystate">HTMLMediaElement.readyState</a></code></p>
    <li data-md>
     <p><code class="idl"><a class="idl-code" data-link-type="attribute" href="https://html.spec.whatwg.org/multipage/media.html#dom-media-error" id="ref-for-dom-media-error">HTMLMediaElement.error</a></code></p>
    <li data-md>
     <p><code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/media.html#dom-media-duration" id="ref-for-dom-media-duration">HTMLMediaElement.duration</a></code></p>
    <li data-md>
     <p><code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/media.html#dom-media-buffered" id="ref-for-dom-media-buffered">HTMLMediaElement.buffered</a></code></p>
    <li data-md>
     <p><code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/media.html#dom-media-seekable" id="ref-for-dom-media-seekable">HTMLMediaElement.seekable</a></code></p>
    <li data-md>
     <p><code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/media.html#dom-media-playbackrate" id="ref-for-dom-media-playbackrate">HTMLMediaElement.playbackRate</a></code></p>
    <li data-md>
     <p><code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/media.html#dom-media-paused" id="ref-for-dom-media-paused">HTMLMediaElement.paused</a></code></p>
    <li data-md>
     <p><code class="idl"><a class="idl-code" data-link-type="attribute" href="https://html.spec.whatwg.org/multipage/media.html#dom-media-seeking" id="ref-for-dom-media-seeking">HTMLMediaElement.seeking</a></code></p>
    <li data-md>
     <p><code class="idl"><a class="idl-code" data-link-type="attribute" href="https://html.spec.whatwg.org/multipage/media.html#dom-media-ended" id="ref-for-dom-media-ended">HTMLMediaElement.ended</a></code></p>
    <li data-md>
     <p><code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/media.html#dom-media-volume" id="ref-for-dom-media-volume">HTMLMediaElement.volume</a></code></p>
    <li data-md>
     <p><code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/media.html#dom-media-muted" id="ref-for-dom-media-muted">HTMLMediaElement.muted</a></code></p>
    <li data-md>
     <p><code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/media.html#dom-media-audiotracks" id="ref-for-dom-media-audiotracks">HTMLMediaElement.audioTracks</a></code></p>
    <li data-md>
     <p><code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/media.html#dom-media-videotracks" id="ref-for-dom-media-videotracks">HTMLMediaElement.videoTracks</a></code></p>
    <li data-md>
     <p><code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/media.html#dom-media-texttracks" id="ref-for-dom-media-texttracks">HTMLMediaElement.textTracks</a></code></p>
    <li data-md>
     <p><code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/media.html#dom-video-videowidth" id="ref-for-dom-video-videowidth">HTMLVideoElement.videoWidth</a></code></p>
    <li data-md>
     <p><code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/media.html#dom-video-videoheight" id="ref-for-dom-video-videoheight">HTMLVideoElement.videoHeight</a></code></p>
   </ul>
   <p>The <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/media.html#timeline-offset" id="ref-for-timeline-offset">timeline offset</a> associated with the playback changes since the last sent <a data-link-type="dfn" href="#remote-playback-state-event" id="ref-for-remote-playback-state-event④">remote-playback-state-event</a> message:</p>
   <p>The <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/media.html#event-media-stalled" id="ref-for-event-media-stalled">stalled</a></code> event needs to fire at the associated <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/media.html#htmlmediaelement" id="ref-for-htmlmediaelement⑤">HTMLMediaElement</a></code> instance.</p>
   <p>More than 250ms pass since the last <a data-link-type="dfn" href="#remote-playback-state-event" id="ref-for-remote-playback-state-event⑤">remote-playback-state-event</a> message
  and any of the following attributes observably change since the last <a data-link-type="dfn" href="#remote-playback-state-event" id="ref-for-remote-playback-state-event⑥">remote-playback-state-event</a> message. Any new continuously changing
  attributes fall under this rule.</p>
   <ul>
    <li data-md>
     <p><code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/media.html#dom-media-played" id="ref-for-dom-media-played">HTMLMediaElement.played</a></code></p>
    <li data-md>
     <p><code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/media.html#dom-media-currenttime" id="ref-for-dom-media-currenttime">HTMLMediaElement.currentTime</a></code></p>
   </ul>
   <p class="note" role="note"><span class="marker">NOTE:</span> A media element is required to fire a <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/media.html#event-media-timeupdate" id="ref-for-event-media-timeupdate">timeupdate</a></code> event every 250ms or sooner.</p>
   <dl>
    <dt data-md>remote-playback-id
    <dd data-md>
     <p>The ID of the remote playback whose state has changed.</p>
    <dt data-md>state
    <dd data-md>
     <p>The updated state of the remote playback, as defined in <a href="#remote-playback-state-and-controls">§ 9.1 Remote Playback State and Controls</a>.</p>
   </dl>
   <p>To terminate the remote playback, the controller may send a <a data-link-type="dfn" href="#remote-playback-termination-request" id="ref-for-remote-playback-termination-request">remote-playback-termination-request</a> message with the following values:</p>
   <dl>
    <dt data-md>remote-playback-id
    <dd data-md>
     <p>The ID of the remote playback to terminate.</p>
    <dt data-md>reason
    <dd data-md>
     <p>The reason the remote playback is being terminated.</p>
   </dl>
   <p>When a receiver receives a <a data-link-type="dfn" href="#remote-playback-termination-request" id="ref-for-remote-playback-termination-request①">remote-playback-termination-request</a>, it should
send back a <a data-link-type="dfn" href="#remote-playback-termination-response" id="ref-for-remote-playback-termination-response">remote-playback-termination-response</a> message to the controller.</p>
   <p>If a receiver terminates a remote playback without a request from the controller
to do so, it must send a <a data-link-type="dfn" href="#remote-playback-termination-event" id="ref-for-remote-playback-termination-event">remote-playback-termination-event</a> message to the
controller with the following values:</p>
   <dl>
    <dt data-md>remote-playback-id
    <dd data-md>
     <p>The ID of the remote playback that was terminated.</p>
    <dt data-md>reason
    <dd data-md>
     <p>The reason the remote playback was terminated.</p>
   </dl>
   <p>As mentioned in <a href="https://w3c.github.io/remote-playback/#disconnecting-from-a-remote-playback-device">Remote Playback
API section 6.2.7</a>, terminating the remote playback means the controller is no
longer controlling the remote playback and does not necessarily stop media from
rendering on the receiver.  Whether or not the receiver stops rendering media depends
upon the implementation of the receiver.</p>
   <h3 class="heading settled" data-level="9.1" id="remote-playback-state-and-controls"><span class="secno">9.1. </span><span class="content">Remote Playback State and Controls</span><a class="self-link" href="#remote-playback-state-and-controls"></a></h3>
   <p>In order for the controller and receiver to stay in sync with regards to the
state of the remote playback, the controller may send controls to modify the state
(for example, via the <a data-link-type="dfn" href="#remote-playback-modify-request" id="ref-for-remote-playback-modify-request②">remote-playback-modify-request</a> message) and the receiver
may send updates about state changes (for example, via the <a data-link-type="dfn" href="#remote-playback-state-event" id="ref-for-remote-playback-state-event⑦">remote-playback-state-event</a> message).</p>
   <p>The controls sent by the controller include the following individual control
values, each of which is optional.  This allows the controller to change one
control value or many control values at once without having to specify all
control values every time.  A non-present control value indicates no change.  A
present control value indicates the change defined below. These controls
intentionally mirror settable attributes and methods of the <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/media.html#htmlmediaelement" id="ref-for-htmlmediaelement⑥">HTMLMediaElement</a></code>.</p>
   <dl>
    <dt data-md>source
    <dd data-md>
     <p>Change the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/media.html#media-resource" id="ref-for-media-resource⑤">media resource</a>. See <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/media.html#dom-media-src" id="ref-for-dom-media-src">HTMLMediaElement.src</a></code> for more details. Must not be used in the initial controls of the <a data-link-type="dfn" href="#remote-playback-start-request" id="ref-for-remote-playback-start-request③">remote-playback-start-request</a> message (which already contains a <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/media.html#media-resource" id="ref-for-media-resource⑥">media resource</a>).</p>
    <dt data-md>preload
    <dd data-md>
     <p>Set how aggressively to preload media. See <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/media.html#dom-media-preload" id="ref-for-dom-media-preload">HTMLMediaElement.preload</a></code> for more details. Should only be used in the initial controls of the <a data-link-type="dfn" href="#remote-playback-start-request" id="ref-for-remote-playback-start-request④">remote-playback-start-request</a> message or when the source is changed.  If not
set in the initial controls, it is left to the receiver to decide.  This is
optional for the receiver to support and if not supported, the receiver will
behave as though it were never set.</p>
    <dt data-md>loop
    <dd data-md>
     <p>Set whether or not to loop media. See <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/media.html#dom-media-loop" id="ref-for-dom-media-loop">HTMLMediaElement.loop</a></code> for more details. Should only be used in the initial control of the <a data-link-type="dfn" href="#remote-playback-start-request" id="ref-for-remote-playback-start-request⑤">remote-playback-start-request</a>.  If not set in the initial controls, it is
assumed to be false.</p>
    <dt data-md>paused
    <dd data-md>
     <p>If true, pause; if false, resume. See <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/media.html#dom-media-pause" id="ref-for-dom-media-pause①">HTMLMediaElement.pause()</a></code> and <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/media.html#dom-media-play" id="ref-for-dom-media-play①">HTMLMediaElement.play()</a></code> for more details.  If not set in the initial controls, it is left to the
receiver to decide.</p>
    <dt data-md>muted
    <dd data-md>
     <p>If true, mute; if false, unmute. See <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/media.html#dom-media-muted" id="ref-for-dom-media-muted①">HTMLMediaElement.muted</a></code> for more details.  If not set in the initial controls, it is left to the
receiver to decide.</p>
    <dt data-md>volume
    <dd data-md>
     <p>Set the audio volume in the range from 0.0 to 1.0 inclusive. See <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/media.html#dom-media-volume" id="ref-for-dom-media-volume①">HTMLMediaElement.volume</a></code> for more details.  If not set in the initial controls, it is left to the
receiver to decide.</p>
    <dt data-md>seek
    <dd data-md>
     <p>Seek to a precise time. See <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/media.html#dom-media-currenttime" id="ref-for-dom-media-currenttime①">HTMLMediaElement.currentTime</a></code> for more details.</p>
    <dt data-md>fast-seek
    <dd data-md>
     <p>Seek to an approximate time as fast as possible. See <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/media.html#dom-media-fastseek" id="ref-for-dom-media-fastseek①">HTMLMediaElement.fastSeek()</a></code> for more details.</p>
    <dt data-md>playback-rate
    <dd data-md>
     <p>Set the rate a which the media plays. See <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/media.html#dom-media-playbackrate" id="ref-for-dom-media-playbackrate①">HTMLMediaElement.playbackRate</a></code> for more details.  If not set in the initial controls, it is left to the
receiver to decide.  This is optional for the receiver to support and if not
supported, the receiver will behave as though it were never set.</p>
    <dt data-md>poster
    <dd data-md>
     <p>Set the URL of an image to show when video data is not available. See <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/media.html#poster-frame" id="ref-for-poster-frame">poster frame</a> for more details. If not set in the initial controls, no poster is used and
the receiver can choose what to render when video data is unavailable.  This
is optional for the receiver to support and if not supported, the receiver
will behave as though it were never set.</p>
    <dt data-md>enabled-audio-track-ids
    <dd data-md>
     <p>Enable included audio tracks by ID and disable all other audio tracks. See <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/media.html#dom-media-audiotracks" id="ref-for-dom-media-audiotracks①">HTMLMediaElement.audioTracks</a></code> for more details.</p>
    <dt data-md>selected-video-track-id
    <dd data-md>
     <p>Select the given video track by ID and unselect all other video tracks. See <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/media.html#dom-media-videotracks" id="ref-for-dom-media-videotracks①">HTMLMediaElement.videoTracks</a></code> for more details.</p>
    <dt data-md>added-text-tracks
    <dd data-md>
     <p>Add text tracks with the given kinds, labels, and languages. See <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/media.html#dom-media-addtexttrack" id="ref-for-dom-media-addtexttrack">HTMLMediaElement.addTextTrack()</a></code> for more details.  This is optional for the receiver to support and if not
supported, the receiver will behave as though it were never set.</p>
    <dt data-md>changed-text-tracks
    <dd data-md>
     <p>Change text tracks by ID.  All other text tracks are left
unchanged.  Set the mode, add cues, and remove cues by id. See <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/media.html#dom-media-texttracks" id="ref-for-dom-media-texttracks①">HTMLMediaElement.textTracks</a></code> for more details.  Note that future specifications or extensions to this
specifications are expected to add new fields to the <a data-link-type="dfn" href="#text-track-cue" id="ref-for-text-track-cue">text-track-cue</a> (such as text size, alignment, position, etc).  Adding and removing
cues is optional for the receiver to support and if not supported, the
receiver will behave as though no cues were added or removed (both adding
and removing are indicated via the support for "added-cues").  As specified in <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/media.html#dom-media-texttracks" id="ref-for-dom-media-texttracks②">HTMLMediaElement.textTracks</a></code>,
if a cue ID is invalid (removing an un-added ID or adding an ID twice, for example),
the receiver may reject the text track change.</p>
   </dl>
   <div class="note" role="note">
    <table>
     <tbody>
      <tr>
       <th>Field
       <th>Default value for the initial controls
       <th>Receiver support
      <tr>
       <td>source
       <td><code>urls</code> in <a data-link-type="dfn" href="#remote-playback-start-request" id="ref-for-remote-playback-start-request⑥">remote-playback-start-request</a>
       <td>Required
      <tr>
       <td>preload
       <td>Decided by the receiver
       <td>Not required
      <tr>
       <td>loop
       <td>False
       <td>Required
      <tr>
       <td>paused
       <td>Decided by the receiver
       <td>Required
      <tr>
       <td>muted
       <td>Decided by the receiver
       <td>Required
      <tr>
       <td>volume
       <td>Decided by the receiver
       <td>Required
      <tr>
       <td>seek
       <td>(None)
       <td>Required
      <tr>
       <td>fast-seek
       <td>(None)
       <td>Required
      <tr>
       <td>playback-rate
       <td>Decided by the receiver
       <td>Not required
      <tr>
       <td>poster
       <td>Decided by the receiver
       <td>Not required
      <tr>
       <td>enabled-audio-track-ids
       <td>(None)
       <td>Required
      <tr>
       <td>selected-video-track-id
       <td>(None)
       <td>Required
      <tr>
       <td>added-text-tracks
       <td>(None)
       <td>Not required
      <tr>
       <td>changed-text-tracks
       <td>(None)
       <td>Not required
    </table>
   </div>
   <p>The states sent by the receiver include the following individual state values,
each of which is optional.  This allows the receiver to update the controller
about more than one state value at once without having to specify all
state values every time.  A non-present state value indicates the state has not
changed.</p>
   <dl>
    <dt data-md>supports
    <dd data-md>
     <p>The controls the receiver supports.  These may differ according to the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/media.html#media-resource" id="ref-for-media-resource⑦">media
resource</a> and should not change unless the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/media.html#media-resource" id="ref-for-media-resource⑧">media resource</a> also changes.
The default is empty (support for nothing)
for the initial state in the <a data-link-type="dfn" href="#remote-playback-start-response" id="ref-for-remote-playback-start-response②">remote-playback-start-response</a> message.</p>
    <dt data-md>source
    <dd data-md>
     <p>The current <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/media.html#media-resource" id="ref-for-media-resource⑨">media resource</a>. See <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/media.html#dom-media-currentsrc" id="ref-for-dom-media-currentsrc①">HTMLMediaElement.currentSrc</a></code>.
Must be present in the initial state in the <a data-link-type="dfn" href="#remote-playback-start-response" id="ref-for-remote-playback-start-response③">remote-playback-start-response</a> message
so the controller knows what <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/media.html#media-resource" id="ref-for-media-resource①⓪">media resource</a> was selected for playback.</p>
    <dt data-md>loading
    <dd data-md>
     <p>The state of network activity for loading the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/media.html#media-resource" id="ref-for-media-resource①①">media resource</a>. See <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/media.html#dom-media-networkstate" id="ref-for-dom-media-networkstate①">HTMLMediaElement.networkState</a></code>.
The default is empty (<code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/media.html#dom-media-network_empty" id="ref-for-dom-media-network_empty">NETWORK_EMPTY</a></code>)
for the initial state in the <a data-link-type="dfn" href="#remote-playback-start-response" id="ref-for-remote-playback-start-response④">remote-playback-start-response</a> message.</p>
    <dt data-md>loaded
    <dd data-md>
     <p>The state of the loaded media (whether enough is loaded to play). See <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/media.html#dom-media-readystate" id="ref-for-dom-media-readystate①">HTMLMediaElement.readyState</a></code>.
The default is nothing (<code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/media.html#dom-media-have_nothing" id="ref-for-dom-media-have_nothing">HAVE_NOTHING</a></code>)
for the initial state in the <a data-link-type="dfn" href="#remote-playback-start-response" id="ref-for-remote-playback-start-response⑤">remote-playback-start-response</a> message.</p>
    <dt data-md>error
    <dd data-md>
     <p>A major error occurred which prevents the remote playback from continuing. See <code class="idl"><a class="idl-code" data-link-type="attribute" href="https://html.spec.whatwg.org/multipage/media.html#dom-media-error" id="ref-for-dom-media-error①">HTMLMediaElement.error</a></code> and <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/media.html#concept-mediaerror-code" id="ref-for-concept-mediaerror-code">media error codes</a>.
The default is no error
for the initial state in the <a data-link-type="dfn" href="#remote-playback-start-response" id="ref-for-remote-playback-start-response⑥">remote-playback-start-response</a> message.</p>
    <dt data-md>epoch
    <dd data-md>
     <p>The "zero time" of the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/media.html#media-timeline" id="ref-for-media-timeline">media timeline</a>, in milliseconds relative to the
epoch. See <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/media.html#timeline-offset" id="ref-for-timeline-offset①">timeline offset</a> and <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/media.html#dom-media-getstartdate" id="ref-for-dom-media-getstartdate">HTMLMediaElement.getStartDate()</a></code>.
The default is an unknown epoch for the initial state in the <a data-link-type="dfn" href="#remote-playback-start-response" id="ref-for-remote-playback-start-response⑦">remote-playback-start-response</a> message, which is represented by null.</p>
    <dt data-md>duration
    <dd data-md>
     <p>The duration of the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/media.html#media-timeline" id="ref-for-media-timeline①">media timeline</a>, in seconds. See <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/media.html#dom-media-duration" id="ref-for-dom-media-duration①">HTMLMediaElement.duration</a></code>.
The default is an unknown duration
for the initial state in the <a data-link-type="dfn" href="#remote-playback-start-response" id="ref-for-remote-playback-start-response⑧">remote-playback-start-response</a> message,
which is represented by null.</p>
    <dt data-md>buffered-time-ranges
    <dd data-md>
     <p>The time ranges for which media has been buffered. See <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/media.html#dom-media-buffered" id="ref-for-dom-media-buffered①">HTMLMediaElement.buffered</a></code>.
The default is an empty array
for the initial state in the <a data-link-type="dfn" href="#remote-playback-start-response" id="ref-for-remote-playback-start-response⑨">remote-playback-start-response</a> message.</p>
    <dt data-md>played-time-ranges
    <dd data-md>
     <p>The time ranges reached by the playback position during normal playback. See <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/media.html#dom-media-played" id="ref-for-dom-media-played①">HTMLMediaElement.played</a></code>.
The default is an empty array
for the initial state in the <a data-link-type="dfn" href="#remote-playback-start-response" id="ref-for-remote-playback-start-response①⓪">remote-playback-start-response</a> message.</p>
    <dt data-md>seekable-time-ranges
    <dd data-md>
     <p>The time ranges for which media is seekable by the controller or the receiver. See <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/media.html#dom-media-seekable" id="ref-for-dom-media-seekable①">HTMLMediaElement.seekable</a></code>.
The default is an empty array
for the initial state in the <a data-link-type="dfn" href="#remote-playback-start-response" id="ref-for-remote-playback-start-response①①">remote-playback-start-response</a> message.</p>
    <dt data-md>position
    <dd data-md>
     <p>The playback position. See <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/media.html#official-playback-position" id="ref-for-official-playback-position">official playback position</a> and <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/media.html#dom-media-currenttime" id="ref-for-dom-media-currenttime②">HTMLMediaElement.currentTime</a></code>.
The default is 0
for the initial state in the <a data-link-type="dfn" href="#remote-playback-start-response" id="ref-for-remote-playback-start-response①②">remote-playback-start-response</a> message.</p>
    <dt data-md>playbackRate
    <dd data-md>
     <p>The current rate of playback on a scale where 1.0 is "normal speed". See <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/media.html#dom-media-playbackrate" id="ref-for-dom-media-playbackrate②">HTMLMediaElement.playbackRate</a></code>.
The default is 1.0
for the initial state in the <a data-link-type="dfn" href="#remote-playback-start-response" id="ref-for-remote-playback-start-response①③">remote-playback-start-response</a> message.</p>
    <dt data-md>paused
    <dd data-md>
     <p>Whether media is paused or not. See <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/media.html#dom-media-paused" id="ref-for-dom-media-paused①">HTMLMediaElement.paused</a></code>.
The default is false
for the initial state in the <a data-link-type="dfn" href="#remote-playback-start-response" id="ref-for-remote-playback-start-response①④">remote-playback-start-response</a> message.</p>
    <dt data-md>seeking
    <dd data-md>
     <p>Whether the receiver is seeking or not. See <code class="idl"><a class="idl-code" data-link-type="attribute" href="https://html.spec.whatwg.org/multipage/media.html#dom-media-seeking" id="ref-for-dom-media-seeking①">HTMLMediaElement.seeking</a></code>.
The default is false
for the initial state in the <a data-link-type="dfn" href="#remote-playback-start-response" id="ref-for-remote-playback-start-response①⑤">remote-playback-start-response</a> message.</p>
    <dt data-md>stalled
    <dd data-md>
     <p>If true, media is not playing because not enough media is loaded, and false otherwise. See
the <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/media.html#event-media-stalled" id="ref-for-event-media-stalled①">stalled</a></code> event.
The default is false
for the initial state in the <a data-link-type="dfn" href="#remote-playback-start-response" id="ref-for-remote-playback-start-response①⑥">remote-playback-start-response</a> message.</p>
    <dt data-md>ended
    <dd data-md>
     <p>Whether media has reached the end or not. See <code class="idl"><a class="idl-code" data-link-type="attribute" href="https://html.spec.whatwg.org/multipage/media.html#dom-media-ended" id="ref-for-dom-media-ended①">HTMLMediaElement.ended</a></code>.
The default is false
for the initial state in the <a data-link-type="dfn" href="#remote-playback-start-response" id="ref-for-remote-playback-start-response①⑦">remote-playback-start-response</a> message.</p>
    <dt data-md>volume
    <dd data-md>
     <p>The current volume of playback on a scale of 0.0 to 1.0. See <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/media.html#dom-media-volume" id="ref-for-dom-media-volume②">HTMLMediaElement.volume</a></code>.
The default is 1.0
for the initial state in the <a data-link-type="dfn" href="#remote-playback-start-response" id="ref-for-remote-playback-start-response①⑧">remote-playback-start-response</a> message.</p>
    <dt data-md>muted
    <dd data-md>
     <p>True if audio is muted (overriding the volume value) and false otherwise.
See <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/media.html#dom-media-muted" id="ref-for-dom-media-muted②">HTMLMediaElement.muted</a></code>.
The default is false
for the initial state in the <a data-link-type="dfn" href="#remote-playback-start-response" id="ref-for-remote-playback-start-response①⑨">remote-playback-start-response</a> message.</p>
    <dt data-md>resolution
    <dd data-md>
     <p>The "intrinsic width" and "intrinsic width" of the video. See <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/media.html#dom-video-videowidth" id="ref-for-dom-video-videowidth①">HTMLVideoElement.videoWidth</a></code> and <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/media.html#dom-video-videoheight" id="ref-for-dom-video-videoheight①">HTMLVideoElement.videoHeight</a></code>.
The default is an unknown resolution
for the initial state in the <a data-link-type="dfn" href="#remote-playback-start-response" id="ref-for-remote-playback-start-response②⓪">remote-playback-start-response</a> message,
which is represented by null.</p>
    <dt data-md>audio-tracks
    <dd data-md>
     <p>The available audio tracks, which can individually enabled or disabled. See <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/media.html#dom-media-audiotracks" id="ref-for-dom-media-audiotracks②">HTMLMediaElement.audioTracks</a></code>.
The default is an empty array
for the initial state in the <a data-link-type="dfn" href="#remote-playback-start-response" id="ref-for-remote-playback-start-response②①">remote-playback-start-response</a> message.</p>
    <dt data-md>video-tracks
    <dd data-md>
     <p>The available video tracks.  Only one may be selected. See <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/media.html#dom-media-videotracks" id="ref-for-dom-media-videotracks②">HTMLMediaElement.videoTracks</a></code>.
The default is an empty array
for the initial state in the <a data-link-type="dfn" href="#remote-playback-start-response" id="ref-for-remote-playback-start-response②②">remote-playback-start-response</a> message.</p>
    <dt data-md>text-tracks
    <dd data-md>
     <p>The available text tracks, which can be individually shown, hidden, or disabled. See <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/media.html#dom-media-texttracks" id="ref-for-dom-media-texttracks③">HTMLMediaElement.textTracks</a></code>.
The controller can also add cues to and remove cues from text tracks.
The default is an empty array
for the initial state in the <a data-link-type="dfn" href="#remote-playback-start-response" id="ref-for-remote-playback-start-response②③">remote-playback-start-response</a> message.</p>
   </dl>
   <p>Media positions, durations, and time ranges are defined in terms of the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/media.html#media-timeline" id="ref-for-media-timeline②">media
timeline</a> specified in HTML, which are fractional seconds between zero and the
media duration.</p>
   <p class="note" role="note"><span class="marker">NOTE:</span> An Open Screen agent can convert between values on the media timeline and
the media sync time sent with individual media frames using the steps in <a href="#appendix-e">Appendix E: Media Time Conversions</a>.</p>
   <div class="note" role="note">
    <table>
     <tbody>
      <tr>
       <th>Field
       <th>Default value for the initial state
      <tr>
       <td>supports
       <td>Empty
      <tr>
       <td>source
       <td><code>url</code> in <code>state</code> in <a data-link-type="dfn" href="#remote-playback-start-response" id="ref-for-remote-playback-start-response②④">remote-playback-start-response</a> (required field)
      <tr>
       <td>loading
       <td><code>empty</code>
      <tr>
       <td>loaded
       <td><code>nothing</code>
      <tr>
       <td>error
       <td>No error
      <tr>
       <td>epoch
       <td><code>null</code>
      <tr>
       <td>duration
       <td><code>null</code>
      <tr>
       <td>buffered-time-ranges
       <td>Empty array
      <tr>
       <td>played-time-ranges
       <td>Empty array
      <tr>
       <td>seekable-time-ranges
       <td>Empty array
      <tr>
       <td>position
       <td>0.0
      <tr>
       <td>playbackRate
       <td>1.0
      <tr>
       <td>paused
       <td>False
      <tr>
       <td>seeking
       <td>False
      <tr>
       <td>stalled
       <td>False
      <tr>
       <td>ended
       <td>False
      <tr>
       <td>volume
       <td>1.0
      <tr>
       <td>muted
       <td>False
      <tr>
       <td>resolution
       <td><code>null</code>
      <tr>
       <td>audio-tracks
       <td>Empty array
      <tr>
       <td>video-tracks
       <td>Empty array
      <tr>
       <td>text-tracks
       <td>Empty array
    </table>
   </div>
   <h3 class="heading settled" data-level="9.2" id="remote-playback-api"><span class="secno">9.2. </span><span class="content">Remote Playback API</span><a class="self-link" href="#remote-playback-api"></a></h3>
   <p>An <a data-link-type="dfn" href="#open-screen-protocol-agent" id="ref-for-open-screen-protocol-agent⑦">Open Screen Protocol agent</a> that implements the <a data-link-type="biblio" href="#biblio-remote-playback" title="Remote Playback API">Remote Playback API</a> must support the <code>control-remote-playback</code> capability.  It may support the <code>send-streaming</code> capability so it can send <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/media.html#htmlmediaelement" id="ref-for-htmlmediaelement⑦">HTMLMediaElement</a></code> media data through media
remoting.</p>
   <p>An an <a data-link-type="dfn" href="#open-screen-protocol-agent" id="ref-for-open-screen-protocol-agent⑧">OSP agent</a> that is a <a data-link-type="dfn" href="https://w3c.github.io/remote-playback/#dfn-remote-playback-devices" id="ref-for-dfn-remote-playback-devices①">remote playback device</a> for the <a data-link-type="biblio" href="#biblio-remote-playback" title="Remote Playback API">Remote Playback API</a> must support the <code>receive-remote-playback</code> capability.  It may support the <code>receive-streaming</code> capability so it can receive <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/media.html#htmlmediaelement" id="ref-for-htmlmediaelement⑧">HTMLMediaElement</a></code> data through media remoting.</p>
   <p>The same OSP agent may implement both the <a data-link-type="biblio" href="#biblio-remote-playback" title="Remote Playback API">Remote Playback API</a> and be a <a data-link-type="dfn" href="https://w3c.github.io/remote-playback/#dfn-remote-playback-devices" id="ref-for-dfn-remote-playback-devices②">remote playback device</a> for that API.</p>
   <p class="note" role="note"><span class="marker">Note:</span> These roles are independent of which agent was the <a data-link-type="dfn" href="#advertising-agent" id="ref-for-advertising-agent⑤">advertising agent</a> or the <a data-link-type="dfn" href="#listening-agent" id="ref-for-listening-agent④">listening agent</a> during discovery and connection establishment.</p>
   <p>This is how the <a data-link-type="biblio" href="#biblio-remote-playback" title="Remote Playback API">Remote Playback API</a> uses the
messages defined in <a href="#remote-playback-protocol">§ 9 Remote Playback Protocol</a>:</p>
   <p>When <a href="https://w3c.github.io/remote-playback/#the-list-of-available-remote-playback-devices">section
5.2.1.2</a> says "This list contains <a data-link-type="dfn" href="https://w3c.github.io/remote-playback/#dfn-remote-playback-devices" id="ref-for-dfn-remote-playback-devices③">remote playback devices</a> and is populated
based on an implementation specific discovery mechanism" and <a href="https://w3c.github.io/remote-playback/#the-list-of-available-remote-playback-devices">section
5.2.1.4</a> says "Retrieve available remote playback devices (using an
implementation specific mechanism)", the user agent may use the mDNS, QUIC, <a data-link-type="dfn" href="#agent-info-request" id="ref-for-agent-info-request③">agent-info-request</a>, and <a data-link-type="dfn" href="#remote-playback-availability-request" id="ref-for-remote-playback-availability-request①">remote-playback-availability-request</a> messages
defined previously in this spec to discover <a data-link-type="dfn" href="#receiver" id="ref-for-receiver④">receivers</a>.  The <a data-link-type="dfn" href="#remote-playback-availability-request" id="ref-for-remote-playback-availability-request②">remote-playback-availability-request</a> URLs must contain the <a data-link-type="dfn" href="https://w3c.github.io/remote-playback/#dfn-availability-sources-set" id="ref-for-dfn-availability-sources-set">availability
sources set</a>.</p>
   <p>When <a href="https://w3c.github.io/remote-playback/#establishing-a-connection-with-a-remote-playback-device">section
5.2.4</a> says "Request connection of remote to device. The implementation of this
step is specific to the user agent." and "Synchronize the current media element
state with the remote playback state", the controller may send the <a data-link-type="dfn" href="#remote-playback-start-request" id="ref-for-remote-playback-start-request⑦">remote-playback-start-request</a> message to the receiver to start remote
playback.  The <a data-link-type="dfn" href="#remote-playback-start-request" id="ref-for-remote-playback-start-request⑧">remote-playback-start-request</a> URLs must contain the <a data-link-type="dfn" href="https://w3c.github.io/remote-playback/#dfn-remote-playback-source" id="ref-for-dfn-remote-playback-source">remote
playback source</a>.  The current <a data-link-type="biblio" href="#biblio-remote-playback" title="Remote Playback API">Remote Playback API</a> only
allows a single source, but the protocol allows for several and future versions
of <a data-link-type="biblio" href="#biblio-remote-playback" title="Remote Playback API">Remote Playback API</a> may allow for several.</p>
   <p>When <a href="https://w3c.github.io/remote-playback/#establishing-a-connection-with-a-remote-playback-device">section
5.2.4</a> says "The mechanism that is used to connect the user agent with the
remote playback device and play the remote playback source is an implementation
choice of the user agent. The connection will likely have to provide a two-way
messaging abstraction capable of carrying media commands to the remote playback
device and receiving media playback state in order to keep the media element
state and remote playback state in sync", the controller may send <a data-link-type="dfn" href="#remote-playback-modify-request" id="ref-for-remote-playback-modify-request③">remote-playback-modify-request</a> messages to the receiver to change the remote playback state
based on changes to the local media element and receive <a data-link-type="dfn" href="#remote-playback-modify-response" id="ref-for-remote-playback-modify-response①">remote-playback-modify-response</a> and <a data-link-type="dfn" href="#remote-playback-state-event" id="ref-for-remote-playback-state-event⑧">remote-playback-state-event</a> messages to
change the local media element based on changes to the remote playback state.</p>
   <p>When <a href="https://w3c.github.io/remote-playback/#disconnecting-from-a-remote-playback-device">section
5.2.7</a> says "Request disconnection of remote from the device. The
implementation of this step is specific to the user agent," the controller may
send the <a data-link-type="dfn" href="#remote-playback-termination-request" id="ref-for-remote-playback-termination-request②">remote-playback-termination-request</a> message to the receiver.</p>
   <h2 class="heading settled" data-level="10" id="streaming-protocol"><span class="secno">10. </span><span class="content">Streaming Protocol</span><a class="self-link" href="#streaming-protocol"></a></h2>
   <p>This section defines the use of the Open Screen Protocol for streaming
media from a <a data-link-type="dfn" href="#media-sender" id="ref-for-media-sender">media sender</a> to a <a data-link-type="dfn" href="#media-receiver" id="ref-for-media-receiver">media receiver</a>.</p>
   <p>If an <a data-link-type="dfn" href="#open-screen-protocol-agent" id="ref-for-open-screen-protocol-agent⑨">Open Screen Protocol agent</a> is a media sender, it must advertise the <code>send-streaming</code> capability.  If an OSP agent is a media receiver, it must
advertise the <code>receive-streaming</code> capability.  The same agent may be a media
sender and a media receiver.</p>
   <p class="note" role="note"><span class="marker">Note:</span> These roles are independent of which agent was the <a data-link-type="dfn" href="#advertising-agent" id="ref-for-advertising-agent⑥">advertising agent</a> or the <a data-link-type="dfn" href="#listening-agent" id="ref-for-listening-agent⑤">listening agent</a> during discovery and connection establishment.</p>
   <h3 class="heading settled" data-level="10.1" id="streaming-protocol-capabilities"><span class="secno">10.1. </span><span class="content">Streaming Protocol Capabilities</span><a class="self-link" href="#streaming-protocol-capabilities"></a></h3>
    If the advertiser is already authenticated, the requester has the ability to
request additional information by sending an <a data-link-type="dfn" href="#streaming-capabilities-request" id="ref-for-streaming-capabilities-request">streaming-capabilities-request</a> message, and receive back a <a data-link-type="dfn" href="#streaming-capabilities-response" id="ref-for-streaming-capabilities-response">streaming-capabilities-response</a> message with the
following fields: 
   <dl>
    <dt data-md>receive-audio (required)
    <dd data-md>
     <p>A list of capabilities for receiving audio. For an explanation of fields, see below.</p>
    <dt data-md>receive-video (required)
    <dd data-md>
     <p>A list of capabilities for receiving video. For an explanation of fields, see below.</p>
   </dl>
   <p>The format type is used as the basis for audio and video capabilities.
Formats are composed of the following fields:</p>
   <dl>
    <dt data-md>codec-name (required)
    <dd data-md>
     <p>A fully qualified codec string listed in the <a data-link-type="biblio" href="#biblio-webcodecs-codec-registry" title="WebCodecs Codec Registry">[WEBCODECS-CODEC-REGISTRY]</a> and further
 specified by the codec-specific registrations referenced in that registry.</p>
   </dl>
   <p>For <code>codec-name</code>, Open Screen agents may also accept a single-codec <a data-link-type="dfn" href="https://tools.ietf.org/html/rfc6381#section-3" id="ref-for-section-3">codec
parameter</a> as described in <a data-link-type="biblio" href="#biblio-rfc6381" title="The &apos;Codecs&apos; and &apos;Profiles&apos; Parameters for &quot;Bucket&quot; Media Types">[RFC6381]</a> for codecs not listed in the <a data-link-type="biblio" href="#biblio-webcodecs-codec-registry" title="WebCodecs Codec Registry">[WEBCODECS-CODEC-REGISTRY]</a>.</p>
   <p>Audio capabilities are composed of the above format type, with the following
additional fields:</p>
   <dl>
    <dt data-md>max-audio-channels (optional)
    <dd data-md>
     <p>An optional field indicating the maximum amount of audio
channels the media receiver is capable of supporting. Default value is "2," meaning
a stereo speaker channel setup.</p>
    <dt data-md>min-bit-rate (optional)
    <dd data-md>
     <p>An optional field indicating the minimum audio bit rate that
the media receiver can handle, in kilobits per second. Default is no minimum.</p>
   </dl>
   <p>Video capabilities are similarly composed of the above format type, with the
following additional fields:</p>
   <dl>
    <dt data-md>max-resolution (optional)
    <dd data-md>
     <p>An optional field indicating the maximum video-resolution (width, height)
that the media receiver is capable of processing. Default is no maximum.</p>
    <dt data-md>max-frames-per-second (optional)
    <dd data-md>
     <p>An optional field indicating the maximum frames-per-second the media receiver is
capable of processing. Default is no maximum.</p>
    <dt data-md>max-pixels-per-second (optional)
    <dd data-md>
     <p>An optional field indicating the maximum pixels-per-second the media receiver is
capable of processing, in pixels per second. Default is no maximum.</p>
    <dt data-md>min-video-bit-rate (optional)
    <dd data-md>
     <p>An optional field indicating the minimum video bit rate the device is
capable of processing, in kilobits per second. Default is no minimum.</p>
    <dt data-md>aspect-ratio (optional)
    <dd data-md>
     <p>An optional field indicating what its ideal aspect ratio is, e.g. a 16:10
display could return this value as 1.6 to indicate its preferred content
scaling. Default is none.</p>
    <dt data-md>color-gamut (optional)
    <dd data-md>
     <p>An optional field indicating the widest color space that can be decoded and
rendered by the media receiver.  The media sender may use this value to
determine how to encode video, and should assume all narrower color spaces
are supported.  Valid values correspond to <a href="https://w3c.github.io/media-capabilities/#colorgamut">ColorGamut</a> in the <a data-link-type="biblio" href="#biblio-media-capabilities" title="Media Capabilities">Media Capabilities</a> API.  The default value is
"srgb".</p>
   </dl>
   <p class="note" role="note"><span class="marker">NOTE:</span> Support for "p3" implies support for "srgb", and support for "rec2020"
implies support for "p3" and "srgb".</p>
   <dl>
    <dt data-md>hdr-formats (optional)
    <dd data-md>
     <p>An optional field indicating what HDR transfer functions and metadata formats
can be decoded and rendered by the media receiver.  Each <code>video-hdr-format</code> consists of two fields, <code>transfer-function</code> and <code>hdr-metadata</code>.</p>
     <p>The <code>transfer-function</code> field must be a valid <a href="https://w3c.github.io/media-capabilities/#transferfunction">TransferFunction</a> and the <code>hdr-metadata</code> field must be a valid <a href="https://w3c.github.io/media-capabilities/#hdrmetadatatype">HdrMetadataType</a>, both defined in the <a data-link-type="biblio" href="#biblio-media-capabilities" title="Media Capabilities">Media Capabilities</a> API.</p>
     <p>If a <code>video-hdr-format</code> is provided with a <code>transfer-function</code> but no <code>hdr-metadata</code>, then the media receiver can render the <code>transfer-function</code> without any associated metadata.  (This is the case, for example, with the
"hlg" <code>transfer-function</code>.)</p>
     <p>The media receiver should ignore duplicate entries in <code>hdr-formats.</code> If no <code>hdr-formats</code> are listed, then the media reciever cannot decode any
HDR formats.</p>
    <dt data-md>native-resolutions (optional)
    <dd data-md>
     <p>An optional field indicating what video-resolutions the media receiver supports and
considers to be "native," meaning that scaling is not required.
The default value is none.</p>
    <dt data-md>supports-scaling (optional)
    <dd data-md>
     <p>An optional boolean field indicating whether the media receiver can scale
content provided in a video-resolution not listed in the native-resolutions
list (if provided) or of a different aspect ratio. The default value is
true.</p>
    <dt data-md>supports-rotation (optional)
    <dd data-md>
     <p>An optional boolean field indicating whether the media receiver can receive
video frames with the rotation field set. The default value is true.</p>
   </dl>
   <h3 class="heading settled" data-level="10.2" id="streaming-sessions"><span class="secno">10.2. </span><span class="content">Sessions</span><a class="self-link" href="#streaming-sessions"></a></h3>
   <p>To start a streaming session, a sender may send a <a data-link-type="dfn" href="#streaming-session-start-request" id="ref-for-streaming-session-start-request①">streaming-session-start-request</a> message with the following fields:</p>
   <dl>
    <dt data-md>streaming-session-id
    <dd data-md>
     <p>Identifies the streaming session.  Must be unique for the (sender,
receiver) pair.  Can be used later to modify or terminate a
streaming session.  These IDs should be treated like other IDs
with regards to the <code>state-token</code> as specified in <a href="#requests-responses-watches">§ 11 Requests, Responses, and Watches</a>.</p>
    <dt data-md>desired-stats-interval
    <dd data-md>
     <p>Indicates the frequency the receiver should send stats messages to
the sender.</p>
    <dt data-md>stream-offers
    <dd data-md>
     <p>Indicates the streams that the receiver can request from the sender.</p>
   </dl>
   <p>Each stream offer contains the following fields:</p>
   <dl>
    <dt data-md>media-stream-id
    <dd data-md>
     <p>Identifies the media stream being offered.  Must be unique within
the streaming session.  Can be used by the receiver to request the
media session.  These IDs should be treated like other IDs
with regards to the <code>state-token</code> as specified in <a href="#requests-responses-watches">§ 11 Requests, Responses, and Watches</a>.</p>
    <dt data-md>display-name
    <dd data-md>
     <p>An optional name intended to be shown to a user, such that the
receiver may allow the user to choose which media streams to
receive, or if they are received automatically by the receiver,
give the user some information about what the media stream is.</p>
    <dt data-md>audio
    <dd data-md>
     <p>A list of audio encodings offered.  An audio encoding is a series
of encoded audio frames.  Encodings define fields needed by
the receiver to know how to decode the encoding, such as codec.
They can differ by codec and related fields, but should be different
encodings of the same audio.</p>
    <dt data-md>video
    <dd data-md>
     <p>A list of video encodings offered.  A video encoding is a series of
encoded video frames.  Encodings define fields needed by the
receiver to know how to decode the encoding, such as codec and
default duration.  They can differ by codec and potentially other
fields, but should be different encodings of the same video.</p>
    <dt data-md>data
    <dd data-md>
     <p>A list of data encodings offered.  A data encoding is a series of
data frames.  Encodings define fields needed by the
receiver to know how to interpret the encoding, such as data type and
default duration.  They can differ by data type and potentially other
fields, but should be different encodings of the same data.
(For encodings of different data, use distinct media streams,
 not distinct encodints with the same media stream).</p>
   </dl>
   <p>Each audio encoding offered defines the following fields:</p>
   <dl>
    <dt data-md>encoding-id
    <dd data-md>
     <p>Identifies the audio encoding being offered.  Must be unique within
the media stream.  These IDs should be treated like request IDs
with regards to the <code>state-token</code> as specified in <a href="#requests-responses-watches">§ 11 Requests, Responses, and Watches</a>.</p>
    <dt data-md>codec-name
    <dd data-md>
     <p>The name of the codec used by the encoding, following the same
rules as <code>codec-name</code> in <a href="#streaming-protocol-capabilities">§ 10.1 Streaming Protocol Capabilities</a>.</p>
    <dt data-md>time-scale
    <dd data-md>
     <p>The <a data-link-type="dfn" href="#time-scale" id="ref-for-time-scale②">time scale</a> used by all audio frames.  This allows senders to
make audio-frame messages smaller by not including the time scale
in each one.</p>
    <dt data-md>default-duration:
    <dd data-md>
     <p>The duration of an audio frame.  This allows senders to make
audio-frame messages smaller by not including the duration for
audio-frame messages that have the default duration.</p>
   </dl>
   <p>Each video encoding offered defines the following fields:</p>
   <dl>
    <dt data-md>encoding-id
    <dd data-md>
     <p>Identifies the video encoding being offered.  Must be unique within
the media stream.  These IDs should be treated like request IDs
with regards to the <code>state-token</code> as specified in <a href="#requests-responses-watches">§ 11 Requests, Responses, and Watches</a>.</p>
    <dt data-md>codec-name
    <dd data-md>
     <p>The name of the codec used by the encoding, following the same
rules as <code>codec-name</code> in <a href="#streaming-protocol-capabilities">§ 10.1 Streaming Protocol Capabilities</a>.</p>
    <dt data-md>time-scale
    <dd data-md>
     <p>The <a data-link-type="dfn" href="#time-scale" id="ref-for-time-scale③">time scale</a> used by all video frames.  This allows senders to
make video-frame messages smaller by not including the time scale
in each one.</p>
    <dt data-md>default-duration:
    <dd data-md>
     <p>The default duration of a video frame.  This allows senders to make
video-frame messages smaller by not including the duration for
video-frame messages that have the default duration.</p>
    <dt data-md>default-rotation:
    <dd data-md>
     <p>The default rotation of a video frame.  This allows senders to make
video-frame messages smaller by not including the rotation for
video-frame messages that have the default rotation.</p>
   </dl>
   <p>Each data encoding offered defines the following fields:</p>
   <dl>
    <dt data-md>encoding-id
    <dd data-md>
     <p>Identifies the data encoding being offered.  Must be unique within
the media stream.  These IDs should be treated like request IDs
with regards to the <code>state-token</code> as specified in <a href="#requests-responses-watches">§ 11 Requests, Responses, and Watches</a>.</p>
    <dt data-md>data-type-name
    <dd data-md>
     <p>The name of the data type used by the encoding.</p>
    <dt data-md>time-scale
    <dd data-md>
     <p>The <a data-link-type="dfn" href="#time-scale" id="ref-for-time-scale④">time scale</a> used by all data frames.  This allows senders to
make data-frame messages smaller by not including the time scale
in each one.</p>
    <dt data-md>default-duration:
    <dd data-md>
     <p>The duration of an data frame .  This allows senders to make
data-frame messages smaller by not including the duration for
data-frame messages that have the default duration.</p>
   </dl>
   <p>After receiving a <a data-link-type="dfn" href="#streaming-session-start-request" id="ref-for-streaming-session-start-request②">streaming-session-start-request</a> message, a receiver
should send back a <a data-link-type="dfn" href="#streaming-session-start-response" id="ref-for-streaming-session-start-response①">streaming-session-start-response</a> message with the
following fields:</p>
   <dl>
    <dt data-md>desired-stats-interval
    <dd data-md>
     <p>Indicates the frequency the sender should send stats messages to
the receiver.</p>
    <dt data-md>stream-requests
    <dd data-md>
     <p>Indicates which media streams the receiver would like to receive
from the sender.</p>
   </dl>
   <p>Each stream request contains the following fields:</p>
   <dl>
    <dt data-md>media-stream-id
    <dd data-md>
     <p>The ID of the stream reqeusted.</p>
    <dt data-md>audio (optional)
    <dd data-md>
     <p>The requested audio encoding, by encoding ID</p>
    <dt data-md>video (optional)
    <dd data-md>
     <p>The requested video encoding, by encoding ID.  It may
include a target resolution and maximum frame rate.  The sender
should not exceed the maximum frame rate and should attempt to
send at the target bitrate, possibly exceeding it by a small amount.</p>
    <dt data-md>data (optional)
    <dd data-md>
     <p>The requested data encoding, by encoding ID</p>
   </dl>
   <p>During a streaming session, the receiver can modify the requests it
made for encodings by sending a <a data-link-type="dfn" href="#streaming-session-modify-request" id="ref-for-streaming-session-modify-request①">streaming-session-modify-request</a> containing a modified list of stream-requests.  When the sender receives
a <a data-link-type="dfn" href="#streaming-session-modify-request" id="ref-for-streaming-session-modify-request②">streaming-session-modify-request</a>, it should send back a <a data-link-type="dfn" href="#streaming-session-modify-response" id="ref-for-streaming-session-modify-response">streaming-session-modify-response</a> indicate whether or not the
application of the new request from the <a data-link-type="dfn" href="#streaming-session-modify-request" id="ref-for-streaming-session-modify-request③">streaming-session-modify-request</a> was successful.</p>
   <p class="note" role="note"><span class="marker">NOTE:</span> If the sender wishes to send an encoding other than the one selected by
the receiver in a <a data-link-type="dfn" href="#streaming-session-start-response" id="ref-for-streaming-session-start-response②">streaming-session-start-response</a> or <a data-link-type="dfn" href="#streaming-session-modify-request" id="ref-for-streaming-session-modify-request④">streaming-session-modify-request</a>, it must terminate the current session
and start a new session.</p>
   <p>Finally, the sender may terminate the streaming session by sending
a <a data-link-type="dfn" href="#streaming-session-terminate-request" id="ref-for-streaming-session-terminate-request">streaming-session-terminate-request</a> command.  When the receiver
receives the <a data-link-type="dfn" href="#streaming-session-terminate-request" id="ref-for-streaming-session-terminate-request①">streaming-session-terminate-request</a>, it should send back
a <a data-link-type="dfn" href="#streaming-session-terminate-response" id="ref-for-streaming-session-terminate-response">streaming-session-terminate-response</a>.  The receiver can terminate at
any point and notify the sender by sending a <a data-link-type="dfn" href="#streaming-session-terminate-event" id="ref-for-streaming-session-terminate-event">streaming-session-terminate-event</a> message.</p>
   <h3 class="heading settled" data-level="10.3" id="streaming-audio"><span class="secno">10.3. </span><span class="content">Audio</span><a class="self-link" href="#streaming-audio"></a></h3>
   <p><a data-link-type="dfn" href="#media-sender" id="ref-for-media-sender①">Media senders</a> may send audio to <a data-link-type="dfn" href="#media-receiver" id="ref-for-media-receiver①">media receivers</a> by sending <a data-link-type="dfn" href="#audio-frame" id="ref-for-audio-frame">audio-frame</a> messages (see <a href="#appendix-a">Appendix A: Messages</a>) with the following keys and
values.  An audio frame message contains a set of encoded audio samples for a
range of time. A series of encoded audio frames that share a codec and a
timeline form an audio encoding.</p>
   <p>Unlike most Open Screen Protocol messages, this one uses an
array-based grouping rather than a struct-based grouping.  For
required fields, this allows for a more efficient use of bytes on the
wire, which is important for streaming audio because the payload is
typically so small and every byte of overhead is relatively large.  In
order to accomodate optional values in the array-based grouping, one
optional field in the array is used to hold all optional values in a
struct-based grouping.  This will hopefully provide a good balance of
efficiency and flexibility.</p>
   <p>To allow for audio frames to be sent out of order, they should be sent in
separate QUIC streams.</p>
   <dl>
    <dt data-md>encoding-id
    <dd data-md>
     <p>Identifies the media encoding to which this audio frame belongs.  This can be
used to reference fields of the encoding (from the <a data-link-type="dfn" href="#audio-encoding-offer" id="ref-for-audio-encoding-offer">audio-encoding-offer</a> message) such as the codec, codec properties, <a data-link-type="dfn" href="#time-scale" id="ref-for-time-scale⑤">time scale</a>, and default duration.
Referencing fields of the encoding through the encoding id
helps to avoid sending duplicate information in every frame.</p>
    <dt data-md>start-time
    <dd data-md>
     <p>Identifies the beginning of the time range of the audio frame. The
end time can be inferred from the start time and duration. The <a data-link-type="dfn" href="#time-scale" id="ref-for-time-scale⑥">time scale</a> is equal to the value in the <code>time-scale</code> field of the <a data-link-type="dfn" href="#audio-encoding-offer" id="ref-for-audio-encoding-offer①">audio-encoding-offer</a> message referenced by the <code>encoding-id</code>.</p>
    <dt data-md>duration
    <dd data-md>
     <p>If present, the duration of the audio frame. If not present, the
duration is equal to the <code>default-duration</code> field of the <a data-link-type="dfn" href="#audio-encoding-offer" id="ref-for-audio-encoding-offer②">audio-encoding-offer</a> message referenced by the <code>encoding-id</code>.
The <a data-link-type="dfn" href="#time-scale" id="ref-for-time-scale⑦">time scale</a> is equal to the value in the <code>time-scale</code> field of
the <a data-link-type="dfn" href="#audio-encoding-offer" id="ref-for-audio-encoding-offer③">audio-encoding-offer</a> message referenced by the <code>encoding-id</code>.</p>
    <dt data-md>sync-time
    <dd data-md>
     <p>If present, a time used to synchronize the start time of this audio frame (and
thus, this encoding) with that of other media encodings on
different timelines.  It may be wall clock time, but it need not
be; it can be any clock chosen by the media sender.</p>
    <dt data-md>payload
    <dd data-md>
     <p>The encoded audio.  The codec is equal to the <code>codec-name</code> field of the <a data-link-type="dfn" href="#audio-encoding-offer" id="ref-for-audio-encoding-offer④">audio-encoding-offer</a> message referenced by the <code>encoding-id</code>.</p>
   </dl>
   <h3 class="heading settled" data-level="10.4" id="streaming-video"><span class="secno">10.4. </span><span class="content">Video</span><a class="self-link" href="#streaming-video"></a></h3>
   <p>Media senders may send video to media receivers by sending <a data-link-type="dfn" href="#video-frame" id="ref-for-video-frame①">video-frame</a> messages (see <a href="#appendix-a">Appendix A: Messages</a>) with the following keys and values.  A video
frame message contains an encoded video frame (an encoded image) at a specific
point in time or over a specfic time range (if the duration is known).  A series
of encoded video frames that share a codec and a timeline form a video encoding.</p>
   <p>To allow for video frames to be sent out of order, they may be sent in
separate QUIC streams.  If the encoding is a long chain of encoded video frames
dependent on the previous one back until an independent frame, it may make sense
to send them in a single QUIC stream starting at the indepdendent frame and
ending at the last dependent frame.</p>
   <dl>
    <dt data-md>encoding-id
    <dd data-md>
     <p>Identifies the media encoding to which this video frame belongs.
This can be used to reference fields of the encoding such as the
codec, codec properties, <a data-link-type="dfn" href="#time-scale" id="ref-for-time-scale⑧">time scale</a>, and default rotation.
Referencing fields of the encoding through the encoding id helps
to avoid sending duplicate information in every frame.</p>
    <dt data-md>sequence-number
    <dd data-md>
     <p>Identifies the frame and its order in the encoding.
Within an encoding, larger sequence numbers mean later start times.
Within an encoding, gaps in sequence numbers mean frames are missing.</p>
    <dt data-md>depends-on
    <dd data-md>
     <p>If present, the sequence numbers of the frames this frame depends on.
If a sequence numbers is negative, it is treated as a relative sequence numbers
and the sequence numbers is calculated by adding it to the sequence number of this frame.
If empty, this is an independent frame (a key frame).
If not present, the default value is [-1].</p>
    <dt data-md>start-time
    <dd data-md>
     <p>Identifies the beginning of the time range of the video frame.  The
end time can be inferred from the start time and duration. The <a data-link-type="dfn" href="#time-scale" id="ref-for-time-scale⑨">time scale</a> is equal to the value in the <code>time-scale</code> field of the <a data-link-type="dfn" href="#video-encoding-offer" id="ref-for-video-encoding-offer">video-encoding-offer</a> message referenced by the <code>encoding-id</code>.</p>
    <dt data-md>duration
    <dd data-md>
     <p>If present, the duration of the video frame. If not present, that
means duration is unknown.  The <a data-link-type="dfn" href="#time-scale" id="ref-for-time-scale①⓪">time scale</a> is equal to the value
in the <code>time-scale</code> field of the <a data-link-type="dfn" href="#video-encoding-offer" id="ref-for-video-encoding-offer①">video-encoding-offer</a> message
referenced by the <code>encoding-id</code>.</p>
    <dt data-md>sync-time
    <dd data-md>
     <p>If present, a time used to synchronize the start time of this frame (and
thus, this encoding) with that of other media encodings on different
timelines.</p>
    <dt data-md>rotation
    <dd data-md>
     <p>If present, indicates how the frame should be rotated after
decoding but before rendering.  Rotation is clockwise in
increments of 90 degrees.  The default is equal to the <code>default-rotation</code> field of the <a data-link-type="dfn" href="#video-encoding-offer" id="ref-for-video-encoding-offer②">video-encoding-offer</a> message
referenced by the <code>encoding-id</code>.</p>
    <dt data-md>payload
    <dd data-md>
     <p>The encoded video frame (encoded image).  The codec is equal to the <code>codec-name</code> field of the <a data-link-type="dfn" href="#video-encoding-offer" id="ref-for-video-encoding-offer③">video-encoding-offer</a> message referenced
by the <code>encoding-id</code>.</p>
   </dl>
   <h3 class="heading settled" data-level="10.5" id="streaming-data"><span class="secno">10.5. </span><span class="content">Data</span><a class="self-link" href="#streaming-data"></a></h3>
   <p>Media senders may send timed data to media receivers by sending <a data-link-type="dfn" href="#data-frame" id="ref-for-data-frame">data-frame</a> messages (see <a href="#appendix-a">Appendix A: Messages</a>) with the following keys and values.  A data frame message
contains an arbitrary payload that can be synchronized with audio and video.
A series of data frames that share a data type and timeline form a data encoding.</p>
   <p>To allow for data frames to be sent out of order, they may be sent in separate
QUIC streams, but more than one data frame may be sent in one QUIC stream if
that makes sense for a specific type of data.</p>
   <dl>
    <dt data-md>encoding-id
    <dd data-md>
     <p>Identifies the data encoding to which this data frame belongs.  This can be
used to reference fields of the encoding such as the type of data and <a data-link-type="dfn" href="#time-scale" id="ref-for-time-scale①①">time scale</a>.  Referencing fields of the encoding through the encoding id
helps to avoid sending duplicate information in every frame.</p>
    <dt data-md>sequence-number
    <dd data-md>
     <p>Identifies the frame and its order in the encoding.
Within an encoding, larger sequence numbers mean later start times.
Within an encoding, gaps in sequence numbers mean frames are missing.</p>
    <dt data-md>start-time
    <dd data-md>
     <p>Identifies the beginning of the time range of the data frame.  The
end time can be inferred from the start time and duration.  The <a data-link-type="dfn" href="#time-scale" id="ref-for-time-scale①②">time scale</a> is equal to the value in the <code>time-scale</code> field of the <a data-link-type="dfn" href="#data-encoding-offer" id="ref-for-data-encoding-offer">data-encoding-offer</a> message referenced by the <code>encoding-id</code>.</p>
    <dt data-md>duration
    <dd data-md>
     <p>If present, the duration of the data frame. If not present, the
duration is equal to the <code>default-duration</code> field of the <a data-link-type="dfn" href="#data-encoding-offer" id="ref-for-data-encoding-offer①">data-encoding-offer</a> message referenced by the <code>encoding-id</code>.
The <a data-link-type="dfn" href="#time-scale" id="ref-for-time-scale①③">time scale</a> is equal to the value in the <code>time-scale</code> field of
the <a data-link-type="dfn" href="#data-encoding-offer" id="ref-for-data-encoding-offer②">data-encoding-offer</a> message referenced by the <code>encoding-id</code>.</p>
    <dt data-md>sync-time
    <dd data-md>
     <p>If present, a time used to synchronize the start time of this data frame (and
thus, this encoding) with that of other media encodings on different
timelines.</p>
    <dt data-md>payload
    <dd data-md>
     <p>The data.  The data type is equal to the <code>data-type-name</code> field of the
the <a data-link-type="dfn" href="#data-encoding-offer" id="ref-for-data-encoding-offer③">data-encoding-offer</a> message referenced by the <code>encoding-id</code>.</p>
   </dl>
   <h3 class="heading settled" data-level="10.6" id="streaming-feedback"><span class="secno">10.6. </span><span class="content">Feedback</span><a class="self-link" href="#streaming-feedback"></a></h3>
   <p>The media receiver can send feedback to the media sender, such as key frame
requests.</p>
   <p>A video key frame is requested by sending a video-request message with
the following keys and values.</p>
   <p>To allow for video frames to be sent out of order, they may be sent in separate
QUIC streams.</p>
   <dl>
    <dt data-md>encoding-id
    <dd data-md>
     <p>The encoding for which the media sender should send a new key frame.</p>
    <dt data-md>sequence-number
    <dd data-md>
     <p>Gives the order in the encoding.
Within an encoding, larger sequence numbers invalidate previous ones.
A media sender may ignore smaller sequence numbers after a larger one has been processed.
This it to prevent out-of-order requests from generating more key frames than necessary.</p>
    <dt data-md>highest-decoded-frame-sequence-number: uint
    <dd data-md>
     <p>If set, the media sender may generate a video frame dependent on the last decoded
frame.  If not set, the media sender must generate an indepdendent (key) frame.</p>
   </dl>
   <h3 class="heading settled" data-level="10.7" id="streaming-stats"><span class="secno">10.7. </span><span class="content">Stats</span><a class="self-link" href="#streaming-stats"></a></h3>
   <p>During a streaming session, the sender should send stats with the <a data-link-type="dfn" href="#streaming-session-sender-stats-event" id="ref-for-streaming-session-sender-stats-event">streaming-session-sender-stats-event</a> at the interval the receiver requested.  It
should send all of the following stats for all of the media streams it is
sending. The <a data-link-type="dfn" href="#streaming-session-sender-stats-event" id="ref-for-streaming-session-sender-stats-event①">streaming-session-sender-stats-event</a> message contains the following
fields:</p>
   <dl>
    <dt data-md>streaming-session-id
    <dd data-md>
     <p>The ID of the streaming session these stats apply to.</p>
    <dt data-md>system-time
    <dd data-md>
     <p>The time when the stats were calculated, using a monotonic system
clock.</p>
    <dt data-md>audio
    <dd data-md>
     <p>Stats specific to audio.  Stats for multiple encodings can be sent
at once, but encodings need not be included if the stats haven’t
changed.  See below.</p>
    <dt data-md>video
    <dd data-md>
     <p>Stats specific to video.  Stats for multiple encodings can be sent
at once, but encodings need not be included if the stats haven’t
changed.  See below.</p>
   </dl>
   <p>Audio encoding sender stats include the following fields:</p>
   <dl>
    <dt data-md>encoding-id
    <dd data-md>
     <p>The ID of the encoding for which the stats apply.</p>
    <dt data-md>cumulative-sent-frames
    <dd data-md>
     <p>The total number of frames sent.</p>
    <dt data-md>cumulative-encode-delay
    <dd data-md>
     <p>The sum of the time spent encoding frames sent.</p>
   </dl>
   <p>Video encoding sender stats include the following fields:</p>
   <dl>
    <dt data-md>encoding-id
    <dd data-md>
     <p>The ID of the encoding for which the stats apply.</p>
    <dt data-md>cumulative-sent-duration
    <dd data-md>
     <p>The sum of all of the durations of all of the audio frames sent.</p>
    <dt data-md>cumulative-encode-delay
    <dd data-md>
     <p>The sum of the time spent encoding frames sent.</p>
    <dt data-md>cumulative-dropped frames
    <dd data-md>
     <p>The total number of frames that were not sent due to network, CPU,
or other contraints.</p>
   </dl>
   <p>During a streaming session, the receiver should send stats with the <a data-link-type="dfn" href="#streaming-session-receiver-stats-event" id="ref-for-streaming-session-receiver-stats-event">streaming-session-receiver-stats-event</a> at the interval the sender requested.
It should send all of the following stats for all of the media streams it is
receiving.</p>
   <p>If the receiver is using a buffer to hold frames before playing them out, it
should also send the status of that buffer using the <code>remote-buffer-status</code> field.
It can have one of three values:</p>
   <ul>
    <li data-md>
     <p><code>enough-data</code>: The buffer has neither too much data nor insufficient data.</p>
    <li data-md>
     <p><code>insufficient-data</code>: The buffer will underrun and not have sufficient frame
data at the time it is scheduled to be played out.</p>
    <li data-md>
     <p><code>too-much-data</code>: At the current send rate, the buffer will overrun and future
frame data will be discarded before it can be played out.</p>
   </ul>
   <p>A sender that receives a status of <code>insufficient-data</code> should increase its send
rate, or switch to a more efficient encoding for future frames.  A sender that
receives a status of <code>too-much-data</code> should decrease its send rate.</p>
   <p>If the receiver is playing frames immediately without buffering, it should always
report a buffering status of <code>enough-data</code>.</p>
   <p>The <a data-link-type="dfn" href="#streaming-session-receiver-stats-event" id="ref-for-streaming-session-receiver-stats-event①">streaming-session-receiver-stats-event</a> message contains the
following fields:</p>
   <dl>
    <dt data-md>streaming-session-id
    <dd data-md>
     <p>The ID of the streaming session these stats apply to.</p>
    <dt data-md>system-time
    <dd data-md>
     <p>The time when the stats were calculated, using a monotonic system
clock.</p>
    <dt data-md>audio
    <dd data-md>
     <p>Stats specific to audio.  Stats for multiple encodings can be sent
at once, but encodings need not be included if the stats haven’t
changed.  See below.</p>
    <dt data-md>video
    <dd data-md>
     <p>Stats specific to video.  Stats for multiple encodings can be sent
at once, but encodings need not be included if the stats haven’t
changed.  See below.</p>
   </dl>
   <p>Audio encoding receiver stats include the following fields.  If not
present, that indicates the value has not changed since the last value.</p>
   <dl>
    <dt data-md>encoding-id
    <dd data-md>
     <p>The ID of the encoding for which the stats apply.</p>
    <dt data-md>cumulative-decoded-frames
    <dd data-md>
     <p>The total number of audio frames received and decoded.</p>
    <dt data-md>cumulative-received-duration
    <dd data-md>
     <p>The sum of all of the durations of all of the audio frames received.</p>
    <dt data-md>cumulative-lost-duration
    <dd data-md>
     <p>The sum of all of the durations of all of the audio frames detected as lost.</p>
    <dt data-md>cumulative-buffer-delay
    <dd data-md>
     <p>The sum of the time frames spent buffered between receipt and playout.</p>
    <dt data-md>cumulative-decode-delay
    <dd data-md>
     <p>The sum of the time spent decoding frames received.</p>
    <dt data-md>remote-buffer-status : streaming-buffer-status
    <dd data-md>
     <p>The status of the remote buffer for this encoding.</p>
   </dl>
   <p>Video encoding receiver stats include the following fields.  If not
present, that indicates the value has not changed since the last
value.</p>
   <dl>
    <dt data-md>encoding-id
    <dd data-md>
     <p>The ID of the encoding for which the stats apply.</p>
    <dt data-md>cumulative-decoded-frames
    <dd data-md>
     <p>The total number of video frames received and decoded.</p>
    <dt data-md>cumulative-lost-frames
    <dd data-md>
     <p>The total number of video frames detected as lost.</p>
    <dt data-md>cumulative-buffer-delay
    <dd data-md>
     <p>The sum of the time frames spent buffered between receipt and render.</p>
    <dt data-md>cumulative-decode-delay
    <dd data-md>
     <p>The sum of the time spent decoding frames received.</p>
    <dt data-md>remote-buffer-status : streaming-buffer-status
    <dd data-md>
     <p>The status of the remote buffer for this encoding.</p>
   </dl>
   <h2 class="heading settled" data-level="11" id="requests-responses-watches"><span class="secno">11. </span><span class="content">Requests, Responses, and Watches</span><a class="self-link" href="#requests-responses-watches"></a></h2>
   <p>Multiple sub-protocols in the Open Screen Protocol have messages that act as
requests, responses, watches, and events. Most requests have a <code>request-id</code>, and
the agent that receives the request must send exactly one reponse message in
return with the same <code>request-id</code>.  A watch request has a <code>watch-id</code>, and the
agent that receives the request may send any number of event messages in
response with the same <code>watch-id</code>, until the watch request expires.</p>
   <p><code>request-id</code> and <code>watch-id</code> values are unsigned integer IDs that are assigned
from a counter kept by each agent that starts at 1 and increments by 1 for each
ID.  Whenever an agent changes its <code>state-token</code>, it must reset its counter to 1.</p>
   <p>When an agent sees that another agent has reset its state (by virtue of
advertising a new <code>state-token</code>), it should discard any requests, responses,
watches and events for that agent.</p>
   <p>Other IDs that must be unique and would cause confusion if one side
loses state, such as <code>streaming-session-id</code>, <code>media-session-id</code>, and <code>encoding-id</code> should be treated the same.</p>
   <p class="note" role="note"><span class="marker">Note:</span> Request and watch IDs are not tied to any particular QUIC connection
between agents.  If a QUIC connection is closed, an agent should not discard
requests, responses, watches, or events related to the other party.  This allows
agents to save power by closing unused connections.</p>
   <p class="note" role="note"><span class="marker">Note:</span> Request and watch IDs are not unique across agents.  An agent can combine
a request ID with a unique identifier for the agent that sent it (like its
certificate fingerprint) to track requests across multiple agents.</p>
   <h2 class="heading settled" data-level="12" id="protocol-extensions"><span class="secno">12. </span><span class="content">Protocol Extensions</span><a class="self-link" href="#protocol-extensions"></a></h2>
   <p><a data-link-type="dfn" href="#open-screen-protocol-agent" id="ref-for-open-screen-protocol-agent①⓪">Open Screen Protocol agents</a> may exchange extension messages that are not
defined by this specification.  This could be used for experimentation,
customization or other purposes.</p>
   <p>To add new extension messages, extension authors must register a capability ID
with a range of message type keys in a <a href="https://w3c.github.io/openscreenprotocol/capabilities.html">public registry</a>.
Agents may then indicate that they accept an extension by including the
corresponding capability ID in the <code>capabilities</code> field of its <a data-link-type="dfn" href="#agent-info" id="ref-for-agent-info⑤">agent-info</a> message.</p>
   <p>Capability IDs 1-999 are reserved for use by the Open Screen Protocol.
Capability IDs 1000 and above are available for extensions.  See <a href="#appendix-b">Appendix B: Message Type Key Ranges</a> for legal ranges for extension message type keys.</p>
   <p class="note" role="note"><span class="marker">Note:</span> The purpose of the public registry is to prevent conflicts between
multiple extension authors' capability IDs and message type keys.</p>
   <p>Agents must not send extension messages to another agent that has not advertised
the corresponding extension capability ID.</p>
   <p class="note" role="note"><span class="marker">Note:</span> See <a href="#messages">§ 5 Messages delivery using CBOR and QUIC streams</a> for how agents handle unknown message type keys.</p>
   <p>It is recommended that extension messages are also encoded in CBOR, to simplify
implementations and provide an easier path to standardization of extension
protocols.  However, this is not required; agents that support non-CBOR
extensions must be able to decode QUIC streams that contain a mix of CBOR
messages and non-CBOR extension messages.</p>
   <h3 class="heading settled" data-level="12.1" id="protocol-extension-fields"><span class="secno">12.1. </span><span class="content">Protocol Extension Fields</span><a class="self-link" href="#protocol-extension-fields"></a></h3>
   <p>It is legal for an agent to add additional, extension fields to any map-valued
CBOR message type defined by the Open Screen Protocol.  Extension fields must be
optional, and the Open Screen Protocol message must make sense both with and
without the field set.</p>
   <p>Agents must not add extended fields to the <a data-link-type="dfn" href="#audio-frame" id="ref-for-audio-frame①">audio-frame</a> message directly.
Instead, they may add them to its nested <code>optional</code> value.</p>
   <p>Extension fields should use string keys to avoid conflicts with integer keys in
Open Screen Protocol messages.  An agent should not send extension fields to
another agent unless that agent advertises an extension capability ID in its <a data-link-type="dfn" href="#agent-info" id="ref-for-agent-info⑥">agent-info</a> that indicates that it understands the extension fields.</p>
   <h2 class="heading settled" data-level="13" id="security-privacy"><span class="secno">13. </span><span class="content">Security and Privacy</span><a class="self-link" href="#security-privacy"></a></h2>
   <p>The Open Screen Protocol allows two <a data-link-type="dfn" href="#open-screen-protocol-agent" id="ref-for-open-screen-protocol-agent①①">OSP agents</a> to discover each other and
exchange user and application data.  As such, its security and privacy
considerations should be closely examined.  We first evaluate the protocol
itself using the W3C <a data-link-type="biblio" href="#biblio-security-privacy-questionnaire" title="Self-Review Questionnaire: Security and Privacy">Security and Privacy
Questionnaire</a>.  We then examine whether the security and privacy guidelines
recommended by the <a data-link-type="biblio" href="#biblio-presentation-api" title="Presentation API">Presentation API</a> and the <a data-link-type="biblio" href="#biblio-remote-playback" title="Remote Playback API">Remote Playback API</a> are met.  Finally we discuss recommended
mitigations that agents can use to meet these security and privacy requirements.</p>
   <h3 class="heading settled" data-level="13.1" id="threat-models"><span class="secno">13.1. </span><span class="content">Threat Models</span><a class="self-link" href="#threat-models"></a></h3>
   <h4 class="heading settled" data-level="13.1.1" id="passive-network-attackers"><span class="secno">13.1.1. </span><span class="content">Passive Network Attackers</span><a class="self-link" href="#passive-network-attackers"></a></h4>
   <p>The Open Screen Protocol should assume that all parties that are connected to
the same LAN are able to observe all data flowing between OSP agents.</p>
   <p>These parties will be able collect any data exposed through unencrypted
messages, such as mDNS records and the QUIC handshakes.</p>
   <p>These parties may attempt to learn cryptographic parameters by observing data
flows on the QUIC connection, or by observing cryptographic timing.</p>
   <h4 class="heading settled" data-level="13.1.2" id="active-network-attackers"><span class="secno">13.1.2. </span><span class="content">Active Network Attackers</span><a class="self-link" href="#active-network-attackers"></a></h4>
   <p>Active attackers, such as compromised routers, will be able to manipulate data
exchanged between agents.  They can inject traffic into existing QUIC
connections and attempt to initiate new QUIC connections.  These abilities can
be used to attempt the following:</p>
   <ul>
    <li data-md>
     <p>Impersonate an agent or one already authenticated by the user, in an attempt
to convince the user to authenticate to it.</p>
    <li data-md>
     <p>Connect to an agent and query its capabilities.</p>
    <li data-md>
     <p>Connect to and control a presentation or remote playback, or extract data
from the application state of the presentation or remote playback.</p>
   </ul>
   <p>One particular attack of concern is misconfigured or compromised routers that
expose local network devices (such as OSP agents) to the Internet.  This vector
of attack has been used by malicious parties to take control of printers and
smart TVs by connecting to local network services that would normally be
inaccessible from the Internet.</p>
   <h4 class="heading settled" data-level="13.1.3" id="denial-of-service"><span class="secno">13.1.3. </span><span class="content">Denial of Service</span><a class="self-link" href="#denial-of-service"></a></h4>
   <p>Parties with connected to the LAN may attempt to deny access to OSP agents.  For
example, an attacker my attempt to open a large number of QUIC connections to an
agent in an attempt to block legitimate connections or exhaust the agent’s
system resources.  They may also multicast spurious DNS-SD records in an attempt
to exhaust the cache capacity for mDNS listeners, or to get listeners to open a
large number of bogus QUIC connections.</p>
   <h4 class="heading settled" data-level="13.1.4" id="same-origin-policy-violations"><span class="secno">13.1.4. </span><span class="content">Same-Origin Policy Violations</span><a class="self-link" href="#same-origin-policy-violations"></a></h4>
   <p>The Presentation API allows cross-origin communication between controlling pages
and presentations with the consent of each origin (through their use of the
API).  This is similar to cross-origin communication via <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/web-messaging.html#dom-window-postmessage" id="ref-for-dom-window-postmessage">postMessage()</a></code> with a <code>targetOrigin</code> of <code>*</code>.  However, the Presentation API does not convey source
origin information with each message.  Therefore, the Open Screen Protocol does
not convey origin information between its agents.</p>
   <p>The <a data-link-type="dfn" href="https://www.w3.org/TR/presentation-api/#dfn-presentation-identifier" id="ref-for-dfn-presentation-identifier⑥">presentation identifier</a> carries some protection against unrestricted
cross-origin access; but, rigorous authentication of the parties connected by a <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/presentation-api/#dom-presentationconnection" id="ref-for-dom-presentationconnection②">PresentationConnection</a></code> must be done at the application level.</p>
   <h3 class="heading settled" data-level="13.2" id="security-privacy-questions"><span class="secno">13.2. </span><span class="content">Open Screen Protocol Security and Privacy Considerations</span><a class="self-link" href="#security-privacy-questions"></a></h3>
   <h4 class="heading settled" data-level="13.2.1" id="personally-identifiable-information"><span class="secno">13.2.1. </span><span class="content">Personally Identifiable Information &amp; High-Value Data</span><a class="self-link" href="#personally-identifiable-information"></a></h4>
   <p>The following data exchanged by the protocol can be personally identifiable
and/or high value data:</p>
   <ol>
    <li data-md>
     <p>Presentation URLs and availability results</p>
    <li data-md>
     <p>Presentation identifiers</p>
    <li data-md>
     <p>Presentation connection IDs</p>
    <li data-md>
     <p>Presentation connection messages</p>
    <li data-md>
     <p>Remote playback URLs</p>
    <li data-md>
     <p>Remote playback commands and status messages</p>
   </ol>
   <p><a data-link-type="dfn" href="https://www.w3.org/TR/presentation-api/#dfn-presentation-identifier" id="ref-for-dfn-presentation-identifier⑦">Presentation identifiers</a> are considered high value data because they can be
used in conjunction with a Presentation URL to connect to a running
presentation.</p>
   <p>Presentation display names, model names, and capabilities, while not
considered personally identifiable, are important to protect to prevent an
attacker from changing them or substituting other values during the discovery
and authentication process.</p>
   <p>The following data cannot be reasonably made confidential and should be
considered public:</p>
   <ol>
    <li data-md>
     <p>IP addresses and ports used by the Open Screen Protocol.</p>
    <li data-md>
     <p>Data advertised through mDNS, including the display name prefix, the
certificate fingerprint, and the metadata version.</p>
    <li data-md>
     <p>Data provided by an agent through <a data-link-type="dfn" href="#agent-info" id="ref-for-agent-info⑦">agent-info</a>, including its <a data-link-type="dfn" href="#display-name" id="ref-for-display-name">display name</a>, its device model name, its capabilities, and its
preferred locales.</p>
   </ol>
   <h4 class="heading settled" data-level="13.2.2" id="cross-origin-state"><span class="secno">13.2.2. </span><span class="content">Cross Origin State Considerations</span><a class="self-link" href="#cross-origin-state"></a></h4>
   <p>Access to origin state across browsing sessions is possible through the
Presentation API by reconnecting to a presentation that was started by a
previous session. This scenario is addressed in <a href="https://w3c.github.io/presentation-api/#cross-origin-access"><cite>Presentation API</cite> § 7.2 Cross-origin access</a>.</p>
   <p>Receiver availability is available cross-origin depending on the user’s network
context.  Exposure of this data to the Web is also discussed in <a href="https://w3c.github.io/presentation-api/#personally-identifiable-information"><cite>Presentation API</cite> § 7.1 Personally identifiable information</a> and <a href="https://w3c.github.io/remote-playback/#personally-identifiable-information"><cite>Remote Playback API</cite> § 6.1 Personally identifiable information</a>.</p>
   <h4 class="heading settled" data-level="13.2.3" id="origin-access-devices"><span class="secno">13.2.3. </span><span class="content">Origin Access to Other Devices</span><a class="self-link" href="#origin-access-devices"></a></h4>
   <p>By design, the Open Screen Protocol allows access to receivers from the Web.  By
implementing the protocol, these devices are knowingly making themselves
available to the Web and should be designed accordingly.</p>
   <p>Below, we discuss mitigation steps to prevent malicious use of these devices.</p>
   <h4 class="heading settled" data-level="13.2.4" id="private-browsing-mode"><span class="secno">13.2.4. </span><span class="content">Private Browsing Mode</span><a class="self-link" href="#private-browsing-mode"></a></h4>
   <p>The Open Screen Protocol itself does not distinguish between the user agent’s normal
browsing and <a href="https://www.w3.org/2001/tag/doc/private-browsing-modes/">private browsing</a> modes.</p>
   <p>However, it’s recommended that user agents use separate authentication contexts
(see <a href="#authentication">§ 6 Authentication</a>) and QUIC connections (see <a href="#transport">§ 4 Transport and metadata discovery with QUIC</a>) for normal and
private browsing from the same user agent instance. This makes it more difficult
for OSP agents to match activities occurring in normal and private browsing by the
same user.</p>
   <h4 class="heading settled" data-level="13.2.5" id="persistent-state"><span class="secno">13.2.5. </span><span class="content">Persistent State</span><a class="self-link" href="#persistent-state"></a></h4>
   <p>An agent is likely to persist the identity of agents that have successfully
completed <a href="#authentication">§ 6 Authentication</a>.  This may include the public key fingerprints,
metadata versions, and metadata for those parties.</p>
   <p>However, this data is not normally exposed to the Web, only through the native
UI of the user agent during the display selection or display authentication
process.  It can be an implementation choice whether the user agent clears or
retains this data when the user clears browsing data.</p>
   <p class="issue" id="issue-8bf4aa9f"><a class="self-link" href="#issue-8bf4aa9f"></a> Fate of metadata / authentication history when clearing browsing data. <a href="https://github.com/w3c/openscreenprotocol/issues/132">[Issue #132]</a></p>
   <h4 class="heading settled" data-level="13.2.6" id="other-considerations"><span class="secno">13.2.6. </span><span class="content">Other Considerations</span><a class="self-link" href="#other-considerations"></a></h4>
   <p>The Open Screen Protocol does not grant to the Web additional access to the
following:</p>
   <ul>
    <li data-md>
     <p>New script loading mechanisms</p>
    <li data-md>
     <p>Access to the user’s location</p>
    <li data-md>
     <p>Access to device sensors</p>
    <li data-md>
     <p>Access to the user’s local computing environment</p>
    <li data-md>
     <p>Control over the user agent’s native UI</p>
    <li data-md>
     <p>Security characteristics of the user agent</p>
   </ul>
   <h3 class="heading settled" data-level="13.3" id="presentation-api-considerations"><span class="secno">13.3. </span><span class="content">Presentation API Considerations</span><a class="self-link" href="#presentation-api-considerations"></a></h3>
   <p><a href="https://w3c.github.io/presentation-api/#security-and-privacy-considerations"><cite>Presentation API</cite> § 7 Security and privacy considerations</a> place these
requirements on the Open Screen Protocol:</p>
   <ol>
    <li data-md>
     <p>Presentation URLs and <a data-link-type="dfn" href="https://www.w3.org/TR/presentation-api/#dfn-presentation-identifier" id="ref-for-dfn-presentation-identifier⑧">presentation identifiers</a> should remain private
among the parties that are allowed to connect to a presentation, per the
cross-origin access guidelines.</p>
    <li data-md>
     <p>Controllers and receivers should be notified when connections representing
multiple user agent profiles have been made to a presentation, per the user
interface guidelines.</p>
    <li data-md>
     <p>Messaging between controllers and receivers should be authenticated and
confidential, per the guidelines for messaging between presentation
connections.</p>
   </ol>
   <p>The Open Screen Protocol addresses these considerations by:</p>
   <ol>
    <li data-md>
     <p>Requiring mutual authentication and a TLS-secured QUIC connection before
 presentation URLs, IDs, or messages are exchanged.</p>
    <li data-md>
     <p>Adding explicit messages and connection IDs for individual <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/presentation-api/#dom-presentationconnection" id="ref-for-dom-presentationconnection③">PresentationConnections</a></code> so that agents can track
 the number of active connections.</p>
   </ol>
   <h3 class="heading settled" data-level="13.4" id="remote-playback-considerations"><span class="secno">13.4. </span><span class="content">Remote Playback API Considerations</span><a class="self-link" href="#remote-playback-considerations"></a></h3>
   <p>The <a href="https://w3c.github.io/remote-playback/#security-and-privacy-considerations"><cite>Remote Playback API</cite> § 6 Security and privacy considerations</a> also state that
messaging between controllers and receivers should also be authenticated and
confidential.</p>
   <p>This consideration is handled by requiring mutual authentication and a
TLS-secured QUIC connection before any remote playback related messages are
exchanged.</p>
   <h3 class="heading settled" data-level="13.5" id="security-mitigations"><span class="secno">13.5. </span><span class="content">Mitigation Strategies</span><a class="self-link" href="#security-mitigations"></a></h3>
   <h4 class="heading settled" data-level="13.5.1" id="local-passive-mitigations"><span class="secno">13.5.1. </span><span class="content">Local passive network attackers</span><a class="self-link" href="#local-passive-mitigations"></a></h4>
   <p>Local passive attackers may attempt to harvest data about user activities and
device capabilities using the Open Screen Protocol.  The main strategy to address
this is data minimization, by only exposing opaque public key fingerprints
before user-mediated authentication takes place.</p>
   <p>Passive attackers may also attempt timing attacks to learn the cryptographic
parameters of the TLS 1.3 QUIC connection.  The application profile for TLS 1.3
mandates constant-time ciphers and TLS 1.3 implementations should use elliptic
curve signing operations that are resistant to side channel attacks.</p>
   <h4 class="heading settled" data-level="13.5.2" id="local-active-mitigations"><span class="secno">13.5.2. </span><span class="content">Local active network attackers</span><a class="self-link" href="#local-active-mitigations"></a></h4>
   <p>Local active attackers may attempt to impersonate a presentation display the
user would normally trust.  The <a href="#authentication">§ 6 Authentication</a> step of the Open Screen
Protocol prevents a man-in-the-middle from impersonating an agent, without
knowledge of a shared secret.  However, it is possible for an attacker to
impersonate an existing, trusted agent or a newly discovered agent that is not
yet authenticated and try to convince the user to authenticate to it.  (Trust in
this context means that a user has completed <a href="#authentication">§ 6 Authentication</a> from their
agent to another agent.)</p>
   <p>This can be addressed through a combination of techniques.  The first is
detecting attempts at impersonation.  Agents should detect the following
situations and flag an agent that meets any of the criteria as a <dfn class="dfn-paneled" data-dfn-type="dfn" data-lt="suspicious agent" data-noexport id="suspicious-agent">suspicious
agent</dfn>:</p>
   <ul>
    <li data-md>
     <p>Agents with distinct IP endpoints whose public key fingerprints collide during
concurrent advertisement.</p>
    <li data-md>
     <p>Untrusted agents whose display name differs from the one previously
advertised under a given public key fingerprint.</p>
    <li data-md>
     <p>Untrusted agents that fail the authentication challenge a certain number of times.</p>
    <li data-md>
     <p>Untrusted agents that advertise a display name that is similar to that from an
already-trusted agent.</p>
    <li data-md>
     <p>Already-trusted agents whose metadata provided through the <a data-link-type="dfn" href="#agent-info" id="ref-for-agent-info⑧">agent-info</a> message has changed.</p>
   </ul>
   <p>The second is through management of the low-entropy secret during mutual
authentication:</p>
   <ul>
    <li data-md>
     <p>Rotate the low-entropy secret to prevent brute force attacks.</p>
    <li data-md>
     <p>Use an increasing backoff to respond to authentication challenges, also to
prevent brute force attacks.</p>
    <li data-md>
     <p>Use a cryptographically sound source of entropy to generate the shared secret.</p>
   </ul>
   <p>The active attacker may also attempt to disrupt data exchanged over the QUIC
connection by injecting or modifying traffic.  These attacks should be mitigated
by a correct implementation of TLS 1.3.  See Appendix E of <a data-link-type="biblio" href="#biblio-rfc8446" title="The Transport Layer Security (TLS) Protocol Version 1.3">[RFC8446]</a> for a
detailed security analysis of the TLS 1.3 protocol.</p>
   <h4 class="heading settled" data-level="13.5.3" id="remote-active-mitigations"><span class="secno">13.5.3. </span><span class="content">Remote active network attackers</span><a class="self-link" href="#remote-active-mitigations"></a></h4>
   <p>Unfortunately, we cannot rely on network devices to fully protect OSP agents,
because a misconfigured firewall or NAT could expose a LAN-connected agent to
the broader Internet.  OSP agents should be secure against attack from any
Internet host.</p>
   <p>Advertising agents must set the <code>at</code> field in their mDNS TXT record to protect
themselves from off-LAN attempts to initiate <a href="#authentication">§ 6 Authentication</a>, which result
in user annoyance (display or input of PSK) and potential brute force attacks
against the PSK.</p>
   <h4 class="heading settled" data-level="13.5.4" id="denial-of-service-mitigations"><span class="secno">13.5.4. </span><span class="content">Denial of service</span><a class="self-link" href="#denial-of-service-mitigations"></a></h4>
   <p>It will be difficult to completely prevent denial service of attacks that
originate on the user’s local area network.  OSP agents can refuse new
connections, close connections that receive too many messages, or limit the
number of mDNS records cached from a specific responder in an attempt to allow
existing activities to continue in spite of such an attack.</p>
   <h4 class="heading settled" data-level="13.5.5" id="malicious-input-mitigations"><span class="secno">13.5.5. </span><span class="content">Malicious input</span><a class="self-link" href="#malicious-input-mitigations"></a></h4>
   <p>OSP agents should be robust against malicious input that attempts to compromise
the target device by exploiting parsing vulnerabilities.</p>
   <p>CBOR is intended to be less vulnerable to such attacks relative to alternatives
like JSON and XML.  Still, agents should be thoroughly tested using approaches
like <a href="https://en.wikipedia.org/wiki/Fuzzing">fuzz testing</a>.</p>
   <p>Where possible, OSP agents (including the content rendering components) should
use defense-in-depth techniques like <a href="https://en.wikipedia.org/wiki/Sandbox_(computer_security)">sandboxing</a> to prevent vulnerabilities from gaining access to user data or leading to
persistent exploits.</p>
   <h3 class="heading settled" data-level="13.6" id="security-ui"><span class="secno">13.6. </span><span class="content">User Interface Considerations</span><a class="self-link" href="#security-ui"></a></h3>
   <p>This specification does not make any specific requirements of the security
relevant user interfaces of OSP agents.  However there are important
considerations when designing these user interfaces, as PSK-based authentication
requires users to make informed decisions about which agents to trust.</p>
   <ol>
    <li data-md>
     <p>Before an agent has authenticated another device, the agent should make it
clear that any <code>agent-info</code> or other data from that device has not been
verified by authentication.  (See below for how this applies to DNS-SD
Instance Names.)</p>
    <li data-md>
     <p>A <a data-link-type="dfn" href="#suspicious-agent" id="ref-for-suspicious-agent">suspicious agent</a> should be displayed differently from trusted
agents that are not suspicious, or not displayed at all.</p>
    <li data-md>
     <p>The user interface to present a PSK during authentication should be done in
trusted UI and be difficult to spoof.  It should be clear to the user which
physical device is presenting the PSK.</p>
    <li data-md>
     <p>The user interface to input a PSK during authentication should be done in
trusted UI and be difficult to spoof.</p>
    <li data-md>
     <p>The user should be required to take action to input the PSK, to prevent the
user from blindly clicking through this step.</p>
    <li data-md>
     <p>The user interfaces to render and input a PSK should meet accessibility
guidelines.</p>
   </ol>
   <h4 class="heading settled" data-level="13.6.1" id="instance-names"><span class="secno">13.6.1. </span><span class="content">Instance and Display Names</span><a class="self-link" href="#instance-names"></a></h4>
   <p>Because DNS-SD <a data-link-type="dfn" href="https://tools.ietf.org/html/rfc6763#section-4.1.1" id="ref-for-section-4.1.1①">Instance Names</a> are the primary information that the user
sees prior to authentication, careful presentation of these names is necessary.</p>
   <p>Agents must treat Instance Names as unverified information, and should check
that the Instance Name is a prefix of the display name received through the <a data-link-type="dfn" href="#agent-info" id="ref-for-agent-info⑨">agent-info</a> message after a successful QUIC connection.  Once an agent has done
this check, it can show the name as a <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="verified-display-name">verified display name</dfn>.</p>
   <p>Agents should show only complete display names to the user, instead of truncated
display names from DNS-SD.  A truncated display name should be verified as above
before being shown in full as a <a data-link-type="dfn" href="#verified-display-name" id="ref-for-verified-display-name">verified display name</a>.</p>
   <div class="note" role="note">
     This means there are three categories of display names that agents should be
capable of handling: 
    <ol>
     <li> Truncated and unverified DNS-SD Instance Names, which should not be shown
       to the user.
     <li> Complete but unverified DNS-SD Instance Names, which can be shown as
       unverified prior to <a href="#authentication">§ 6 Authentication</a>.
     <li>Verified display names.
    </ol>
   </div>
   <h2 class="heading settled" id="appendix-a"><span class="content">Appendix A: Messages</span><a class="self-link" href="#appendix-a"></a></h2>
   <p>The following messages are defined using the <a data-link-type="dfn" href="https://tools.ietf.org/html/rfc8610#section-3" id="ref-for-section-3①">Concise Data Definition
Language</a> syntax. When integer keys are used, a comment is appended to the line
to indicate the name of the field. Object definitions in this specification have
this unusual syntax to reduce the number of bytes-on-the-wire, while maintaining
a human-readable name for each key. Integer keys are used instead of object
arrays to allow for easy indexing of optional fields.</p>
   <p>Each root message (one that can be put into a QUIC stream without being enclosed
by another message) has a comment indicating the message type key.</p>
   <p>Smaller numbers should be reserved for message that will be sent more frequently
or are very small or both and larger numbers should be reserved for messages
that are infrequently sent or large or both because smaller type keys encode on
the wire smaller.</p>
   <div class="highlight">
    <div>
<pre><span class="c1">; type key 10</span>
<span class="nc"><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="agent-info-request">agent-info-request</dfn> </span><span class="p">=</span> <span class="p">{</span>
  <span class="nx">request</span>
<span class="p">}</span>

<span class="c1">; type key 11</span>
<span class="nc"><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="agent-info-response">agent-info-response</dfn> </span><span class="p">=</span> <span class="p">{</span>
  <span class="nx">response</span>
<span class="nx">  1</span><span class="p">:</span> <span class="nx">agent-info </span><span class="c1">; agent-info</span>
<span class="p">}</span>

<span class="c1">; type key 122</span>
<span class="nc"><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="agent-info-event">agent-info-event</dfn> </span><span class="p">=</span> <span class="p">{</span>
  <span class="mi">1</span><span class="p">:</span> <span class="nx">agent-info </span><span class="c1">; agent-info</span>
<span class="p">}</span>

<span class="nc">agent-capability </span><span class="p">=</span> <span class="o">&amp;</span><span class="p">(</span>
  <span class="nx">receive-audio</span><span class="p">:</span> <span class="mi">1</span>
  <span class="nx">receive-video</span><span class="p">:</span> <span class="mi">2</span>
  <span class="nx">receive-presentation</span><span class="p">:</span> <span class="mi">3</span>
  <span class="nx">control-presentation</span><span class="p">:</span> <span class="mi">4</span>
  <span class="nx">receive-remote-playback</span><span class="p">:</span> <span class="mi">5</span>
  <span class="nx">control-remote-playback</span><span class="p">:</span> <span class="mi">6</span>
  <span class="nx">receive-streaming</span><span class="p">:</span> <span class="mi">7</span>
  <span class="nx">send-streaming</span><span class="p">:</span> <span class="mi">8</span>
<span class="p">)</span>

<span class="nc"><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="agent-info">agent-info</dfn> </span><span class="p">=</span> <span class="p">{</span>
  <span class="mi">0</span><span class="p">:</span> <span class="nx">text </span><span class="c1">; display-name</span>
  <span class="mi">1</span><span class="p">:</span> <span class="nx">text </span><span class="c1">; model-name</span>
  <span class="mi">2</span><span class="p">:</span> <span class="p">[</span><span class="o">*</span> <span class="nx">agent-capability</span><span class="p">]</span> <span class="c1">; capabilities</span>
  <span class="mi">3</span><span class="p">:</span> <span class="nx">text </span><span class="c1">; state-token</span>
  <span class="mi">4</span><span class="p">:</span> <span class="p">[</span><span class="o">*</span> <span class="nx">text</span><span class="p">]</span> <span class="c1">; locales</span>
<span class="p">}</span>

<span class="c1">; type key 12</span>
<span class="nc"><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="agent-status-request">agent-status-request</dfn> </span><span class="p">=</span> <span class="p">{</span>
  <span class="nx">request</span>
<span class="nx">  </span><span class="p">?</span> <span class="mi">1</span><span class="p">:</span> <span class="nx">status </span><span class="c1">; status</span>
<span class="p">}</span>

<span class="c1">; type key 13</span>
<span class="nc"><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="agent-status-response">agent-status-response</dfn> </span><span class="p">=</span> <span class="p">{</span>
  <span class="nx">response</span>
<span class="nx">  </span><span class="p">?</span> <span class="mi">1</span><span class="p">:</span> <span class="nx">status </span><span class="c1">; status</span>
<span class="p">}</span>

<span class="nc">status </span><span class="p">=</span> <span class="p">{}</span>

<span class="nc">request </span><span class="p">=</span> <span class="p">(</span>
 <span class="mi">0</span><span class="p">:</span> <span class="nx">request-id </span><span class="c1">; request-id</span>
<span class="p">)</span>

<span class="nc">response </span><span class="p">=</span> <span class="p">(</span>
 <span class="mi">0</span><span class="p">:</span> <span class="nx">request-id </span><span class="c1">; request-id</span>
<span class="p">)</span>

<span class="nc">request-id </span><span class="p">=</span> <span class="kt">uint</span>

<span class="nc">microseconds </span><span class="p">=</span> <span class="kt">uint</span>

<span class="nc">epoch-time </span><span class="p">=</span> <span class="kt">int</span>

<span class="nc">media-timeline </span><span class="p">=</span> <span class="kt">float64</span>

<span class="nc">media-timeline-range </span><span class="p">=</span> <span class="p">[</span>
  <span class="nx">start</span><span class="p">:</span> <span class="nx">media-timeline</span><span class="p">,</span>
  <span class="nx">end</span><span class="p">:</span> <span class="nx">media-timeline</span>
<span class="p">]</span>

<span class="c1">; type key 1001</span>
<span class="nc"><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="auth-capabilities">auth-capabilities</dfn> </span><span class="p">=</span> <span class="p">{</span>
  <span class="mi">0</span><span class="p">:</span> <span class="kt">uint</span> <span class="c1">; psk-ease-of-input</span>
  <span class="mi">1</span><span class="p">:</span> <span class="p">[</span><span class="o">*</span> <span class="nx">psk-input-method</span><span class="p">]</span> <span class="c1">; psk-input-methods</span>
  <span class="mi">2</span><span class="p">:</span> <span class="kt">uint</span> <span class="c1">; psk-min-bits-of-entropy</span>
<span class="p">}</span>

<span class="nc">psk-input-method </span><span class="p">=</span> <span class="o">&amp;</span><span class="p">(</span>
  <span class="nx">numeric</span><span class="p">:</span> <span class="mi">0</span>
  <span class="nx">qr-code</span><span class="p">:</span> <span class="mi">1</span>
<span class="p">)</span>

<span class="nc"><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="auth-initiation-token">auth-initiation-token</dfn> </span><span class="p">=</span> <span class="p">(</span>
  <span class="p">?</span> <span class="mi">0</span> <span class="p">:</span> <span class="nx">text </span><span class="c1">; token</span>
<span class="p">)</span>

<span class="nc">auth-spake2-psk-status </span><span class="p">=</span> <span class="o">&amp;</span><span class="p">(</span>
 <span class="nx">psk-needs-presentation</span><span class="p">:</span> <span class="mi">0</span>
 <span class="nx">psk-shown</span><span class="p">:</span> <span class="mi">1</span>
 <span class="nx">psk-input</span><span class="p">:</span> <span class="mi">2</span>
<span class="p">)</span>

<span class="c1">; type key 1003</span>
<span class="nc"><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="auth-spake2-confirmation">auth-spake2-confirmation</dfn> </span><span class="p">=</span> <span class="p">{</span>
  <span class="mi">1</span> <span class="p">:</span> <span class="nx">bytes .size 64 </span><span class="c1">; confirmation-value</span>
<span class="p">}</span>

<span class="nc">auth-status-result </span><span class="p">=</span> <span class="o">&amp;</span><span class="p">(</span>
  <span class="nx">authenticated</span><span class="p">:</span> <span class="mi">0</span>
  <span class="nx">unknown-error</span><span class="p">:</span> <span class="mi">1</span>
  <span class="nx">timeout</span><span class="p">:</span> <span class="mi">2</span>
  <span class="nx">secret-unknown</span><span class="p">:</span> <span class="mi">3</span>
  <span class="nx">validation-took-too-long </span><span class="p">:</span> <span class="mi">4</span>
  <span class="nx">proof-invalid</span><span class="p">:</span> <span class="mi">5</span>
<span class="p">)</span>

<span class="c1">; type key 1004</span>
<span class="nc"><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="auth-status">auth-status</dfn> </span><span class="p">=</span> <span class="p">{</span>
  <span class="mi">1</span> <span class="p">:</span> <span class="nx">auth-status-result </span><span class="c1">; result</span>
<span class="p">}</span>

<span class="c1">; type key 1005</span>
<span class="nc"><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="auth-spake2-handshake">auth-spake2-handshake</dfn> </span><span class="p">=</span> <span class="p">{</span>
  <span class="mi">0</span><span class="p">:</span> <span class="nx">auth-spake2-psk-status </span><span class="c1">; psk-status</span>
  <span class="mi">1</span><span class="p">:</span> <span class="nx">bytes </span><span class="c1">; public-value</span>
<span class="p">}</span>

<span class="nc">watch-id </span><span class="p">=</span> <span class="kt">uint</span>

<span class="c1">; type key 14</span>
<span class="nc"><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="presentation-url-availability-request">presentation-url-availability-request</dfn> </span><span class="p">=</span> <span class="p">{</span>
  <span class="nx">request</span>
<span class="nx">  1</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="o">*</span> <span class="nx">text</span><span class="p">]</span> <span class="c1">; urls</span>
  <span class="mi">2</span><span class="p">:</span> <span class="nx">microseconds </span><span class="c1">; watch-duration</span>
  <span class="mi">3</span><span class="p">:</span> <span class="nx">watch-id </span><span class="c1">; watch-id</span>
<span class="p">}</span>

<span class="c1">; type key 15</span>
<span class="nc"><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="presentation-url-availability-response">presentation-url-availability-response</dfn> </span><span class="p">=</span> <span class="p">{</span>
  <span class="nx">response</span>
<span class="nx">  1</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="o">*</span> <span class="nx">url-availability</span><span class="p">]</span> <span class="c1">; url-availabilities</span>
<span class="p">}</span>

<span class="c1">; type key 103</span>
<span class="nc"><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="presentation-url-availability-event">presentation-url-availability-event</dfn> </span><span class="p">=</span> <span class="p">{</span>
  <span class="mi">1</span><span class="p">:</span> <span class="nx">watch-id </span><span class="c1">; watch-id</span>
  <span class="mi">2</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="o">*</span> <span class="nx">url-availability</span><span class="p">]</span> <span class="c1">; url-availabilities</span>
<span class="p">}</span>

<span class="c1">; idea: use HTTP response codes?</span>
<span class="nc">url-availability </span><span class="p">=</span> <span class="o">&amp;</span><span class="p">(</span>
  <span class="nx">available</span><span class="p">:</span> <span class="mi">0</span>
  <span class="nx">unavailable</span><span class="p">:</span> <span class="mi">1</span>
  <span class="nx">invalid</span><span class="p">:</span> <span class="mi">10</span>
<span class="p">)</span>

<span class="c1">; type key 104</span>
<span class="nc"><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="presentation-start-request">presentation-start-request</dfn> </span><span class="p">=</span> <span class="p">{</span>
  <span class="nx">request</span>
<span class="nx">  1</span><span class="p">:</span> <span class="nx">text </span><span class="c1">; presentation-id</span>
  <span class="mi">2</span><span class="p">:</span> <span class="nx">text </span><span class="c1">; url</span>
  <span class="mi">3</span><span class="p">:</span> <span class="p">[</span><span class="o">*</span> <span class="nx">http-header</span><span class="p">]</span> <span class="c1">; headers</span>
<span class="p">}</span>

<span class="nc">http-header </span><span class="p">=</span> <span class="p">[</span>
  <span class="nx">key</span><span class="p">:</span> <span class="nx">text</span>
<span class="nx">  value</span><span class="p">:</span> <span class="nx">text</span>
<span class="p">]</span>

<span class="c1">; type key 105</span>
<span class="nc"><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="presentation-start-response">presentation-start-response</dfn> </span><span class="p">=</span> <span class="p">{</span>
  <span class="nx">response</span>
<span class="nx">  1</span><span class="p">:</span> <span class="o">&amp;</span><span class="nx">result </span><span class="c1">; result</span>
  <span class="mi">2</span><span class="p">:</span> <span class="kt">uint</span> <span class="c1">; connection-id</span>
  <span class="mi">3</span><span class="p">:</span> <span class="p">?</span> <span class="kt">uint</span> <span class="c1">; http-response-code</span>
<span class="p">}</span>

<span class="nc">presentation-termination-source </span><span class="p">=</span> <span class="o">&amp;</span><span class="p">(</span>
  <span class="nx">controller</span><span class="p">:</span> <span class="mi">1</span>
  <span class="nx">receiver</span><span class="p">:</span> <span class="mi">2</span>
  <span class="nx">unknown</span><span class="p">:</span> <span class="mi">255</span>
<span class="p">)</span>

<span class="nc">presentation-termination-reason </span><span class="p">=</span> <span class="o">&amp;</span><span class="p">(</span>
  <span class="nx">application-request</span><span class="p">:</span> <span class="mi">1</span>
  <span class="nx">user-request</span><span class="p">:</span> <span class="mi">2</span>
  <span class="nx">receiver-replaced-presentation</span><span class="p">:</span> <span class="mi">20</span>
  <span class="nx">receiver-idle-too-long</span><span class="p">:</span> <span class="mi">30</span>
  <span class="nx">receiver-attempted-to-navigate</span><span class="p">:</span> <span class="mi">31</span>
  <span class="nx">receiver-powering-down</span><span class="p">:</span> <span class="mi">100</span>
  <span class="nx">receiver-error</span><span class="p">:</span> <span class="mi">101</span>
  <span class="nx">unknown</span><span class="p">:</span> <span class="mi">255</span>
<span class="p">)</span>

<span class="c1">; type key 106</span>
<span class="nc"><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="presentation-termination-request">presentation-termination-request</dfn> </span><span class="p">=</span> <span class="p">{</span>
  <span class="nx">request</span>
<span class="nx">  1</span><span class="p">:</span> <span class="nx">text </span><span class="c1">; presentation-id</span>
  <span class="mi">2</span><span class="p">:</span> <span class="nx">presentation-termination-reason </span><span class="c1">; reason</span>
<span class="p">}</span>

<span class="c1">; type key 107</span>
<span class="nc"><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="presentation-termination-response">presentation-termination-response</dfn> </span><span class="p">=</span> <span class="p">{</span>
  <span class="nx">response</span>
<span class="nx">  1</span><span class="p">:</span> <span class="o">&amp;</span><span class="nx">result </span><span class="c1">; result</span>
<span class="p">}</span>

<span class="c1">; type key 108</span>
<span class="nc"><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="presentation-termination-event">presentation-termination-event</dfn> </span><span class="p">=</span> <span class="p">{</span>
  <span class="mi">1</span><span class="p">:</span> <span class="nx">text </span><span class="c1">; presentation-id</span>
  <span class="mi">2</span><span class="p">:</span> <span class="nx">presentation-termination-source </span><span class="c1">; source</span>
  <span class="mi">3</span><span class="p">:</span> <span class="nx">presentation-termination-reason </span><span class="c1">; reason</span>
<span class="p">}</span>

<span class="c1">; type key 109</span>
<span class="nc"><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="presentation-connection-open-request">presentation-connection-open-request</dfn> </span><span class="p">=</span> <span class="p">{</span>
  <span class="nx">request</span>
<span class="nx">  1</span><span class="p">:</span> <span class="nx">text </span><span class="c1">; presentation-id</span>
  <span class="mi">2</span><span class="p">:</span> <span class="nx">text </span><span class="c1">; url</span>
<span class="p">}</span>

<span class="c1">; type key 110</span>
<span class="nc"><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="presentation-connection-open-response">presentation-connection-open-response</dfn> </span><span class="p">=</span> <span class="p">{</span>
  <span class="nx">response</span>
<span class="nx">  1</span><span class="p">:</span> <span class="o">&amp;</span><span class="nx">result </span><span class="c1">; result</span>
  <span class="mi">2</span><span class="p">:</span> <span class="kt">uint</span><span class="c1">; connection-id</span>
  <span class="mi">3</span><span class="p">:</span> <span class="kt">uint</span><span class="c1">; connection-count</span>
<span class="p">}</span>

<span class="c1">; type key 113</span>
<span class="nc"><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="presentation-connection-close-event">presentation-connection-close-event</dfn> </span><span class="p">=</span> <span class="p">{</span>
  <span class="mi">1</span><span class="p">:</span> <span class="kt">uint</span><span class="c1">; connection-id</span>
  <span class="mi">2</span><span class="p">:</span> <span class="o">&amp;</span><span class="p">(</span>
    <span class="nx">close-method-called</span><span class="p">:</span> <span class="mi">1</span>
    <span class="nx">connection-object-discarded</span><span class="p">:</span> <span class="mi">10</span>
    <span class="nx">unrecoverable-error-while-sending-or-receiving-message</span><span class="p">:</span> <span class="mi">100</span>
  <span class="p">)</span> <span class="c1">; reason</span>
  <span class="p">?</span> <span class="mi">3</span><span class="p">:</span> <span class="nx">text </span><span class="c1">; error-message</span>
  <span class="mi">4</span><span class="p">:</span> <span class="kt">uint</span><span class="c1">; connection-count</span>
<span class="p">}</span>

<span class="c1">; type key 121</span>
<span class="nc"><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="presentation-change-event">presentation-change-event</dfn> </span><span class="p">=</span> <span class="p">{</span>
  <span class="mi">1</span><span class="p">:</span> <span class="nx">text </span><span class="c1">; presentation-id</span>
  <span class="mi">2</span><span class="p">:</span> <span class="kt">uint</span> <span class="c1">; connection-count</span>
<span class="p">}</span>

<span class="c1">; type key 16</span>
<span class="nc"><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="presentation-connection-message">presentation-connection-message</dfn> </span><span class="p">=</span> <span class="p">{</span>
  <span class="mi">1</span><span class="p">:</span> <span class="kt">uint</span> <span class="c1">; connection-id</span>
  <span class="mi">2</span><span class="p">:</span> <span class="nx">bytes </span><span class="o">/</span> <span class="nx">text </span><span class="c1">; message</span>
<span class="p">}</span>

<span class="nc">result </span><span class="p">=</span> <span class="p">(</span>
  <span class="nx">success</span><span class="p">:</span> <span class="mi">1</span>
  <span class="nx">invalid-url</span><span class="p">:</span> <span class="mi">10</span>
  <span class="nx">invalid-presentation-id</span><span class="p">:</span> <span class="mi">11</span>
  <span class="nx">timeout</span><span class="p">:</span> <span class="mi">100</span>
  <span class="nx">transient-error</span><span class="p">:</span> <span class="mi">101</span>
  <span class="nx">permanent-error</span><span class="p">:</span> <span class="mi">102</span>
  <span class="nx">terminating</span><span class="p">:</span> <span class="mi">103</span>
  <span class="nx">unknown-error</span><span class="p">:</span> <span class="mi">199</span>
<span class="p">)</span>

<span class="c1">; type key 17</span>
<span class="nc"><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="remote-playback-availability-request">remote-playback-availability-request</dfn> </span><span class="p">=</span> <span class="p">{</span>
  <span class="nx">request</span>
<span class="nx">  1</span><span class="p">:</span> <span class="p">[</span><span class="o">*</span> <span class="nx">remote-playback-source</span><span class="p">]</span> <span class="c1">; sources</span>
  <span class="mi">2</span><span class="p">:</span> <span class="nx">microseconds </span><span class="c1">; watch-duration</span>
  <span class="mi">3</span><span class="p">:</span> <span class="nx">watch-id </span><span class="c1">; watch-id</span>
<span class="p">}</span>

<span class="c1">; type key 18</span>
<span class="nc"><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="remote-playback-availability-response">remote-playback-availability-response</dfn> </span><span class="p">=</span> <span class="p">{</span>
  <span class="nx">response</span>
<span class="nx">  url-availabilities</span><span class="p">:</span> <span class="p">[</span><span class="o">*</span> <span class="nx">url-availability</span><span class="p">]</span>
<span class="p">}</span>

<span class="c1">; type key 114</span>
<span class="nc"><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="remote-playback-availability-event">remote-playback-availability-event</dfn> </span><span class="p">=</span> <span class="p">{</span>
  <span class="mi">1</span><span class="p">:</span> <span class="nx">watch-id </span><span class="c1">; watch-id</span>
  <span class="mi">2</span><span class="p">:</span> <span class="p">[</span><span class="o">*</span> <span class="nx">url-availability</span><span class="p">]</span> <span class="c1">; url-availabilities</span>
<span class="p">}</span>

<span class="c1">; type key 115</span>
<span class="nc"><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="remote-playback-start-request">remote-playback-start-request</dfn> </span><span class="p">=</span> <span class="p">{</span>
  <span class="nx">request</span>
<span class="nx">  1</span><span class="p">:</span> <span class="nx">remote-playback-id </span><span class="c1">; remote-playback-id</span>
  <span class="p">?</span> <span class="mi">2</span><span class="p">:</span> <span class="p">[</span><span class="o">*</span> <span class="nx">remote-playback-source</span><span class="p">]</span> <span class="c1">; sources</span>
  <span class="p">?</span> <span class="mi">3</span><span class="p">:</span> <span class="p">[</span><span class="o">*</span> <span class="nx">text</span><span class="p">]</span> <span class="c1">; text-track-urls</span>
  <span class="p">?</span> <span class="mi">4</span><span class="p">:</span> <span class="p">[</span><span class="o">*</span> <span class="nx">http-header</span><span class="p">]</span> <span class="c1">; headers</span>
  <span class="p">?</span> <span class="mi">5</span><span class="p">:</span> <span class="nx">remote-playback-controls </span><span class="c1">; controls</span>
  <span class="p">?</span> <span class="mi">6</span><span class="p">:</span> <span class="p">{</span><span class="nx">streaming-session-start-request-params</span><span class="p">}</span> <span class="c1">; remoting</span>
<span class="p">}</span>

<span class="nc">remote-playback-source </span><span class="p">=</span> <span class="p">{</span>
  <span class="mi">1</span><span class="p">:</span> <span class="nx">text</span><span class="c1">; url</span>
  <span class="mi">3</span><span class="p">:</span> <span class="nx">text</span><span class="c1">; extended-mime-type</span>
<span class="p">}</span>

<span class="c1">; type key 116</span>
<span class="nc"><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="remote-playback-start-response">remote-playback-start-response</dfn> </span><span class="p">=</span> <span class="p">{</span>
  <span class="nx">response</span>
<span class="nx">  </span><span class="p">?</span> <span class="mi">1</span><span class="p">:</span> <span class="nx">remote-playback-state </span><span class="c1">; state</span>
  <span class="p">?</span> <span class="mi">2</span><span class="p">:</span> <span class="p">{</span><span class="nx">streaming-session-start-response-params</span><span class="p">}</span> <span class="c1">; remoting</span>
<span class="p">}</span>

<span class="c1">; type key 117</span>
<span class="nc"><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="remote-playback-termination-request">remote-playback-termination-request</dfn> </span><span class="p">=</span> <span class="p">{</span>
  <span class="nx">request</span>
<span class="nx">  1</span><span class="p">:</span> <span class="nx">remote-playback-id </span><span class="c1">; remote-playback-id</span>
  <span class="mi">2</span><span class="p">:</span> <span class="o">&amp;</span><span class="p">(</span>
    <span class="nx">user-terminated-via-controller</span><span class="p">:</span> <span class="mi">11</span>
    <span class="nx">unknown</span><span class="p">:</span> <span class="mi">255</span>
  <span class="p">)</span> <span class="c1">; reason</span>
<span class="p">}</span>

<span class="c1">; type key 118</span>
<span class="nc"><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="remote-playback-termination-response">remote-playback-termination-response</dfn> </span><span class="p">=</span> <span class="p">{</span>
  <span class="nx">response</span>
<span class="nx">  1</span><span class="p">:</span> <span class="o">&amp;</span><span class="nx">result </span><span class="c1">; result</span>
<span class="p">}</span>

<span class="c1">; type key 119</span>
<span class="nc"><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="remote-playback-termination-event">remote-playback-termination-event</dfn> </span><span class="p">=</span> <span class="p">{</span>
 <span class="mi">1</span><span class="p">:</span> <span class="nx">remote-playback-id </span><span class="c1">; remote-playback-id</span>
 <span class="mi">2</span><span class="p">:</span> <span class="o">&amp;</span><span class="p">(</span>
    <span class="nx">receiver-called-terminate</span><span class="p">:</span> <span class="mi">1</span>
    <span class="nx">user-terminated-via-receiver</span><span class="p">:</span> <span class="mi">2</span>
    <span class="nx">receiver-idle-too-long</span><span class="p">:</span> <span class="mi">30</span>
    <span class="nx">receiver-powering-down</span><span class="p">:</span> <span class="mi">100</span>
    <span class="nx">receiver-crashed</span><span class="p">:</span> <span class="mi">101</span>
    <span class="nx">unknown</span><span class="p">:</span> <span class="mi">255</span>
  <span class="p">)</span> <span class="c1">; reason</span>
<span class="p">}</span>

<span class="c1">; type key 19</span>
<span class="nc"><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="remote-playback-modify-request">remote-playback-modify-request</dfn> </span><span class="p">=</span> <span class="p">{</span>
  <span class="nx">request</span>
<span class="nx">  1</span><span class="p">:</span> <span class="nx">remote-playback-id </span><span class="c1">; remote-playback-id</span>
  <span class="mi">2</span><span class="p">:</span> <span class="nx">remote-playback-controls </span><span class="c1">; controls</span>
<span class="p">)</span>

<span class="c1">; type key 20</span>
<span class="nc"><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="remote-playback-modify-response">remote-playback-modify-response</dfn> </span><span class="p">=</span> <span class="p">{</span>
  <span class="nx">response</span>
<span class="nx">  1</span><span class="p">:</span> <span class="o">&amp;</span><span class="nx">result </span><span class="c1">; result</span>
  <span class="p">?</span> <span class="mi">2</span><span class="p">:</span> <span class="nx">remote-playback-state </span><span class="c1">; state</span>
<span class="p">}</span>

<span class="c1">; type key 21</span>
<span class="nc"><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="remote-playback-state-event">remote-playback-state-event</dfn> </span><span class="p">=</span> <span class="p">{</span>
  <span class="mi">1</span><span class="p">:</span> <span class="nx">remote-playback-id </span><span class="c1">; remote-playback-id</span>
  <span class="mi">2</span><span class="p">:</span> <span class="nx">remote-playback-state </span><span class="c1">; state</span>
<span class="p">}</span>

<span class="nc">remote-playback-id </span><span class="p">=</span> <span class="kt">uint</span>

<span class="nc">remote-playback-controls </span><span class="p">=</span> <span class="p">{</span>
  <span class="p">?</span> <span class="mi">1</span><span class="p">:</span> <span class="nx">remote-playback-source </span><span class="c1">; source</span>
  <span class="p">?</span> <span class="mi">2</span><span class="p">:</span> <span class="o">&amp;</span><span class="p">(</span><span class="nx">none</span><span class="p">,</span> <span class="nx">metadata</span><span class="p">,</span> <span class="nx">auto</span><span class="p">)</span> <span class="c1">; preload</span>
  <span class="p">?</span> <span class="mi">3</span><span class="p">:</span> <span class="nx">bool </span><span class="c1">; loop</span>
  <span class="p">?</span> <span class="mi">4</span><span class="p">:</span> <span class="nx">bool </span><span class="c1">; paused</span>
  <span class="p">?</span> <span class="mi">5</span><span class="p">:</span> <span class="nx">bool </span><span class="c1">; muted</span>
  <span class="p">?</span> <span class="mi">6</span><span class="p">:</span> <span class="kt">float64</span> <span class="c1">; volume</span>
  <span class="p">?</span> <span class="mi">7</span><span class="p">:</span> <span class="nx">media-timeline </span><span class="c1">; seek</span>
  <span class="p">?</span> <span class="mi">8</span><span class="p">:</span> <span class="nx">media-timeline </span><span class="c1">; fast-seek</span>
  <span class="p">?</span> <span class="mi">9</span><span class="p">:</span> <span class="kt">float64</span> <span class="c1">; playback-rate</span>
  <span class="p">?</span> <span class="mi">10</span><span class="p">:</span> <span class="nx">text </span><span class="c1">; poster</span>
  <span class="p">?</span> <span class="mi">11</span><span class="p">:</span> <span class="p">[</span><span class="o">*</span> <span class="nx">text</span><span class="p">]</span> <span class="c1">; enabled-audio-track-ids</span>
  <span class="p">?</span> <span class="mi">12</span><span class="p">:</span> <span class="nx">text </span><span class="c1">; selected-video-track-id</span>
  <span class="p">?</span> <span class="mi">13</span><span class="p">:</span> <span class="p">[</span><span class="o">*</span> <span class="nx">added-text-track</span><span class="p">]</span> <span class="c1">; added-text-tracks</span>
  <span class="p">?</span> <span class="mi">14</span><span class="p">:</span> <span class="p">[</span><span class="o">*</span> <span class="nx">changed-text-track</span><span class="p">]</span> <span class="c1">; changed-text-tracks</span>
<span class="p">}</span>

<span class="nc">remote-playback-state </span><span class="p">=</span> <span class="p">{</span>
  <span class="p">?</span> <span class="mi">1</span><span class="p">:</span> <span class="o">&amp;</span><span class="p">(</span><span class="nx">rate</span><span class="p">:</span> <span class="nx">bool</span><span class="p">,</span>
         <span class="nx">preload</span><span class="p">:</span> <span class="nx">bool</span><span class="p">,</span>
         <span class="nx">poster</span><span class="p">:</span> <span class="nx">bool</span><span class="p">,</span>
         <span class="nx">added-text-track</span><span class="p">:</span>
         <span class="nx">bool</span><span class="p">,</span>
         <span class="nx">added-cues</span><span class="p">:</span> <span class="nx">bool</span><span class="p">)</span> <span class="c1">; supports</span>
  <span class="p">?</span> <span class="mi">2</span><span class="p">:</span> <span class="nx">remote-playback-source </span><span class="c1">; source</span>
  <span class="p">?</span> <span class="mi">3</span><span class="p">:</span> <span class="o">&amp;</span><span class="p">(</span>
    <span class="nx">empty</span><span class="p">:</span> <span class="mi">0</span>
    <span class="nx">idle</span><span class="p">:</span> <span class="mi">1</span>
    <span class="nx">loading</span><span class="p">:</span> <span class="mi">2</span>
    <span class="nx">no-source</span><span class="p">:</span> <span class="mi">3</span>
  <span class="p">)</span> <span class="c1">; loading</span>
  <span class="p">?</span> <span class="mi">4</span><span class="p">:</span> <span class="o">&amp;</span><span class="p">(</span>
    <span class="nx">nothing</span><span class="p">:</span> <span class="mi">0</span>
    <span class="nx">metadata</span><span class="p">:</span> <span class="mi">1</span>
    <span class="nx">current</span><span class="p">:</span> <span class="mi">2</span>
    <span class="nx">future</span><span class="p">:</span> <span class="mi">3</span>
    <span class="nx">enough</span><span class="p">:</span> <span class="mi">4</span>
  <span class="p">)</span> <span class="c1">; loaded</span>
  <span class="p">?</span> <span class="mi">5</span><span class="p">:</span> <span class="nx">media-error </span><span class="p">:</span> <span class="nx">error</span>
<span class="nx">  </span><span class="p">?</span> <span class="mi">6</span><span class="p">:</span> <span class="nx">epoch-time </span><span class="o">/</span> <span class="kc">null</span><span class="c1">; epoch</span>
  <span class="p">?</span> <span class="mi">7</span><span class="p">:</span> <span class="nx">media-timeline </span><span class="o">/</span> <span class="kc">null</span> <span class="c1">; duration</span>
  <span class="p">?</span> <span class="mi">8</span><span class="p">:</span> <span class="p">[</span><span class="o">*</span> <span class="nx">media-timeline-range</span><span class="p">]</span> <span class="c1">; buffered-time-ranges</span>
  <span class="p">?</span> <span class="mi">9</span><span class="p">:</span> <span class="p">[</span><span class="o">*</span> <span class="nx">media-timeline-range</span><span class="p">]</span> <span class="c1">; seekable-time-ranges</span>
  <span class="p">?</span> <span class="mi">10</span><span class="p">:</span> <span class="p">[</span><span class="o">*</span> <span class="nx">media-timeline-range</span><span class="p">]</span> <span class="c1">; played-time-ranges</span>
  <span class="p">?</span> <span class="mi">11</span><span class="p">:</span> <span class="nx">media-timeline </span><span class="c1">; position</span>
  <span class="p">?</span> <span class="mi">12</span><span class="p">:</span> <span class="kt">float64</span> <span class="p">:</span> <span class="nx">playbackRate</span>
<span class="nx">  </span><span class="p">?</span> <span class="mi">13</span><span class="p">:</span> <span class="nx">bool </span><span class="c1">; paused</span>
  <span class="p">?</span> <span class="mi">14</span><span class="p">:</span> <span class="nx">bool </span><span class="c1">; seeking</span>
  <span class="p">?</span> <span class="mi">15</span><span class="p">:</span> <span class="nx">bool </span><span class="c1">; stalled</span>
  <span class="p">?</span> <span class="mi">16</span><span class="p">:</span> <span class="nx">bool </span><span class="c1">; ended</span>
  <span class="p">?</span> <span class="mi">17</span><span class="p">:</span> <span class="kt">float64</span> <span class="c1">; volume</span>
  <span class="p">?</span> <span class="mi">18</span><span class="p">:</span> <span class="nx">bool </span><span class="c1">; muted</span>
  <span class="p">?</span> <span class="mi">19</span><span class="p">:</span> <span class="nx">video-resolution </span><span class="o">/</span> <span class="kc">null</span> <span class="c1">; resolution</span>
  <span class="p">?</span> <span class="mi">20</span><span class="p">:</span> <span class="p">[</span><span class="o">*</span> <span class="nx">audio-track-state</span><span class="p">]</span> <span class="nx">audio-tracks</span>
<span class="nx">  </span><span class="p">?</span> <span class="mi">21</span><span class="p">:</span> <span class="p">[</span><span class="o">*</span> <span class="nx">video-track-state</span><span class="p">]</span> <span class="nx">video-tracks</span>
<span class="nx">  </span><span class="p">?</span> <span class="mi">22</span><span class="p">:</span> <span class="p">[</span><span class="o">*</span> <span class="nx">text-track-state</span><span class="p">]</span> <span class="nx">text-tracks</span>
<span class="p">}</span>

<span class="nc">added-text-track </span><span class="p">=</span> <span class="p">{</span>
  <span class="mi">1</span><span class="p">:</span> <span class="o">&amp;</span><span class="p">(</span>
    <span class="nx">subtitles</span>
<span class="nx">    captions</span>
<span class="nx">    descriptions</span>
<span class="nx">    chapters</span>
<span class="nx">    metadata</span>
<span class="nx">  </span><span class="p">)</span> <span class="c1">; kind</span>
  <span class="p">?</span> <span class="mi">2</span><span class="p">:</span> <span class="nx">text </span><span class="c1">; label</span>
  <span class="p">?</span> <span class="mi">3</span><span class="p">:</span> <span class="nx">text </span><span class="c1">; language</span>
<span class="p">}</span>

<span class="nc">changed-text-track </span><span class="p">=</span> <span class="p">{</span>
  <span class="mi">1</span><span class="p">:</span> <span class="nx">text </span><span class="c1">; id</span>
  <span class="mi">2</span><span class="p">:</span> <span class="nx">mode </span><span class="c1">; mode</span>
  <span class="p">?</span> <span class="mi">3</span><span class="p">:</span> <span class="p">[</span><span class="o">*</span> <span class="nx">text-track-cue</span><span class="p">]</span> <span class="c1">; added-cues</span>
  <span class="p">?</span> <span class="mi">4</span><span class="p">:</span> <span class="p">[</span><span class="o">*</span> <span class="nx">text</span><span class="p">]</span> <span class="c1">; removed-cue-ids</span>
<span class="p">}</span>

<span class="nc">text-track-mode </span><span class="p">=</span> <span class="o">&amp;</span><span class="p">(</span>
  <span class="nx">disabled</span>
<span class="nx">  showing</span>
<span class="nx">  hidden</span>
<span class="p">)</span>

<span class="nc"><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="text-track-cue">text-track-cue</dfn> </span><span class="p">=</span> <span class="p">{</span>
  <span class="mi">1</span><span class="p">:</span> <span class="nx">text </span><span class="c1">; id</span>
  <span class="mi">2</span><span class="p">:</span> <span class="nx">media-timeline-range </span><span class="c1">; range</span>
  <span class="mi">3</span><span class="p">:</span> <span class="nx">text </span><span class="c1">; text</span>
<span class="p">}</span>

<span class="nc">media-sync-time </span><span class="p">=</span> <span class="p">[</span>
  <span class="nx">value</span><span class="p">:</span> <span class="kt">uint</span>
  <span class="nx">scale</span><span class="p">:</span> <span class="kt">uint</span>
<span class="p">]</span>

<span class="nc">unknown </span><span class="p">=</span> <span class="mi">0</span>
<span class="nc">forever </span><span class="p">=</span> <span class="mi">1</span>

<span class="nc">media-error </span><span class="p">=</span> <span class="p">[</span>
  <span class="nx">code</span><span class="p">:</span> <span class="o">&amp;</span><span class="p">(</span>
    <span class="nx">user-aborted</span><span class="p">:</span> <span class="mi">1</span>
    <span class="nx">network-error</span><span class="p">:</span> <span class="mi">2</span>
    <span class="nx">decode-error</span><span class="p">:</span> <span class="mi">3</span>
    <span class="nx">source-not-supported</span><span class="p">:</span> <span class="mi">4</span>
    <span class="nx">unknown-error</span><span class="p">:</span> <span class="mi">5</span>
  <span class="p">)</span>
  <span class="nx">message</span><span class="p">:</span> <span class="nx">text</span>
<span class="p">]</span>

<span class="nc">track-state </span><span class="p">=</span> <span class="p">(</span>
  <span class="mi">1</span><span class="p">:</span> <span class="nx">text </span><span class="c1">; id</span>
  <span class="mi">2</span><span class="p">:</span> <span class="nx">text </span><span class="c1">; label</span>
  <span class="mi">3</span><span class="p">:</span> <span class="nx">text </span><span class="c1">; language</span>
<span class="p">)</span>

<span class="nc">audio-track-state </span><span class="p">=</span> <span class="p">{</span>
  <span class="nx">track-state</span>
<span class="nx">  4</span><span class="p">:</span> <span class="nx">bool </span><span class="c1">; enabled</span>
<span class="p">}</span>

<span class="nc">video-track-state </span><span class="p">=</span> <span class="p">{</span>
  <span class="nx">track-state</span>
<span class="nx">  5 </span><span class="p">:</span> <span class="nx">bool </span><span class="c1">; selected</span>
<span class="p">}</span>

<span class="nc">text-track-state </span><span class="p">=</span> <span class="p">{</span>
  <span class="nx">track-state</span>
<span class="nx">  6 </span><span class="p">:</span> <span class="nx">mode </span><span class="c1">; text-track-mode</span>
<span class="p">}</span>

<span class="c1">; type key 22</span>
<span class="nc"><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="audio-frame">audio-frame</dfn> </span><span class="p">=</span> <span class="p">[</span>
  <span class="nx">encoding-id</span><span class="p">:</span> <span class="kt">uint</span>
  <span class="nx">start-time</span><span class="p">:</span> <span class="kt">uint</span>
  <span class="nx">payload</span><span class="p">:</span> <span class="nx">bytes</span>
<span class="nx">  </span><span class="p">?</span> <span class="nx">optional</span><span class="p">:</span> <span class="p">{</span>
    <span class="p">?</span> <span class="mi">0</span><span class="p">:</span> <span class="kt">uint</span> <span class="c1">; duration</span>
    <span class="p">?</span> <span class="mi">1</span><span class="p">:</span> <span class="nx">media-sync-time </span><span class="c1">; sync-time</span>
  <span class="p">}</span>
<span class="p">]</span>

<span class="c1">; type key 23</span>
<span class="nc"><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="video-frame">video-frame</dfn> </span><span class="p">=</span> <span class="p">{</span>
  <span class="mi">0</span><span class="p">:</span> <span class="kt">uint</span> <span class="c1">; encoding-id</span>
  <span class="mi">1</span><span class="p">:</span> <span class="kt">uint</span> <span class="c1">; sequence-number</span>
  <span class="p">?</span> <span class="mi">2</span><span class="p">:</span> <span class="p">[</span><span class="o">*</span> <span class="kt">int</span><span class="p">]</span> <span class="c1">; depends-on</span>
  <span class="mi">3</span><span class="p">:</span> <span class="kt">uint</span> <span class="c1">; start-time</span>
  <span class="p">?</span> <span class="mi">4</span><span class="p">:</span> <span class="kt">uint</span> <span class="c1">; duration</span>
  <span class="mi">5</span><span class="p">:</span> <span class="nx">bytes </span><span class="c1">; payload</span>
  <span class="p">?</span> <span class="mi">6</span><span class="p">:</span> <span class="kt">uint</span> <span class="c1">; video-rotation</span>
  <span class="p">?</span> <span class="mi">7</span><span class="p">:</span> <span class="nx">media-sync-time </span><span class="c1">; sync-time</span>
<span class="p">}</span>

<span class="c1">; type key 24</span>
<span class="nc"><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="data-frame">data-frame</dfn> </span><span class="p">=</span> <span class="p">{</span>
  <span class="mi">0</span><span class="p">:</span> <span class="kt">uint</span><span class="c1">; encoding-id</span>
  <span class="p">?</span> <span class="mi">1</span><span class="p">:</span> <span class="kt">uint</span> <span class="c1">; sequence-number</span>
  <span class="p">?</span> <span class="mi">2</span><span class="p">:</span> <span class="kt">uint</span> <span class="c1">; start-time</span>
  <span class="p">?</span> <span class="mi">3</span><span class="p">:</span> <span class="kt">uint</span> <span class="c1">; duration</span>
  <span class="mi">4</span><span class="p">:</span> <span class="nx">any</span><span class="c1">; payload</span>
  <span class="p">?</span> <span class="mi">5</span><span class="p">:</span> <span class="nx">media-sync-time </span><span class="c1">; sync-time</span>
<span class="p">}</span>

<span class="nc">ratio </span><span class="p">=</span> <span class="p">[</span>
  <span class="nx">antecedent</span><span class="p">:</span> <span class="kt">uint</span>
  <span class="nx">consequent</span><span class="p">:</span> <span class="kt">uint</span>
<span class="p">]</span>

<span class="c1">; type key 122</span>
<span class="nc"><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="streaming-capabilities-request">streaming-capabilities-request</dfn> </span><span class="p">=</span> <span class="p">{</span>
  <span class="nx">request</span>
<span class="p">}</span>

<span class="c1">; type key 123</span>
<span class="nc"><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="streaming-capabilities-response">streaming-capabilities-response</dfn> </span><span class="p">=</span> <span class="p">{</span>
  <span class="nx">response</span>
<span class="nx">  1</span><span class="p">:</span> <span class="nx">streaming-capabilities </span><span class="c1">; streaming-capabilities</span>
<span class="p">}</span>

<span class="nc">streaming-capabilities </span><span class="p">=</span> <span class="p">{</span>
  <span class="mi">0</span><span class="p">:</span> <span class="p">[</span><span class="o">*</span> <span class="nx">receive-audio-capability</span><span class="p">]</span> <span class="c1">; receive-audio</span>
  <span class="mi">1</span><span class="p">:</span> <span class="p">[</span><span class="o">*</span> <span class="nx">receive-video-capability</span><span class="p">]</span> <span class="c1">; receive-video</span>
  <span class="mi">2</span><span class="p">:</span> <span class="p">[</span><span class="o">*</span> <span class="nx">receive-data-capability</span><span class="p">]</span> <span class="c1">; receive-data</span>
<span class="p">}</span>

<span class="nc">format </span><span class="p">=</span> <span class="p">{</span>
  <span class="mi">0</span><span class="p">:</span> <span class="nx">string </span><span class="c1">; codec-name</span>
<span class="p">}</span>

<span class="nc">receive-audio-capability </span><span class="p">=</span> <span class="p">{</span>
  <span class="mi">0</span><span class="p">:</span> <span class="nx">format </span><span class="c1">; codec</span>
  <span class="p">?</span> <span class="mi">1</span><span class="p">:</span> <span class="kt">uint</span> <span class="c1">; max-audio-channels</span>
  <span class="p">?</span> <span class="mi">2</span><span class="p">:</span> <span class="kt">uint</span> <span class="c1">; min-bit-rate</span>
<span class="p">}</span>

<span class="nc">video-resolution </span><span class="p">=</span> <span class="p">{</span>
  <span class="mi">0</span><span class="p">:</span> <span class="kt">uint</span> <span class="c1">; height</span>
  <span class="mi">1</span><span class="p">:</span> <span class="kt">uint</span> <span class="c1">; width</span>
<span class="p">}</span>

<span class="nc">video-hdr-format </span><span class="p">=</span> <span class="p">{</span>
  <span class="mi">0</span><span class="p">:</span> <span class="nx">transfer-function </span><span class="c1">; string</span>
  <span class="mi">1</span><span class="p">:</span> <span class="p">?</span> <span class="nx">hdr-metadata </span><span class="c1">; string</span>
<span class="p">}</span>

<span class="nc">receive-video-capability </span><span class="p">=</span> <span class="p">{</span>
  <span class="mi">0</span><span class="p">:</span> <span class="nx">format </span><span class="c1">; codec</span>
  <span class="p">?</span> <span class="mi">1</span><span class="p">:</span> <span class="nx">video-resolution </span><span class="c1">; max-resolution</span>
  <span class="p">?</span> <span class="mi">2</span><span class="p">:</span> <span class="nx">ratio </span><span class="c1">; max-frames-per-second</span>
  <span class="p">?</span> <span class="mi">3</span><span class="p">:</span> <span class="kt">uint</span> <span class="c1">; max-pixels-per-second</span>
  <span class="p">?</span> <span class="mi">4</span><span class="p">:</span> <span class="kt">uint</span> <span class="c1">; min-bit-rate</span>
  <span class="p">?</span> <span class="mi">5</span><span class="p">:</span> <span class="nx">ratio </span><span class="c1">; aspect-ratio</span>
  <span class="p">?</span> <span class="mi">6</span><span class="p">:</span> <span class="nx">string </span><span class="c1">; color-gamut</span>
  <span class="p">?</span> <span class="mi">7</span><span class="p">:</span> <span class="p">[</span><span class="o">*</span> <span class="nx">video-resolution</span><span class="p">]</span> <span class="c1">; native-resolutions</span>
  <span class="p">?</span> <span class="mi">8</span><span class="p">:</span> <span class="nx">bool </span><span class="c1">; supports-scaling</span>
  <span class="p">?</span> <span class="mi">9</span><span class="p">:</span> <span class="nx">bool </span><span class="c1">; supports-rotation</span>
  <span class="p">?</span> <span class="mi">10</span><span class="p">:</span> <span class="p">[</span><span class="o">*</span> <span class="nx">video-hdr-format</span><span class="p">]</span> <span class="c1">; hdr-formats</span>
<span class="p">}</span>

<span class="nc">receive-data-capability </span><span class="p">=</span> <span class="p">{</span>
  <span class="mi">0</span><span class="p">:</span> <span class="nx">format </span><span class="c1">; data-type</span>
<span class="p">}</span>

<span class="c1">; type key 124</span>
<span class="nc"><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="streaming-session-start-request">streaming-session-start-request</dfn> </span><span class="p">=</span> <span class="p">{</span>
  <span class="nx">request</span>
<span class="nx">  streaming-session-start-request-params</span>
<span class="p">}</span>

<span class="c1">; type key 125</span>
<span class="nc"><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="streaming-session-start-response">streaming-session-start-response</dfn> </span><span class="p">=</span> <span class="p">{</span>
  <span class="nx">response</span>
<span class="nx">  streaming-session-start-response-params</span>
<span class="p">}</span>

<span class="c1">; A separate group so it can be used in remote-playback-start-request</span>
<span class="nc">streaming-session-start-request-params </span><span class="p">=</span> <span class="p">(</span>
  <span class="mi">1</span><span class="p">:</span> <span class="kt">uint</span><span class="c1">; streaming-session-id</span>
  <span class="mi">2</span><span class="p">:</span> <span class="p">[</span><span class="o">*</span> <span class="nx">media-stream-offer</span><span class="p">]</span> <span class="c1">;  stream-offers</span>
  <span class="mi">3</span><span class="p">:</span> <span class="nx">microseconds </span><span class="c1">; desired-stats-interval</span>
<span class="p">)</span>

<span class="c1">; type key 126</span>
<span class="nc"><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="streaming-session-modify-request">streaming-session-modify-request</dfn> </span><span class="p">=</span> <span class="p">{</span>
  <span class="nx">request</span>
<span class="nx">  streaming-session-modify-request-params</span>
<span class="p">}</span>

<span class="c1">; A separate group so it can be used in remote-playback-start-response</span>
<span class="nc">streaming-session-start-response-params </span><span class="p">=</span> <span class="p">(</span>
  <span class="mi">1</span><span class="p">:</span> <span class="o">&amp;</span><span class="nx">result </span><span class="c1">; result</span>
  <span class="mi">2</span><span class="p">:</span> <span class="p">[</span><span class="o">*</span> <span class="nx">media-stream-request</span><span class="p">]</span> <span class="c1">; stream-requests</span>
  <span class="mi">3</span><span class="p">:</span> <span class="nx">microseconds </span><span class="c1">; desired-stats-interval  </span>
<span class="p">)</span>

<span class="nc">streaming-session-modify-request-params </span><span class="p">=</span> <span class="p">(</span>
  <span class="mi">1</span><span class="p">:</span> <span class="kt">uint</span> <span class="c1">; streaming-session-id</span>
  <span class="mi">2</span><span class="p">:</span> <span class="p">[</span><span class="o">*</span> <span class="nx">media-stream-request</span><span class="p">]</span> <span class="c1">; stream-requests</span>
<span class="p">)</span>

<span class="c1">; type key 127</span>
<span class="nc"><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="streaming-session-modify-response">streaming-session-modify-response</dfn> </span><span class="p">=</span> <span class="p">{</span>
  <span class="nx">response</span>
<span class="nx">  1</span><span class="p">:</span> <span class="o">&amp;</span><span class="nx">result </span><span class="c1">; result</span>
<span class="p">}</span>

<span class="c1">; type key 128</span>
<span class="nc"><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="streaming-session-terminate-request">streaming-session-terminate-request</dfn> </span><span class="p">=</span> <span class="p">{</span>
  <span class="nx">request</span>
<span class="nx">  1 </span><span class="p">:</span> <span class="kt">uint</span> <span class="c1">; streaming-session-id</span>
<span class="p">}</span>

<span class="c1">; type key 129</span>
<span class="nc"><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="streaming-session-terminate-response">streaming-session-terminate-response</dfn> </span><span class="p">=</span> <span class="p">{</span>
  <span class="nx">response</span>
<span class="p">}</span>

<span class="c1">; type key 130</span>
<span class="nc"><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="streaming-session-terminate-event">streaming-session-terminate-event</dfn> </span><span class="p">=</span> <span class="p">{</span>
  <span class="mi">1</span> <span class="p">:</span> <span class="kt">uint</span> <span class="c1">; streaming-session-id</span>
<span class="p">}</span>

<span class="nc">media-stream-offer </span><span class="p">=</span> <span class="p">{</span>
  <span class="mi">1</span> <span class="p">:</span> <span class="kt">uint</span> <span class="c1">; media-stream-id</span>
  <span class="p">?</span> <span class="mi">2</span> <span class="p">:</span> <span class="nx">text </span><span class="c1">; display-name</span>
  <span class="p">?</span> <span class="mi">3</span> <span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="o">*</span> <span class="nx">audio-encoding-offer</span><span class="p">]</span> <span class="c1">; audio</span>
  <span class="p">?</span> <span class="mi">4</span> <span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="o">*</span> <span class="nx">video-encoding-offer</span><span class="p">]</span> <span class="c1">; video</span>
  <span class="p">?</span> <span class="mi">5</span> <span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="o">*</span> <span class="nx">data-encoding-offer</span><span class="p">]</span> <span class="c1">; data</span>
<span class="p">}</span>

<span class="nc">media-stream-request </span><span class="p">=</span> <span class="p">{</span>
  <span class="mi">1</span> <span class="p">:</span> <span class="kt">uint</span> <span class="c1">; media-stream-id</span>
  <span class="p">?</span> <span class="mi">2</span> <span class="p">:</span> <span class="nx">audio-encoding-request </span><span class="c1">; audio</span>
  <span class="p">?</span> <span class="mi">3</span> <span class="p">:</span> <span class="nx">video-encoding-request </span><span class="c1">; video</span>
  <span class="p">?</span> <span class="mi">4</span> <span class="p">:</span> <span class="nx">data-encoding-request </span><span class="c1">; data</span>
<span class="p">}</span>

<span class="nc"><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="audio-encoding-offer">audio-encoding-offer</dfn> </span><span class="p">=</span> <span class="p">{</span>
  <span class="mi">1</span> <span class="p">:</span> <span class="kt">uint</span> <span class="c1">; encoding-id</span>
  <span class="mi">2</span> <span class="p">:</span> <span class="nx">text </span><span class="c1">; codec-name</span>
  <span class="mi">3</span> <span class="p">:</span> <span class="kt">uint</span> <span class="c1">; time-scale</span>
  <span class="p">?</span> <span class="mi">4</span> <span class="p">:</span> <span class="kt">uint</span> <span class="c1">; default-duration</span>
<span class="p">}</span>

<span class="nc"><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="video-encoding-offer">video-encoding-offer</dfn> </span><span class="p">=</span> <span class="p">{</span>
  <span class="mi">1</span> <span class="p">:</span> <span class="kt">uint</span> <span class="c1">; encoding-id</span>
  <span class="mi">2</span> <span class="p">:</span> <span class="nx">text </span><span class="c1">; codec-name</span>
  <span class="mi">3</span> <span class="p">:</span> <span class="kt">uint</span> <span class="c1">; time-scale</span>
  <span class="p">?</span> <span class="mi">4</span> <span class="p">:</span> <span class="kt">uint</span> <span class="c1">; default-duration</span>
  <span class="p">?</span> <span class="mi">5</span> <span class="p">:</span> <span class="nx">video-rotation </span><span class="c1">; default-rotation</span>
<span class="p">}</span>

<span class="nc"><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="data-encoding-offer">data-encoding-offer</dfn> </span><span class="p">=</span> <span class="p">{</span>
  <span class="mi">1</span> <span class="p">:</span> <span class="kt">uint</span> <span class="c1">; encoding-id</span>
  <span class="mi">2</span> <span class="p">:</span> <span class="nx">text </span><span class="c1">; data-type-name</span>
  <span class="mi">3</span> <span class="p">:</span> <span class="kt">uint</span> <span class="c1">; time-scale</span>
  <span class="p">?</span> <span class="mi">4</span> <span class="p">:</span> <span class="kt">uint</span> <span class="c1">; default-duration</span>
<span class="p">}</span>


<span class="nc">audio-encoding-request </span><span class="p">=</span> <span class="p">{</span>
  <span class="mi">1</span><span class="p">:</span> <span class="kt">uint</span> <span class="c1">; encoding-id</span>
<span class="p">}</span>

<span class="nc">video-encoding-request </span><span class="p">=</span> <span class="p">{</span>
  <span class="mi">1</span> <span class="p">:</span> <span class="kt">uint</span> <span class="c1">; encoding-id</span>
  <span class="p">?</span> <span class="mi">2</span> <span class="p">:</span> <span class="nx">video-resolution </span><span class="c1">; target-resolution</span>
  <span class="p">?</span> <span class="mi">3</span> <span class="p">:</span> <span class="nx">ratio </span><span class="c1">; max-frames-per-second</span>
<span class="p">}</span>

<span class="nc">data-encoding-request </span><span class="p">=</span> <span class="p">{</span>
  <span class="mi">1</span><span class="p">:</span> <span class="kt">uint</span> <span class="c1">; encoding-id</span>
<span class="p">}</span>

<span class="nc">video-rotation </span><span class="p">=</span> <span class="o">&amp;</span><span class="p">(</span>
  <span class="c1">; Degrees clockwise</span>
  <span class="nx">video-rotation-0</span>
<span class="nx">  video-rotation-90</span>
<span class="nx">  video-rotation-180</span>
<span class="nx">  video-rotation-270</span>
<span class="p">)</span>

<span class="c1">; type key 131</span>
<span class="nc"><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="streaming-session-sender-stats-event">streaming-session-sender-stats-event</dfn> </span><span class="p">=</span> <span class="p">{</span>
  <span class="mi">1</span><span class="p">:</span> <span class="kt">uint</span><span class="c1">; streaming-session-id</span>
  <span class="mi">2</span><span class="p">:</span> <span class="nx">microseconds </span><span class="c1">; system-time</span>
  <span class="p">?</span> <span class="mi">3</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="o">*</span> <span class="p">{</span>
    <span class="mi">1</span><span class="p">:</span> <span class="kt">uint</span> <span class="c1">; encoding-id</span>
    <span class="p">?</span> <span class="mi">2</span><span class="p">:</span> <span class="kt">uint</span> <span class="c1">; cumulative-sent-frames</span>
    <span class="p">?</span> <span class="mi">3</span><span class="p">:</span> <span class="nx">microseconds </span><span class="c1">; cumulative-encode-delay</span>
  <span class="p">}]</span> <span class="c1">; audio</span>
  <span class="p">?</span> <span class="mi">4</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="o">*</span> <span class="p">{</span>
    <span class="mi">1</span><span class="p">:</span> <span class="kt">uint</span> <span class="c1">; encoding-id</span>
    <span class="p">?</span> <span class="mi">2</span><span class="p">:</span> <span class="nx">microseconds </span><span class="c1">; cumulative-sent-duration</span>
    <span class="p">?</span> <span class="mi">3</span><span class="p">:</span> <span class="nx">microseconds </span><span class="c1">; cumulative-encode-delay</span>
    <span class="p">?</span> <span class="mi">4</span><span class="p">:</span> <span class="kt">uint</span> <span class="c1">; cumulative-dropped-frames</span>
  <span class="p">}]</span> <span class="c1">; video</span>
<span class="p">}</span>

<span class="nc">streaming-buffer-status </span><span class="p">=</span> <span class="o">&amp;</span><span class="p">(</span>
  <span class="nx">enough-data</span><span class="p">:</span> <span class="mi">0</span>
  <span class="nx">insufficient-data</span><span class="p">:</span> <span class="mi">1</span>
  <span class="nx">too-much-data</span><span class="p">:</span> <span class="mi">2</span>
<span class="p">)</span>

<span class="c1">; type key 132</span>
<span class="nc"><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="streaming-session-receiver-stats-event">streaming-session-receiver-stats-event</dfn> </span><span class="p">=</span> <span class="p">{</span>
  <span class="mi">1</span><span class="p">:</span> <span class="kt">uint</span><span class="c1">; streaming-session-id</span>
  <span class="mi">2</span><span class="p">:</span> <span class="nx">microseconds </span><span class="c1">; system-time</span>
  <span class="p">?</span> <span class="mi">3</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="o">*</span> <span class="p">{</span>
    <span class="mi">1</span><span class="p">:</span> <span class="kt">uint</span> <span class="c1">; encoding-id</span>
    <span class="p">?</span> <span class="mi">2</span><span class="p">:</span> <span class="nx">microseconds </span><span class="c1">; cumulative-received-duration</span>
    <span class="p">?</span> <span class="mi">3</span><span class="p">:</span> <span class="nx">microseconds </span><span class="c1">; cumulative-lost-duration</span>
    <span class="p">?</span> <span class="mi">3</span><span class="p">:</span> <span class="nx">microseconds </span><span class="c1">; cumulative-buffer-delay</span>
    <span class="p">?</span> <span class="mi">4</span><span class="p">:</span> <span class="nx">microseconds </span><span class="c1">; cumulative-decode-delay</span>
    <span class="p">?</span> <span class="mi">5</span><span class="p">:</span> <span class="nx">streaming-buffer-status </span><span class="c1">; remote-buffer-status</span>
  <span class="p">}]</span> <span class="c1">; audio</span>
  <span class="p">?</span> <span class="mi">4</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="o">*</span> <span class="p">{</span>
    <span class="mi">1</span><span class="p">:</span> <span class="kt">uint</span> <span class="c1">; encoding-id</span>
    <span class="p">?</span> <span class="mi">2</span><span class="p">:</span> <span class="kt">uint</span> <span class="c1">; cumulative-decoded-frames</span>
    <span class="p">?</span> <span class="mi">3</span><span class="p">:</span> <span class="kt">uint</span> <span class="c1">; cumulative-lost-frames</span>
    <span class="p">?</span> <span class="mi">4</span><span class="p">:</span> <span class="nx">microseconds </span><span class="c1">; cumulative-buffer-delay</span>
    <span class="p">?</span> <span class="mi">5</span><span class="p">:</span> <span class="nx">microseconds </span><span class="c1">; cumulative-decode-delay</span>
    <span class="p">?</span> <span class="mi">6</span><span class="p">:</span> <span class="nx">streaming-buffer-status </span><span class="c1">; remote-buffer-status    </span>
  <span class="p">}]</span> <span class="c1">; video</span>
<span class="p">}</span>
</pre>
    </div>
   </div>
   <h2 class="heading settled" id="appendix-b"><span class="content">Appendix B: Message Type Key Ranges</span><a class="self-link" href="#appendix-b"></a></h2>
   <p>The following appendix describes how the range of message type keys is divided.
Legal values are 1 to 2<sup>64</sup>.</p>
   <p>Each type key is encoded as a <a data-link-type="dfn" href="https://datatracker.ietf.org/doc/html/rfc9000#name-variable-length-integer-enc" id="ref-for-name-variable-length-integer-enc③">variable-length integer</a> on the wire of 1, 2, 4 or
8 bytes.  For each wire byte size, 1/4 to 1/2 of the keys are available for
extensions.</p>
   <table>
    <thead>
     <tr>
      <th>Bytes
      <th>Range
      <th>Purpose
    <tbody>
     <tr>
      <td>1
      <td>1 - 48
      <td>Open Screen Protocol
     <tr>
      <td>1
      <td>49 - 63
      <td>Available for extensions
     <tr>
      <td>2
      <td>64 - 8,192
      <td>Open Screen Protocol
     <tr>
      <td>2
      <td>8,193 - 16,383
      <td>Available for extensions
     <tr>
      <td>4
      <td>16,384 - 2<sup>29</sup>
      <td>Reserved for future use
     <tr>
      <td>4
      <td>2<sup>29</sup>+1 - 2<sup>30</sup>-1
      <td>Available for extensions
     <tr>
      <td>8
      <td>>= 2<sup>30</sup>
      <td>Reserved for future use
   </table>
   <h2 class="heading settled" id="appendix-c"><span class="content">Appendix C: PSK Encoding Schemes</span><a class="self-link" href="#appendix-c"></a></h2>
   <p>The following appendix describes two encoding schemes for PSKs that take a value <code>P</code> between 20 bits and 80 bits in length and produce either a string or a <a data-link-type="dfn" href="https://www.iso.org/standard/62021.html#" id="ref-for-something①">QR
code</a> for display to the user.</p>
   <p>Agents should use these encoding schemes to maximize the interoperability of the
authentication step, which typically requires displaying the PSK on one
device and the user inputting it on another device.</p>
   <h3 class="heading settled" id="appendix-c-base-10"><span class="content">Base-10 Numeric</span><a class="self-link" href="#appendix-c-base-10"></a></h3>
   <p>To encode <code>P</code> into a numeric string, follow these steps:</p>
   <ol>
    <li data-md>
     <p>Convert <code>P</code> to a base-10 integer <code>N</code>.</p>
    <li data-md>
     <p>If <code>N</code> has fewer than 9 digits:</p>
     <ul>
      <li data-md>
       <p>Zero-pad <code>N</code> on the left with <code>3 - len(N) mod 3</code> digits.</p>
      <li data-md>
       <p>Output <code>N</code> in groups of three digits separated by dashes.</p>
     </ul>
    <li data-md>
     <p>If <code>N</code> has more than 9 digits:</p>
     <ul>
      <li data-md>
       <p>Zero-pad <code>N</code> on the left with <code>4 - len(N) mod 4</code> digits.</p>
      <li data-md>
       <p>Output <code>N</code> in groups of four digits separated by dashes.</p>
     </ul>
   </ol>
   <div class="example" id="example-7640121e"><a class="self-link" href="#example-7640121e"></a> For PSK <code>61488548833</code>, the steps would produce the string <code>0614-8854-8833</code>. </div>
   <p>To decode a string <code>N</code> into a PSK <code>P</code>, follow these steps:</p>
   <ol>
    <li data-md>
     <p>Remove dashes and leading zeros from <code>N</code>.</p>
    <li data-md>
     <p>Parse <code>N</code> as a base-10 decimal number to obtain <code>P</code>.</p>
   </ol>
   <p class="note" role="note"><span class="marker">Note:</span> <code>P</code> values between approximately 2^30 and 2^40 will produce values between
10 and 12 digits in length.  Values over 12 digits are inconvenient to input
and have limited additional security value.</p>
   <p class="note" role="note"><span class="marker">Note:</span> We do not allow the use of hexadecimal encoding here, because it would
be ambiguous with base-10 numeric encodings, and not all devices may support
alphanumeric input.</p>
   <h3 class="heading settled" id="appendix-c-qr-code"><span class="content">QR Code</span><a class="self-link" href="#appendix-c-qr-code"></a></h3>
   <p>To encode a PSK into a QR code, follow these steps:</p>
   <ol>
    <li data-md>
     <p>Set <code>N</code> to the value of <code>P</code> converted to an ASCII-encoded, hexadecimal string.</p>
    <li data-md>
     <p>Construct a text <a data-link-type="dfn" href="https://www.iso.org/standard/62021.html#" id="ref-for-something②">QR code</a> with the value of <code>N</code>.</p>
   </ol>
   <div class="example" id="example-9c4041cf">
    <a class="self-link" href="#example-9c4041cf"></a> For PSK <code>61488548833</code>, the steps would produce the following QR code: 
    <p>
     <svg height="20%" stroke="none" version="1.1" viewBox="0 0 29 29" width="20%" xmlns="http://www.w3.org/2000/svg">
      <rect fill="#FFFFFF" height="100%" width="100%"></rect>
      <path d="M4,4h1v1h-1z M5,4h1v1h-1z M6,4h1v1h-1z M7,4h1v1h-1z M8,4h1v1h-1z M9,4h1v1h-1z M10,4h1v1h-1z M12,4h1v1h-1z M18,4h1v1h-1z M19,4h1v1h-1z M20,4h1v1h-1z M21,4h1v1h-1z M22,4h1v1h-1z M23,4h1v1h-1z M24,4h1v1h-1z M4,5h1v1h-1z M10,5h1v1h-1z M14,5h1v1h-1z M16,5h1v1h-1z M18,5h1v1h-1z M24,5h1v1h-1z M4,6h1v1h-1z M6,6h1v1h-1z M7,6h1v1h-1z M8,6h1v1h-1z M10,6h1v1h-1z M14,6h1v1h-1z M16,6h1v1h-1z M18,6h1v1h-1z M20,6h1v1h-1z M21,6h1v1h-1z M22,6h1v1h-1z M24,6h1v1h-1z M4,7h1v1h-1z M6,7h1v1h-1z M7,7h1v1h-1z M8,7h1v1h-1z M10,7h1v1h-1z M12,7h1v1h-1z M18,7h1v1h-1z M20,7h1v1h-1z M21,7h1v1h-1z M22,7h1v1h-1z M24,7h1v1h-1z M4,8h1v1h-1z M6,8h1v1h-1z M7,8h1v1h-1z M8,8h1v1h-1z M10,8h1v1h-1z M13,8h1v1h-1z M15,8h1v1h-1z M18,8h1v1h-1z M20,8h1v1h-1z M21,8h1v1h-1z M22,8h1v1h-1z M24,8h1v1h-1z M4,9h1v1h-1z M10,9h1v1h-1z M13,9h1v1h-1z M15,9h1v1h-1z M16,9h1v1h-1z M18,9h1v1h-1z M24,9h1v1h-1z M4,10h1v1h-1z M5,10h1v1h-1z M6,10h1v1h-1z M7,10h1v1h-1z M8,10h1v1h-1z M9,10h1v1h-1z M10,10h1v1h-1z M12,10h1v1h-1z M14,10h1v1h-1z M16,10h1v1h-1z M18,10h1v1h-1z M19,10h1v1h-1z M20,10h1v1h-1z M21,10h1v1h-1z M22,10h1v1h-1z M23,10h1v1h-1z M24,10h1v1h-1z M15,11h1v1h-1z M16,11h1v1h-1z M6,12h1v1h-1z M8,12h1v1h-1z M9,12h1v1h-1z M10,12h1v1h-1z M12,12h1v1h-1z M15,12h1v1h-1z M16,12h1v1h-1z M17,12h1v1h-1z M21,12h1v1h-1z M24,12h1v1h-1z M4,13h1v1h-1z M6,13h1v1h-1z M8,13h1v1h-1z M9,13h1v1h-1z M11,13h1v1h-1z M14,13h1v1h-1z M15,13h1v1h-1z M18,13h1v1h-1z M19,13h1v1h-1z M21,13h1v1h-1z M24,13h1v1h-1z M4,14h1v1h-1z M5,14h1v1h-1z M7,14h1v1h-1z M8,14h1v1h-1z M10,14h1v1h-1z M11,14h1v1h-1z M13,14h1v1h-1z M14,14h1v1h-1z M15,14h1v1h-1z M16,14h1v1h-1z M17,14h1v1h-1z M20,14h1v1h-1z M22,14h1v1h-1z M5,15h1v1h-1z M7,15h1v1h-1z M9,15h1v1h-1z M11,15h1v1h-1z M12,15h1v1h-1z M13,15h1v1h-1z M14,15h1v1h-1z M17,15h1v1h-1z M19,15h1v1h-1z M24,15h1v1h-1z M4,16h1v1h-1z M6,16h1v1h-1z M7,16h1v1h-1z M9,16h1v1h-1z M10,16h1v1h-1z M11,16h1v1h-1z M13,16h1v1h-1z M16,16h1v1h-1z M17,16h1v1h-1z M20,16h1v1h-1z M21,16h1v1h-1z M22,16h1v1h-1z M23,16h1v1h-1z M24,16h1v1h-1z M12,17h1v1h-1z M13,17h1v1h-1z M14,17h1v1h-1z M15,17h1v1h-1z M16,17h1v1h-1z M17,17h1v1h-1z M19,17h1v1h-1z M20,17h1v1h-1z M21,17h1v1h-1z M22,17h1v1h-1z M23,17h1v1h-1z M24,17h1v1h-1z M4,18h1v1h-1z M5,18h1v1h-1z M6,18h1v1h-1z M7,18h1v1h-1z M8,18h1v1h-1z M9,18h1v1h-1z M10,18h1v1h-1z M13,18h1v1h-1z M14,18h1v1h-1z M15,18h1v1h-1z M16,18h1v1h-1z M18,18h1v1h-1z M20,18h1v1h-1z M4,19h1v1h-1z M10,19h1v1h-1z M12,19h1v1h-1z M13,19h1v1h-1z M17,19h1v1h-1z M18,19h1v1h-1z M19,19h1v1h-1z M21,19h1v1h-1z M23,19h1v1h-1z M4,20h1v1h-1z M6,20h1v1h-1z M7,20h1v1h-1z M8,20h1v1h-1z M10,20h1v1h-1z M12,20h1v1h-1z M13,20h1v1h-1z M15,20h1v1h-1z M16,20h1v1h-1z M18,20h1v1h-1z M22,20h1v1h-1z M23,20h1v1h-1z M24,20h1v1h-1z M4,21h1v1h-1z M6,21h1v1h-1z M7,21h1v1h-1z M8,21h1v1h-1z M10,21h1v1h-1z M13,21h1v1h-1z M14,21h1v1h-1z M15,21h1v1h-1z M16,21h1v1h-1z M18,21h1v1h-1z M19,21h1v1h-1z M20,21h1v1h-1z M21,21h1v1h-1z M23,21h1v1h-1z M4,22h1v1h-1z M6,22h1v1h-1z M7,22h1v1h-1z M8,22h1v1h-1z M10,22h1v1h-1z M12,22h1v1h-1z M14,22h1v1h-1z M17,22h1v1h-1z M18,22h1v1h-1z M19,22h1v1h-1z M21,22h1v1h-1z M24,22h1v1h-1z M4,23h1v1h-1z M10,23h1v1h-1z M14,23h1v1h-1z M15,23h1v1h-1z M18,23h1v1h-1z M20,23h1v1h-1z M21,23h1v1h-1z M23,23h1v1h-1z M24,23h1v1h-1z M4,24h1v1h-1z M5,24h1v1h-1z M6,24h1v1h-1z M7,24h1v1h-1z M8,24h1v1h-1z M9,24h1v1h-1z M10,24h1v1h-1z M15,24h1v1h-1z M17,24h1v1h-1z M19,24h1v1h-1z M22,24h1v1h-1z M24,24h1v1h-1z" fill="#000000"></path>
     </svg>
    </p>
   </div>
   <p>To decode a PSK <code>P</code> given a QR code, follow these steps:</p>
   <ol>
    <li data-md>
     <p>Obtain the string <code>N</code> by decoding the QR code.</p>
    <li data-md>
     <p>Parse <code>N</code> as a hexadecimal number to obtain <code>P</code>.</p>
   </ol>
   <section class="informative">
    <h2 class="heading settled" id="appendix-d"><span class="content">Appendix D: Entire Flow Chart</span><a class="self-link" href="#appendix-d"></a></h2>
     <em>This section is non-normative.</em> 
    <p><img alt="Before a listening agent (client) and an advertising agent (server) may exchange application messages, they first need to discover each other through an mDNS exchange, establish a QUIC connection through ClientHello and ServerHello exchanges and sharing of certificates, and run an SPAKE2 authentication handshake and confirmation. They may also exchange messages to discover metadata at any time after a QUIC connection has been established." src="./images/entire_flow_chart.svg" style="width: 100%"></p>
   </section>
   <h2 class="heading settled" id="appendix-e"><span class="content">Appendix E: Media Time Conversions</span><a class="self-link" href="#appendix-e"></a></h2>
   <p>To convert between a media synchronization timestamp for a given audio or video
frame and a media timeline value, the following formula can be used:</p>
<pre>media-timeline-value = media-zero-time + (value / scale)
</pre>
   <p>Where:</p>
   <ul>
    <li data-md>
     <p><code>media-zero-time</code> is the origin of the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/media.html#media-timeline" id="ref-for-media-timeline③">media timeline</a> as defined in HTML,
converted to an IEEE-754 double precision floating point number <a data-link-type="biblio" href="#biblio-ieee-754" title="IEEE Standard for Floating-Point Arithmetic">[IEEE-754]</a>.</p>
    <li data-md>
     <p><code>value</code> and <code>scale</code> are the values passed in the <code>sync-time</code> field of the
corresponding <a data-link-type="dfn" href="#audio-frame" id="ref-for-audio-frame②">audio-frame</a> or <a data-link-type="dfn" href="#video-frame" id="ref-for-video-frame②">video-frame</a>.</p>
    <li data-md>
     <p><code>value / scale</code> should be computed with double floating point precision.</p>
    <li data-md>
     <p><code>media-timeline-value</code> is an IEEE-754 double precision floating point number <a data-link-type="biblio" href="#biblio-ieee-754" title="IEEE Standard for Floating-Point Arithmetic">[IEEE-754]</a>.</p>
   </ul>
   <p>In the event of an overflow in <code>media-timeline-value</code>, the maximum representable
value should be used.</p>
  </main>
  <div data-fill-with="conformance">
   <h2 class="no-ref no-num heading settled" id="w3c-conformance"><span class="content">Conformance</span><a class="self-link" href="#w3c-conformance"></a></h2>
   <h3 class="no-ref no-num heading settled" id="w3c-conventions"><span class="content">Document conventions</span><a class="self-link" href="#w3c-conventions"></a></h3>
   <p>Conformance requirements are expressed
    with a combination of descriptive assertions
    and RFC 2119 terminology.
    The key words “MUST”, “MUST NOT”, “REQUIRED”, “SHALL”, “SHALL NOT”, “SHOULD”, “SHOULD NOT”, “RECOMMENDED”, “MAY”, and “OPTIONAL”
    in the normative parts of this document
    are to be interpreted as described in RFC 2119.
    However, for readability,
    these words do not appear in all uppercase letters in this specification. </p>
   <p>All of the text of this specification is normative
    except sections explicitly marked as non-normative, examples, and notes. <a data-link-type="biblio" href="#biblio-rfc2119" title="Key words for use in RFCs to Indicate Requirement Levels">[RFC2119]</a> </p>
   <p>Examples in this specification are introduced with the words “for example”
    or are set apart from the normative text
    with <code>class="example"</code>,
    like this: </p>
   <div class="example" id="w3c-example">
    <a class="self-link" href="#w3c-example"></a> 
    <p>This is an example of an informative example. </p>
   </div>
   <p>Informative notes begin with the word “Note”
    and are set apart from the normative text
    with <code>class="note"</code>,
    like this: </p>
   <p class="note" role="note">Note, this is an informative note.</p>
   <section>
    <h3 class="no-ref no-num heading settled" id="w3c-conformant-algorithms"><span class="content">Conformant Algorithms</span><a class="self-link" href="#w3c-conformant-algorithms"></a></h3>
    <p>Requirements phrased in the imperative as part of algorithms
    (such as "strip any leading space characters"
    or "return false and abort these steps")
    are to be interpreted with the meaning of the key word
    ("must", "should", "may", etc)
    used in introducing the algorithm. </p>
    <p>Conformance requirements phrased as algorithms or specific steps
    can be implemented in any manner,
    so long as the end result is equivalent.
    In particular, the algorithms defined in this specification
    are intended to be easy to understand
    and are not intended to be performant.
    Implementers are encouraged to optimize. </p>
   </section>
  </div>
  <script src="https://www.w3.org/scripts/TR/2021/fixup.js"></script>
  <h2 class="no-num no-ref heading settled" id="index"><span class="content">Index</span><a class="self-link" href="#index"></a></h2>
  <h3 class="no-num no-ref heading settled" id="index-defined-here"><span class="content">Terms defined by this specification</span><a class="self-link" href="#index-defined-here"></a></h3>
  <ul class="index">
   <li><a href="#advertising-agent">advertising agent</a><span>, in § 3</span>
   <li><a href="#agent-certificate">agent certificate</a><span>, in § 4.2</span>
   <li><a href="#agent-fingerprint">agent fingerprint</a><span>, in § 3.1</span>
   <li><a href="#agent-info">agent-info</a><span>, in § Unnumbered section</span>
   <li><a href="#agent-info-event">agent-info-event</a><span>, in § Unnumbered section</span>
   <li><a href="#agent-info-request">agent-info-request</a><span>, in § Unnumbered section</span>
   <li><a href="#agent-info-response">agent-info-response</a><span>, in § Unnumbered section</span>
   <li><a href="#agent-status-request">agent-status-request</a><span>, in § Unnumbered section</span>
   <li><a href="#agent-status-response">agent-status-response</a><span>, in § Unnumbered section</span>
   <li><a href="#audio-encoding-offer">audio-encoding-offer</a><span>, in § Unnumbered section</span>
   <li><a href="#audio-frame">audio-frame</a><span>, in § Unnumbered section</span>
   <li><a href="#auth-capabilities">auth-capabilities</a><span>, in § Unnumbered section</span>
   <li><a href="#auth-initiation-token">auth-initiation-token</a><span>, in § Unnumbered section</span>
   <li><a href="#auth-spake2-confirmation">auth-spake2-confirmation</a><span>, in § Unnumbered section</span>
   <li><a href="#auth-spake2-handshake">auth-spake2-handshake</a><span>, in § Unnumbered section</span>
   <li><a href="#auth-status">auth-status</a><span>, in § Unnumbered section</span>
   <li><a href="#certificate-serial-number">certificate serial number</a><span>, in § 4.2</span>
   <li><a href="#certificate-serial-number-base">certificate serial number base</a><span>, in § 4.2</span>
   <li><a href="#certificate-serial-number-counter">certificate serial number counter</a><span>, in § 4.2</span>
   <li><a href="#controller">controller</a><span>, in § 1.1</span>
   <li><a href="#data-encoding-offer">data-encoding-offer</a><span>, in § Unnumbered section</span>
   <li><a href="#data-frame">data-frame</a><span>, in § Unnumbered section</span>
   <li><a href="#display-name">display name</a><span>, in § 3</span>
   <li><a href="#listening-agent">listening agent</a><span>, in § 3</span>
   <li><a href="#media-receiver">media receiver</a><span>, in § 1.1</span>
   <li><a href="#media-sender">media sender</a><span>, in § 1.1</span>
   <li><a href="#open-screen-protocol-agent">open screen protocol agent</a><span>, in § 1.1</span>
   <li><a href="#open-screen-protocol-agent">osp agent</a><span>, in § 1.1</span>
   <li><a href="#presentation-change-event">presentation-change-event</a><span>, in § Unnumbered section</span>
   <li><a href="#presentation-connection-close-event">presentation-connection-close-event</a><span>, in § Unnumbered section</span>
   <li><a href="#presentation-connection-message">presentation-connection-message</a><span>, in § Unnumbered section</span>
   <li><a href="#presentation-connection-open-request">presentation-connection-open-request</a><span>, in § Unnumbered section</span>
   <li><a href="#presentation-connection-open-response">presentation-connection-open-response</a><span>, in § Unnumbered section</span>
   <li><a href="#presentation-start-request">presentation-start-request</a><span>, in § Unnumbered section</span>
   <li><a href="#presentation-start-response">presentation-start-response</a><span>, in § Unnumbered section</span>
   <li><a href="#presentation-termination-event">presentation-termination-event</a><span>, in § Unnumbered section</span>
   <li><a href="#presentation-termination-request">presentation-termination-request</a><span>, in § Unnumbered section</span>
   <li><a href="#presentation-termination-response">presentation-termination-response</a><span>, in § Unnumbered section</span>
   <li><a href="#presentation-url-availability-event">presentation-url-availability-event</a><span>, in § Unnumbered section</span>
   <li><a href="#presentation-url-availability-request">presentation-url-availability-request</a><span>, in § Unnumbered section</span>
   <li><a href="#presentation-url-availability-response">presentation-url-availability-response</a><span>, in § Unnumbered section</span>
   <li><a href="#receiver">receiver</a><span>, in § 1.1</span>
   <li><a href="#remote-playback-availability-event">remote-playback-availability-event</a><span>, in § Unnumbered section</span>
   <li><a href="#remote-playback-availability-request">remote-playback-availability-request</a><span>, in § Unnumbered section</span>
   <li><a href="#remote-playback-availability-response">remote-playback-availability-response</a><span>, in § Unnumbered section</span>
   <li><a href="#remote-playback-modify-request">remote-playback-modify-request</a><span>, in § Unnumbered section</span>
   <li><a href="#remote-playback-modify-response">remote-playback-modify-response</a><span>, in § Unnumbered section</span>
   <li><a href="#remote-playback-start-request">remote-playback-start-request</a><span>, in § Unnumbered section</span>
   <li><a href="#remote-playback-start-response">remote-playback-start-response</a><span>, in § Unnumbered section</span>
   <li><a href="#remote-playback-state-event">remote-playback-state-event</a><span>, in § Unnumbered section</span>
   <li><a href="#remote-playback-termination-event">remote-playback-termination-event</a><span>, in § Unnumbered section</span>
   <li><a href="#remote-playback-termination-request">remote-playback-termination-request</a><span>, in § Unnumbered section</span>
   <li><a href="#remote-playback-termination-response">remote-playback-termination-response</a><span>, in § Unnumbered section</span>
   <li><a href="#streaming-capabilities-request">streaming-capabilities-request</a><span>, in § Unnumbered section</span>
   <li><a href="#streaming-capabilities-response">streaming-capabilities-response</a><span>, in § Unnumbered section</span>
   <li><a href="#streaming-session-modify-request">streaming-session-modify-request</a><span>, in § Unnumbered section</span>
   <li><a href="#streaming-session-modify-response">streaming-session-modify-response</a><span>, in § Unnumbered section</span>
   <li><a href="#streaming-session-receiver-stats-event">streaming-session-receiver-stats-event</a><span>, in § Unnumbered section</span>
   <li><a href="#streaming-session-sender-stats-event">streaming-session-sender-stats-event</a><span>, in § Unnumbered section</span>
   <li><a href="#streaming-session-start-request">streaming-session-start-request</a><span>, in § Unnumbered section</span>
   <li><a href="#streaming-session-start-response">streaming-session-start-response</a><span>, in § Unnumbered section</span>
   <li><a href="#streaming-session-terminate-event">streaming-session-terminate-event</a><span>, in § Unnumbered section</span>
   <li><a href="#streaming-session-terminate-request">streaming-session-terminate-request</a><span>, in § Unnumbered section</span>
   <li><a href="#streaming-session-terminate-response">streaming-session-terminate-response</a><span>, in § Unnumbered section</span>
   <li><a href="#suspicious-agent">suspicious agent</a><span>, in § 13.5.2</span>
   <li><a href="#text-track-cue">text-track-cue</a><span>, in § Unnumbered section</span>
   <li><a href="#time-scale">time scale</a><span>, in § 8</span>
   <li><a href="#verified-display-name">verified display name</a><span>, in § 13.6.1</span>
   <li><a href="#video-encoding-offer">video-encoding-offer</a><span>, in § Unnumbered section</span>
   <li><a href="#video-frame">video-frame</a><span>, in § Unnumbered section</span>
  </ul>
  <h3 class="no-num no-ref heading settled" id="index-defined-elsewhere"><span class="content">Terms defined by reference</span><a class="self-link" href="#index-defined-elsewhere"></a></h3>
  <ul class="index">
   <li>
    <a data-link-type="biblio">[HTML]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="3f5f11ee">HAVE_NOTHING</span>
     <li><span class="dfn-paneled" id="1076ec40">HTMLMediaElement</span>
     <li><span class="dfn-paneled" id="d834f763">NETWORK_EMPTY</span>
     <li><span class="dfn-paneled" id="15a088cb">addTextTrack(kind, label, language)</span>
     <li><span class="dfn-paneled" id="03cd5764">audioTracks</span>
     <li><span class="dfn-paneled" id="a65cc4ee">buffered</span>
     <li><span class="dfn-paneled" id="e9415387">currentSrc</span>
     <li><span class="dfn-paneled" id="89da795b">currentTime</span>
     <li><span class="dfn-paneled" id="36aa3708">duration</span>
     <li><span class="dfn-paneled" id="a17504bd">ended</span>
     <li><span class="dfn-paneled" id="ba8a9b31">error</span>
     <li><span class="dfn-paneled" id="732fbcbd">fastSeek(time)</span>
     <li><span class="dfn-paneled" id="eacd6596">getStartDate()</span>
     <li><span class="dfn-paneled" id="1c76c896">loop</span>
     <li><span class="dfn-paneled" id="03499e48">media element</span>
     <li><span class="dfn-paneled" id="9e0b0141">media error code</span>
     <li><span class="dfn-paneled" id="649ace3d">media resource</span>
     <li><span class="dfn-paneled" id="23808d57">media timeline</span>
     <li><span class="dfn-paneled" id="8d87f944">muted</span>
     <li><span class="dfn-paneled" id="552e1f12">networkState</span>
     <li><span class="dfn-paneled" id="3ce575bf">official playback position</span>
     <li><span class="dfn-paneled" id="a35cc467">pause()</span>
     <li><span class="dfn-paneled" id="eb577fbe">paused</span>
     <li><span class="dfn-paneled" id="613edb27">play()</span>
     <li><span class="dfn-paneled" id="99123207">playbackRate</span>
     <li><span class="dfn-paneled" id="87a0c5de">played</span>
     <li><span class="dfn-paneled" id="cb19d8be">postMessage(message, targetOrigin, transfer)</span>
     <li><span class="dfn-paneled" id="565ece29">poster frame</span>
     <li><span class="dfn-paneled" id="36c7793a">preload</span>
     <li><span class="dfn-paneled" id="621f3aeb">readyState</span>
     <li><span class="dfn-paneled" id="4728547d">seekable</span>
     <li><span class="dfn-paneled" id="45182159">seeking</span>
     <li><span class="dfn-paneled" id="eb573143">src <small>(for HTMLMediaElement)</small></span>
     <li><span class="dfn-paneled" id="1d3efcfe">src <small>(for source)</small></span>
     <li><span class="dfn-paneled" id="ea42745f">stalled</span>
     <li><span class="dfn-paneled" id="df48f90a">textTracks</span>
     <li><span class="dfn-paneled" id="e5d99cfd">timeline offset</span>
     <li><span class="dfn-paneled" id="4ef17206">timeupdate</span>
     <li><span class="dfn-paneled" id="da57602e">type</span>
     <li><span class="dfn-paneled" id="d0a3e1e6">videoHeight</span>
     <li><span class="dfn-paneled" id="4bc31655">videoTracks</span>
     <li><span class="dfn-paneled" id="1a09160b">videoWidth</span>
     <li><span class="dfn-paneled" id="5078a29a">volume</span>
    </ul>
   <li>
    <a data-link-type="biblio">[ISO18004]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="a2a5cd12">qr code</span>
    </ul>
   <li>
    <a data-link-type="biblio">[PRESENTATION-API]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="374afd71">PresentationConnection</span>
     <li><span class="dfn-paneled" id="e01f0d07">available presentation display</span>
     <li><span class="dfn-paneled" id="ef3ff42b">controlling user agent</span>
     <li><span class="dfn-paneled" id="f1776616">presentation</span>
     <li><span class="dfn-paneled" id="456f89c8">presentation identifier</span>
     <li><span class="dfn-paneled" id="e9b42004">presentation request url</span>
     <li><span class="dfn-paneled" id="e21cba52">receiving user agent</span>
    </ul>
   <li>
    <a data-link-type="biblio">[REMOTE-PLAYBACK]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="a07c7f7e">availability sources set</span>
     <li><span class="dfn-paneled" id="be4088c1">compatible remote playback device</span>
     <li><span class="dfn-paneled" id="62061ebf">initiate remote playback</span>
     <li><span class="dfn-paneled" id="c5013a3b">media element state</span>
     <li><span class="dfn-paneled" id="06b254b0">remote playback devices</span>
     <li><span class="dfn-paneled" id="b2b6fbb0">remote playback source</span>
    </ul>
   <li>
    <a data-link-type="biblio">[RFC4122]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="1704ff9c">uuid</span>
    </ul>
   <li>
    <a data-link-type="biblio">[RFC5280]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="1fe3b46b">digitalsignature</span>
    </ul>
   <li>
    <a data-link-type="biblio">[RFC5646]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="208b5961">language tag</span>
    </ul>
   <li>
    <a data-link-type="biblio">[RFC6381]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="09153fed">codecs parameter</span>
    </ul>
   <li>
    <a data-link-type="biblio">[RFC6762]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="38cb699f">conflict resolution</span>
    </ul>
   <li>
    <a data-link-type="biblio">[RFC6763]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="34d12a4f">instance name</span>
     <li><span class="dfn-paneled" id="6f0181fa">service name</span>
    </ul>
   <li>
    <a data-link-type="biblio">[RFC8446]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="c7313446">signature scheme</span>
    </ul>
   <li>
    <a data-link-type="biblio">[RFC8610]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="8f45ca65">concise data definition language</span>
    </ul>
   <li>
    <a data-link-type="biblio">[RFC9000]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="a6ddbb58">connection_close frames</span>
     <li><span class="dfn-paneled" id="fc89f77a">transport parameter encoding</span>
     <li><span class="dfn-paneled" id="6c09a22e">variable-length integer</span>
     <li><span class="dfn-paneled" id="4be354e2">variable-length integer encoding</span>
    </ul>
  </ul>
  <h2 class="no-num no-ref heading settled" id="references"><span class="content">References</span><a class="self-link" href="#references"></a></h2>
  <h3 class="no-num no-ref heading settled" id="normative"><span class="content">Normative References</span><a class="self-link" href="#normative"></a></h3>
  <dl>
   <dt id="biblio-html">[HTML]
   <dd>Anne van Kesteren; et al. <a href="https://html.spec.whatwg.org/multipage/"><cite>HTML Standard</cite></a>. Living Standard. URL: <a href="https://html.spec.whatwg.org/multipage/">https://html.spec.whatwg.org/multipage/</a>
   <dt id="biblio-iso18004">[ISO18004]
   <dd><a href="https://iso.org/standard/62021.html"><cite>Information technology — Automatic identification and data capture techniques — QR Code bar code symbology specification</cite></a>. Published. URL: <a href="https://iso.org/standard/62021.html">https://iso.org/standard/62021.html</a>
   <dt id="biblio-media-capabilities">[MEDIA-CAPABILITIES]
   <dd>Jean-Yves Avenard. <a href="https://w3c.github.io/media-capabilities/"><cite>Media Capabilities</cite></a>. URL: <a href="https://w3c.github.io/media-capabilities/">https://w3c.github.io/media-capabilities/</a>
   <dt id="biblio-presentation-api">[PRESENTATION-API]
   <dd>Mark Foltz; Dominik Röttsches. <a href="https://w3c.github.io/presentation-api/"><cite>Presentation API</cite></a>. URL: <a href="https://w3c.github.io/presentation-api/">https://w3c.github.io/presentation-api/</a>
   <dt id="biblio-remote-playback">[REMOTE-PLAYBACK]
   <dd>Mark Foltz. <a href="https://w3c.github.io/remote-playback/"><cite>Remote Playback API</cite></a>. URL: <a href="https://w3c.github.io/remote-playback/">https://w3c.github.io/remote-playback/</a>
   <dt id="biblio-rfc2119">[RFC2119]
   <dd>S. Bradner. <a href="https://datatracker.ietf.org/doc/html/rfc2119"><cite>Key words for use in RFCs to Indicate Requirement Levels</cite></a>. March 1997. Best Current Practice. URL: <a href="https://datatracker.ietf.org/doc/html/rfc2119">https://datatracker.ietf.org/doc/html/rfc2119</a>
   <dt id="biblio-rfc4648">[RFC4648]
   <dd>S. Josefsson. <a href="https://www.rfc-editor.org/rfc/rfc4648"><cite>The Base16, Base32, and Base64 Data Encodings</cite></a>. October 2006. Proposed Standard. URL: <a href="https://www.rfc-editor.org/rfc/rfc4648">https://www.rfc-editor.org/rfc/rfc4648</a>
   <dt id="biblio-rfc5280">[RFC5280]
   <dd>D. Cooper; et al. <a href="https://www.rfc-editor.org/rfc/rfc5280"><cite>Internet X.509 Public Key Infrastructure Certificate and Certificate Revocation List (CRL) Profile</cite></a>. May 2008. Proposed Standard. URL: <a href="https://www.rfc-editor.org/rfc/rfc5280">https://www.rfc-editor.org/rfc/rfc5280</a>
   <dt id="biblio-rfc5480">[RFC5480]
   <dd>S. Turner; et al. <a href="https://www.rfc-editor.org/rfc/rfc5480"><cite>Elliptic Curve Cryptography Subject Public Key Information</cite></a>. March 2009. Proposed Standard. URL: <a href="https://www.rfc-editor.org/rfc/rfc5480">https://www.rfc-editor.org/rfc/rfc5480</a>
   <dt id="biblio-rfc5646">[RFC5646]
   <dd>A. Phillips, Ed.; M. Davis, Ed.. <a href="https://www.rfc-editor.org/rfc/rfc5646"><cite>Tags for Identifying Languages</cite></a>. September 2009. Best Current Practice. URL: <a href="https://www.rfc-editor.org/rfc/rfc5646">https://www.rfc-editor.org/rfc/rfc5646</a>
   <dt id="biblio-rfc5758">[RFC5758]
   <dd>Q. Dang; et al. <a href="https://www.rfc-editor.org/rfc/rfc5758"><cite>Internet X.509 Public Key Infrastructure: Additional Algorithms and Identifiers for DSA and ECDSA</cite></a>. January 2010. Proposed Standard. URL: <a href="https://www.rfc-editor.org/rfc/rfc5758">https://www.rfc-editor.org/rfc/rfc5758</a>
   <dt id="biblio-rfc6066">[RFC6066]
   <dd>D. Eastlake 3rd. <a href="https://www.rfc-editor.org/rfc/rfc6066"><cite>Transport Layer Security (TLS) Extensions: Extension Definitions</cite></a>. January 2011. Proposed Standard. URL: <a href="https://www.rfc-editor.org/rfc/rfc6066">https://www.rfc-editor.org/rfc/rfc6066</a>
   <dt id="biblio-rfc6381">[RFC6381]
   <dd>R. Gellens; D. Singer; P. Frojdh. <a href="https://www.rfc-editor.org/rfc/rfc6381"><cite>The 'Codecs' and 'Profiles' Parameters for "Bucket" Media Types</cite></a>. August 2011. Proposed Standard. URL: <a href="https://www.rfc-editor.org/rfc/rfc6381">https://www.rfc-editor.org/rfc/rfc6381</a>
   <dt id="biblio-rfc6762">[RFC6762]
   <dd>S. Cheshire; M. Krochmal. <a href="https://www.rfc-editor.org/rfc/rfc6762"><cite>Multicast DNS</cite></a>. February 2013. Proposed Standard. URL: <a href="https://www.rfc-editor.org/rfc/rfc6762">https://www.rfc-editor.org/rfc/rfc6762</a>
   <dt id="biblio-rfc6763">[RFC6763]
   <dd>S. Cheshire; M. Krochmal. <a href="https://www.rfc-editor.org/rfc/rfc6763"><cite>DNS-Based Service Discovery</cite></a>. February 2013. Proposed Standard. URL: <a href="https://www.rfc-editor.org/rfc/rfc6763">https://www.rfc-editor.org/rfc/rfc6763</a>
   <dt id="biblio-rfc7301">[RFC7301]
   <dd>S. Friedl; et al. <a href="https://www.rfc-editor.org/rfc/rfc7301"><cite>Transport Layer Security (TLS) Application-Layer Protocol Negotiation Extension</cite></a>. July 2014. Proposed Standard. URL: <a href="https://www.rfc-editor.org/rfc/rfc7301">https://www.rfc-editor.org/rfc/rfc7301</a>
   <dt id="biblio-rfc7469">[RFC7469]
   <dd>C. Evans; C. Palmer; R. Sleevi. <a href="https://www.rfc-editor.org/rfc/rfc7469"><cite>Public Key Pinning Extension for HTTP</cite></a>. April 2015. Proposed Standard. URL: <a href="https://www.rfc-editor.org/rfc/rfc7469">https://www.rfc-editor.org/rfc/rfc7469</a>
   <dt id="biblio-rfc8446">[RFC8446]
   <dd>E. Rescorla. <a href="https://www.rfc-editor.org/rfc/rfc8446"><cite>The Transport Layer Security (TLS) Protocol Version 1.3</cite></a>. August 2018. Proposed Standard. URL: <a href="https://www.rfc-editor.org/rfc/rfc8446">https://www.rfc-editor.org/rfc/rfc8446</a>
   <dt id="biblio-rfc8610">[RFC8610]
   <dd>H. Birkholz; C. Vigano; C. Bormann. <a href="https://www.rfc-editor.org/rfc/rfc8610"><cite>Concise Data Definition Language (CDDL): A Notational Convention to Express Concise Binary Object Representation (CBOR) and JSON Data Structures</cite></a>. June 2019. Proposed Standard. URL: <a href="https://www.rfc-editor.org/rfc/rfc8610">https://www.rfc-editor.org/rfc/rfc8610</a>
   <dt id="biblio-rfc8949">[RFC8949]
   <dd>C. Bormann; P. Hoffman. <a href="https://www.rfc-editor.org/rfc/rfc8949"><cite>Concise Binary Object Representation (CBOR)</cite></a>. December 2020. Internet Standard. URL: <a href="https://www.rfc-editor.org/rfc/rfc8949">https://www.rfc-editor.org/rfc/rfc8949</a>
   <dt id="biblio-rfc9000">[RFC9000]
   <dd>J. Iyengar, Ed.; M. Thomson, Ed.. <a href="https://www.rfc-editor.org/rfc/rfc9000"><cite>QUIC: A UDP-Based Multiplexed and Secure Transport</cite></a>. May 2021. Proposed Standard. URL: <a href="https://www.rfc-editor.org/rfc/rfc9000">https://www.rfc-editor.org/rfc/rfc9000</a>
   <dt id="biblio-x690">[X690]
   <dd><a href="https://www.itu.int/ITU-T/studygroups/com17/languages/X.690-0207.pdf"><cite>Recommendation X.690 — Information Technology — ASN.1 Encoding Rules — Specification of Basic Encoding Rules (BER), Canonical Encoding Rules (CER), and Distinguished Encoding Rules (DER)</cite></a>. URL: <a href="https://www.itu.int/ITU-T/studygroups/com17/languages/X.690-0207.pdf">https://www.itu.int/ITU-T/studygroups/com17/languages/X.690-0207.pdf</a>
  </dl>
  <h3 class="no-num no-ref heading settled" id="informative"><span class="content">Informative References</span><a class="self-link" href="#informative"></a></h3>
  <dl>
   <dt id="biblio-ieee-754">[IEEE-754]
   <dd><a href="http://ieeexplore.ieee.org/servlet/opac?punumber=4610933"><cite>IEEE Standard for Floating-Point Arithmetic</cite></a>. 29 August 2008. URL: <a href="http://ieeexplore.ieee.org/servlet/opac?punumber=4610933">http://ieeexplore.ieee.org/servlet/opac?punumber=4610933</a>
   <dt id="biblio-itu-r-bt1359-1">[ITU-R-BT.1359-1]
   <dd><a href="https://www.itu.int/dms_pubrec/itu-r/rec/bt/R-REC-BT.1359-1-199811-I!!PDF-E.pdf"><cite>ITU-R BT.1359-1, Relative Timing of Sound and Vision for Broadcasting</cite></a>. Recommendation. URL: <a href="https://www.itu.int/dms_pubrec/itu-r/rec/bt/R-REC-BT.1359-1-199811-I!!PDF-E.pdf">https://www.itu.int/dms_pubrec/itu-r/rec/bt/R-REC-BT.1359-1-199811-I!!PDF-E.pdf</a>
   <dt id="biblio-rfc4122">[RFC4122]
   <dd>P. Leach; M. Mealling; R. Salz. <a href="https://www.rfc-editor.org/rfc/rfc4122"><cite>A Universally Unique IDentifier (UUID) URN Namespace</cite></a>. July 2005. Proposed Standard. URL: <a href="https://www.rfc-editor.org/rfc/rfc4122">https://www.rfc-editor.org/rfc/rfc4122</a>
   <dt id="biblio-rfc6234">[RFC6234]
   <dd>D. Eastlake 3rd; T. Hansen. <a href="https://www.rfc-editor.org/rfc/rfc6234"><cite>US Secure Hash Algorithms (SHA and SHA-based HMAC and HKDF)</cite></a>. May 2011. Informational. URL: <a href="https://www.rfc-editor.org/rfc/rfc6234">https://www.rfc-editor.org/rfc/rfc6234</a>
   <dt id="biblio-security-privacy-questionnaire">[SECURITY-PRIVACY-QUESTIONNAIRE]
   <dd>Theresa O'Connor; Peter Snyder. <a href="https://w3ctag.github.io/security-questionnaire/"><cite>Self-Review Questionnaire: Security and Privacy</cite></a>. URL: <a href="https://w3ctag.github.io/security-questionnaire/">https://w3ctag.github.io/security-questionnaire/</a>
   <dt id="biblio-webcodecs-codec-registry">[WEBCODECS-CODEC-REGISTRY]
   <dd>Chris Cunningham; Paul Adenot; Bernard Aboba. <a href="https://w3c.github.io/webcodecs/codec_registry.html"><cite>WebCodecs Codec Registry</cite></a>. URL: <a href="https://w3c.github.io/webcodecs/codec_registry.html">https://w3c.github.io/webcodecs/codec_registry.html</a>
  </dl>
  <h2 class="no-num no-ref heading settled" id="issues-index"><span class="content">Issues Index</span><a class="self-link" href="#issues-index"></a></h2>
  <div style="counter-reset:issue">
   <div class="issue"> Register ALPN with IANA. <a href="https://github.com/w3c/openscreenprotocol/issues/228">[Issue #228]</a> <a class="issue-return" href="#issue-808efb48" title="Jump to section">↵</a></div>
   <div class="issue"> [Meta] Track CFRG PAKE competition outcome <a href="https://github.com/w3c/openscreenprotocol/issues/242">[Issue #242]</a> <a class="issue-return" href="#issue-dc398825" title="Jump to section">↵</a></div>
   <div class="issue"> Add a back pressure signal for media remoting <a href="https://github.com/w3c/openscreenprotocol/issues/241">[Issue #241]</a> <a class="issue-return" href="#issue-9717419d" title="Jump to section">↵</a></div>
   <div class="issue"> Fate of metadata / authentication history when clearing browsing data. <a href="https://github.com/w3c/openscreenprotocol/issues/132">[Issue #132]</a> <a class="issue-return" href="#issue-8bf4aa9f" title="Jump to section">↵</a></div>
  </div>
<script>/* Boilerplate: script-dom-helper */
"use strict";
function query(sel) { return document.querySelector(sel); }

function queryAll(sel) { return [...document.querySelectorAll(sel)]; }

function iter(obj) {
	if(!obj) return [];
	var it = obj[Symbol.iterator];
	if(it) return it;
	return Object.entries(obj);
}

function mk(tagname, attrs, ...children) {
	const el = document.createElement(tagname);
	for(const [k,v] of iter(attrs)) {
		if(k.slice(0,3) == "_on") {
			const eventName = k.slice(3);
			el.addEventListener(eventName, v);
		} else if(k[0] == "_") {
			// property, not attribute
			el[k.slice(1)] = v;
		} else {
			if(v === false || v == null) {
        continue;
      } else if(v === true) {
        el.setAttribute(k, "");
        continue;
      } else {
  			el.setAttribute(k, v);
      }
		}
	}
	append(el, children);
	return el;
}

/* Create shortcuts for every known HTML element */
[
  "a",
  "abbr",
  "acronym",
  "address",
  "applet",
  "area",
  "article",
  "aside",
  "audio",
  "b",
  "base",
  "basefont",
  "bdo",
  "big",
  "blockquote",
  "body",
  "br",
  "button",
  "canvas",
  "caption",
  "center",
  "cite",
  "code",
  "col",
  "colgroup",
  "datalist",
  "dd",
  "del",
  "details",
  "dfn",
  "dialog",
  "div",
  "dl",
  "dt",
  "em",
  "embed",
  "fieldset",
  "figcaption",
  "figure",
  "font",
  "footer",
  "form",
  "frame",
  "frameset",
  "head",
  "header",
  "h1",
  "h2",
  "h3",
  "h4",
  "h5",
  "h6",
  "hr",
  "html",
  "i",
  "iframe",
  "img",
  "input",
  "ins",
  "kbd",
  "label",
  "legend",
  "li",
  "link",
  "main",
  "map",
  "mark",
  "meta",
  "meter",
  "nav",
  "nobr",
  "noscript",
  "object",
  "ol",
  "optgroup",
  "option",
  "output",
  "p",
  "param",
  "pre",
  "progress",
  "q",
  "s",
  "samp",
  "script",
  "section",
  "select",
  "small",
  "source",
  "span",
  "strike",
  "strong",
  "style",
  "sub",
  "summary",
  "sup",
  "table",
  "tbody",
  "td",
  "template",
  "textarea",
  "tfoot",
  "th",
  "thead",
  "time",
  "title",
  "tr",
  "u",
  "ul",
  "var",
  "video",
  "wbr",
  "xmp",
].forEach(tagname=>{
	mk[tagname] = (...args) => mk(tagname, ...args);
});

function* nodesFromChildList(children) {
	for(const child of children.flat(Infinity)) {
		if(child instanceof Node) {
			yield child;
		} else {
			yield new Text(child);
		}
	}
}
function append(el, ...children) {
	for(const child of nodesFromChildList(children)) {
		if(el instanceof Node) el.appendChild(child);
		else el.push(child);
	}
	return el;
}

function insertAfter(el, ...children) {
	for(const child of nodesFromChildList(children)) {
		el.parentNode.insertBefore(child, el.nextSibling);
	}
	return el;
}

function clearContents(el) {
	el.innerHTML = "";
	return el;
}

function parseHTML(markup) {
	if(markup.toLowerCase().trim().indexOf('<!doctype') === 0) {
		const doc = document.implementation.createHTMLDocument("");
		doc.documentElement.innerHTML = markup;
		return doc;
	} else {
		const el = mk.template({});
		el.innerHTML = markup;
		return el.content;
	}
}</script>
<script>/* Boilerplate: script-dfn-panel */
"use strict";
{
let dfnPanelData = {
"03499e48": {"dfnID":"03499e48","dfnText":"media element","external":true,"refSections":[{"refs":[{"id":"ref-for-media-element"}],"title":"1. Introduction"},{"refs":[{"id":"ref-for-media-element\u2460"}],"title":"1.1. Terminology"}],"url":"https://html.spec.whatwg.org/multipage/media.html#media-element"},
"03cd5764": {"dfnID":"03cd5764","dfnText":"audioTracks","external":true,"refSections":[{"refs":[{"id":"ref-for-dom-media-audiotracks"}],"title":"9. Remote Playback Protocol"},{"refs":[{"id":"ref-for-dom-media-audiotracks\u2460"},{"id":"ref-for-dom-media-audiotracks\u2461"}],"title":"9.1. Remote Playback State and Controls"}],"url":"https://html.spec.whatwg.org/multipage/media.html#dom-media-audiotracks"},
"06b254b0": {"dfnID":"06b254b0","dfnText":"remote playback devices","external":true,"refSections":[{"refs":[{"id":"ref-for-dfn-remote-playback-devices"}],"title":"1.1. Terminology"},{"refs":[{"id":"ref-for-dfn-remote-playback-devices\u2460"},{"id":"ref-for-dfn-remote-playback-devices\u2461"},{"id":"ref-for-dfn-remote-playback-devices\u2462"}],"title":"9.2. Remote Playback API"}],"url":"https://w3c.github.io/remote-playback/#dfn-remote-playback-devices"},
"09153fed": {"dfnID":"09153fed","dfnText":"codecs parameter","external":true,"refSections":[{"refs":[{"id":"ref-for-section-3"}],"title":"10.1. Streaming Protocol Capabilities"}],"url":"https://tools.ietf.org/html/rfc6381#section-3"},
"1076ec40": {"dfnID":"1076ec40","dfnText":"HTMLMediaElement","external":true,"refSections":[{"refs":[{"id":"ref-for-htmlmediaelement"},{"id":"ref-for-htmlmediaelement\u2460"},{"id":"ref-for-htmlmediaelement\u2461"},{"id":"ref-for-htmlmediaelement\u2462"},{"id":"ref-for-htmlmediaelement\u2463"}],"title":"2.3. Remote Playback API Requirements"},{"refs":[{"id":"ref-for-htmlmediaelement\u2464"}],"title":"9. Remote Playback Protocol"},{"refs":[{"id":"ref-for-htmlmediaelement\u2465"}],"title":"9.1. Remote Playback State and Controls"},{"refs":[{"id":"ref-for-htmlmediaelement\u2466"},{"id":"ref-for-htmlmediaelement\u2467"}],"title":"9.2. Remote Playback API"}],"url":"https://html.spec.whatwg.org/multipage/media.html#htmlmediaelement"},
"15a088cb": {"dfnID":"15a088cb","dfnText":"addTextTrack(kind, label, language)","external":true,"refSections":[{"refs":[{"id":"ref-for-dom-media-addtexttrack"}],"title":"9.1. Remote Playback State and Controls"}],"url":"https://html.spec.whatwg.org/multipage/media.html#dom-media-addtexttrack"},
"1704ff9c": {"dfnID":"1704ff9c","dfnText":"uuid","external":true,"refSections":[{"refs":[{"id":"ref-for-section-4.4"}],"title":"9. Remote Playback Protocol"}],"url":"https://tools.ietf.org/html/rfc4122#section-4.4"},
"1a09160b": {"dfnID":"1a09160b","dfnText":"videoWidth","external":true,"refSections":[{"refs":[{"id":"ref-for-dom-video-videowidth"}],"title":"9. Remote Playback Protocol"},{"refs":[{"id":"ref-for-dom-video-videowidth\u2460"}],"title":"9.1. Remote Playback State and Controls"}],"url":"https://html.spec.whatwg.org/multipage/media.html#dom-video-videowidth"},
"1c76c896": {"dfnID":"1c76c896","dfnText":"loop","external":true,"refSections":[{"refs":[{"id":"ref-for-dom-media-loop"}],"title":"9.1. Remote Playback State and Controls"}],"url":"https://html.spec.whatwg.org/multipage/media.html#dom-media-loop"},
"1d3efcfe": {"dfnID":"1d3efcfe","dfnText":"src (for source)","external":true,"refSections":[{"refs":[{"id":"ref-for-attr-source-src"}],"title":"9. Remote Playback Protocol"}],"url":"https://html.spec.whatwg.org/multipage/embedded-content.html#attr-source-src"},
"1fe3b46b": {"dfnID":"1fe3b46b","dfnText":"digitalsignature","external":true,"refSections":[{"refs":[{"id":"ref-for-section-4.2.1.3"}],"title":"4.2. Agent Certificates"}],"url":"https://tools.ietf.org/html/rfc5280#section-4.2.1.3"},
"208b5961": {"dfnID":"208b5961","dfnText":"language tag","external":true,"refSections":[{"refs":[{"id":"ref-for-section-2"}],"title":"4.3. Metadata Discovery"}],"url":"https://tools.ietf.org/html/rfc5646#section-2"},
"23808d57": {"dfnID":"23808d57","dfnText":"media timeline","external":true,"refSections":[{"refs":[{"id":"ref-for-media-timeline"},{"id":"ref-for-media-timeline\u2460"},{"id":"ref-for-media-timeline\u2461"}],"title":"9.1. Remote Playback State and Controls"},{"refs":[{"id":"ref-for-media-timeline\u2462"}],"title":"Appendix E: Media Time Conversions"}],"url":"https://html.spec.whatwg.org/multipage/media.html#media-timeline"},
"34d12a4f": {"dfnID":"34d12a4f","dfnText":"instance name","external":true,"refSections":[{"refs":[{"id":"ref-for-section-4.1.1"}],"title":"3. Discovery with mDNS"},{"refs":[{"id":"ref-for-section-4.1.1\u2460"}],"title":"13.6.1. Instance and Display Names"}],"url":"https://tools.ietf.org/html/rfc6763#section-4.1.1"},
"36aa3708": {"dfnID":"36aa3708","dfnText":"duration","external":true,"refSections":[{"refs":[{"id":"ref-for-dom-media-duration"}],"title":"9. Remote Playback Protocol"},{"refs":[{"id":"ref-for-dom-media-duration\u2460"}],"title":"9.1. Remote Playback State and Controls"}],"url":"https://html.spec.whatwg.org/multipage/media.html#dom-media-duration"},
"36c7793a": {"dfnID":"36c7793a","dfnText":"preload","external":true,"refSections":[{"refs":[{"id":"ref-for-dom-media-preload"}],"title":"9.1. Remote Playback State and Controls"}],"url":"https://html.spec.whatwg.org/multipage/media.html#dom-media-preload"},
"374afd71": {"dfnID":"374afd71","dfnText":"PresentationConnection","external":true,"refSections":[{"refs":[{"id":"ref-for-dom-presentationconnection"},{"id":"ref-for-dom-presentationconnection\u2460"}],"title":"2.2. Presentation API Requirements"},{"refs":[{"id":"ref-for-dom-presentationconnection\u2461"}],"title":"13.1.4. Same-Origin Policy Violations"},{"refs":[{"id":"ref-for-dom-presentationconnection\u2462"}],"title":"13.3. Presentation API Considerations"}],"url":"https://w3c.github.io/presentation-api/#dom-presentationconnection"},
"38cb699f": {"dfnID":"38cb699f","dfnText":"conflict resolution","external":true,"refSections":[{"refs":[{"id":"ref-for-section-9"}],"title":"3. Discovery with mDNS"}],"url":"https://tools.ietf.org/html/rfc6762#section-9"},
"3ce575bf": {"dfnID":"3ce575bf","dfnText":"official playback position","external":true,"refSections":[{"refs":[{"id":"ref-for-official-playback-position"}],"title":"9.1. Remote Playback State and Controls"}],"url":"https://html.spec.whatwg.org/multipage/media.html#official-playback-position"},
"3f5f11ee": {"dfnID":"3f5f11ee","dfnText":"HAVE_NOTHING","external":true,"refSections":[{"refs":[{"id":"ref-for-dom-media-have_nothing"}],"title":"9.1. Remote Playback State and Controls"}],"url":"https://html.spec.whatwg.org/multipage/media.html#dom-media-have_nothing"},
"45182159": {"dfnID":"45182159","dfnText":"seeking","external":true,"refSections":[{"refs":[{"id":"ref-for-dom-media-seeking"}],"title":"9. Remote Playback Protocol"},{"refs":[{"id":"ref-for-dom-media-seeking\u2460"}],"title":"9.1. Remote Playback State and Controls"}],"url":"https://html.spec.whatwg.org/multipage/media.html#dom-media-seeking"},
"456f89c8": {"dfnID":"456f89c8","dfnText":"presentation identifier","external":true,"refSections":[{"refs":[{"id":"ref-for-dfn-presentation-identifier"},{"id":"ref-for-dfn-presentation-identifier\u2460"},{"id":"ref-for-dfn-presentation-identifier\u2461"}],"title":"2.2. Presentation API Requirements"},{"refs":[{"id":"ref-for-dfn-presentation-identifier\u2462"},{"id":"ref-for-dfn-presentation-identifier\u2463"}],"title":"7. Presentation Protocol"},{"refs":[{"id":"ref-for-dfn-presentation-identifier\u2464"}],"title":"7.1. Presentation API"},{"refs":[{"id":"ref-for-dfn-presentation-identifier\u2465"}],"title":"13.1.4. Same-Origin Policy Violations"},{"refs":[{"id":"ref-for-dfn-presentation-identifier\u2466"}],"title":"13.2.1. Personally Identifiable Information & High-Value Data"},{"refs":[{"id":"ref-for-dfn-presentation-identifier\u2467"}],"title":"13.3. Presentation API Considerations"}],"url":"https://www.w3.org/TR/presentation-api/#dfn-presentation-identifier"},
"4728547d": {"dfnID":"4728547d","dfnText":"seekable","external":true,"refSections":[{"refs":[{"id":"ref-for-dom-media-seekable"}],"title":"9. Remote Playback Protocol"},{"refs":[{"id":"ref-for-dom-media-seekable\u2460"}],"title":"9.1. Remote Playback State and Controls"}],"url":"https://html.spec.whatwg.org/multipage/media.html#dom-media-seekable"},
"4bc31655": {"dfnID":"4bc31655","dfnText":"videoTracks","external":true,"refSections":[{"refs":[{"id":"ref-for-dom-media-videotracks"}],"title":"9. Remote Playback Protocol"},{"refs":[{"id":"ref-for-dom-media-videotracks\u2460"},{"id":"ref-for-dom-media-videotracks\u2461"}],"title":"9.1. Remote Playback State and Controls"}],"url":"https://html.spec.whatwg.org/multipage/media.html#dom-media-videotracks"},
"4be354e2": {"dfnID":"4be354e2","dfnText":"variable-length integer encoding","external":true,"refSections":[{"refs":[{"id":"ref-for-name-variable-length-integer-enc"}],"title":"3. Discovery with mDNS"},{"refs":[{"id":"ref-for-name-variable-length-integer-enc\u2460"},{"id":"ref-for-name-variable-length-integer-enc\u2461"}],"title":"5. Messages delivery using CBOR and QUIC streams"},{"refs":[{"id":"ref-for-name-variable-length-integer-enc\u2462"}],"title":"Appendix B: Message Type Key Ranges"}],"url":"https://datatracker.ietf.org/doc/html/rfc9000#name-variable-length-integer-enc"},
"4ef17206": {"dfnID":"4ef17206","dfnText":"timeupdate","external":true,"refSections":[{"refs":[{"id":"ref-for-event-media-timeupdate"}],"title":"9. Remote Playback Protocol"}],"url":"https://html.spec.whatwg.org/multipage/media.html#event-media-timeupdate"},
"5078a29a": {"dfnID":"5078a29a","dfnText":"volume","external":true,"refSections":[{"refs":[{"id":"ref-for-dom-media-volume"}],"title":"9. Remote Playback Protocol"},{"refs":[{"id":"ref-for-dom-media-volume\u2460"},{"id":"ref-for-dom-media-volume\u2461"}],"title":"9.1. Remote Playback State and Controls"}],"url":"https://html.spec.whatwg.org/multipage/media.html#dom-media-volume"},
"552e1f12": {"dfnID":"552e1f12","dfnText":"networkState","external":true,"refSections":[{"refs":[{"id":"ref-for-dom-media-networkstate"}],"title":"9. Remote Playback Protocol"},{"refs":[{"id":"ref-for-dom-media-networkstate\u2460"}],"title":"9.1. Remote Playback State and Controls"}],"url":"https://html.spec.whatwg.org/multipage/media.html#dom-media-networkstate"},
"565ece29": {"dfnID":"565ece29","dfnText":"poster frame","external":true,"refSections":[{"refs":[{"id":"ref-for-poster-frame"}],"title":"9.1. Remote Playback State and Controls"}],"url":"https://html.spec.whatwg.org/multipage/media.html#poster-frame"},
"613edb27": {"dfnID":"613edb27","dfnText":"play()","external":true,"refSections":[{"refs":[{"id":"ref-for-dom-media-play"}],"title":"9. Remote Playback Protocol"},{"refs":[{"id":"ref-for-dom-media-play\u2460"}],"title":"9.1. Remote Playback State and Controls"}],"url":"https://html.spec.whatwg.org/multipage/media.html#dom-media-play"},
"62061ebf": {"dfnID":"62061ebf","dfnText":"initiate remote playback","external":true,"refSections":[{"refs":[{"id":"ref-for-dfn-initiate-remote-playback"}],"title":"2.3. Remote Playback API Requirements"}],"url":"https://w3c.github.io/remote-playback/#dfn-initiate-remote-playback"},
"621f3aeb": {"dfnID":"621f3aeb","dfnText":"readyState","external":true,"refSections":[{"refs":[{"id":"ref-for-dom-media-readystate"}],"title":"9. Remote Playback Protocol"},{"refs":[{"id":"ref-for-dom-media-readystate\u2460"}],"title":"9.1. Remote Playback State and Controls"}],"url":"https://html.spec.whatwg.org/multipage/media.html#dom-media-readystate"},
"649ace3d": {"dfnID":"649ace3d","dfnText":"media resource","external":true,"refSections":[{"refs":[{"id":"ref-for-media-resource"},{"id":"ref-for-media-resource\u2460"},{"id":"ref-for-media-resource\u2461"},{"id":"ref-for-media-resource\u2462"},{"id":"ref-for-media-resource\u2463"}],"title":"9. Remote Playback Protocol"},{"refs":[{"id":"ref-for-media-resource\u2464"},{"id":"ref-for-media-resource\u2465"},{"id":"ref-for-media-resource\u2466"},{"id":"ref-for-media-resource\u2467"},{"id":"ref-for-media-resource\u2468"},{"id":"ref-for-media-resource\u2460\u24ea"},{"id":"ref-for-media-resource\u2460\u2460"}],"title":"9.1. Remote Playback State and Controls"}],"url":"https://html.spec.whatwg.org/multipage/media.html#media-resource"},
"6c09a22e": {"dfnID":"6c09a22e","dfnText":"variable-length integer","external":true,"refSections":[{"refs":[{"id":"ref-for-name-variable-length-integer-enc"}],"title":"3. Discovery with mDNS"},{"refs":[{"id":"ref-for-name-variable-length-integer-enc\u2460"},{"id":"ref-for-name-variable-length-integer-enc\u2461"}],"title":"5. Messages delivery using CBOR and QUIC streams"},{"refs":[{"id":"ref-for-name-variable-length-integer-enc\u2462"}],"title":"Appendix B: Message Type Key Ranges"}],"url":"https://datatracker.ietf.org/doc/html/rfc9000#name-variable-length-integer-enc"},
"6f0181fa": {"dfnID":"6f0181fa","dfnText":"service name","external":true,"refSections":[{"refs":[{"id":"ref-for-section-7"}],"title":"3. Discovery with mDNS"}],"url":"https://tools.ietf.org/html/rfc6763#section-7"},
"732fbcbd": {"dfnID":"732fbcbd","dfnText":"fastSeek(time)","external":true,"refSections":[{"refs":[{"id":"ref-for-dom-media-fastseek"}],"title":"9. Remote Playback Protocol"},{"refs":[{"id":"ref-for-dom-media-fastseek\u2460"}],"title":"9.1. Remote Playback State and Controls"}],"url":"https://html.spec.whatwg.org/multipage/media.html#dom-media-fastseek"},
"87a0c5de": {"dfnID":"87a0c5de","dfnText":"played","external":true,"refSections":[{"refs":[{"id":"ref-for-dom-media-played"}],"title":"9. Remote Playback Protocol"},{"refs":[{"id":"ref-for-dom-media-played\u2460"}],"title":"9.1. Remote Playback State and Controls"}],"url":"https://html.spec.whatwg.org/multipage/media.html#dom-media-played"},
"89da795b": {"dfnID":"89da795b","dfnText":"currentTime","external":true,"refSections":[{"refs":[{"id":"ref-for-dom-media-currenttime"}],"title":"9. Remote Playback Protocol"},{"refs":[{"id":"ref-for-dom-media-currenttime\u2460"},{"id":"ref-for-dom-media-currenttime\u2461"}],"title":"9.1. Remote Playback State and Controls"}],"url":"https://html.spec.whatwg.org/multipage/media.html#dom-media-currenttime"},
"8d87f944": {"dfnID":"8d87f944","dfnText":"muted","external":true,"refSections":[{"refs":[{"id":"ref-for-dom-media-muted"}],"title":"9. Remote Playback Protocol"},{"refs":[{"id":"ref-for-dom-media-muted\u2460"},{"id":"ref-for-dom-media-muted\u2461"}],"title":"9.1. Remote Playback State and Controls"}],"url":"https://html.spec.whatwg.org/multipage/media.html#dom-media-muted"},
"8f45ca65": {"dfnID":"8f45ca65","dfnText":"concise data definition language","external":true,"refSections":[{"refs":[{"id":"ref-for-section-3\u2460"}],"title":"Appendix A: Messages"}],"url":"https://tools.ietf.org/html/rfc8610#section-3"},
"99123207": {"dfnID":"99123207","dfnText":"playbackRate","external":true,"refSections":[{"refs":[{"id":"ref-for-dom-media-playbackrate"}],"title":"9. Remote Playback Protocol"},{"refs":[{"id":"ref-for-dom-media-playbackrate\u2460"},{"id":"ref-for-dom-media-playbackrate\u2461"}],"title":"9.1. Remote Playback State and Controls"}],"url":"https://html.spec.whatwg.org/multipage/media.html#dom-media-playbackrate"},
"9e0b0141": {"dfnID":"9e0b0141","dfnText":"media error code","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-mediaerror-code"}],"title":"9.1. Remote Playback State and Controls"}],"url":"https://html.spec.whatwg.org/multipage/media.html#concept-mediaerror-code"},
"a07c7f7e": {"dfnID":"a07c7f7e","dfnText":"availability sources set","external":true,"refSections":[{"refs":[{"id":"ref-for-dfn-availability-sources-set"}],"title":"9.2. Remote Playback API"}],"url":"https://w3c.github.io/remote-playback/#dfn-availability-sources-set"},
"a17504bd": {"dfnID":"a17504bd","dfnText":"ended","external":true,"refSections":[{"refs":[{"id":"ref-for-dom-media-ended"}],"title":"9. Remote Playback Protocol"},{"refs":[{"id":"ref-for-dom-media-ended\u2460"}],"title":"9.1. Remote Playback State and Controls"}],"url":"https://html.spec.whatwg.org/multipage/media.html#dom-media-ended"},
"a2a5cd12": {"dfnID":"a2a5cd12","dfnText":"qr code","external":true,"refSections":[{"refs":[{"id":"ref-for-something"}],"title":"6. Authentication"},{"refs":[{"id":"ref-for-something\u2460"}],"title":"Appendix C: PSK Encoding Schemes"},{"refs":[{"id":"ref-for-something\u2461"}],"title":"QR Code"}],"url":"https://www.iso.org/standard/62021.html#"},
"a35cc467": {"dfnID":"a35cc467","dfnText":"pause()","external":true,"refSections":[{"refs":[{"id":"ref-for-dom-media-pause"}],"title":"9. Remote Playback Protocol"},{"refs":[{"id":"ref-for-dom-media-pause\u2460"}],"title":"9.1. Remote Playback State and Controls"}],"url":"https://html.spec.whatwg.org/multipage/media.html#dom-media-pause"},
"a65cc4ee": {"dfnID":"a65cc4ee","dfnText":"buffered","external":true,"refSections":[{"refs":[{"id":"ref-for-dom-media-buffered"}],"title":"9. Remote Playback Protocol"},{"refs":[{"id":"ref-for-dom-media-buffered\u2460"}],"title":"9.1. Remote Playback State and Controls"}],"url":"https://html.spec.whatwg.org/multipage/media.html#dom-media-buffered"},
"a6ddbb58": {"dfnID":"a6ddbb58","dfnText":"connection_close frames","external":true,"refSections":[{"refs":[{"id":"ref-for-name-connection_close-frames"}],"title":"5. Messages delivery using CBOR and QUIC streams"}],"url":"https://datatracker.ietf.org/doc/html/rfc9000#name-connection_close-frames"},
"advertising-agent": {"dfnID":"advertising-agent","dfnText":"advertising agent","external":false,"refSections":[{"refs":[{"id":"ref-for-advertising-agent"}],"title":"2.4. Non-Functional Requirements"},{"refs":[{"id":"ref-for-advertising-agent\u2460"}],"title":"4. Transport and metadata discovery with QUIC"},{"refs":[{"id":"ref-for-advertising-agent\u2461"}],"title":"4.2. Agent Certificates"},{"refs":[{"id":"ref-for-advertising-agent\u2462"}],"title":"6. Authentication"},{"refs":[{"id":"ref-for-advertising-agent\u2463"}],"title":"7.1. Presentation API"},{"refs":[{"id":"ref-for-advertising-agent\u2464"}],"title":"9.2. Remote Playback API"},{"refs":[{"id":"ref-for-advertising-agent\u2465"}],"title":"10. Streaming Protocol"}],"url":"#advertising-agent"},
"agent-certificate": {"dfnID":"agent-certificate","dfnText":"agent\ncertificate","external":false,"refSections":[{"refs":[{"id":"ref-for-agent-certificate"}],"title":"3.1. Computing the Agent Fingerprint"},{"refs":[{"id":"ref-for-agent-certificate\u2460"},{"id":"ref-for-agent-certificate\u2461"},{"id":"ref-for-agent-certificate\u2462"},{"id":"ref-for-agent-certificate\u2463"}],"title":"4.2. Agent Certificates"}],"url":"#agent-certificate"},
"agent-fingerprint": {"dfnID":"agent-fingerprint","dfnText":"agent fingerprint","external":false,"refSections":[{"refs":[{"id":"ref-for-agent-fingerprint"}],"title":"3. Discovery with mDNS"},{"refs":[{"id":"ref-for-agent-fingerprint\u2460"}],"title":"4.1. TLS 1.3"},{"refs":[{"id":"ref-for-agent-fingerprint\u2461"}],"title":"6.1. Authentication with SPAKE2"}],"url":"#agent-fingerprint"},
"agent-info": {"dfnID":"agent-info","dfnText":"agent-info","external":false,"refSections":[{"refs":[{"id":"ref-for-agent-info"},{"id":"ref-for-agent-info\u2460"},{"id":"ref-for-agent-info\u2461"},{"id":"ref-for-agent-info\u2462"},{"id":"ref-for-agent-info\u2463"}],"title":"4.3. Metadata Discovery"},{"refs":[{"id":"ref-for-agent-info\u2464"}],"title":"12. Protocol Extensions"},{"refs":[{"id":"ref-for-agent-info\u2465"}],"title":"12.1. Protocol Extension Fields"},{"refs":[{"id":"ref-for-agent-info\u2466"}],"title":"13.2.1. Personally Identifiable Information & High-Value Data"},{"refs":[{"id":"ref-for-agent-info\u2467"}],"title":"13.5.2. Local active network attackers"},{"refs":[{"id":"ref-for-agent-info\u2468"}],"title":"13.6.1. Instance and Display Names"}],"url":"#agent-info"},
"agent-info-event": {"dfnID":"agent-info-event","dfnText":"agent-info-event","external":false,"refSections":[{"refs":[{"id":"ref-for-agent-info-event"}],"title":"4.3. Metadata Discovery"}],"url":"#agent-info-event"},
"agent-info-request": {"dfnID":"agent-info-request","dfnText":"agent-info-request","external":false,"refSections":[{"refs":[{"id":"ref-for-agent-info-request"},{"id":"ref-for-agent-info-request\u2460"}],"title":"4.3. Metadata Discovery"},{"refs":[{"id":"ref-for-agent-info-request\u2461"}],"title":"7.1. Presentation API"},{"refs":[{"id":"ref-for-agent-info-request\u2462"}],"title":"9.2. Remote Playback API"}],"url":"#agent-info-request"},
"agent-info-response": {"dfnID":"agent-info-response","dfnText":"agent-info-response","external":false,"refSections":[{"refs":[{"id":"ref-for-agent-info-response"},{"id":"ref-for-agent-info-response\u2460"}],"title":"4.3. Metadata Discovery"}],"url":"#agent-info-response"},
"agent-status-request": {"dfnID":"agent-status-request","dfnText":"agent-status-request","external":false,"refSections":[{"refs":[{"id":"ref-for-agent-status-request"},{"id":"ref-for-agent-status-request\u2460"},{"id":"ref-for-agent-status-request\u2461"}],"title":"4.3. Metadata Discovery"}],"url":"#agent-status-request"},
"agent-status-response": {"dfnID":"agent-status-response","dfnText":"agent-status-response","external":false,"refSections":[{"refs":[{"id":"ref-for-agent-status-response"},{"id":"ref-for-agent-status-response\u2460"}],"title":"4.3. Metadata Discovery"}],"url":"#agent-status-response"},
"audio-encoding-offer": {"dfnID":"audio-encoding-offer","dfnText":"audio-encoding-offer","external":false,"refSections":[{"refs":[{"id":"ref-for-audio-encoding-offer"},{"id":"ref-for-audio-encoding-offer\u2460"},{"id":"ref-for-audio-encoding-offer\u2461"},{"id":"ref-for-audio-encoding-offer\u2462"},{"id":"ref-for-audio-encoding-offer\u2463"}],"title":"10.3. Audio"}],"url":"#audio-encoding-offer"},
"audio-frame": {"dfnID":"audio-frame","dfnText":"audio-frame","external":false,"refSections":[{"refs":[{"id":"ref-for-audio-frame"}],"title":"10.3. Audio"},{"refs":[{"id":"ref-for-audio-frame\u2460"}],"title":"12.1. Protocol Extension Fields"},{"refs":[{"id":"ref-for-audio-frame\u2461"}],"title":"Appendix E: Media Time Conversions"}],"url":"#audio-frame"},
"auth-capabilities": {"dfnID":"auth-capabilities","dfnText":"auth-capabilities","external":false,"refSections":[{"refs":[{"id":"ref-for-auth-capabilities"},{"id":"ref-for-auth-capabilities\u2460"}],"title":"6. Authentication"}],"url":"#auth-capabilities"},
"auth-initiation-token": {"dfnID":"auth-initiation-token","dfnText":"auth-initiation-token","external":false,"refSections":[{"refs":[{"id":"ref-for-auth-initiation-token"}],"title":"6. Authentication"}],"url":"#auth-initiation-token"},
"auth-spake2-confirmation": {"dfnID":"auth-spake2-confirmation","dfnText":"auth-spake2-confirmation","external":false,"refSections":[{"refs":[{"id":"ref-for-auth-spake2-confirmation"},{"id":"ref-for-auth-spake2-confirmation\u2460"},{"id":"ref-for-auth-spake2-confirmation\u2461"},{"id":"ref-for-auth-spake2-confirmation\u2462"}],"title":"6.1. Authentication with SPAKE2"}],"url":"#auth-spake2-confirmation"},
"auth-spake2-handshake": {"dfnID":"auth-spake2-handshake","dfnText":"auth-spake2-handshake","external":false,"refSections":[{"refs":[{"id":"ref-for-auth-spake2-handshake"},{"id":"ref-for-auth-spake2-handshake\u2460"},{"id":"ref-for-auth-spake2-handshake\u2461"},{"id":"ref-for-auth-spake2-handshake\u2462"},{"id":"ref-for-auth-spake2-handshake\u2463"},{"id":"ref-for-auth-spake2-handshake\u2464"},{"id":"ref-for-auth-spake2-handshake\u2465"},{"id":"ref-for-auth-spake2-handshake\u2466"},{"id":"ref-for-auth-spake2-handshake\u2467"}],"title":"6.1. Authentication with SPAKE2"}],"url":"#auth-spake2-handshake"},
"auth-status": {"dfnID":"auth-status","dfnText":"auth-status","external":false,"refSections":[{"refs":[{"id":"ref-for-auth-status"},{"id":"ref-for-auth-status\u2460"},{"id":"ref-for-auth-status\u2461"}],"title":"6.1. Authentication with SPAKE2"}],"url":"#auth-status"},
"b2b6fbb0": {"dfnID":"b2b6fbb0","dfnText":"remote playback source","external":true,"refSections":[{"refs":[{"id":"ref-for-dfn-remote-playback-source"}],"title":"9.2. Remote Playback API"}],"url":"https://w3c.github.io/remote-playback/#dfn-remote-playback-source"},
"ba8a9b31": {"dfnID":"ba8a9b31","dfnText":"error","external":true,"refSections":[{"refs":[{"id":"ref-for-dom-media-error"}],"title":"9. Remote Playback Protocol"},{"refs":[{"id":"ref-for-dom-media-error\u2460"}],"title":"9.1. Remote Playback State and Controls"}],"url":"https://html.spec.whatwg.org/multipage/media.html#dom-media-error"},
"be4088c1": {"dfnID":"be4088c1","dfnText":"compatible remote playback device","external":true,"refSections":[{"refs":[{"id":"ref-for-dfn-compatible-remote-playback-device"}],"title":"9. Remote Playback Protocol"}],"url":"https://w3c.github.io/remote-playback/#dfn-compatible-remote-playback-device"},
"c5013a3b": {"dfnID":"c5013a3b","dfnText":"media element state","external":true,"refSections":[{"refs":[{"id":"ref-for-dfn-media-element-state"}],"title":"2.3. Remote Playback API Requirements"}],"url":"https://w3c.github.io/remote-playback/#dfn-media-element-state"},
"c7313446": {"dfnID":"c7313446","dfnText":"signature scheme","external":true,"refSections":[{"refs":[{"id":"ref-for-section-4.2.3"}],"title":"4.2. Agent Certificates"}],"url":"https://datatracker.ietf.org/doc/html/rfc8446#section-4.2.3"},
"cb19d8be": {"dfnID":"cb19d8be","dfnText":"postMessage(message, targetOrigin, transfer)","external":true,"refSections":[{"refs":[{"id":"ref-for-dom-window-postmessage"}],"title":"13.1.4. Same-Origin Policy Violations"}],"url":"https://html.spec.whatwg.org/multipage/web-messaging.html#dom-window-postmessage"},
"certificate-serial-number": {"dfnID":"certificate-serial-number","dfnText":"certificate serial number","external":false,"refSections":[{"refs":[{"id":"ref-for-certificate-serial-number"},{"id":"ref-for-certificate-serial-number\u2460"}],"title":"4.2. Agent Certificates"}],"url":"#certificate-serial-number"},
"certificate-serial-number-base": {"dfnID":"certificate-serial-number-base","dfnText":"certificate serial number base","external":false,"refSections":[{"refs":[{"id":"ref-for-certificate-serial-number-base"}],"title":"4.2. Agent Certificates"}],"url":"#certificate-serial-number-base"},
"certificate-serial-number-counter": {"dfnID":"certificate-serial-number-counter","dfnText":"certificate serial number counter","external":false,"refSections":[{"refs":[{"id":"ref-for-certificate-serial-number-counter"},{"id":"ref-for-certificate-serial-number-counter\u2460"}],"title":"4.2. Agent Certificates"}],"url":"#certificate-serial-number-counter"},
"controller": {"dfnID":"controller","dfnText":"controller","external":false,"refSections":[{"refs":[{"id":"ref-for-controller"}],"title":"1.1. Terminology"},{"refs":[{"id":"ref-for-controller\u2460"}],"title":"2.2. Presentation API Requirements"},{"refs":[{"id":"ref-for-controller\u2461"}],"title":"2.3. Remote Playback API Requirements"},{"refs":[{"id":"ref-for-controller\u2462"}],"title":"7.1. Presentation API"}],"url":"#controller"},
"d0a3e1e6": {"dfnID":"d0a3e1e6","dfnText":"videoHeight","external":true,"refSections":[{"refs":[{"id":"ref-for-dom-video-videoheight"}],"title":"9. Remote Playback Protocol"},{"refs":[{"id":"ref-for-dom-video-videoheight\u2460"}],"title":"9.1. Remote Playback State and Controls"}],"url":"https://html.spec.whatwg.org/multipage/media.html#dom-video-videoheight"},
"d834f763": {"dfnID":"d834f763","dfnText":"NETWORK_EMPTY","external":true,"refSections":[{"refs":[{"id":"ref-for-dom-media-network_empty"}],"title":"9.1. Remote Playback State and Controls"}],"url":"https://html.spec.whatwg.org/multipage/media.html#dom-media-network_empty"},
"da57602e": {"dfnID":"da57602e","dfnText":"type","external":true,"refSections":[{"refs":[{"id":"ref-for-attr-source-type"}],"title":"9. Remote Playback Protocol"}],"url":"https://html.spec.whatwg.org/multipage/embedded-content.html#attr-source-type"},
"data-encoding-offer": {"dfnID":"data-encoding-offer","dfnText":"data-encoding-offer","external":false,"refSections":[{"refs":[{"id":"ref-for-data-encoding-offer"},{"id":"ref-for-data-encoding-offer\u2460"},{"id":"ref-for-data-encoding-offer\u2461"},{"id":"ref-for-data-encoding-offer\u2462"}],"title":"10.5. Data"}],"url":"#data-encoding-offer"},
"data-frame": {"dfnID":"data-frame","dfnText":"data-frame","external":false,"refSections":[{"refs":[{"id":"ref-for-data-frame"}],"title":"10.5. Data"}],"url":"#data-frame"},
"df48f90a": {"dfnID":"df48f90a","dfnText":"textTracks","external":true,"refSections":[{"refs":[{"id":"ref-for-dom-media-texttracks"}],"title":"9. Remote Playback Protocol"},{"refs":[{"id":"ref-for-dom-media-texttracks\u2460"},{"id":"ref-for-dom-media-texttracks\u2461"},{"id":"ref-for-dom-media-texttracks\u2462"}],"title":"9.1. Remote Playback State and Controls"}],"url":"https://html.spec.whatwg.org/multipage/media.html#dom-media-texttracks"},
"display-name": {"dfnID":"display-name","dfnText":"display\nname","external":false,"refSections":[{"refs":[{"id":"ref-for-display-name"}],"title":"13.2.1. Personally Identifiable Information & High-Value Data"}],"url":"#display-name"},
"e01f0d07": {"dfnID":"e01f0d07","dfnText":"available presentation display","external":true,"refSections":[{"refs":[{"id":"ref-for-dfn-available-presentation-display"}],"title":"7. Presentation Protocol"}],"url":"https://www.w3.org/TR/presentation-api/#dfn-available-presentation-display"},
"e21cba52": {"dfnID":"e21cba52","dfnText":"receiving user agent","external":true,"refSections":[{"refs":[{"id":"ref-for-dfn-receiving-user-agent"}],"title":"1.1. Terminology"},{"refs":[{"id":"ref-for-dfn-receiving-user-agent\u2460"},{"id":"ref-for-dfn-receiving-user-agent\u2461"}],"title":"7.1. Presentation API"}],"url":"https://www.w3.org/TR/presentation-api/#dfn-receiving-user-agent"},
"e5d99cfd": {"dfnID":"e5d99cfd","dfnText":"timeline offset","external":true,"refSections":[{"refs":[{"id":"ref-for-timeline-offset"}],"title":"9. Remote Playback Protocol"},{"refs":[{"id":"ref-for-timeline-offset\u2460"}],"title":"9.1. Remote Playback State and Controls"}],"url":"https://html.spec.whatwg.org/multipage/media.html#timeline-offset"},
"e9415387": {"dfnID":"e9415387","dfnText":"currentSrc","external":true,"refSections":[{"refs":[{"id":"ref-for-dom-media-currentsrc"}],"title":"9. Remote Playback Protocol"},{"refs":[{"id":"ref-for-dom-media-currentsrc\u2460"}],"title":"9.1. Remote Playback State and Controls"}],"url":"https://html.spec.whatwg.org/multipage/media.html#dom-media-currentsrc"},
"e9b42004": {"dfnID":"e9b42004","dfnText":"presentation request url","external":true,"refSections":[{"refs":[{"id":"ref-for-dfn-presentation-request-url"},{"id":"ref-for-dfn-presentation-request-url\u2460"},{"id":"ref-for-dfn-presentation-request-url\u2461"},{"id":"ref-for-dfn-presentation-request-url\u2462"}],"title":"2.2. Presentation API Requirements"},{"refs":[{"id":"ref-for-dfn-presentation-request-url\u2463"}],"title":"7. Presentation Protocol"}],"url":"https://www.w3.org/TR/presentation-api/#dfn-presentation-request-url"},
"ea42745f": {"dfnID":"ea42745f","dfnText":"stalled","external":true,"refSections":[{"refs":[{"id":"ref-for-event-media-stalled"}],"title":"9. Remote Playback Protocol"},{"refs":[{"id":"ref-for-event-media-stalled\u2460"}],"title":"9.1. Remote Playback State and Controls"}],"url":"https://html.spec.whatwg.org/multipage/media.html#event-media-stalled"},
"eacd6596": {"dfnID":"eacd6596","dfnText":"getStartDate()","external":true,"refSections":[{"refs":[{"id":"ref-for-dom-media-getstartdate"}],"title":"9.1. Remote Playback State and Controls"}],"url":"https://html.spec.whatwg.org/multipage/media.html#dom-media-getstartdate"},
"eb573143": {"dfnID":"eb573143","dfnText":"src (for HTMLMediaElement)","external":true,"refSections":[{"refs":[{"id":"ref-for-dom-media-src"}],"title":"9.1. Remote Playback State and Controls"}],"url":"https://html.spec.whatwg.org/multipage/media.html#dom-media-src"},
"eb577fbe": {"dfnID":"eb577fbe","dfnText":"paused","external":true,"refSections":[{"refs":[{"id":"ref-for-dom-media-paused"}],"title":"9. Remote Playback Protocol"},{"refs":[{"id":"ref-for-dom-media-paused\u2460"}],"title":"9.1. Remote Playback State and Controls"}],"url":"https://html.spec.whatwg.org/multipage/media.html#dom-media-paused"},
"ef3ff42b": {"dfnID":"ef3ff42b","dfnText":"controlling user agent","external":true,"refSections":[{"refs":[{"id":"ref-for-dfn-controlling-user-agent"}],"title":"1.1. Terminology"},{"refs":[{"id":"ref-for-dfn-controlling-user-agent\u2460"},{"id":"ref-for-dfn-controlling-user-agent\u2461"}],"title":"7.1. Presentation API"}],"url":"https://www.w3.org/TR/presentation-api/#dfn-controlling-user-agent"},
"f1776616": {"dfnID":"f1776616","dfnText":"presentation","external":true,"refSections":[{"refs":[{"id":"ref-for-dfn-receiving-browsing-context"}],"title":"1.1. Terminology"},{"refs":[{"id":"ref-for-dfn-receiving-browsing-context\u2460"}],"title":"2.2. Presentation API Requirements"}],"url":"https://www.w3.org/TR/presentation-api/#dfn-receiving-browsing-context"},
"fc89f77a": {"dfnID":"fc89f77a","dfnText":"transport parameter encoding","external":true,"refSections":[{"refs":[{"id":"ref-for-name-transport-parameter-encodin"}],"title":"4.3. Metadata Discovery"}],"url":"https://datatracker.ietf.org/doc/html/rfc9000#name-transport-parameter-encodin"},
"listening-agent": {"dfnID":"listening-agent","dfnText":"listening agent","external":false,"refSections":[{"refs":[{"id":"ref-for-listening-agent"}],"title":"2.4. Non-Functional Requirements"},{"refs":[{"id":"ref-for-listening-agent\u2460"}],"title":"4. Transport and metadata discovery with QUIC"},{"refs":[{"id":"ref-for-listening-agent\u2461"}],"title":"4.2. Agent Certificates"},{"refs":[{"id":"ref-for-listening-agent\u2462"}],"title":"7.1. Presentation API"},{"refs":[{"id":"ref-for-listening-agent\u2463"}],"title":"9.2. Remote Playback API"},{"refs":[{"id":"ref-for-listening-agent\u2464"}],"title":"10. Streaming Protocol"}],"url":"#listening-agent"},
"media-receiver": {"dfnID":"media-receiver","dfnText":"media receiver","external":false,"refSections":[{"refs":[{"id":"ref-for-media-receiver"}],"title":"10. Streaming Protocol"},{"refs":[{"id":"ref-for-media-receiver\u2460"}],"title":"10.3. Audio"}],"url":"#media-receiver"},
"media-sender": {"dfnID":"media-sender","dfnText":"media sender","external":false,"refSections":[{"refs":[{"id":"ref-for-media-sender"}],"title":"10. Streaming Protocol"},{"refs":[{"id":"ref-for-media-sender\u2460"}],"title":"10.3. Audio"}],"url":"#media-sender"},
"open-screen-protocol-agent": {"dfnID":"open-screen-protocol-agent","dfnText":"Open Screen Protocol\nagent","external":false,"refSections":[{"refs":[{"id":"ref-for-open-screen-protocol-agent"}],"title":"2.1. General Requirements"},{"refs":[{"id":"ref-for-open-screen-protocol-agent\u2460"}],"title":"3. Discovery with mDNS"},{"refs":[{"id":"ref-for-open-screen-protocol-agent\u2461"}],"title":"4.1. TLS 1.3"},{"refs":[{"id":"ref-for-open-screen-protocol-agent\u2462"}],"title":"5. Messages delivery using CBOR and QUIC streams"},{"refs":[{"id":"ref-for-open-screen-protocol-agent\u2463"}],"title":"6. Authentication"},{"refs":[{"id":"ref-for-open-screen-protocol-agent\u2464"},{"id":"ref-for-open-screen-protocol-agent\u2465"}],"title":"7.1. Presentation API"},{"refs":[{"id":"ref-for-open-screen-protocol-agent\u2466"},{"id":"ref-for-open-screen-protocol-agent\u2467"}],"title":"9.2. Remote Playback API"},{"refs":[{"id":"ref-for-open-screen-protocol-agent\u2468"}],"title":"10. Streaming Protocol"},{"refs":[{"id":"ref-for-open-screen-protocol-agent\u2460\u24ea"}],"title":"12. Protocol Extensions"},{"refs":[{"id":"ref-for-open-screen-protocol-agent\u2460\u2460"}],"title":"13. Security and Privacy"}],"url":"#open-screen-protocol-agent"},
"presentation-change-event": {"dfnID":"presentation-change-event","dfnText":"presentation-change-event","external":false,"refSections":[{"refs":[{"id":"ref-for-presentation-change-event"},{"id":"ref-for-presentation-change-event\u2460"}],"title":"7. Presentation Protocol"},{"refs":[{"id":"ref-for-presentation-change-event\u2461"},{"id":"ref-for-presentation-change-event\u2462"}],"title":"7.1. Presentation API"}],"url":"#presentation-change-event"},
"presentation-connection-close-event": {"dfnID":"presentation-connection-close-event","dfnText":"presentation-connection-close-event","external":false,"refSections":[{"refs":[{"id":"ref-for-presentation-connection-close-event"},{"id":"ref-for-presentation-connection-close-event\u2460"}],"title":"7. Presentation Protocol"},{"refs":[{"id":"ref-for-presentation-connection-close-event\u2461"}],"title":"7.1. Presentation API"}],"url":"#presentation-connection-close-event"},
"presentation-connection-message": {"dfnID":"presentation-connection-message","dfnText":"presentation-connection-message","external":false,"refSections":[{"refs":[{"id":"ref-for-presentation-connection-message"}],"title":"7. Presentation Protocol"},{"refs":[{"id":"ref-for-presentation-connection-message\u2460"}],"title":"7.1. Presentation API"}],"url":"#presentation-connection-message"},
"presentation-connection-open-request": {"dfnID":"presentation-connection-open-request","dfnText":"presentation-connection-open-request","external":false,"refSections":[{"refs":[{"id":"ref-for-presentation-connection-open-request"},{"id":"ref-for-presentation-connection-open-request\u2460"}],"title":"7. Presentation Protocol"},{"refs":[{"id":"ref-for-presentation-connection-open-request\u2461"},{"id":"ref-for-presentation-connection-open-request\u2462"}],"title":"7.1. Presentation API"}],"url":"#presentation-connection-open-request"},
"presentation-connection-open-response": {"dfnID":"presentation-connection-open-response","dfnText":"presentation-connection-open-response","external":false,"refSections":[{"refs":[{"id":"ref-for-presentation-connection-open-response"},{"id":"ref-for-presentation-connection-open-response\u2460"},{"id":"ref-for-presentation-connection-open-response\u2461"}],"title":"7. Presentation Protocol"},{"refs":[{"id":"ref-for-presentation-connection-open-response\u2462"}],"title":"7.1. Presentation API"}],"url":"#presentation-connection-open-response"},
"presentation-start-request": {"dfnID":"presentation-start-request","dfnText":"presentation-start-request","external":false,"refSections":[{"refs":[{"id":"ref-for-presentation-start-request"},{"id":"ref-for-presentation-start-request\u2460"}],"title":"7. Presentation Protocol"},{"refs":[{"id":"ref-for-presentation-start-request\u2461"}],"title":"7.1. Presentation API"}],"url":"#presentation-start-request"},
"presentation-start-response": {"dfnID":"presentation-start-response","dfnText":"presentation-start-response","external":false,"refSections":[{"refs":[{"id":"ref-for-presentation-start-response"},{"id":"ref-for-presentation-start-response\u2460"}],"title":"7. Presentation Protocol"}],"url":"#presentation-start-response"},
"presentation-termination-event": {"dfnID":"presentation-termination-event","dfnText":"presentation-termination-event","external":false,"refSections":[{"refs":[{"id":"ref-for-presentation-termination-event"}],"title":"7. Presentation Protocol"}],"url":"#presentation-termination-event"},
"presentation-termination-request": {"dfnID":"presentation-termination-request","dfnText":"presentation-termination-request","external":false,"refSections":[{"refs":[{"id":"ref-for-presentation-termination-request"},{"id":"ref-for-presentation-termination-request\u2460"},{"id":"ref-for-presentation-termination-request\u2461"},{"id":"ref-for-presentation-termination-request\u2462"}],"title":"7. Presentation Protocol"},{"refs":[{"id":"ref-for-presentation-termination-request\u2463"}],"title":"7.1. Presentation API"}],"url":"#presentation-termination-request"},
"presentation-termination-response": {"dfnID":"presentation-termination-response","dfnText":"presentation-termination-response","external":false,"refSections":[{"refs":[{"id":"ref-for-presentation-termination-response"}],"title":"7. Presentation Protocol"}],"url":"#presentation-termination-response"},
"presentation-url-availability-event": {"dfnID":"presentation-url-availability-event","dfnText":"presentation-url-availability-event","external":false,"refSections":[{"refs":[{"id":"ref-for-presentation-url-availability-event"}],"title":"7. Presentation Protocol"}],"url":"#presentation-url-availability-event"},
"presentation-url-availability-request": {"dfnID":"presentation-url-availability-request","dfnText":"presentation-url-availability-request","external":false,"refSections":[{"refs":[{"id":"ref-for-presentation-url-availability-request"}],"title":"7. Presentation Protocol"},{"refs":[{"id":"ref-for-presentation-url-availability-request\u2460"}],"title":"7.1. Presentation API"}],"url":"#presentation-url-availability-request"},
"presentation-url-availability-response": {"dfnID":"presentation-url-availability-response","dfnText":"presentation-url-availability-response","external":false,"refSections":[{"refs":[{"id":"ref-for-presentation-url-availability-response"},{"id":"ref-for-presentation-url-availability-response\u2460"}],"title":"7. Presentation Protocol"}],"url":"#presentation-url-availability-response"},
"receiver": {"dfnID":"receiver","dfnText":"receiver","external":false,"refSections":[{"refs":[{"id":"ref-for-receiver"}],"title":"1.1. Terminology"},{"refs":[{"id":"ref-for-receiver\u2460"}],"title":"2.2. Presentation API Requirements"},{"refs":[{"id":"ref-for-receiver\u2461"}],"title":"2.3. Remote Playback API Requirements"},{"refs":[{"id":"ref-for-receiver\u2462"}],"title":"7. Presentation Protocol"},{"refs":[{"id":"ref-for-receiver\u2463"}],"title":"9.2. Remote Playback API"}],"url":"#receiver"},
"remote-playback-availability-event": {"dfnID":"remote-playback-availability-event","dfnText":"remote-playback-availability-event","external":false,"refSections":[{"refs":[{"id":"ref-for-remote-playback-availability-event"}],"title":"9. Remote Playback Protocol"}],"url":"#remote-playback-availability-event"},
"remote-playback-availability-request": {"dfnID":"remote-playback-availability-request","dfnText":"remote-playback-availability-request","external":false,"refSections":[{"refs":[{"id":"ref-for-remote-playback-availability-request"}],"title":"9. Remote Playback Protocol"},{"refs":[{"id":"ref-for-remote-playback-availability-request\u2460"},{"id":"ref-for-remote-playback-availability-request\u2461"}],"title":"9.2. Remote Playback API"}],"url":"#remote-playback-availability-request"},
"remote-playback-availability-response": {"dfnID":"remote-playback-availability-response","dfnText":"remote-playback-availability-response","external":false,"refSections":[{"refs":[{"id":"ref-for-remote-playback-availability-response"},{"id":"ref-for-remote-playback-availability-response\u2460"}],"title":"9. Remote Playback Protocol"}],"url":"#remote-playback-availability-response"},
"remote-playback-modify-request": {"dfnID":"remote-playback-modify-request","dfnText":"remote-playback-modify-request","external":false,"refSections":[{"refs":[{"id":"ref-for-remote-playback-modify-request"},{"id":"ref-for-remote-playback-modify-request\u2460"}],"title":"9. Remote Playback Protocol"},{"refs":[{"id":"ref-for-remote-playback-modify-request\u2461"}],"title":"9.1. Remote Playback State and Controls"},{"refs":[{"id":"ref-for-remote-playback-modify-request\u2462"}],"title":"9.2. Remote Playback API"}],"url":"#remote-playback-modify-request"},
"remote-playback-modify-response": {"dfnID":"remote-playback-modify-response","dfnText":"remote-playback-modify-response","external":false,"refSections":[{"refs":[{"id":"ref-for-remote-playback-modify-response"}],"title":"9. Remote Playback Protocol"},{"refs":[{"id":"ref-for-remote-playback-modify-response\u2460"}],"title":"9.2. Remote Playback API"}],"url":"#remote-playback-modify-response"},
"remote-playback-start-request": {"dfnID":"remote-playback-start-request","dfnText":"remote-playback-start-request","external":false,"refSections":[{"refs":[{"id":"ref-for-remote-playback-start-request"},{"id":"ref-for-remote-playback-start-request\u2460"},{"id":"ref-for-remote-playback-start-request\u2461"}],"title":"9. Remote Playback Protocol"},{"refs":[{"id":"ref-for-remote-playback-start-request\u2462"},{"id":"ref-for-remote-playback-start-request\u2463"},{"id":"ref-for-remote-playback-start-request\u2464"},{"id":"ref-for-remote-playback-start-request\u2465"}],"title":"9.1. Remote Playback State and Controls"},{"refs":[{"id":"ref-for-remote-playback-start-request\u2466"},{"id":"ref-for-remote-playback-start-request\u2467"}],"title":"9.2. Remote Playback API"}],"url":"#remote-playback-start-request"},
"remote-playback-start-response": {"dfnID":"remote-playback-start-response","dfnText":"remote-playback-start-response","external":false,"refSections":[{"refs":[{"id":"ref-for-remote-playback-start-response"},{"id":"ref-for-remote-playback-start-response\u2460"}],"title":"9. Remote Playback Protocol"},{"refs":[{"id":"ref-for-remote-playback-start-response\u2461"},{"id":"ref-for-remote-playback-start-response\u2462"},{"id":"ref-for-remote-playback-start-response\u2463"},{"id":"ref-for-remote-playback-start-response\u2464"},{"id":"ref-for-remote-playback-start-response\u2465"},{"id":"ref-for-remote-playback-start-response\u2466"},{"id":"ref-for-remote-playback-start-response\u2467"},{"id":"ref-for-remote-playback-start-response\u2468"},{"id":"ref-for-remote-playback-start-response\u2460\u24ea"},{"id":"ref-for-remote-playback-start-response\u2460\u2460"},{"id":"ref-for-remote-playback-start-response\u2460\u2461"},{"id":"ref-for-remote-playback-start-response\u2460\u2462"},{"id":"ref-for-remote-playback-start-response\u2460\u2463"},{"id":"ref-for-remote-playback-start-response\u2460\u2464"},{"id":"ref-for-remote-playback-start-response\u2460\u2465"},{"id":"ref-for-remote-playback-start-response\u2460\u2466"},{"id":"ref-for-remote-playback-start-response\u2460\u2467"},{"id":"ref-for-remote-playback-start-response\u2460\u2468"},{"id":"ref-for-remote-playback-start-response\u2461\u24ea"},{"id":"ref-for-remote-playback-start-response\u2461\u2460"},{"id":"ref-for-remote-playback-start-response\u2461\u2461"},{"id":"ref-for-remote-playback-start-response\u2461\u2462"},{"id":"ref-for-remote-playback-start-response\u2461\u2463"}],"title":"9.1. Remote Playback State and Controls"}],"url":"#remote-playback-start-response"},
"remote-playback-state-event": {"dfnID":"remote-playback-state-event","dfnText":"remote-playback-state-event","external":false,"refSections":[{"refs":[{"id":"ref-for-remote-playback-state-event"},{"id":"ref-for-remote-playback-state-event\u2460"},{"id":"ref-for-remote-playback-state-event\u2461"},{"id":"ref-for-remote-playback-state-event\u2462"},{"id":"ref-for-remote-playback-state-event\u2463"},{"id":"ref-for-remote-playback-state-event\u2464"},{"id":"ref-for-remote-playback-state-event\u2465"}],"title":"9. Remote Playback Protocol"},{"refs":[{"id":"ref-for-remote-playback-state-event\u2466"}],"title":"9.1. Remote Playback State and Controls"},{"refs":[{"id":"ref-for-remote-playback-state-event\u2467"}],"title":"9.2. Remote Playback API"}],"url":"#remote-playback-state-event"},
"remote-playback-termination-event": {"dfnID":"remote-playback-termination-event","dfnText":"remote-playback-termination-event","external":false,"refSections":[{"refs":[{"id":"ref-for-remote-playback-termination-event"}],"title":"9. Remote Playback Protocol"}],"url":"#remote-playback-termination-event"},
"remote-playback-termination-request": {"dfnID":"remote-playback-termination-request","dfnText":"remote-playback-termination-request","external":false,"refSections":[{"refs":[{"id":"ref-for-remote-playback-termination-request"},{"id":"ref-for-remote-playback-termination-request\u2460"}],"title":"9. Remote Playback Protocol"},{"refs":[{"id":"ref-for-remote-playback-termination-request\u2461"}],"title":"9.2. Remote Playback API"}],"url":"#remote-playback-termination-request"},
"remote-playback-termination-response": {"dfnID":"remote-playback-termination-response","dfnText":"remote-playback-termination-response","external":false,"refSections":[{"refs":[{"id":"ref-for-remote-playback-termination-response"}],"title":"9. Remote Playback Protocol"}],"url":"#remote-playback-termination-response"},
"streaming-capabilities-request": {"dfnID":"streaming-capabilities-request","dfnText":"streaming-capabilities-request","external":false,"refSections":[{"refs":[{"id":"ref-for-streaming-capabilities-request"}],"title":"10.1. Streaming Protocol Capabilities"}],"url":"#streaming-capabilities-request"},
"streaming-capabilities-response": {"dfnID":"streaming-capabilities-response","dfnText":"streaming-capabilities-response","external":false,"refSections":[{"refs":[{"id":"ref-for-streaming-capabilities-response"}],"title":"10.1. Streaming Protocol Capabilities"}],"url":"#streaming-capabilities-response"},
"streaming-session-modify-request": {"dfnID":"streaming-session-modify-request","dfnText":"streaming-session-modify-request","external":false,"refSections":[{"refs":[{"id":"ref-for-streaming-session-modify-request"}],"title":"9. Remote Playback Protocol"},{"refs":[{"id":"ref-for-streaming-session-modify-request\u2460"},{"id":"ref-for-streaming-session-modify-request\u2461"},{"id":"ref-for-streaming-session-modify-request\u2462"},{"id":"ref-for-streaming-session-modify-request\u2463"}],"title":"10.2. Sessions"}],"url":"#streaming-session-modify-request"},
"streaming-session-modify-response": {"dfnID":"streaming-session-modify-response","dfnText":"streaming-session-modify-response","external":false,"refSections":[{"refs":[{"id":"ref-for-streaming-session-modify-response"}],"title":"10.2. Sessions"}],"url":"#streaming-session-modify-response"},
"streaming-session-receiver-stats-event": {"dfnID":"streaming-session-receiver-stats-event","dfnText":"streaming-session-receiver-stats-event","external":false,"refSections":[{"refs":[{"id":"ref-for-streaming-session-receiver-stats-event"},{"id":"ref-for-streaming-session-receiver-stats-event\u2460"}],"title":"10.7. Stats"}],"url":"#streaming-session-receiver-stats-event"},
"streaming-session-sender-stats-event": {"dfnID":"streaming-session-sender-stats-event","dfnText":"streaming-session-sender-stats-event","external":false,"refSections":[{"refs":[{"id":"ref-for-streaming-session-sender-stats-event"},{"id":"ref-for-streaming-session-sender-stats-event\u2460"}],"title":"10.7. Stats"}],"url":"#streaming-session-sender-stats-event"},
"streaming-session-start-request": {"dfnID":"streaming-session-start-request","dfnText":"streaming-session-start-request","external":false,"refSections":[{"refs":[{"id":"ref-for-streaming-session-start-request"}],"title":"9. Remote Playback Protocol"},{"refs":[{"id":"ref-for-streaming-session-start-request\u2460"},{"id":"ref-for-streaming-session-start-request\u2461"}],"title":"10.2. Sessions"}],"url":"#streaming-session-start-request"},
"streaming-session-start-response": {"dfnID":"streaming-session-start-response","dfnText":"streaming-session-start-response","external":false,"refSections":[{"refs":[{"id":"ref-for-streaming-session-start-response"}],"title":"9. Remote Playback Protocol"},{"refs":[{"id":"ref-for-streaming-session-start-response\u2460"},{"id":"ref-for-streaming-session-start-response\u2461"}],"title":"10.2. Sessions"}],"url":"#streaming-session-start-response"},
"streaming-session-terminate-event": {"dfnID":"streaming-session-terminate-event","dfnText":"streaming-session-terminate-event","external":false,"refSections":[{"refs":[{"id":"ref-for-streaming-session-terminate-event"}],"title":"10.2. Sessions"}],"url":"#streaming-session-terminate-event"},
"streaming-session-terminate-request": {"dfnID":"streaming-session-terminate-request","dfnText":"streaming-session-terminate-request","external":false,"refSections":[{"refs":[{"id":"ref-for-streaming-session-terminate-request"},{"id":"ref-for-streaming-session-terminate-request\u2460"}],"title":"10.2. Sessions"}],"url":"#streaming-session-terminate-request"},
"streaming-session-terminate-response": {"dfnID":"streaming-session-terminate-response","dfnText":"streaming-session-terminate-response","external":false,"refSections":[{"refs":[{"id":"ref-for-streaming-session-terminate-response"}],"title":"10.2. Sessions"}],"url":"#streaming-session-terminate-response"},
"suspicious-agent": {"dfnID":"suspicious-agent","dfnText":"suspicious\nagent","external":false,"refSections":[{"refs":[{"id":"ref-for-suspicious-agent"}],"title":"13.6. User Interface Considerations"}],"url":"#suspicious-agent"},
"text-track-cue": {"dfnID":"text-track-cue","dfnText":"text-track-cue","external":false,"refSections":[{"refs":[{"id":"ref-for-text-track-cue"}],"title":"9.1. Remote Playback State and Controls"}],"url":"#text-track-cue"},
"time-scale": {"dfnID":"time-scale","dfnText":"time\nscale","external":false,"refSections":[{"refs":[{"id":"ref-for-time-scale"},{"id":"ref-for-time-scale\u2460"}],"title":"8. Representation Of Time"},{"refs":[{"id":"ref-for-time-scale\u2461"},{"id":"ref-for-time-scale\u2462"},{"id":"ref-for-time-scale\u2463"}],"title":"10.2. Sessions"},{"refs":[{"id":"ref-for-time-scale\u2464"},{"id":"ref-for-time-scale\u2465"},{"id":"ref-for-time-scale\u2466"}],"title":"10.3. Audio"},{"refs":[{"id":"ref-for-time-scale\u2467"},{"id":"ref-for-time-scale\u2468"},{"id":"ref-for-time-scale\u2460\u24ea"}],"title":"10.4. Video"},{"refs":[{"id":"ref-for-time-scale\u2460\u2460"},{"id":"ref-for-time-scale\u2460\u2461"},{"id":"ref-for-time-scale\u2460\u2462"}],"title":"10.5. Data"}],"url":"#time-scale"},
"verified-display-name": {"dfnID":"verified-display-name","dfnText":"verified display name","external":false,"refSections":[{"refs":[{"id":"ref-for-verified-display-name"}],"title":"13.6.1. Instance and Display Names"}],"url":"#verified-display-name"},
"video-encoding-offer": {"dfnID":"video-encoding-offer","dfnText":"video-encoding-offer","external":false,"refSections":[{"refs":[{"id":"ref-for-video-encoding-offer"},{"id":"ref-for-video-encoding-offer\u2460"},{"id":"ref-for-video-encoding-offer\u2461"},{"id":"ref-for-video-encoding-offer\u2462"}],"title":"10.4. Video"}],"url":"#video-encoding-offer"},
"video-frame": {"dfnID":"video-frame","dfnText":"video-frame","external":false,"refSections":[{"refs":[{"id":"ref-for-video-frame"}],"title":"9. Remote Playback Protocol"},{"refs":[{"id":"ref-for-video-frame\u2460"}],"title":"10.4. Video"},{"refs":[{"id":"ref-for-video-frame\u2461"}],"title":"Appendix E: Media Time Conversions"}],"url":"#video-frame"},
};

document.addEventListener("DOMContentLoaded", ()=>{
    genAllDfnPanels();

    document.body.addEventListener("click", (e) => {
        // If not handled already, just hide all dfn panels.
        hideAllDfnPanels();
    });
});

window.addEventListener("resize", () => {
    // Pin any visible dfn panel
    queryAll(".dfn-panel.on, .dfn-panel.activated").forEach(el=>positionDfnPanel(el));
});

function genAllDfnPanels() {
    for(const panelData of Object.values(dfnPanelData)) {
        const dfnID = panelData.dfnID;
        const dfn = document.getElementById(dfnID);
        if(!dfn) {
            console.log(`Can't find dfn#${dfnID}.`, panelData);
            continue;
        }
        dfn.panelData = panelData;
        insertDfnPopupAction(dfn);
    }
}

function genDfnPanel(dfn, { dfnID, url, dfnText, refSections, external }) {
    const dfnPanel = mk.aside({
        class: "dfn-panel on",
        id: `infopanel-for-${dfnID}`,
        "data-for": dfnID,
        "aria-labelled-by":`infopaneltitle-for-${dfnID}`,
        },
        mk.span({id:`infopaneltitle-for-${dfnID}`, style:"display:none"},
            `Info about the '${dfnText}' ${external?"external":""} reference.`),
        mk.a({href:url, class:"dfn-link"}, url),
        refSections.length == 0 ? [] :
            mk.b({}, "Referenced in:"),
            mk.ul({},
                ...refSections.map(section=>
                    mk.li({},
                        ...section.refs.map((ref, refI)=>
                            [
                                mk.a({ href: `#${ref.id}` },
                                    (refI == 0) ? section.title : `(${refI + 1})`
                                ),
                                " ",
                            ]
                        ),
                    ),
                ),
            ),
        genLinkingSyntaxes(dfn),
    );

    dfnPanel.addEventListener('click', (event) => {
        if (event.target.nodeName == 'A') {
            scrollToTargetAndHighlight(event);
            pinDfnPanel(dfnPanel);
        }
        event.stopPropagation();
        refocusOnTarget(event);
    });
    dfnPanel.addEventListener('keydown', (event) => {
        if(event.keyCode == 27) { // Escape key
            hideDfnPanel({dfnPanel});
            event.stopPropagation();
            event.preventDefault();
        }
    });

    dfnPanel.dfn = dfn;
    dfn.dfnPanel = dfnPanel;
    return dfnPanel;
}



function hideAllDfnPanels() {
    // Delete the currently-active dfn panel.
    queryAll(".dfn-panel").forEach(dfnPanel=>hideDfnPanel({dfnPanel}));
}

function showDfnPanel(dfn) {
    hideAllDfnPanels(); // Only display one at a time.

    dfn.setAttribute("aria-expanded", "true");

    const dfnPanel = genDfnPanel(dfn, dfn.panelData);

    // Give the dfn a unique tabindex, and then
    // give all the tabbable panel bits successive indexes.
    let tabIndex = 100;
    dfn.tabIndex = tabIndex++;
    const tabbable = dfnPanel.querySelectorAll(":is(a, button)");
    for (const el of tabbable) {
        el.tabIndex = tabIndex++;
    }

    append(document.body, dfnPanel);
    positionDfnPanel(dfnPanel);
}

function positionDfnPanel(dfnPanel) {
    const dfn = dfnPanel.dfn;
    const dfnPos = getBounds(dfn);
    dfnPanel.style.top = dfnPos.bottom + "px";
    dfnPanel.style.left = dfnPos.left + "px";

    const panelPos = dfnPanel.getBoundingClientRect();
    const panelMargin = 8;
    const maxRight = document.body.parentNode.clientWidth - panelMargin;
    if (panelPos.right > maxRight) {
        const overflowAmount = panelPos.right - maxRight;
        const newLeft = Math.max(panelMargin, dfnPos.left - overflowAmount);
        dfnPanel.style.left = newLeft + "px";
    }
}

function pinDfnPanel(dfnPanel) {
    // Switch it to "activated" state, which pins it.
    dfnPanel.classList.add("activated");
    dfnPanel.style.position = "fixed";
    dfnPanel.style.left = null;
    dfnPanel.style.top = null;
}

function hideDfnPanel({dfn, dfnPanel}) {
    if(!dfnPanel) dfnPanel = dfn.dfnPanel;
    if(!dfn) dfn = dfnPanel.dfn;
    dfn.dfnPanel = undefined;
    dfnPanel.dfn = undefined;
    dfn.setAttribute("aria-expanded", "false");
    dfn.tabIndex = undefined;
    dfnPanel.remove()
}

function toggleDfnPanel(dfn) {
    if(dfn.dfnPanel) {
        hideDfnPanel(dfn);
    } else {
        showDfnPanel(dfn);
    }
}

function insertDfnPopupAction(dfn) {
    dfn.setAttribute('role', 'button');
    dfn.setAttribute('aria-expanded', 'false')
    dfn.tabIndex = 0;
    dfn.classList.add('has-dfn-panel');
    dfn.addEventListener('click', (event) => {
        toggleDfnPanel(dfn);
        event.stopPropagation();
    });
    dfn.addEventListener('keypress', (event) => {
        const kc = event.keyCode;
        // 32->Space, 13->Enter
        if(kc == 32 || kc == 13) {
            toggleDfnPanel(dfn);
            event.stopPropagation();
            event.preventDefault();
        }
    });
}

function refocusOnTarget(event) {
    const target = event.target;
    setTimeout(() => {
        // Refocus on the event.target element.
        // This is needed after browser scrolls to the destination.
        target.focus();
    });
}

// TODO: shared util
// Returns the root-level absolute position {left and top} of element.
function getBounds(el, relativeTo=document.body) {
    const relativeRect = relativeTo.getBoundingClientRect();
    const elRect = el.getBoundingClientRect();
    const top = elRect.top - relativeRect.top;
    const left = elRect.left - relativeRect.left;
    return {
        top,
        left,
        bottom: top + elRect.height,
        right: left + elRect.width,
    }
}

function scrollToTargetAndHighlight(event) {
    let hash = event.target.hash;
    if (hash) {
        hash = decodeURIComponent(hash.substring(1));
        const dest = document.getElementById(hash);
        if (dest) {
            dest.classList.add('highlighted');
            setTimeout(() => dest.classList.remove('highlighted'), 1000);
        }
    }
}

// Functions, divided by link type, that wrap an autolink's
// contents with the appropriate outer syntax.
// Alternately, a string naming another type they format
// the same as.
function needsFor(type) {
    switch(type) {
        case "descriptor":
        case "value":
        case "element-attr":
        case "attr-value":
        case "element-state":
        case "method":
        case "constructor":
        case "argument":
        case "attribute":
        case "const":
        case "dict-member":
        case "event":
        case "enum-value":
        case "stringifier":
        case "serializer":
        case "iterator":
        case "maplike":
        case "setlike":
        case "state":
        case "mode":
        case "context":
        case "facet": return true;

        default: return false;
    }
}
function refusesFor(type) {
    switch(type) {
        case "property":
        case "element":
        case "interface":
        case "namespace":
        case "callback":
        case "dictionary":
        case "enum":
        case "exception":
        case "typedef":
        case "http-header":
        case "permission": return true;

        default: return false;
    }
}
function linkFormatterFromType(type) {
    switch(type) {
        case 'scheme':
        case 'permission':
        case 'dfn': return (text) => `[=${text}=]`;

        case 'abstract-op': return (text) => `[\$${text}\$]`;

        case 'function':
        case 'at-rule':
        case 'selector':
        case 'value': return (text) => `''${text}''`;

        case 'http-header': return (text) => `[:${text}:]`;

        case 'interface':
        case 'constructor':
        case 'method':
        case 'argument':
        case 'attribute':
        case 'callback':
        case 'dictionary':
        case 'dict-member':
        case 'enum':
        case 'enum-value':
        case 'exception':
        case 'const':
        case 'typedef':
        case 'stringifier':
        case 'serializer':
        case 'iterator':
        case 'maplike':
        case 'setlike':
        case 'extended-attribute':
        case 'event':
        case 'idl': return (text) => `{{${text}}}`;

        case 'element-state':
        case 'element-attr':
        case 'attr-value':
        case 'element': return (element) => `<{${element}}>`;

        case 'grammar': return (text) => `${text} (within a <pre class=prod>)`;

        case 'type': return (text)=> `<<${text}>>`;

        case 'descriptor':
        case 'property': return (text) => `'${text}'`;

        default: return;
    };
};

function genLinkingSyntaxes(dfn) {
    if(dfn.tagName != "DFN") return;

    const type = dfn.getAttribute('data-dfn-type');
    if(!type) {
        console.log(`<dfn> doesn't have a data-dfn-type:`, dfn);
        return [];
    }

    // Return a function that wraps link text based on the type
    const linkFormatter = linkFormatterFromType(type);
    if(!linkFormatter) {
        console.log(`<dfn> has an unknown data-dfn-type:`, dfn);
        return [];
    }

    let ltAlts;
    if(dfn.hasAttribute('data-lt')) {
        ltAlts = dfn.getAttribute('data-lt')
            .split("|")
            .map(x=>x.trim());
    } else {
        ltAlts = [dfn.textContent.trim()];
    }
    if(type == "type") {
        // lt of "<foo>", but "foo" is the interior;
        // <<foo/bar>> is how you write it with a for,
        // not <foo/<bar>> or whatever.
        for(var i = 0; i < ltAlts.length; i++) {
            const lt = ltAlts[i];
            const match = /<(.*)>/.exec(lt);
            if(match) { ltAlts[i] = match[1]; }
        }
    }

    let forAlts;
    if(dfn.hasAttribute('data-dfn-for')) {
        forAlts = dfn.getAttribute('data-dfn-for')
            .split(",")
            .map(x=>x.trim());
    } else {
        forAlts = [''];
    }

    let linkingSyntaxes = [];
    if(!needsFor(type)) {
        for(const lt of ltAlts) {
            linkingSyntaxes.push(linkFormatter(lt));
        }
    }
    if(!refusesFor(type)) {
        for(const f of forAlts) {
            linkingSyntaxes.push(linkFormatter(`${f}/${ltAlts[0]}`))
        }
    }
    return [
        mk.b({}, 'Possible linking syntaxes:'),
        mk.ul({},
            ...linkingSyntaxes.map(link => {
                const copyLink = async () =>
                    await navigator.clipboard.writeText(link);
                return mk.li({},
                    mk.div({ class: 'link-item' },
                        mk.button({
                            class: 'copy-icon', title: 'Copy',
                            type: 'button',
                            _onclick: copyLink,
                            tabindex: 0,
                        }, mk.span({ class: 'icon' }) ),
                        mk.span({}, link)
                    )
                );
            })
        )
    ];
}
}
</script>
<script>/* Boilerplate: script-ref-hints */
"use strict";
{
let refsData = {
"#advertising-agent": {"export":true,"for_":[],"level":"","normative":true,"shortname":"openscreenprotocol","spec":"openscreenprotocol","status":"local","text":"advertising agent","type":"dfn","url":"#advertising-agent"},
"#agent-certificate": {"export":true,"for_":[],"level":"","normative":true,"shortname":"openscreenprotocol","spec":"openscreenprotocol","status":"local","text":"agent certificate","type":"dfn","url":"#agent-certificate"},
"#agent-fingerprint": {"export":true,"for_":[],"level":"","normative":true,"shortname":"openscreenprotocol","spec":"openscreenprotocol","status":"local","text":"agent fingerprint","type":"dfn","url":"#agent-fingerprint"},
"#agent-info": {"export":true,"for_":[],"level":"","normative":true,"shortname":"openscreenprotocol","spec":"openscreenprotocol","status":"local","text":"agent-info","type":"dfn","url":"#agent-info"},
"#agent-info-event": {"export":true,"for_":[],"level":"","normative":true,"shortname":"openscreenprotocol","spec":"openscreenprotocol","status":"local","text":"agent-info-event","type":"dfn","url":"#agent-info-event"},
"#agent-info-request": {"export":true,"for_":[],"level":"","normative":true,"shortname":"openscreenprotocol","spec":"openscreenprotocol","status":"local","text":"agent-info-request","type":"dfn","url":"#agent-info-request"},
"#agent-info-response": {"export":true,"for_":[],"level":"","normative":true,"shortname":"openscreenprotocol","spec":"openscreenprotocol","status":"local","text":"agent-info-response","type":"dfn","url":"#agent-info-response"},
"#agent-status-request": {"export":true,"for_":[],"level":"","normative":true,"shortname":"openscreenprotocol","spec":"openscreenprotocol","status":"local","text":"agent-status-request","type":"dfn","url":"#agent-status-request"},
"#agent-status-response": {"export":true,"for_":[],"level":"","normative":true,"shortname":"openscreenprotocol","spec":"openscreenprotocol","status":"local","text":"agent-status-response","type":"dfn","url":"#agent-status-response"},
"#audio-encoding-offer": {"export":true,"for_":[],"level":"","normative":true,"shortname":"openscreenprotocol","spec":"openscreenprotocol","status":"local","text":"audio-encoding-offer","type":"dfn","url":"#audio-encoding-offer"},
"#audio-frame": {"export":true,"for_":[],"level":"","normative":true,"shortname":"openscreenprotocol","spec":"openscreenprotocol","status":"local","text":"audio-frame","type":"dfn","url":"#audio-frame"},
"#auth-capabilities": {"export":true,"for_":[],"level":"","normative":true,"shortname":"openscreenprotocol","spec":"openscreenprotocol","status":"local","text":"auth-capabilities","type":"dfn","url":"#auth-capabilities"},
"#auth-initiation-token": {"export":true,"for_":[],"level":"","normative":true,"shortname":"openscreenprotocol","spec":"openscreenprotocol","status":"local","text":"auth-initiation-token","type":"dfn","url":"#auth-initiation-token"},
"#auth-spake2-confirmation": {"export":true,"for_":[],"level":"","normative":true,"shortname":"openscreenprotocol","spec":"openscreenprotocol","status":"local","text":"auth-spake2-confirmation","type":"dfn","url":"#auth-spake2-confirmation"},
"#auth-spake2-handshake": {"export":true,"for_":[],"level":"","normative":true,"shortname":"openscreenprotocol","spec":"openscreenprotocol","status":"local","text":"auth-spake2-handshake","type":"dfn","url":"#auth-spake2-handshake"},
"#auth-status": {"export":true,"for_":[],"level":"","normative":true,"shortname":"openscreenprotocol","spec":"openscreenprotocol","status":"local","text":"auth-status","type":"dfn","url":"#auth-status"},
"#certificate-serial-number": {"export":true,"for_":[],"level":"","normative":true,"shortname":"openscreenprotocol","spec":"openscreenprotocol","status":"local","text":"certificate serial number","type":"dfn","url":"#certificate-serial-number"},
"#certificate-serial-number-base": {"export":true,"for_":[],"level":"","normative":true,"shortname":"openscreenprotocol","spec":"openscreenprotocol","status":"local","text":"certificate serial number base","type":"dfn","url":"#certificate-serial-number-base"},
"#certificate-serial-number-counter": {"export":true,"for_":[],"level":"","normative":true,"shortname":"openscreenprotocol","spec":"openscreenprotocol","status":"local","text":"certificate serial number counter","type":"dfn","url":"#certificate-serial-number-counter"},
"#controller": {"export":true,"for_":[],"level":"","normative":true,"shortname":"openscreenprotocol","spec":"openscreenprotocol","status":"local","text":"controller","type":"dfn","url":"#controller"},
"#data-encoding-offer": {"export":true,"for_":[],"level":"","normative":true,"shortname":"openscreenprotocol","spec":"openscreenprotocol","status":"local","text":"data-encoding-offer","type":"dfn","url":"#data-encoding-offer"},
"#data-frame": {"export":true,"for_":[],"level":"","normative":true,"shortname":"openscreenprotocol","spec":"openscreenprotocol","status":"local","text":"data-frame","type":"dfn","url":"#data-frame"},
"#display-name": {"export":true,"for_":[],"level":"","normative":true,"shortname":"openscreenprotocol","spec":"openscreenprotocol","status":"local","text":"display name","type":"dfn","url":"#display-name"},
"#listening-agent": {"export":true,"for_":[],"level":"","normative":true,"shortname":"openscreenprotocol","spec":"openscreenprotocol","status":"local","text":"listening agent","type":"dfn","url":"#listening-agent"},
"#media-receiver": {"export":true,"for_":[],"level":"","normative":true,"shortname":"openscreenprotocol","spec":"openscreenprotocol","status":"local","text":"media receiver","type":"dfn","url":"#media-receiver"},
"#media-sender": {"export":true,"for_":[],"level":"","normative":true,"shortname":"openscreenprotocol","spec":"openscreenprotocol","status":"local","text":"media sender","type":"dfn","url":"#media-sender"},
"#open-screen-protocol-agent": {"export":true,"for_":[],"level":"","normative":true,"shortname":"openscreenprotocol","spec":"openscreenprotocol","status":"local","text":"open screen protocol agent","type":"dfn","url":"#open-screen-protocol-agent"},
"#presentation-change-event": {"export":true,"for_":[],"level":"","normative":true,"shortname":"openscreenprotocol","spec":"openscreenprotocol","status":"local","text":"presentation-change-event","type":"dfn","url":"#presentation-change-event"},
"#presentation-connection-close-event": {"export":true,"for_":[],"level":"","normative":true,"shortname":"openscreenprotocol","spec":"openscreenprotocol","status":"local","text":"presentation-connection-close-event","type":"dfn","url":"#presentation-connection-close-event"},
"#presentation-connection-message": {"export":true,"for_":[],"level":"","normative":true,"shortname":"openscreenprotocol","spec":"openscreenprotocol","status":"local","text":"presentation-connection-message","type":"dfn","url":"#presentation-connection-message"},
"#presentation-connection-open-request": {"export":true,"for_":[],"level":"","normative":true,"shortname":"openscreenprotocol","spec":"openscreenprotocol","status":"local","text":"presentation-connection-open-request","type":"dfn","url":"#presentation-connection-open-request"},
"#presentation-connection-open-response": {"export":true,"for_":[],"level":"","normative":true,"shortname":"openscreenprotocol","spec":"openscreenprotocol","status":"local","text":"presentation-connection-open-response","type":"dfn","url":"#presentation-connection-open-response"},
"#presentation-start-request": {"export":true,"for_":[],"level":"","normative":true,"shortname":"openscreenprotocol","spec":"openscreenprotocol","status":"local","text":"presentation-start-request","type":"dfn","url":"#presentation-start-request"},
"#presentation-start-response": {"export":true,"for_":[],"level":"","normative":true,"shortname":"openscreenprotocol","spec":"openscreenprotocol","status":"local","text":"presentation-start-response","type":"dfn","url":"#presentation-start-response"},
"#presentation-termination-event": {"export":true,"for_":[],"level":"","normative":true,"shortname":"openscreenprotocol","spec":"openscreenprotocol","status":"local","text":"presentation-termination-event","type":"dfn","url":"#presentation-termination-event"},
"#presentation-termination-request": {"export":true,"for_":[],"level":"","normative":true,"shortname":"openscreenprotocol","spec":"openscreenprotocol","status":"local","text":"presentation-termination-request","type":"dfn","url":"#presentation-termination-request"},
"#presentation-termination-response": {"export":true,"for_":[],"level":"","normative":true,"shortname":"openscreenprotocol","spec":"openscreenprotocol","status":"local","text":"presentation-termination-response","type":"dfn","url":"#presentation-termination-response"},
"#presentation-url-availability-event": {"export":true,"for_":[],"level":"","normative":true,"shortname":"openscreenprotocol","spec":"openscreenprotocol","status":"local","text":"presentation-url-availability-event","type":"dfn","url":"#presentation-url-availability-event"},
"#presentation-url-availability-request": {"export":true,"for_":[],"level":"","normative":true,"shortname":"openscreenprotocol","spec":"openscreenprotocol","status":"local","text":"presentation-url-availability-request","type":"dfn","url":"#presentation-url-availability-request"},
"#presentation-url-availability-response": {"export":true,"for_":[],"level":"","normative":true,"shortname":"openscreenprotocol","spec":"openscreenprotocol","status":"local","text":"presentation-url-availability-response","type":"dfn","url":"#presentation-url-availability-response"},
"#receiver": {"export":true,"for_":[],"level":"","normative":true,"shortname":"openscreenprotocol","spec":"openscreenprotocol","status":"local","text":"receiver","type":"dfn","url":"#receiver"},
"#remote-playback-availability-event": {"export":true,"for_":[],"level":"","normative":true,"shortname":"openscreenprotocol","spec":"openscreenprotocol","status":"local","text":"remote-playback-availability-event","type":"dfn","url":"#remote-playback-availability-event"},
"#remote-playback-availability-request": {"export":true,"for_":[],"level":"","normative":true,"shortname":"openscreenprotocol","spec":"openscreenprotocol","status":"local","text":"remote-playback-availability-request","type":"dfn","url":"#remote-playback-availability-request"},
"#remote-playback-availability-response": {"export":true,"for_":[],"level":"","normative":true,"shortname":"openscreenprotocol","spec":"openscreenprotocol","status":"local","text":"remote-playback-availability-response","type":"dfn","url":"#remote-playback-availability-response"},
"#remote-playback-modify-request": {"export":true,"for_":[],"level":"","normative":true,"shortname":"openscreenprotocol","spec":"openscreenprotocol","status":"local","text":"remote-playback-modify-request","type":"dfn","url":"#remote-playback-modify-request"},
"#remote-playback-modify-response": {"export":true,"for_":[],"level":"","normative":true,"shortname":"openscreenprotocol","spec":"openscreenprotocol","status":"local","text":"remote-playback-modify-response","type":"dfn","url":"#remote-playback-modify-response"},
"#remote-playback-start-request": {"export":true,"for_":[],"level":"","normative":true,"shortname":"openscreenprotocol","spec":"openscreenprotocol","status":"local","text":"remote-playback-start-request","type":"dfn","url":"#remote-playback-start-request"},
"#remote-playback-start-response": {"export":true,"for_":[],"level":"","normative":true,"shortname":"openscreenprotocol","spec":"openscreenprotocol","status":"local","text":"remote-playback-start-response","type":"dfn","url":"#remote-playback-start-response"},
"#remote-playback-state-event": {"export":true,"for_":[],"level":"","normative":true,"shortname":"openscreenprotocol","spec":"openscreenprotocol","status":"local","text":"remote-playback-state-event","type":"dfn","url":"#remote-playback-state-event"},
"#remote-playback-termination-event": {"export":true,"for_":[],"level":"","normative":true,"shortname":"openscreenprotocol","spec":"openscreenprotocol","status":"local","text":"remote-playback-termination-event","type":"dfn","url":"#remote-playback-termination-event"},
"#remote-playback-termination-request": {"export":true,"for_":[],"level":"","normative":true,"shortname":"openscreenprotocol","spec":"openscreenprotocol","status":"local","text":"remote-playback-termination-request","type":"dfn","url":"#remote-playback-termination-request"},
"#remote-playback-termination-response": {"export":true,"for_":[],"level":"","normative":true,"shortname":"openscreenprotocol","spec":"openscreenprotocol","status":"local","text":"remote-playback-termination-response","type":"dfn","url":"#remote-playback-termination-response"},
"#streaming-capabilities-request": {"export":true,"for_":[],"level":"","normative":true,"shortname":"openscreenprotocol","spec":"openscreenprotocol","status":"local","text":"streaming-capabilities-request","type":"dfn","url":"#streaming-capabilities-request"},
"#streaming-capabilities-response": {"export":true,"for_":[],"level":"","normative":true,"shortname":"openscreenprotocol","spec":"openscreenprotocol","status":"local","text":"streaming-capabilities-response","type":"dfn","url":"#streaming-capabilities-response"},
"#streaming-session-modify-request": {"export":true,"for_":[],"level":"","normative":true,"shortname":"openscreenprotocol","spec":"openscreenprotocol","status":"local","text":"streaming-session-modify-request","type":"dfn","url":"#streaming-session-modify-request"},
"#streaming-session-modify-response": {"export":true,"for_":[],"level":"","normative":true,"shortname":"openscreenprotocol","spec":"openscreenprotocol","status":"local","text":"streaming-session-modify-response","type":"dfn","url":"#streaming-session-modify-response"},
"#streaming-session-receiver-stats-event": {"export":true,"for_":[],"level":"","normative":true,"shortname":"openscreenprotocol","spec":"openscreenprotocol","status":"local","text":"streaming-session-receiver-stats-event","type":"dfn","url":"#streaming-session-receiver-stats-event"},
"#streaming-session-sender-stats-event": {"export":true,"for_":[],"level":"","normative":true,"shortname":"openscreenprotocol","spec":"openscreenprotocol","status":"local","text":"streaming-session-sender-stats-event","type":"dfn","url":"#streaming-session-sender-stats-event"},
"#streaming-session-start-request": {"export":true,"for_":[],"level":"","normative":true,"shortname":"openscreenprotocol","spec":"openscreenprotocol","status":"local","text":"streaming-session-start-request","type":"dfn","url":"#streaming-session-start-request"},
"#streaming-session-start-response": {"export":true,"for_":[],"level":"","normative":true,"shortname":"openscreenprotocol","spec":"openscreenprotocol","status":"local","text":"streaming-session-start-response","type":"dfn","url":"#streaming-session-start-response"},
"#streaming-session-terminate-event": {"export":true,"for_":[],"level":"","normative":true,"shortname":"openscreenprotocol","spec":"openscreenprotocol","status":"local","text":"streaming-session-terminate-event","type":"dfn","url":"#streaming-session-terminate-event"},
"#streaming-session-terminate-request": {"export":true,"for_":[],"level":"","normative":true,"shortname":"openscreenprotocol","spec":"openscreenprotocol","status":"local","text":"streaming-session-terminate-request","type":"dfn","url":"#streaming-session-terminate-request"},
"#streaming-session-terminate-response": {"export":true,"for_":[],"level":"","normative":true,"shortname":"openscreenprotocol","spec":"openscreenprotocol","status":"local","text":"streaming-session-terminate-response","type":"dfn","url":"#streaming-session-terminate-response"},
"#suspicious-agent": {"export":true,"for_":[],"level":"","normative":true,"shortname":"openscreenprotocol","spec":"openscreenprotocol","status":"local","text":"suspicious agent","type":"dfn","url":"#suspicious-agent"},
"#text-track-cue": {"export":true,"for_":[],"level":"","normative":true,"shortname":"openscreenprotocol","spec":"openscreenprotocol","status":"local","text":"text-track-cue","type":"dfn","url":"#text-track-cue"},
"#time-scale": {"export":true,"for_":[],"level":"","normative":true,"shortname":"openscreenprotocol","spec":"openscreenprotocol","status":"local","text":"time scale","type":"dfn","url":"#time-scale"},
"#verified-display-name": {"export":true,"for_":[],"level":"","normative":true,"shortname":"openscreenprotocol","spec":"openscreenprotocol","status":"local","text":"verified display name","type":"dfn","url":"#verified-display-name"},
"#video-encoding-offer": {"export":true,"for_":[],"level":"","normative":true,"shortname":"openscreenprotocol","spec":"openscreenprotocol","status":"local","text":"video-encoding-offer","type":"dfn","url":"#video-encoding-offer"},
"#video-frame": {"export":true,"for_":[],"level":"","normative":true,"shortname":"openscreenprotocol","spec":"openscreenprotocol","status":"local","text":"video-frame","type":"dfn","url":"#video-frame"},
"https://datatracker.ietf.org/doc/html/rfc8446#section-4.2.3": {"export":true,"for_":[],"level":"","normative":true,"shortname":"rfc8446","spec":"rfc8446","status":"anchor-block","text":"signature scheme","type":"dfn","url":"https://datatracker.ietf.org/doc/html/rfc8446#section-4.2.3"},
"https://datatracker.ietf.org/doc/html/rfc9000#name-connection_close-frames": {"export":true,"for_":[],"level":"","normative":true,"shortname":"rfc9000","spec":"rfc9000","status":"anchor-block","text":"connection_close frames","type":"dfn","url":"https://datatracker.ietf.org/doc/html/rfc9000#name-connection_close-frames"},
"https://datatracker.ietf.org/doc/html/rfc9000#name-transport-parameter-encodin": {"export":true,"for_":[],"level":"","normative":true,"shortname":"rfc9000","spec":"rfc9000","status":"anchor-block","text":"transport parameter encoding","type":"dfn","url":"https://datatracker.ietf.org/doc/html/rfc9000#name-transport-parameter-encodin"},
"https://datatracker.ietf.org/doc/html/rfc9000#name-variable-length-integer-enc": {"export":true,"for_":[],"level":"","normative":true,"shortname":"rfc9000","spec":"rfc9000","status":"anchor-block","text":"variable-length integer","type":"dfn","url":"https://datatracker.ietf.org/doc/html/rfc9000#name-variable-length-integer-enc"},
"https://html.spec.whatwg.org/multipage/embedded-content.html#attr-source-src": {"export":true,"for_":["source"],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"src","type":"element-attr","url":"https://html.spec.whatwg.org/multipage/embedded-content.html#attr-source-src"},
"https://html.spec.whatwg.org/multipage/embedded-content.html#attr-source-type": {"export":true,"for_":["source"],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"type","type":"element-attr","url":"https://html.spec.whatwg.org/multipage/embedded-content.html#attr-source-type"},
"https://html.spec.whatwg.org/multipage/media.html#concept-mediaerror-code": {"export":true,"for_":[],"level":"","normative":true,"shortname":"html","spec":"html","status":"anchor-block","text":"media error code","type":"dfn","url":"https://html.spec.whatwg.org/multipage/media.html#concept-mediaerror-code"},
"https://html.spec.whatwg.org/multipage/media.html#dom-media-addtexttrack": {"export":true,"for_":["HTMLMediaElement"],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"addTextTrack(kind, label, language)","type":"method","url":"https://html.spec.whatwg.org/multipage/media.html#dom-media-addtexttrack"},
"https://html.spec.whatwg.org/multipage/media.html#dom-media-audiotracks": {"export":true,"for_":["HTMLMediaElement"],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"audioTracks","type":"attribute","url":"https://html.spec.whatwg.org/multipage/media.html#dom-media-audiotracks"},
"https://html.spec.whatwg.org/multipage/media.html#dom-media-buffered": {"export":true,"for_":["HTMLMediaElement"],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"buffered","type":"attribute","url":"https://html.spec.whatwg.org/multipage/media.html#dom-media-buffered"},
"https://html.spec.whatwg.org/multipage/media.html#dom-media-currentsrc": {"export":true,"for_":["HTMLMediaElement"],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"currentSrc","type":"attribute","url":"https://html.spec.whatwg.org/multipage/media.html#dom-media-currentsrc"},
"https://html.spec.whatwg.org/multipage/media.html#dom-media-currenttime": {"export":true,"for_":["HTMLMediaElement"],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"currentTime","type":"attribute","url":"https://html.spec.whatwg.org/multipage/media.html#dom-media-currenttime"},
"https://html.spec.whatwg.org/multipage/media.html#dom-media-duration": {"export":true,"for_":["HTMLMediaElement"],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"duration","type":"attribute","url":"https://html.spec.whatwg.org/multipage/media.html#dom-media-duration"},
"https://html.spec.whatwg.org/multipage/media.html#dom-media-ended": {"export":true,"for_":["HTMLMediaElement"],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"ended","type":"attribute","url":"https://html.spec.whatwg.org/multipage/media.html#dom-media-ended"},
"https://html.spec.whatwg.org/multipage/media.html#dom-media-error": {"export":true,"for_":["HTMLMediaElement"],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"error","type":"attribute","url":"https://html.spec.whatwg.org/multipage/media.html#dom-media-error"},
"https://html.spec.whatwg.org/multipage/media.html#dom-media-fastseek": {"export":true,"for_":["HTMLMediaElement"],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"fastSeek(time)","type":"method","url":"https://html.spec.whatwg.org/multipage/media.html#dom-media-fastseek"},
"https://html.spec.whatwg.org/multipage/media.html#dom-media-getstartdate": {"export":true,"for_":["HTMLMediaElement"],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"getStartDate()","type":"method","url":"https://html.spec.whatwg.org/multipage/media.html#dom-media-getstartdate"},
"https://html.spec.whatwg.org/multipage/media.html#dom-media-have_nothing": {"export":true,"for_":["HTMLMediaElement"],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"HAVE_NOTHING","type":"const","url":"https://html.spec.whatwg.org/multipage/media.html#dom-media-have_nothing"},
"https://html.spec.whatwg.org/multipage/media.html#dom-media-loop": {"export":true,"for_":["HTMLMediaElement"],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"loop","type":"attribute","url":"https://html.spec.whatwg.org/multipage/media.html#dom-media-loop"},
"https://html.spec.whatwg.org/multipage/media.html#dom-media-muted": {"export":true,"for_":["HTMLMediaElement"],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"muted","type":"attribute","url":"https://html.spec.whatwg.org/multipage/media.html#dom-media-muted"},
"https://html.spec.whatwg.org/multipage/media.html#dom-media-network_empty": {"export":true,"for_":["HTMLMediaElement"],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"NETWORK_EMPTY","type":"const","url":"https://html.spec.whatwg.org/multipage/media.html#dom-media-network_empty"},
"https://html.spec.whatwg.org/multipage/media.html#dom-media-networkstate": {"export":true,"for_":["HTMLMediaElement"],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"networkState","type":"attribute","url":"https://html.spec.whatwg.org/multipage/media.html#dom-media-networkstate"},
"https://html.spec.whatwg.org/multipage/media.html#dom-media-pause": {"export":true,"for_":["HTMLMediaElement"],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"pause()","type":"method","url":"https://html.spec.whatwg.org/multipage/media.html#dom-media-pause"},
"https://html.spec.whatwg.org/multipage/media.html#dom-media-paused": {"export":true,"for_":["HTMLMediaElement"],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"paused","type":"attribute","url":"https://html.spec.whatwg.org/multipage/media.html#dom-media-paused"},
"https://html.spec.whatwg.org/multipage/media.html#dom-media-play": {"export":true,"for_":["HTMLMediaElement"],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"play()","type":"method","url":"https://html.spec.whatwg.org/multipage/media.html#dom-media-play"},
"https://html.spec.whatwg.org/multipage/media.html#dom-media-playbackrate": {"export":true,"for_":["HTMLMediaElement"],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"playbackRate","type":"attribute","url":"https://html.spec.whatwg.org/multipage/media.html#dom-media-playbackrate"},
"https://html.spec.whatwg.org/multipage/media.html#dom-media-played": {"export":true,"for_":["HTMLMediaElement"],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"played","type":"attribute","url":"https://html.spec.whatwg.org/multipage/media.html#dom-media-played"},
"https://html.spec.whatwg.org/multipage/media.html#dom-media-preload": {"export":true,"for_":["HTMLMediaElement"],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"preload","type":"attribute","url":"https://html.spec.whatwg.org/multipage/media.html#dom-media-preload"},
"https://html.spec.whatwg.org/multipage/media.html#dom-media-readystate": {"export":true,"for_":["HTMLMediaElement"],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"readyState","type":"attribute","url":"https://html.spec.whatwg.org/multipage/media.html#dom-media-readystate"},
"https://html.spec.whatwg.org/multipage/media.html#dom-media-seekable": {"export":true,"for_":["HTMLMediaElement"],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"seekable","type":"attribute","url":"https://html.spec.whatwg.org/multipage/media.html#dom-media-seekable"},
"https://html.spec.whatwg.org/multipage/media.html#dom-media-seeking": {"export":true,"for_":["HTMLMediaElement"],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"seeking","type":"attribute","url":"https://html.spec.whatwg.org/multipage/media.html#dom-media-seeking"},
"https://html.spec.whatwg.org/multipage/media.html#dom-media-src": {"export":true,"for_":["HTMLMediaElement"],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"src","type":"attribute","url":"https://html.spec.whatwg.org/multipage/media.html#dom-media-src"},
"https://html.spec.whatwg.org/multipage/media.html#dom-media-texttracks": {"export":true,"for_":["HTMLMediaElement"],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"textTracks","type":"attribute","url":"https://html.spec.whatwg.org/multipage/media.html#dom-media-texttracks"},
"https://html.spec.whatwg.org/multipage/media.html#dom-media-videotracks": {"export":true,"for_":["HTMLMediaElement"],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"videoTracks","type":"attribute","url":"https://html.spec.whatwg.org/multipage/media.html#dom-media-videotracks"},
"https://html.spec.whatwg.org/multipage/media.html#dom-media-volume": {"export":true,"for_":["HTMLMediaElement"],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"volume","type":"attribute","url":"https://html.spec.whatwg.org/multipage/media.html#dom-media-volume"},
"https://html.spec.whatwg.org/multipage/media.html#dom-video-videoheight": {"export":true,"for_":["HTMLVideoElement"],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"videoHeight","type":"attribute","url":"https://html.spec.whatwg.org/multipage/media.html#dom-video-videoheight"},
"https://html.spec.whatwg.org/multipage/media.html#dom-video-videowidth": {"export":true,"for_":["HTMLVideoElement"],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"videoWidth","type":"attribute","url":"https://html.spec.whatwg.org/multipage/media.html#dom-video-videowidth"},
"https://html.spec.whatwg.org/multipage/media.html#event-media-stalled": {"export":true,"for_":["HTMLMediaElement"],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"stalled","type":"event","url":"https://html.spec.whatwg.org/multipage/media.html#event-media-stalled"},
"https://html.spec.whatwg.org/multipage/media.html#event-media-timeupdate": {"export":true,"for_":["HTMLMediaElement"],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"timeupdate","type":"event","url":"https://html.spec.whatwg.org/multipage/media.html#event-media-timeupdate"},
"https://html.spec.whatwg.org/multipage/media.html#htmlmediaelement": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"HTMLMediaElement","type":"interface","url":"https://html.spec.whatwg.org/multipage/media.html#htmlmediaelement"},
"https://html.spec.whatwg.org/multipage/media.html#media-element": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"media element","type":"dfn","url":"https://html.spec.whatwg.org/multipage/media.html#media-element"},
"https://html.spec.whatwg.org/multipage/media.html#media-resource": {"export":true,"for_":[],"level":"","normative":true,"shortname":"html","spec":"html","status":"anchor-block","text":"media resource","type":"dfn","url":"https://html.spec.whatwg.org/multipage/media.html#media-resource"},
"https://html.spec.whatwg.org/multipage/media.html#media-timeline": {"export":true,"for_":[],"level":"","normative":true,"shortname":"html","spec":"html","status":"anchor-block","text":"media timeline","type":"dfn","url":"https://html.spec.whatwg.org/multipage/media.html#media-timeline"},
"https://html.spec.whatwg.org/multipage/media.html#official-playback-position": {"export":true,"for_":[],"level":"","normative":true,"shortname":"html","spec":"html","status":"anchor-block","text":"official playback position","type":"dfn","url":"https://html.spec.whatwg.org/multipage/media.html#official-playback-position"},
"https://html.spec.whatwg.org/multipage/media.html#poster-frame": {"export":true,"for_":[],"level":"","normative":true,"shortname":"html","spec":"html","status":"anchor-block","text":"poster frame","type":"dfn","url":"https://html.spec.whatwg.org/multipage/media.html#poster-frame"},
"https://html.spec.whatwg.org/multipage/media.html#timeline-offset": {"export":true,"for_":[],"level":"","normative":true,"shortname":"html","spec":"html","status":"anchor-block","text":"timeline offset","type":"dfn","url":"https://html.spec.whatwg.org/multipage/media.html#timeline-offset"},
"https://html.spec.whatwg.org/multipage/web-messaging.html#dom-window-postmessage": {"export":true,"for_":["Window"],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"postMessage(message, targetOrigin, transfer)","type":"method","url":"https://html.spec.whatwg.org/multipage/web-messaging.html#dom-window-postmessage"},
"https://tools.ietf.org/html/rfc4122#section-4.4": {"export":true,"for_":[],"level":"","normative":true,"shortname":"rfc4122","spec":"rfc4122","status":"anchor-block","text":"uuid","type":"dfn","url":"https://tools.ietf.org/html/rfc4122#section-4.4"},
"https://tools.ietf.org/html/rfc5280#section-4.2.1.3": {"export":true,"for_":[],"level":"","normative":true,"shortname":"rfc5280","spec":"rfc5280","status":"anchor-block","text":"digitalsignature","type":"dfn","url":"https://tools.ietf.org/html/rfc5280#section-4.2.1.3"},
"https://tools.ietf.org/html/rfc5646#section-2": {"export":true,"for_":[],"level":"","normative":true,"shortname":"rfc5646","spec":"rfc5646","status":"anchor-block","text":"language tag","type":"dfn","url":"https://tools.ietf.org/html/rfc5646#section-2"},
"https://tools.ietf.org/html/rfc6381#section-3": {"export":true,"for_":[],"level":"","normative":true,"shortname":"rfc6381","spec":"rfc6381","status":"anchor-block","text":"codecs parameter","type":"dfn","url":"https://tools.ietf.org/html/rfc6381#section-3"},
"https://tools.ietf.org/html/rfc6762#section-9": {"export":true,"for_":[],"level":"","normative":true,"shortname":"rfc6762","spec":"rfc6762","status":"anchor-block","text":"conflict resolution","type":"dfn","url":"https://tools.ietf.org/html/rfc6762#section-9"},
"https://tools.ietf.org/html/rfc6763#section-4.1.1": {"export":true,"for_":[],"level":"","normative":true,"shortname":"rfc6763","spec":"rfc6763","status":"anchor-block","text":"instance name","type":"dfn","url":"https://tools.ietf.org/html/rfc6763#section-4.1.1"},
"https://tools.ietf.org/html/rfc6763#section-7": {"export":true,"for_":[],"level":"","normative":true,"shortname":"rfc6763","spec":"rfc6763","status":"anchor-block","text":"service name","type":"dfn","url":"https://tools.ietf.org/html/rfc6763#section-7"},
"https://tools.ietf.org/html/rfc8610#section-3": {"export":true,"for_":[],"level":"","normative":true,"shortname":"rfc8610","spec":"rfc8610","status":"anchor-block","text":"concise data definition language","type":"dfn","url":"https://tools.ietf.org/html/rfc8610#section-3"},
"https://w3c.github.io/presentation-api/#dom-presentationconnection": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"presentation-api","spec":"presentation-api","status":"current","text":"PresentationConnection","type":"interface","url":"https://w3c.github.io/presentation-api/#dom-presentationconnection"},
"https://w3c.github.io/remote-playback/#dfn-availability-sources-set": {"export":true,"for_":[],"level":"","normative":true,"shortname":"remote-playback","spec":"remote-playback","status":"anchor-block","text":"availability sources set","type":"dfn","url":"https://w3c.github.io/remote-playback/#dfn-availability-sources-set"},
"https://w3c.github.io/remote-playback/#dfn-compatible-remote-playback-device": {"export":true,"for_":[],"level":"","normative":true,"shortname":"remote-playback","spec":"remote-playback","status":"anchor-block","text":"compatible remote playback device","type":"dfn","url":"https://w3c.github.io/remote-playback/#dfn-compatible-remote-playback-device"},
"https://w3c.github.io/remote-playback/#dfn-initiate-remote-playback": {"export":true,"for_":[],"level":"","normative":true,"shortname":"remote-playback","spec":"remote-playback","status":"anchor-block","text":"initiate remote playback","type":"dfn","url":"https://w3c.github.io/remote-playback/#dfn-initiate-remote-playback"},
"https://w3c.github.io/remote-playback/#dfn-media-element-state": {"export":true,"for_":[],"level":"","normative":true,"shortname":"remote-playback","spec":"remote-playback","status":"anchor-block","text":"media element state","type":"dfn","url":"https://w3c.github.io/remote-playback/#dfn-media-element-state"},
"https://w3c.github.io/remote-playback/#dfn-remote-playback-devices": {"export":true,"for_":[],"level":"","normative":true,"shortname":"remote-playback","spec":"remote-playback","status":"anchor-block","text":"remote playback devices","type":"dfn","url":"https://w3c.github.io/remote-playback/#dfn-remote-playback-devices"},
"https://w3c.github.io/remote-playback/#dfn-remote-playback-source": {"export":true,"for_":[],"level":"","normative":true,"shortname":"remote-playback","spec":"remote-playback","status":"anchor-block","text":"remote playback source","type":"dfn","url":"https://w3c.github.io/remote-playback/#dfn-remote-playback-source"},
"https://www.iso.org/standard/62021.html#": {"export":true,"for_":[],"level":"","normative":true,"shortname":"iso18004","spec":"iso18004","status":"anchor-block","text":"qr code","type":"dfn","url":"https://www.iso.org/standard/62021.html#"},
"https://www.w3.org/TR/presentation-api/#dfn-available-presentation-display": {"export":true,"for_":[],"level":"","normative":true,"shortname":"presentation-api","spec":"presentation-api","status":"anchor-block","text":"available presentation display","type":"dfn","url":"https://www.w3.org/TR/presentation-api/#dfn-available-presentation-display"},
"https://www.w3.org/TR/presentation-api/#dfn-controlling-user-agent": {"export":true,"for_":[],"level":"","normative":true,"shortname":"presentation-api","spec":"presentation-api","status":"anchor-block","text":"controlling user agent","type":"dfn","url":"https://www.w3.org/TR/presentation-api/#dfn-controlling-user-agent"},
"https://www.w3.org/TR/presentation-api/#dfn-presentation-identifier": {"export":true,"for_":[],"level":"","normative":true,"shortname":"presentation-api","spec":"presentation-api","status":"anchor-block","text":"presentation identifier","type":"dfn","url":"https://www.w3.org/TR/presentation-api/#dfn-presentation-identifier"},
"https://www.w3.org/TR/presentation-api/#dfn-presentation-request-url": {"export":true,"for_":[],"level":"","normative":true,"shortname":"presentation-api","spec":"presentation-api","status":"anchor-block","text":"presentation request url","type":"dfn","url":"https://www.w3.org/TR/presentation-api/#dfn-presentation-request-url"},
"https://www.w3.org/TR/presentation-api/#dfn-receiving-browsing-context": {"export":true,"for_":[],"level":"","normative":true,"shortname":"presentation-api","spec":"presentation-api","status":"anchor-block","text":"presentation","type":"dfn","url":"https://www.w3.org/TR/presentation-api/#dfn-receiving-browsing-context"},
"https://www.w3.org/TR/presentation-api/#dfn-receiving-user-agent": {"export":true,"for_":[],"level":"","normative":true,"shortname":"presentation-api","spec":"presentation-api","status":"anchor-block","text":"receiving user agent","type":"dfn","url":"https://www.w3.org/TR/presentation-api/#dfn-receiving-user-agent"},
};

function mkRefHint(link, ref) {
    const linkText = link.textContent;
    let dfnTextElements = '';
    if (ref.text != linkText) {
        dfnTextElements =
            mk.li({},
                mk.b({}, "Term: "),
                mk.span({}, ref.text)
            );
    }
    const forList = ref.for_;
    let forListElements;
    if(forList.length == 0) {
        forListElements = [];
    } else if(forList.length == 1) {
        forListElements = mk.li({},
            mk.b({}, "For: "),
            mk.span({}, forList[0]),
        );
    } else {
        forListElements = mk.li({},
            mk.b({}, "For: "),
            mk.ul({},
                ...forList.map(forItem =>
                    mk.li({},
                        mk.span({}, forItem)
                    ),
                ),
            ),
        );
    }
    const url = ref.url;
    const safeUrl = encodeURIComponent(url);
    const hintPanel = mk.aside({
        class: "ref-hint",
        id: `ref-hint-for-${safeUrl}`,
        "data-for": url,
        "aria-labelled-by": `ref-hint-for-${safeUrl}`,
    },
        mk.ul({},
            dfnTextElements,
            mk.li({},
                mk.b({}, "URL: "),
                mk.a({ href: url, class: "ref" }, url),
            ),
            mk.li({},
                mk.b({}, "Type: "),
                mk.span({}, `${ref.type}`),
            ),
            mk.li({},
                mk.b({}, "Spec: "),
                mk.span({}, `${ref.spec ? ref.spec : ''}`),
            ),
            forListElements
        ),
    );
    hintPanel.forLink = link;
    setupRefHintEventListeners(link, hintPanel);
    return hintPanel;
}

function hideAllRefHints() {
    queryAll(".ref-hint").forEach(el=>hideRefHint(el));
}

function hideRefHint(refHint) {
    const link = refHint.forLink;
    link.setAttribute("aria-expanded", "false");
    if(refHint.teardownEventListeners) {
        refHint.teardownEventListeners();
    }
    refHint.remove();
}

function showRefHint(link) {
    if(link.classList.contains("dfn-link")) return;
    const url = link.getAttribute("href");
    const ref = refsData[url];
    if(!ref) return;

    hideAllRefHints(); // Only display one at this time.

    const refHint = mkRefHint(link, ref);
    append(document.body, refHint);
    link.setAttribute("aria-expanded", "true");
    positionRefHint(refHint);
}

function setupRefHintEventListeners(link, refHint) {
    if (refHint.teardownEventListeners) return;
    // Add event handlers to hide the refHint after the user moves away
    // from both the link and refHint, if not hovering either within one second.
    let timeout = null;
    const startHidingRefHint = (event) => {
        if (timeout) {
            clearTimeout(timeout);
        }
        timeout = setTimeout(() => {
            hideRefHint(refHint);
        }, 1000);
    }
    const resetHidingRefHint = (event) => {
        if (timeout) clearTimeout(timeout);
        timeout = null;
    };
    link.addEventListener("mouseleave", startHidingRefHint);
    link.addEventListener("mouseenter", resetHidingRefHint);
    link.addEventListener("blur", startHidingRefHint);
    link.addEventListener("focus", resetHidingRefHint);
    refHint.addEventListener("mouseleave", startHidingRefHint);
    refHint.addEventListener("mouseenter", resetHidingRefHint);
    refHint.addEventListener("blur", startHidingRefHint);
    refHint.addEventListener("focus", resetHidingRefHint);

    refHint.teardownEventListeners = () => {
        // remove event listeners
        resetHidingRefHint();
        link.removeEventListener("mouseleave", startHidingRefHint);
        link.removeEventListener("mouseenter", resetHidingRefHint);
        link.removeEventListener("blur", startHidingRefHint);
        link.removeEventListener("focus", resetHidingRefHint);
        refHint.removeEventListener("mouseleave", startHidingRefHint);
        refHint.removeEventListener("mouseenter", resetHidingRefHint);
        refHint.removeEventListener("blur", startHidingRefHint);
        refHint.removeEventListener("focus", resetHidingRefHint);
    };
}

function positionRefHint(refHint) {
    const link = refHint.forLink;
    const linkPos = getBounds(link);
    refHint.style.top = linkPos.bottom + "px";
    refHint.style.left = linkPos.left + "px";

    const panelPos = refHint.getBoundingClientRect();
    const panelMargin = 8;
    const maxRight = document.body.parentNode.clientWidth - panelMargin;
    if (panelPos.right > maxRight) {
        const overflowAmount = panelPos.right - maxRight;
        const newLeft = Math.max(panelMargin, linkPos.left - overflowAmount);
        refHint.style.left = newLeft + "px";
    }
}

// TODO: shared util
// Returns the root-level absolute position {left and top} of element.
function getBounds(el, relativeTo=document.body) {
    const relativeRect = relativeTo.getBoundingClientRect();
    const elRect = el.getBoundingClientRect();
    const top = elRect.top - relativeRect.top;
    const left = elRect.left - relativeRect.left;
    return {
        top,
        left,
        bottom: top + elRect.height,
        right: left + elRect.width,
    }
}

function showRefHintListener(e) {
    // If the target isn't in a link (or is a link),
    // just ignore it.
    let link = e.target.closest("a");
    if(!link) return;

    // If the target is in a ref-hint panel
    // (aka a link in the already-open one),
    // also just ignore it.
    if(link.closest(".ref-hint")) return;

    // Otherwise, show the panel for the link.
    showRefHint(link);
}

function hideAllHintsListener(e) {
    // If the click is inside a ref-hint panel, ignore it.
    if(e.target.closest(".ref-hint")) return;
    // Otherwise, close all the current panels.
    hideAllRefHints();
}

document.addEventListener("DOMContentLoaded", () => {
    document.body.addEventListener("mousedown", showRefHintListener);
    document.body.addEventListener("focus", showRefHintListener);

    document.body.addEventListener("click", hideAllHintsListener);
});

window.addEventListener("resize", () => {
    // Hide any open ref hint.
    hideAllRefHints();
});
}
</script>